<html><head></head><body>
<div id="sbo-rt-content"><section data-nutshell-tab="Email, MIME, and Encodings" data-pdf-bookmark="Chapter 21. Email, MIME, and Other Network Encodings" data-type="chapter" epub:type="chapter"><div class="chapter" id="emailcomma_mimecomma_and_other_network">
<h1><span class="label">Chapter 21. </span>Email, MIME, and Other <span class="keep-together">Network Encodings</span></h1>
<p>What travels on a network are streams of bytes, also known in networking jargon as <em>octets.</em> Bytes can, of course, represent text, via any of several possible encodings. However, what you want to send over the network often has more structure than just a stream of text or bytes. The<a contenteditable="false" data-primary="Multipurpose Internet Mail Extensions (MIME)" data-type="indexterm" id="idm44924486055760"/><a contenteditable="false" data-primary="MIME (Multipurpose Internet Mail Extensions)" data-type="indexterm" id="idm44924486054784"/> Multipurpose Internet Mail Extensions (<a href="https://oreil.ly/dwyZi">MIME</a>) and other encoding standards bridge the gap, by specifying how to represent structured data as bytes or text. While often originally designed for email, such encodings are also used on the web and in many other networked systems. Python supports such encodings through various library modules, such as <span class="code">base64</span>, <span class="code">quopri</span>, and <span class="code">uu</span> (covered in <a data-type="xref" href="#encoding_binary_data_as_ascii_text">“Encoding Binary Data as ASCII Text”</a>), and the modules of the <span class="code">email</span> package (covered in the following section). These encodings allow us, for example, to seamlessly create messages in one encoding containing attachments in another, avoiding many awkward tasks along the way.</p>
<section data-pdf-bookmark="MIME and Email Format Handling" data-type="sect1"><div class="sect1" id="mime_and_email_format_handling">
<h1>MIME and Email Format Handling</h1>
<p>The<a contenteditable="false" data-primary="network encodings" data-secondary="MIME and email format handling" data-type="indexterm" id="NEmime21"/><a contenteditable="false" data-primary="email module" data-secondary="versus imaplib, poplib, and smtplib modules" data-secondary-sortas="imaplib, poplib, and smtplib modules" data-type="indexterm" id="idm44924486046048"/> <span class="code">email</span> package handles parsing, generation, and manipulation of MIME files such as email messages, Network News Transfer Protocol (NNTP)<a contenteditable="false" data-primary="Network News Transfer Protocol (NNTP)" data-type="indexterm" id="idm44924486043840"/><a contenteditable="false" data-primary="NNTP (Network News Transfer Protocol)" data-type="indexterm" id="idm44924486042864"/> posts, HTTP interactions, and so on. The Python standard library also contains other modules that handle some parts of these jobs. However, the <span class="code">email</span> package offers a complete and systematic approach to these important tasks. We suggest you use <span class="code">email</span>, not the older modules that partially overlap with parts of <span class="code">email</span>’s functionality. <span class="code">email</span>, despite its name, need have nothing to do with receiving or sending email; for such tasks, see the modules <span class="code">imaplib</span>, <span class="code">poplib</span>, and <span class="code">smtplib</span>, covered in <a data-type="xref" href="ch19.xhtml#email_protocols">“Email Protocols”</a>. Rather, <span class="code">email</span> deals with handling MIME messages (which may or may not be mail) after you receive them, or constructing them properly before you send them.</p>
<section data-pdf-bookmark="Functions in the email Package" data-type="sect2"><div class="sect2" id="functions_in_the_email_package">
<h2>Functions in the email Package</h2>
<p>The<a contenteditable="false" data-primary="email module" data-secondary="functions in" data-type="indexterm" id="idm44924486034032"/><a contenteditable="false" data-primary="standard library modules" data-secondary="email" data-type="indexterm" id="idm44924486032816"/> <span class="code">email</span> package supplies four factory functions that return an instance <span class="code"><em>m</em></span> of the class <span class="code">email.message.Message</span> from a string or file (see <a data-type="xref" href="#email_factory_functions_that_build_mess">Table 21-1</a>). These functions rely on the class <span class="code">email.parser.Parser</span>, but the factory functions are handier and simpler. Therefore, we do not cover the <span class="code">email.parser</span> module further in this book.</p>
<table class="border" id="email_factory_functions_that_build_mess">
<caption><span class="label">Table 21-1. </span><span class="code">email</span> factory functions that build message objects from strings or files</caption>
<tbody>
<tr>
<td><span class="code">m⁠e⁠s⁠s⁠a⁠g⁠e⁠_⁠f⁠r⁠o⁠m⁠_⁠b⁠i⁠n⁠a⁠r⁠y⁠_​f⁠i⁠l⁠e</span></td>
<td><span class="code">message_from_binary_file(<em>f</em>)</span><br/>
			Builds <span class="code"><em>m</em></span> by parsing the contents of binary file-like object <span class="code"><em>f</em></span>, which must be open for reading</td>
</tr>
<tr>
<td><span class="code">message_from_bytes</span></td>
<td><span class="code">message_from_bytes(<em>s</em>)</span><br/>
			Builds <span class="code"><em>m</em></span> by parsing bytestring <span class="code"><em>s</em></span></td>
</tr>
<tr>
<td><span class="code">message_from_file</span></td>
<td><span class="code">message_from_file(<em>f</em>)</span><br/>
			Builds <span class="code"><em>m</em></span> by parsing the contents of text file-like object <span class="code"><em>f</em></span>, which must be open for reading</td>
</tr>
<tr>
<td><span class="code">message_from_string</span></td>
<td><span class="code">message_from_string(<em>s</em>)</span><br/>
			Builds <span class="code"><em>m</em></span> by parsing string <span class="code"><em>s</em></span></td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="The email.message Module" data-type="sect2"><div class="sect2" id="the_emaildotmessage_module">
<h2>The email.message Module</h2>
<p>The<a contenteditable="false" data-primary="email module" data-secondary="email.message module" data-type="indexterm" id="EPmesmod21"/> <span class="code">email.message</span> module supplies the class <span class="code">Message</span>. All parts of the <span class="code">email</span> package make, modify, or use instances of <span class="code">Message</span>. An instance <span class="code"><em>m</em></span> of <span class="code">Message</span> models a MIME message, including<a contenteditable="false" data-primary="headers" data-type="indexterm" id="idm44924485998912"/><a contenteditable="false" data-primary="payload" data-type="indexterm" id="idm44924485997904"/> <em>headers</em> and a <em>payload</em> (data content). <span class="code"><em>m</em></span> is a mapping, with header names as keys, and header value strings as values.</p>
<p>To create an initially empty <span class="code"><em>m</em></span>, call <span class="code">Message</span> with no arguments. More often, you create <span class="code"><em>m</em></span> by parsing via one of the factory functions in <a data-type="xref" href="#email_factory_functions_that_build_mess">Table 21-1</a>, or other indirect means such as the classes covered in <a data-type="xref" href="#creating_messages">“Creating Messages”</a>. <span class="code"><em>m</em></span>’s payload can be a string, a single other instance of <span class="code">Message</span>, or a<a contenteditable="false" data-primary="multipart messages" data-type="indexterm" id="idm44924485988288"/> <em>multipart message</em> (a recursively nested list of other <span class="code">Message</span> instances).</p>
<p>You can set arbitrary headers on email messages you’re building. Several internet RFCs specify headers for a wide variety of purposes. The main applicable RFC is <a href="https://oreil.ly/xyfF_">RFC 2822</a>; you can find a summary of many other RFCs about headers in nonnormative <a href="https://oreil.ly/IpSCO">RFC 2076</a>.</p>
<p>To make <span class="code"><em>m</em></span> more convenient, its semantics as a mapping are different from those of a <span class="code">dict</span>. <span class="code"><em>m</em></span>’s keys are case insensitive. <span class="code"><em>m</em></span> keeps headers in the order in which you add them, and the methods <span class="code">keys</span>, <span class="code">values</span>, and <span class="code">items</span> return lists (not views!) of headers in that order. <span class="code"><em>m</em></span> can have more than one header named <span class="code"><em>key</em></span>: <span class="code"><em>m</em></span><span class="code">[<em>key</em>]</span> returns an arbitrary such header (or <span class="code"><strong>None</strong></span> when the header is missing), and <span class="code"><strong>del</strong></span> <span class="code"><em>m</em></span><span class="code">[<em>key</em>]</span> deletes all of them (it’s not an error if the header is missing).</p>
<p>To get a list of all headers with a certain name, call <span class="code"><em>m</em></span><span class="code">.get_all(<em>key</em>)</span>. <span class="code">len(<em>m</em>)</span> returns the total number of headers, counting duplicates, not just the number of distinct header names. When there is no header named <span class="code"><em>key</em></span><em>,</em> <span class="code"><em>m</em></span><span class="code">[<em>key</em>]</span> returns <span class="code"><strong>None</strong></span> and does not raise <span class="code">KeyError</span> (i.e., it behaves like <span class="code"><em>m</em></span><span class="code">.get(<em>key</em>))</span>: <span class="code"><strong>del</strong></span> <span class="code"><em>m</em></span><span class="code">[<em>key</em>]</span> does nothing in this case, and <span class="code"><em>m</em></span><span class="code">.get_all(<em>key</em>)</span> returns <span class="code"><strong>None</strong></span>. You can loop directly on <span class="code"><em>m</em></span>: it’s just like looping on <span class="code"><em>m</em></span><span class="code">.keys()</span> instead.</p>
<p>An instance <span class="code"><em>m</em></span> of <span class="code">Message</span> supplies various attributes and methods that deal with <span class="code"><em>m</em></span>’s headers and payload, listed in <a data-type="xref" href="#attributes_and_methods_of_an_instance_m">Table 21-2</a>.</p>
<table class="border" id="attributes_and_methods_of_an_instance_m">
<caption><span class="label">Table 21-2. </span>Attributes and methods of an instance <span class="code"><em>m</em></span> of <span class="code">Message</span></caption>
<tbody>
<tr>
<td class="width-15"><span class="code">add_header</span></td>
<td><span class="code"><em>m</em></span><span class="code">.add_header(_<em>name</em>,</span> <span class="code"><em>_value</em></span><span class="code">,</span> <span class="code"><em>**_params</em></span><span class="code">)</span><br/>
			Like <span class="code"><em>m</em></span><span class="code">[_<em>name</em>]=_<em>value</em></span>, but you can also supply header parameters as named arguments. For each named argument <span class="code"><em>pname</em>=<em>pvalue</em></span>, <span class="code">add_header</span> changes any underscores in <span class="code"><em>pname</em></span> to dashes, then appends to the header’s value a string of the form:<br/>
<span class="code">;</span> <span class="code"><em>pname</em>="<em>pvalue</em>"</span><br/>
			When <span class="code"><em>pvalue</em></span> is <span class="code"><strong>None</strong></span>, <span class="code">add_header</span> appends only a string of the form:<br/>
<span class="code">;</span> <span class="code"><em>pname</em></span><br/>
			When a parameter’s value contains non-ASCII characters, specify it as a tuple with three items, (<span class="code"><em>CHARSET</em></span><span class="code">,</span> <span class="code"><em>LANGUAGE</em></span><span class="code">,</span> <span class="code"><em>VALUE</em></span>). <span class="code"><em>CHARSET</em></span> names the encoding to use for the value. <span class="code"><em>LANGUAGE</em></span> is usually <span class="code"><strong>None</strong></span> or <span class="code">''</span> but can be set any language value per <a href="https://oreil.ly/FKtQA">RFC 2231</a>; <span class="code"><em>VALUE</em></span> is the string value containing non-ASCII characters.</td>
</tr>
<tr>
<td><span class="code">as_string</span></td>
<td><span class="code"><em>m</em></span><span class="code">.as_string(unixfrom=<strong>False</strong>)</span><br/>
			Returns the entire message as a string. When <span class="code">unixfrom</span> is true, also includes a first line, normally starting with <span class="code">'From '</span>, known as the <em>envelope header</em> of the message.</td>
</tr>
<tr>
<td><span class="code">attach</span></td>
<td><span class="code"><em>m</em></span><span class="code">.attach(<em>payload</em>)</span><br/>
			Adds <span class="code"><em>payload</em></span>, a message, to <span class="code"><em>m</em></span>’s payload. When <span class="code"><em>m</em></span>’s payload is <span class="code"><strong>None</strong></span>, <span class="code"><em>m</em></span>’s payload is now the single-item list <span class="code">[<em>payload</em>]</span>. When <span class="code"><em>m</em></span>’s payload is a list of messages, appends <span class="code"><em>payload</em></span> to the list. When <span class="code"><em>m</em></span>’s payload is anything else, <span class="code"><em>m</em></span><span class="code">.attach(<em>payload</em>)</span> raises <span class="code">MultipartConversionError</span>.</td>
</tr>
<tr>
<td><span class="code">epilogue</span></td>
<td>The attribute <span class="code"><em>m</em></span><span class="code">.epilogue</span> can be <span class="code"><strong>None</strong></span>, or a string that becomes part of the message’s string form after the last boundary line. Mail programs normally don’t display this text. <span class="code">epilogue</span> is a normal attribute of <span class="code"><em>m</em></span>: your program can access it when you’re handling any <span class="code"><em>m</em></span>, and bind it when you’re building or modifying <span class="code"><em>m</em></span>.</td>
</tr>
<tr>
<td><span class="code">get_all</span></td>
<td><span class="code"><em>m</em></span><span class="code">.get_all(<em>name</em>, default=<strong>None</strong>)</span><br/>
			Returns a list with all values of headers named <span class="code"><em>name</em></span> in the order in which the headers are added to <span class="code"><em>m</em></span>. When <span class="code"><em>m</em></span> has no header named <span class="code"><em>name</em></span>, <span class="code">get_all</span> returns <span class="code">default</span>.</td>
</tr>
<tr>
<td><span class="code">get_boundary</span></td>
<td><span class="code"><em>m</em></span><span class="code">.get_boundary(default=<strong>None</strong>)</span><br/>
			Returns the string value of the <span class="code">boundary</span> parameter of <span class="code"><em>m</em></span>’s Content-Type header. When <span class="code"><em>m</em></span> has no Content-Type header, or the header has no <span class="code">boundary</span> parameter, <span class="code">get_boundary</span> returns <span class="code">default</span>.</td>
</tr>
<tr>
<td><span class="code">get_charsets</span></td>
<td><span class="code"><em>m</em></span><span class="code">.get_charsets(default=<strong>None</strong>)</span><br/>
			Returns the list <span class="code"><em>L</em></span> of string values of parameter <span class="code">charset</span> of <span class="code"><em>m</em></span>’s Content-Type header. When <span class="code"><em>m</em></span> is multipart, <span class="code"><em>L</em></span> has one item per part; otherwise, <span class="code"><em>L</em></span> has length <span class="code">1</span>. For parts that have no Content-Type header, no <span class="code">charset</span> parameter, or a main type different from <span class="code">'text'</span>, the corresponding item in <span class="code"><em>L</em></span> is <span class="code">default</span>.</td>
</tr>
<tr>
<td><span class="code">g⁠e⁠t⁠_⁠c⁠o⁠n⁠t⁠e⁠n⁠t⁠_​m⁠a⁠i⁠n⁠t⁠y⁠p⁠e</span></td>
<td><span class="code"><em>m</em></span><span class="code">.get_content_maintype(default=<strong>None</strong>)</span><br/>
			Returns <span class="code"><em>m</em></span>’s main content type: a lowercase string <span class="code">'<em>maintype</em>'</span> taken from header Content-Type. For example, when Content-Type is <span class="code">'Text/Html'</span>, <span class="code">get_content_maintype</span> returns <span class="code">'text'</span>. When <span class="code"><em>m</em></span> has no Content-Type header, <span class="code keep-together">get_content_maintype</span> returns <span class="code">default</span>.</td>
</tr>
<tr>
<td><span class="code">g⁠e⁠t⁠_⁠c⁠o⁠n⁠t⁠e⁠n⁠t⁠_​s⁠u⁠b⁠t⁠y⁠p⁠e</span></td>
<td><span class="code"><em>m</em></span><span class="code">.get_content_subtype(default=<strong>None</strong>)</span><br/>
			Returns <span class="code"><em>m</em></span>’s content subtype: a lowercase string <span class="code">'<em>subtype</em>'</span> taken from header Content-Type. For example, when Content-Type is <span class="code">'Text/Html'</span>, <span class="code">get_content_subtype</span> returns <span class="code">'html'</span>. When <span class="code"><em>m</em></span> has no Content-Type header, <span class="code">get_content_subtype</span> returns <span class="code">default</span>.</td>
</tr>
<tr>
<td><span class="code">g⁠e⁠t⁠_⁠c⁠o⁠n⁠t⁠e⁠n⁠t⁠_​t⁠y⁠p⁠e</span></td>
<td><span class="code"><em>m</em></span><span class="code">.get_content_type(default=<strong>None</strong>)</span><br/>
			Returns <span class="code"><em>m</em></span>’s content type: a lowercase string <span class="code">'<em>maintype/subtype</em>'</span> taken from header Content-Type. For example, when Content-Type is <span class="code">'Text/Html'</span>, <span class="code">get_content_type</span> returns <span class="code">'text/html'</span>. When <span class="code"><em>m</em></span> has no Content-Type header, <span class="code keep-together">get_content_type</span> returns <span class="code">default</span>.</td>
</tr>
<tr>
<td><span class="code">get_filename</span></td>
<td><span class="code"><em>m</em></span><span class="code">.get_filename(default=<strong>None</strong>)</span><br/>
			Returns the string value of the <span class="code">filename</span> parameter of <span class="code"><em>m</em></span>’s Content-Disposition header. When <span class="code"><em>m</em></span> has no Content-Disposition header, or the header has no <span class="code">filename</span> parameter, <span class="code">get_filename</span> returns <span class="code">default</span>.</td>
</tr>
<tr>
<td><span class="code">get_param</span></td>
<td><span class="code"><em>m</em></span><span class="code">.get_param(<em>param</em>,</span> <span class="code"><em>d</em></span><span class="code">efault=<strong>None</strong>, header='Content-Type')</span><br/>
			Returns the string value of parameter <span class="code"><em>param</em></span> of <span class="code"><em>m</em></span>’s header <span class="code">header</span>. Returns <span class="code">''</span> for a parameter specified just by name (without a value). When <span class="code"><em>m</em></span> has no header <span class="code">header</span>, or the header has no parameter named <span class="code"><em>param</em></span>, <span class="code">get_param</span> returns <span class="code">default</span>.</td>
</tr>
<tr>
<td><span class="code">get_params</span></td>
<td><span class="code"><em>m</em></span><span class="code">.get_params(default=<strong>None</strong>, header='Content-Type')</span><br/>
			Returns the parameters of <span class="code"><em>m</em></span>’s header <span class="code">header</span>, a list of pairs of strings that give each parameter’s name and value. Uses <span class="code">''</span> as the value for parameters specified just by name (without a value). When <span class="code"><em>m</em></span> has no header <span class="code">header</span>, <span class="code">get_params</span> returns <span class="code">default</span>.</td>
</tr>
<tr>
<td><span class="code">get_payload</span></td>
<td><span class="code"><em>m</em></span><span class="code">.get_payload(i=<strong>None</strong>, decode=<strong>False</strong>)</span><br/>
			Returns <span class="code"><em>m</em></span>’s payload. When <span class="code"><em>m</em></span><span class="code">.is_multipart</span> is <span class="code"><strong>False</strong></span>, <span class="code">i</span> must be <span class="code"><strong>None</strong></span>, and <span class="code"><em>m</em></span><span class="code">.get_payload</span> returns <span class="code"><em>m</em></span>’s entire payload, a string or <span class="code">Message</span> instance. If <span class="code">decode</span> is true and the value of header Content-Transfer-Encoding is either <span class="code">'quoted-printable'</span> or <span class="code">'base64'</span>, <span class="code"><em>m</em></span><span class="code">.get_payload</span> also decodes the payload. If <span class="code">decode</span> is false, or header Content-Transfer-Encoding is missing or has other values, <span class="code"><em>m</em></span><span class="code">.get_payload</span> returns the payload unchanged.<br/>
			When <span class="code"><em>m</em></span><span class="code">.is_multipart</span> is <span class="code"><strong>True</strong></span>, <span class="code">decode</span> must be false. When <span class="code">i</span> is <span class="code"><strong>None</strong></span>, <span class="code"><em>m</em></span><span class="code">.get_payload</span> returns <span class="code"><em>m</em></span>’s payload as a list. Otherwise, <span class="code"><em>m</em></span><span class="code">.get_payload(<em>i</em>)</span> returns the <span class="code"><em>i</em></span>th item of the payload, or raises <span class="code">TypeError</span> if <span class="code"><em>i</em></span> <span class="code">&lt; 0</span> or <span class="code">i</span> is too large.</td>
</tr>
<tr>
<td><span class="code">get_unixfrom</span></td>
<td><span class="code"><em>m</em></span><span class="code">.get_unixfrom()</span><br/>
			Returns the envelope header string for <span class="code"><em>m</em></span>, or <span class="code"><strong>None</strong></span> when <span class="code"><em>m</em></span> has no envelope header.</td>
</tr>
<tr>
<td><span class="code">is_multipart</span></td>
<td><span class="code"><em>m</em></span><span class="code">.is_multipart()</span><br/>
			Returns <span class="code"><strong>True</strong></span> when <span class="code"><em>m</em></span>’s payload is a list; otherwise, returns <span class="code"><strong>False</strong></span>.</td>
</tr>
<tr>
<td><span class="code">preamble</span></td>
<td>Attribute <span class="code"><em>m</em></span><span class="code">.preamble</span> can be <span class="code"><strong>None</strong></span>, or a string that becomes part of the message’s string form before the first boundary line. A mail program shows this text only if it doesn’t support multipart messages, so you can use this attribute to alert the user that your message is multipart and a different mail program is needed to view it. <span class="code">preamble</span> is a normal attribute of <span class="code"><em>m</em></span>: your program can access it when you’re handling an <span class="code"><em>m</em></span> that is built by whatever means, and bind, rebind, or unbind it when you’re building or modifying <span class="code"><em>m</em></span>.</td>
</tr>
<tr>
<td><span class="code">set_boundary</span></td>
<td><span class="code"><em>m</em></span><span class="code">.set_boundary(<em>boundary</em>)</span><br/>
			Sets the <span class="code">boundary</span> parameter of <span class="code"><em>m</em></span>’s Content-Type header to <span class="code"><em>boundary</em></span><em>.</em> When <span class="code"><em>m</em></span> has no Content-Type header, raises <span class="code">HeaderParseError</span>.</td>
</tr>
<tr>
<td><span class="code">set_payload</span></td>
<td><span class="code"><em>m</em></span><span class="code">.set_payload(<em>payload</em>)</span><br/>
			Sets <span class="code"><em>m</em></span>’s payload to <span class="code"><em>payload</em></span>, which must be a string, or a list of <span class="code">Message</span> instances, as appropriate to <span class="code"><em>m</em></span>’s Content-Type.</td>
</tr>
<tr>
<td><span class="code">set_unixfrom</span></td>
<td><span class="code"><em>m</em></span><span class="code">.set_unixfrom(<em>unixfrom</em>)</span><br/>
			Sets the envelope header string for <span class="code"><em>m</em></span><em>.</em> <span class="code"><em>unixfrom</em></span> is the entire envelope header line, including the leading <span class="code">'From '</span> but <span class="code"><em>not</em></span> including the trailing <span class="code">'\n'</span>.</td>
</tr>
<tr>
<td><span class="code">walk</span></td>
<td><span class="code"><em>m</em></span><span class="code">.walk()</span><br/>
			Returns an iterator on all parts and subparts of <span class="code"><em>m</em></span> to walk the tree of parts, depth-first (see <a data-type="xref" href="ch03.xhtml#recursion">“Recursion”</a>).<a contenteditable="false" data-primary="" data-startref="EPmesmod21" data-type="indexterm" id="idm44924485724080"/></td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="The email.Generator Module" data-type="sect2"><div class="sect2" id="the_emaildotgenerator_module">
<h2>The email.Generator Module</h2>
<p>The<a contenteditable="false" data-primary="email module" data-secondary="email.Generator module" data-type="indexterm" id="idm44924485721312"/> <span class="code">email.Generator</span> module supplies the class <span class="code">Generator</span>, which you can use to generate the textual form of a message <span class="code"><em>m</em></span><em>.</em> <span class="code"><em>m</em></span><span class="code">.as_string()</span> and <span class="code">str(<em>m</em>)</span> may be enough, but <span class="code">Generator</span> gives more flexibility. Instantiate the <span class="code">Generator</span> class with a mandatory argument, <span class="code"><em>outfp</em></span>, and two optional arguments:</p>
<table class="border">
<tbody>
<tr>
<td class="width-15"><span class="code">Generator</span></td>
<td><span class="code"><strong>class</strong></span> <span class="code">Generator(<em>outfp</em>, mangle_from_=<strong>False</strong>, maxheaderlen=78)</span><br/>
<span class="code"><em>outfp</em></span> is a file or file-like object that supplies the method <span class="code">write</span>. When <span class="code">mangle_from_</span> is true, <span class="code"><em>g</em></span> prepends a greater-than sign (<span class="code">&gt;</span>) to any line in the payload that starts with <span class="code">'From '</span>, to make the message’s textual form easier to parse. <span class="code"><em>g</em></span> wraps each header line, at semicolons, into physical lines of no more than <span class="code">maxheaderlen</span> characters. To use <span class="code"><em>g</em></span>, call <span class="code"><em>g</em></span><span class="code">.flatten</span>; for example:
			<pre data-code-language="python" data-type="programlisting">
<em><code class="n">g</code></em><code class="o">.</code><code class="n">flatten</code><code class="p">(</code><em><code class="n">m</code></em><code class="p">,</code><code> </code><code class="n">unixfrom</code><code class="o">=</code><strong><code class="kc">False</code></strong><code class="p">)</code></pre>
			This emits <span class="code"><em>m</em></span> as text to <span class="code"><em>outfp</em></span>, like (but consuming less memory than):

			<pre data-code-language="python" data-type="programlisting">
<em><code class="n">outfp</code></em><code class="o">.</code><code class="n">write</code><code class="p">(</code><em><code class="n">m</code></em><code class="o">.</code><code class="n">as_string</code><code class="p">(</code><em><code class="n">unixfrom</code></em><code class="p">)</code><code class="p">)</code></pre>
			.</td>
</tr>
</tbody>
</table>
</div></section>
<section class="pagebreak-before" data-pdf-bookmark="Creating Messages" data-type="sect2"><div class="sect2" id="creating_messages">
<h2 class="less_space">Creating Messages</h2>
<p>The<a contenteditable="false" data-primary="email module" data-secondary="creating messages" data-type="indexterm" id="idm44924485651680"/> subpackage <span class="code">email.mime</span> supplies various modules, each with a subclass of <span class="code">Message</span> named like the module. The modules’ names are lowercase (e.g., <span class="code">email.mime.text</span>), while the class names are in mixed case. These classes, listed in <a data-type="xref" href="#classes_supplied_by_emaildotmime">Table 21-3</a>, help you create <span class="code">Message</span> instances of different MIME types.</p>
<table class="border" id="classes_supplied_by_emaildotmime">
<caption><span class="label">Table 21-3. </span>Classes supplied by <span class="code">email.mime</span></caption>
<tbody>
<tr>
<td class="width-15"><span class="code">MIMEAudio</span></td>
<td><span class="code"><strong>class</strong></span> <span class="code">MIMEAudio(_<em>audiodata</em>, _subtype=<strong>None</strong>, _encoder=<strong>None</strong>, **_<em>params</em>)</span><br/>
			Creates MIME message objects of major type ‘audio’. <span class="code"><em>_audiodata</em></span> is a bytestring of audio data to pack in a message of MIME type <span class="code">'audio/_subtype'</span>. When <span class="code">_subtype</span> is <span class="code"><strong>None</strong></span>, <span class="code"><em>_audiodata</em></span> must be parsable by standard Python library module <span class="code">sndhdr</span> to determine the subtype; otherwise, <span class="code">MIMEAudio</span> raises <span class="code">TypeError</span>. <span class="version">3.11+</span> Since <span class="code">sndhdr</span> is deprecated, you should always specify the <span class="code">_subtype</span>. When <span class="code">_encoder</span> is <span class="code"><strong>None</strong></span>, <span class="code">MIMEAudio</span> encodes data as Base64, which is usually optimal. Otherwise, <span class="code">_encoder</span> must be callable with one parameter, <span class="code"><em>m</em></span>, which is the message being constructed; <span class="code">_encoder</span> must then call <span class="code"><em>m</em></span><span class="code">.get_payload</span> to get the payload, encode the payload, put the encoded form back by calling <span class="code"><em>m</em></span><span class="code">.set_payload</span>, and set <span class="code"><em>m</em></span>’s Content-Transfer-Encoding header. <span class="code">MIMEAudio</span> passes the <span class="code"><em>_params</em></span> dictionary of named argument names and values to <span class="code"><em>m</em></span><span class="code">.add_header</span> to construct <span class="code"><em>m</em></span>’s Content-Type header.</td>
</tr>
<tr>
<td><span class="code">MIMEBase</span></td>
<td><span class="code"><strong>class</strong></span> <span class="code">MIMEBase(_<em>maintype</em>,</span> <span class="code"><em>_subtype</em></span><span class="code">, **_<em>params</em>)</span><br/>
			Base class of all MIME classes; extends <span class="code">Message</span>. Instantiating:
			<pre data-code-language="python" data-type="programlisting">
<em><code class="n">m</code></em><code> </code><code class="o">=</code><code> </code><code class="n">MIMEBase</code><code class="p">(</code><em><code class="n">mainsub</code></em><code class="p">,</code><code> </code><code class="o">*</code><code class="o">*</code><em><code class="n">params</code></em><code class="p">)</code></pre>
			is equivalent to the longer and slightly less convenient idiom:

			<pre data-code-language="python" data-type="programlisting">
<em><code class="n">m</code></em><code> </code><code class="o">=</code><code> </code><code class="n">Message</code><code class="p">(</code><code class="p">)</code><code>
</code><em><code class="n">m</code></em><code class="o">.</code><code class="n">add_header</code><code class="p">(</code><code class="s1">'</code><code class="s1">Content-Type</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="sa">f</code><code class="s1">'</code><code class="si">{</code><em><code class="n">main</code></em><code class="si">}</code><code class="s1">/</code><code class="si">{</code><em><code class="n">sub</code></em><code class="si">}</code><code class="s1">'</code><code class="p">,</code><code> </code><code>
</code><code>             </code><code class="o">*</code><code class="o">*</code><em><code class="n">params</code></em><code class="p">)</code><code>
</code><em><code class="n">m</code></em><code class="o">.</code><code class="n">add_header</code><code class="p">(</code><code class="s1">'</code><code class="s1">Mime-Version</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">1.0</code><code class="s1">'</code><code class="p">)</code></pre>
</td>
</tr>
<tr>
<td><span class="code">MIMEImage</span></td>
<td><span class="code"><strong>class</strong></span> <span class="code">MIMEImage(_<em>imagedata</em>, _subtype=<strong>None</strong>, _encoder=<strong>None</strong>, **<em>_params</em>)</span><br/>
			Like <span class="code">MIMEAudio</span>, but with main type <span class="code">'image'</span>; uses standard Python module <span class="code">imghdr</span> to determine the subtype, if needed. <span class="version">3.11+</span> Since <span class="code">imghdr</span> is deprecated, you should always specify the <span class="code">_subtype</span>.</td>
</tr>
<tr>
<td><span class="code">MIMEMessage</span></td>
<td><span class="code"><strong>class</strong></span> <span class="code">MIMEMessage(<em>msg</em>, _subtype='rfc822')</span><br/>
			Packs <span class="code"><em>msg</em></span>, which must be an instance of <span class="code">Message</span> (or a subclass), as the payload of a message of MIME type <span class="code">'message/_subtype'</span>.</td>
</tr>
<tr>
<td><span class="code">MIMEText</span></td>
<td><span class="code"><strong>class</strong></span> <span class="code">MIMEText(_<em>text</em>, _subtype='plain', _charset='us-ascii', _encoder=<strong>None</strong>)</span><br/>
			Packs text string <span class="code"><em>_text</em></span> as the payload of a message of MIME type <span class="code">'text/_subtype'</span> with the given <span class="code">_charset</span>. When <span class="code">_encoder</span> is <span class="code"><strong>None</strong></span>, <span class="code">MIMEText</span> does not encode the text, which is generally the best choice. Otherwise, <span class="code">_encoder</span> must be callable with one parameter, <span class="code"><em>m</em></span>, which is the message being constructed; <span class="code">_encoder</span> must then call <span class="code"><em>m</em></span><span class="code">.get_payload</span> to get the payload, encode the payload, put the encoded form back by calling <span class="code"><em>m</em></span><span class="code">.set_payload</span>, and set <span class="code"><em>m</em></span>’s Content-Transfer-Encoding header appropriately.</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="The email.encoders Module" data-type="sect2"><div class="sect2" id="the_emaildotencoders_module">
<h2>The email.encoders Module</h2>
<p>The<a contenteditable="false" data-primary="email module" data-secondary="email.encoders module" data-type="indexterm" id="idm44924485458208"/> <span class="code">email.encoders</span> module supplies functions that take a<a contenteditable="false" data-primary="non-multipart messages" data-type="indexterm" id="idm44924485455952"/> <em>nonmultipart</em> message <span class="code"><em>m</em></span> as their only argument, encode <span class="code"><em>m</em></span>’s payload, and set <span class="code"><em>m</em></span>’s headers appropriately. These functions are listed in <a data-type="xref" href="#functions_of_the_emaildotencoders_modul">Table 21-4</a>.</p>
<table class="border" id="functions_of_the_emaildotencoders_modul">
<caption><span class="label">Table 21-4. </span>Functions of the <span class="code">email.encoders</span> module</caption>
<tbody>
<tr>
<td><span class="code">encode_base64</span></td>
<td><span class="code">encode_base64(<em>m</em>)</span><br/>
			Uses Base64 encoding, usually optimal for arbitrary binary data (see <a data-type="xref" href="#the_basesixfour_module">“The base64 Module”</a>).</td>
</tr>
<tr>
<td><span class="code">encode_noop</span></td>
<td><span class="code">encode_noop(<em>m</em>)</span><br/>
			Does nothing to <span class="code"><em>m</em></span>’s payload and headers.</td>
</tr>
<tr>
<td><span class="code">encode_quopri</span></td>
<td><span class="code">encode_quopri(<em>m</em>)</span><br/>
			Uses Quoted Printable encoding, usually optimal for text that is almost but not fully ASCII (see <a data-type="xref" href="#the_quopri_module">“The quopri Module”</a>).</td>
</tr>
<tr>
<td><span class="code">encode_7or8bit</span></td>
<td><span class="code">encode_7or8bit(<em>m</em>)</span><br/>
			Does nothing to <span class="code"><em>m</em></span>’s payload, but sets the header Content-Transfer-Encoding to <span class="code">'8bit'</span> when any byte of <span class="code"><em>m</em></span>’s payload has the high bit set; otherwise, sets it to <span class="code">'7bit'</span>.</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="The email.utils Module" data-type="sect2"><div class="sect2" id="the_emaildotutils_module">
<h2>The email.utils Module</h2>
<p>The<a contenteditable="false" data-primary="email module" data-secondary="email.utils module" data-type="indexterm" id="idm44924485428640"/> <span class="code">email.utils</span> module supplies several functions for email processing, listed in <a data-type="xref" href="#functions_of_the_emaildotutils_module">Table 21-5</a>.</p>
<table class="border" id="functions_of_the_emaildotutils_module">
<caption><span class="label">Table 21-5. </span>Functions of the <span class="code">email.utils</span> module</caption>
<tbody>
<tr>
<td class="width-20"><span class="code">formataddr</span></td>
<td><span class="code">formataddr(<em>pair</em>)</span><br/>
			Takes a pair of strings <span class="code">(<em>realname</em>,</span> <span class="code"><em>email_address</em></span><span class="code">)</span> and returns a string <span class="code"><em>s</em></span> with the address to insert in header fields such as <span class="code">To</span> and <span class="code">Cc</span>. When <span class="code"><em>realname</em></span> is false (e.g., the empty string, <span class="code">''</span>), <span class="code">formataddr</span> returns <span class="code"><em>email_address</em></span>.</td>
</tr>
<tr>
<td><span class="code">formatdate</span></td>
<td><span class="code">formatdate(timeval=<strong>None</strong>, localtime=<strong>False</strong>)</span><br/>
			Returns a string with the time instant formatted as specified by RFC 2822. <span class="code">timeval</span> is a number of seconds since the epoch. When <span class="code">timeval</span> is <span class="code"><strong>None</strong></span>, <span class="code">formatdate</span> uses the current time. When <span class="code">localtime</span> is <span class="code"><strong>True</strong></span>, <span class="code">formatdate</span> uses the local<a contenteditable="false" data-primary="time zone" data-secondary="in email" data-secondary-sortas="email" data-type="indexterm" id="idm44924485403040"/> time zone; otherwise, it uses UTC.</td>
</tr>
<tr>
<td><span class="code">getaddresses</span></td>
<td><span class="code">getaddresses(<em>L</em>)</span><br/>
			Parses each item of <span class="code"><em>L</em></span>, a list of address strings as used in header fields such as <span class="code">To</span> and <span class="code">Cc</span>, and returns a list of pairs of strings <span class="code">(<em>name</em>,</span> <span class="code"><em>address</em></span><span class="code">)</span>. When <span class="code">getaddresses</span> cannot parse an item of <span class="code"><em>L</em></span> as an email address, it sets <span class="code">('', '')</span> as the corresponding item in the list.</td>
</tr>
<tr>
<td><span class="code">mktime_tz</span></td>
<td><span class="code">mktime_tz(<em>t</em>)</span><br/>
			Returns a <span class="code">float</span> representing the number of seconds since the epoch, in UTC, corresponding to the instant that <span class="code"><em>t</em></span> denotes. <span class="code"><em>t</em></span> is a tuple with 10 items. The first nine items of <span class="code"><em>t</em></span> are in the same format used in the module <span class="code">time</span>, covered in <a data-type="xref" href="ch13.xhtml#the_time_module">“The time Module”</a>. <span class="code"><em>t</em></span><span class="code">[-1]</span> is a time zone as an offset in seconds from UTC (with the opposite sign from <span class="code">time.timezone</span>, as specified by RFC 2822). When <span class="code"><em>t</em></span><span class="code">[-1]</span> is <span class="code"><strong>None</strong></span>, <span class="code">mktime_tz</span> uses the local time zone.</td>
</tr>
<tr>
<td><span class="code">parseaddr</span></td>
<td><span class="code">parseaddr(<em>s</em>)</span><br/>
			Parses string <span class="code"><em>s</em></span>, which contains an address as typically specified in header fields such as <span class="code">To</span> and <span class="code">Cc</span>, and returns a pair of strings <span class="code">(<em>realname</em>,</span> <span class="code"><em>address</em></span><span class="code">)</span>. When <span class="code">parseaddr</span> cannot parse <span class="code"><em>s</em></span> as an address, it returns <span class="code">('', '')</span>.</td>
</tr>
<tr>
<td><span class="code">parsedate</span></td>
<td><span class="code">parsedate(<em>s</em>)</span><br/>
			Parses string <span class="code"><em>s</em></span> as per the rules in RFC 2822 and returns a tuple <span class="code"><em>t</em></span> with nine items, as used in the module <span class="code">time</span>, covered in <a data-type="xref" href="ch13.xhtml#the_time_module">“The time Module”</a> (the items <span class="code"><em>t</em></span><span class="code">[-3:]</span> are not meaningful). <span class="code">parsedate</span> also attempts to parse some erroneous variations on RFC 2822 that commonly encountered mailers use. When <span class="code">parsedate</span> cannot parse <span class="code"><em>s</em></span>, it returns <span class="code">None</span>.</td>
</tr>
<tr>
<td><span class="code">parsed⁠a⁠t⁠e⁠_​t⁠z</span></td>
<td><span class="code">parsedate_tz(<em>s</em>)</span><br/>
			Like <span class="code">parsedate</span>, but returns a tuple <span class="code"><em>t</em></span> with 10 items, where <span class="code"><em>t</em></span><span class="code">[-1]</span> is <span class="code"><em>s</em></span>’s time zone as an offset in seconds from UTC (with the opposite sign from <span class="code">time.timezone</span>, as specified by RFC 2822), like in the argument that <span class="code">mktime_tz</span> accepts. Items <span class="code"><em>t</em></span><span class="code">[-4:-1]</span> are not meaningful. When <span class="code"><em>s</em></span> has no time zone, <span class="code"><em>t</em></span><span class="code">[-1]</span> is <span class="code"><strong>None</strong></span>.</td>
</tr>
<tr>
<td><span class="code">quote</span></td>
<td><span class="code">quote(<em>s</em>)</span><br/>
			Returns a copy of string <span class="code"><em>s</em></span>, where each double quote (<span class="code">"</span>) becomes <span class="code">'\"'</span>, and each existing backslash is repeated.</td>
</tr>
<tr>
<td><span class="code">unquote</span></td>
<td><span class="code">unquote(<em>s</em>)</span><br/>
			Returns a copy of string <span class="code"><em>s</em></span> where leading and trailing double-quote characters (<span class="code">"</span>) and angle brackets (<span class="code">&lt;&gt;</span>) are removed if they surround the rest of <span class="code"><em>s</em></span>.</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Example Uses of the email Package" data-type="sect2"><div class="sect2" id="example_uses_of_the_email_package">
<h2>Example Uses of the email Package</h2>
<p>The<a contenteditable="false" data-primary="email module" data-secondary="example uses of" data-type="indexterm" id="idm44924485330704"/> <span class="code">email</span> package helps you both in reading and composing email and email-like messages (but it’s not involved in receiving and transmitting such messages: those tasks belong to separate modules covered in <a data-type="xref" href="ch19.xhtml#client_side_network_protocol_modules">Chapter 19</a>). Here is an example of how to use <span class="code">email</span> to read a possibly multipart message and unpack each part into a file in a given directory:</p>
<pre data-code-language="python" data-type="programlisting">
<strong><code class="kn">import</code></strong><code> </code><code class="nn">pathlib</code><code class="o">,</code><code> </code><code class="nn">email</code><code>
</code><strong><code class="k">def</code></strong><code> </code><code class="nf">unpack_mail</code><code class="p">(</code><code class="n">mail_file</code><code class="p">,</code><code> </code><code class="n">dest_dir</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><em><code class="sd">'''Given file object mail_file, open for reading, and dest_dir,</code></em><code class="sd">
       </code><em><code class="sd">a string that is a path to an existing, writable directory,</code></em><code class="sd">
       </code><em><code class="sd">unpack each part of the mail message from mail_file to a</code></em><code class="sd">
       </code><em><code class="sd">file within dest_dir.</code></em><code class="sd">
    </code><em><code class="sd">'''</code></em><code>
</code><code>    </code><code class="n">dest_dir_path</code><code> </code><code class="o">=</code><code> </code><code class="n">pathlib</code><code class="o">.</code><code class="n">Path</code><code class="p">(</code><code class="n">dest_dir</code><code class="p">)</code><code>
</code><code>    </code><strong><code class="k">with</code></strong><code> </code><code class="n">mail_file</code><code class="p">:</code><code>
</code><code>        </code><code class="n">msg</code><code> </code><code class="o">=</code><code> </code><code class="n">email</code><code class="o">.</code><code class="n">message_from_file</code><code class="p">(</code><code class="n">mail_file</code><code class="p">)</code><code>
</code><code>    </code><strong><code class="k">for</code></strong><code> </code><code class="n">part_number</code><code class="p">,</code><code> </code><code class="n">part</code><code> </code><strong><code class="ow">in</code></strong><code> </code><code class="nb">enumerate</code><code class="p">(</code><code class="n">msg</code><code class="o">.</code><code class="n">walk</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="p">:</code><code>
</code><code>        </code><strong><code class="k">if</code></strong><code> </code><code class="n">part</code><code class="o">.</code><code class="n">get_content_maintype</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">multipart</code><code class="s1">'</code><code class="p">:</code><code>
</code><code>            </code><em><code class="c1"># we get each specific part later in the loop,</code></em><code>
</code><code>            </code><em><code class="c1"># so, nothing to do for the 'multipart' itself</code></em><code>
</code><strong><code>           </code></strong><code> </code><strong><code class="k">continue</code></strong><code>
</code><code>        </code><code class="n">dest</code><code> </code><code class="o">=</code><code> </code><code class="n">part</code><code class="o">.</code><code class="n">get_filename</code><code class="p">(</code><code class="p">)</code><code>
</code><code>        </code><strong><code class="k">if</code></strong><code> </code><code class="n">dest</code><code> </code><strong><code class="ow">is</code><code> </code><code class="kc">None</code></strong><code class="p">:</code><code> </code><code class="n">dest</code><code> </code><code class="o">=</code><code> </code><code class="n">part</code><code class="o">.</code><code class="n">get_param</code><code class="p">(</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>        </code><strong><code class="k">if</code></strong><code> </code><code class="n">dest</code><code> </code><strong><code class="ow">is</code><code> </code><code class="kc">None</code></strong><code class="p">:</code><code> </code><code class="n">dest</code><code> </code><code class="o">=</code><code> </code><code class="sa">f</code><code class="s1">'</code><code class="s1">part-</code><code class="si">{</code><code class="n">part_number</code><code class="si">}</code><code class="s1">'</code><code>
</code><code>        </code><em><code class="c1"># in real life, make sure that dest is a reasonable filename</code></em><code>
</code><code>        </code><em><code class="c1"># for your OS; otherwise, mangle that name until it is</code></em><code>
</code><code>        </code><code class="n">part_payload</code><code> </code><code class="o">=</code><code> </code><code class="n">part</code><code class="o">.</code><code class="n">get_payload</code><code class="p">(</code><code class="n">decode</code><code class="o">=</code><strong><code class="kc">True</code></strong><code class="p">)</code><code>
</code><code>        </code><code class="p">(</code><code class="n">dest_dir_path</code><code> </code><code class="o">/</code><code> </code><code class="n">dest</code><code class="p">)</code><code class="o">.</code><code class="n">write_text</code><code class="p">(</code><code class="n">part_payload</code><code class="p">)</code></pre>
<p>And here is an example that performs roughly the reverse task, packaging all files that are directly under a given source directory into a single file suitable for<a contenteditable="false" data-primary="" data-startref="NEmime21" data-type="indexterm" id="idm44924485150912"/> mailing:</p>
<pre data-code-language="python" data-type="programlisting">
<strong><code class="k">def</code></strong><code> </code><code class="nf">pack_mail</code><code class="p">(</code><code class="n">source_dir</code><code class="p">,</code><code> </code><code class="o">*</code><code class="o">*</code><code class="n">headers</code><code class="p">)</code><code class="p">:</code><code>
</code><code>     </code><em><code class="sd">'''Given source_dir, a string that is a path to an existing,</code></em><code class="sd">
        </code><em><code class="sd">readable directory, and arbitrary header name/value pairs</code></em><code class="sd">
        </code><em><code class="sd">passed in as named arguments, packs all the files directly</code></em><code class="sd">
        </code><em><code class="sd">under source_dir (assumed to be plain text files) into a</code></em><code class="sd">
        </code><em><code class="sd">mail message returned as a MIME-formatted string.</code></em><code class="sd">
     </code><em><code class="sd">'''</code></em><code>
</code><code>     </code><code class="n">source_dir_path</code><code> </code><code class="o">=</code><code> </code><code class="n">pathlib</code><code class="o">.</code><code class="n">Path</code><code class="p">(</code><code class="n">source_dir</code><code class="p">)</code><code>
</code><code>     </code><code class="n">msg</code><code> </code><code class="o">=</code><code> </code><code class="n">email</code><code class="o">.</code><code class="n">message</code><code class="o">.</code><code class="n">Message</code><code class="p">(</code><code class="p">)</code><code>
</code><code>     </code><strong><code class="k">for</code></strong><code> </code><code class="n">name</code><code class="p">,</code><code> </code><code class="n">value</code><code> </code><strong><code class="ow">in</code></strong><code> </code><code class="n">headers</code><code class="o">.</code><code class="n">items</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>
</code><code>         </code><code class="n">msg</code><code class="p">[</code><code class="n">name</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">value</code><code>
</code><code>     </code><code class="n">msg</code><code class="p">[</code><code class="s1">'</code><code class="s1">Content-type</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">multipart/mixed</code><code class="s1">'</code><code>
</code><code>     </code><code class="n">filepaths</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="n">path</code><code> </code><code class="k">for</code><code> </code><code class="n">path</code><code> </code><code class="ow">in</code><code> </code><code class="n">source_dir_path</code><code class="o">.</code><code class="n">iterdir</code><code class="p">(</code><code class="p">)</code><code> </code><code>
</code><code>                  </code><code class="k">if</code><code> </code><code class="n">path</code><code class="o">.</code><code class="n">is_file</code><code class="p">(</code><code class="p">)</code><code class="p">]</code><code>
</code><code>     </code><strong><code class="k">for</code></strong><code> </code><code class="n">filepath</code><code> </code><strong><code class="ow">in</code></strong><code> </code><code class="n">filepaths</code><code class="p">:</code><code>
</code><code>         </code><code class="n">m</code><code> </code><code class="o">=</code><code> </code><code class="n">email</code><code class="o">.</code><code class="n">message</code><code class="o">.</code><code class="n">Message</code><code class="p">(</code><code class="p">)</code><code>
</code><code>         </code><code class="n">m</code><code class="o">.</code><code class="n">add_header</code><code class="p">(</code><code class="s1">'</code><code class="s1">Content-type</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">text/plain</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">name</code><code class="o">=</code><code class="n">filename</code><code class="p">)</code><code>
</code><code>         </code><code class="n">m</code><code class="o">.</code><code class="n">set_payload</code><code class="p">(</code><code class="n">filepath</code><code class="o">.</code><code class="n">read_text</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code>
</code><code>         </code><code class="n">msg</code><code class="o">.</code><code class="n">attach</code><code class="p">(</code><code class="n">m</code><code class="p">)</code><code>
</code><code>     </code><strong><code class="k">return</code></strong><code> </code><code class="n">msg</code><code class="o">.</code><code class="n">as_string</code><code class="p">(</code><code class="p">)</code></pre>
</div></section>
</div></section>
<section data-pdf-bookmark="Encoding Binary Data as ASCII Text" data-type="sect1"><div class="sect1" id="encoding_binary_data_as_ascii_text">
<h1>Encoding Binary Data as ASCII Text</h1>
<p>Several<a contenteditable="false" data-primary="network encodings" data-secondary="encoding binary data as ASCII text" data-type="indexterm" id="NEbinary21"/><a contenteditable="false" data-primary="encoding binary data" data-type="indexterm" id="enbin21"/><a contenteditable="false" data-primary="ASCII characters" data-type="indexterm" id="ascii21"/><a contenteditable="false" data-primary="binary data, encoding as ASCII text" data-type="indexterm" id="binaryencode21"/> kinds of media (e.g., email messages) can contain only ASCII text. When you want to transmit arbitrary binary data via such media, you need to encode the data as ASCII text strings. The Python standard library supplies modules that support the standard encodings known as Base64, Quoted Printable, and Unix-to-Unix, described in the following sections.</p>
<section class="pagebreak-before" data-pdf-bookmark="The base64 Module" data-type="sect2"><div class="sect2" id="the_basesixfour_module">
<h2 class="less_space">The base64 Module</h2>
<p>The<a contenteditable="false" data-primary="base64 module" data-type="indexterm" id="base64mod21"/><a contenteditable="false" data-primary="standard library modules" data-secondary="base64" data-type="indexterm" id="idm44924484970960"/> <span class="code">base64</span> module supports the encodings specified in <a href="https://oreil.ly/Cbhkl">RFC 3548</a> as Base16, Base32, and Base64. Each of these encodings is a compact way to represent arbitrary binary data as ASCII text, without any attempt to produce human-readable results. <span class="code">base64</span> supplies 10 functions: 6 for Base64, plus 2 each for Base32 and Base16. The six Base64 functions are listed in <a data-type="xref" href="#basesixfour_functions_of_the_basesixfou">Table 21-6</a>.</p>
<table class="border" id="basesixfour_functions_of_the_basesixfou">
<caption><span class="label">Table 21-6. </span>Base64 functions of the <span class="code">base64</span> module</caption>
<tbody>
<tr>
<td><span class="code">b64decode</span></td>
<td><span class="code">b64decode(<em>s</em>, altchars=<strong>None</strong>, validate=<strong>False</strong>)</span><br/>
			Decodes<a contenteditable="false" data-primary="b64decode (base64 module)" data-type="indexterm" id="idm44924484903536"/> B64-encoded bytestring <span class="code"><em>s</em></span>, and returns the decoded bytestring. <span class="code">altchars</span>, if not <span class="code"><strong>None</strong></span>, must be a bytestring of at least two characters (extra characters are ignored) specifying the two nonstandard characters to use instead of <span class="code">+</span> and <span class="code">/</span> (potentially useful to decode URL-safe or filesystem-safe B64-encoded strings). When <span class="code">validate</span> is <span class="code"><strong>True</strong></span>, the call raises an exception if <span class="code"><em>s</em></span> contains any bytes that are not valid in B64-encoded strings (by default, such bytes are just ignored and skipped). Also raises an exception when <span class="code"><em>s</em></span> is improperly padded according to the Base64 standard.</td>
</tr>
<tr>
<td><span class="code">b64encode</span></td>
<td><span class="code">b64encode(<em>s</em>, altchars=<strong>None</strong>)</span><br/>
			Encodes<a contenteditable="false" data-primary="b64encode (base64 module)" data-type="indexterm" id="idm44924484892304"/> bytestring <span class="code"><em>s</em></span> and returns the bytestring with the corresponding B64-encoded data. <span class="code">altchars</span>, if not <span class="code"><strong>None</strong></span>, must be a bytestring of at least two characters (extra characters are ignored) specifying the two nonstandard characters to use instead of <span class="code">+</span> and <span class="code">/</span> (potentially useful to make URL-safe or filesystem-safe B64-encoded strings).</td>
</tr>
<tr>
<td><span class="code">standa⁠r⁠d⁠_​b⁠6⁠4⁠decode</span></td>
<td><span class="code">standard_b64decode(<em>s</em>)</span><br/>
			Like <span class="code">b64decode(<em>s</em>)</span>.</td>
</tr>
<tr>
<td><span class="code">standa⁠r⁠d⁠_​b⁠6⁠4⁠encode</span></td>
<td><span class="code">standard_b64encode(<em>s</em>)</span><br/>
			Like <span class="code">b64encode(<em>s</em>)</span>.</td>
</tr>
<tr>
<td><span class="code">urlsa⁠f⁠e⁠_​b⁠6⁠4⁠decode</span></td>
<td><span class="code">urlsafe_b64decode(<em>s</em>)</span><br/>
			Like <span class="code">b64decode(<em>s</em>, '-_')</span>.</td>
</tr>
<tr>
<td><span class="code">urlsa⁠f⁠e⁠_​b⁠6⁠4⁠encode</span></td>
<td><span class="code">urlsafe_b64encode(<em>s</em>)</span><br/>
			Like <span class="code">b64encode(<em>s</em>, '-_')</span>.</td>
</tr>
</tbody>
</table>
<p>The four Base16 and Base32 functions are listed in <a data-type="xref" href="#baseonesix_and_basethreetwo_functions_o">Table 21-7</a>.</p>
<table class="border" id="baseonesix_and_basethreetwo_functions_o">
<caption><span class="label">Table 21-7. </span>Base16 and Base32 functions of the <span class="code">base64</span> module</caption>
<tbody>
<tr>
<td><span class="code">b16decode</span></td>
<td><span class="code">b16decode(<em>s</em>, casefold=<strong>False</strong>)</span><br/>
			Decodes B16-encoded bytestring <span class="code"><em>s</em></span>, and returns the decoded bytestring. When <span class="code">casefold</span> is <span class="code"><strong>True</strong></span>, lowercase characters in <span class="code"><em>s</em></span> are treated like their uppercase equivalents; by default, when lowercase characters are present, the call raises an exception.</td>
</tr>
<tr>
<td><span class="code">b16encode</span></td>
<td><span class="code">b16encode(<em>s</em>)</span><br/>
			Encodes bytestring <span class="code"><em>s</em></span>, and returns the bytestring with the corresponding B16-encoded data.</td>
</tr>
<tr>
<td><span class="code">b32decode</span></td>
<td><span class="code">b32decode(<em>s</em>, casefold=<strong>False</strong>, map01=<strong>None</strong>)</span><br/>
			Decodes B32-encoded bytestring <span class="code"><em>s</em></span>, and returns the decoded bytestring. When <span class="code">casefold</span> is <span class="code"><strong>True</strong></span>, lowercase characters in <span class="code"><em>s</em></span> are treated like their uppercase equivalents; by default, when lowercase characters are present, the call raises an exception. When <span class="code">map01</span> is <span class="code"><strong>None</strong></span>, characters <span class="code">0</span> and <span class="code">1</span> are not allowed in the input; when not <span class="code"><strong>None</strong></span>, it must be a single-character bytestring specifying what <span class="code">1</span> is mapped to (lowercase <span class="code">'l'</span> or uppercase <span class="code">'L'</span>); <span class="code">0</span> is then always mapped to uppercase <span class="code">'O'</span>.</td>
</tr>
<tr>
<td><span class="code">b32encode</span></td>
<td><span class="code">b32encode(<em>s</em>)</span><br/>
			Encodes bytestring <span class="code"><em>s</em></span> and returns the bytestring with the corresponding B32-encoded data.</td>
</tr>
</tbody>
</table>
<p>The module also supplies functions to encode and decode the nonstandard but popular encodings Base85 and Ascii85, which, while not codified in RFCs or compatible with each other, can offer space savings of 15% by using larger alphabets for encoded bytestrings. See the <a href="https://oreil.ly/rndpn">online docs</a> for details on those functions.<a contenteditable="false" data-primary="" data-startref="base64mod21" data-type="indexterm" id="idm44924484837600"/></p>
</div></section>
<section data-pdf-bookmark="The quopri Module" data-type="sect2"><div class="sect2" id="the_quopri_module">
<h2>The quopri Module</h2>
<p>The<a contenteditable="false" data-primary="quopri module" data-type="indexterm" id="idm44924484834272"/><a contenteditable="false" data-primary="standard library modules" data-secondary="quopri" data-type="indexterm" id="idm44924484833168"/> <span class="code">quopri</span> module supports the encoding specified in RFC 1521 as<a contenteditable="false" data-primary="Quoted Printable (QP) encoding" data-type="indexterm" id="idm44924484830880"/> <em>Quoted Printable</em> (QP). QP can represent any binary data as ASCII text, but it’s mainly intended for data that is mostly text, with a small amount of characters with the high bit set (i.e., characters outside the ASCII range). For such data, QP produces results that are both compact and human-readable. The <span class="code">quopri</span> module supplies four functions, listed in <a data-type="xref" href="#functions_of_the_quopri_module">Table 21-8</a>.</p>
<table class="border" id="functions_of_the_quopri_module">
<caption><span class="label">Table 21-8. </span>Functions of the <span class="code">quopri</span> module</caption>
<tbody>
<tr>
<td><span class="code">decode</span></td>
<td><span class="code">decode(<em>infile</em>,</span> <span class="code"><em>outfile</em></span><span class="code">, header=<strong>False</strong>)</span><br/>
			Reads the binary file-like object <span class="code"><em>infile</em></span> by calling <span class="code"><em>infile</em></span><span class="code">.readline</span> until end-of-file (i.e., until a call to <span class="code"><em>infile</em></span><span class="code">.readline</span> returns an empty string), decodes the QP-encoded ASCII text thus read, and writes the results to binary file-like object <span class="code"><em>outfile</em></span><em>.</em> When <span class="code">header</span> is true, <span class="code">decode</span> also turns <span class="code">_</span> (underscores) into spaces (per RFC 1522).</td>
</tr>
<tr>
<td><span class="code">decodestring</span></td>
<td><span class="code">decodestring(<em>s</em>, header=<strong>False</strong>)</span><br/>
			Decodes bytestring <span class="code"><em>s</em></span>, QP-encoded ASCII text, and returns the bytestring with the decoded data. When <span class="code">header</span> is true, <span class="code">decodestring</span> also turns <span class="code">_</span> (underscores) into spaces.</td>
</tr>
<tr>
<td><span class="code">encode</span></td>
<td><span class="code">encode(<em>infile</em>,</span> <span class="code"><em>outfile</em></span><span class="code">,</span> <span class="code"><em>quotetabs</em></span><span class="code">, header=<strong>False</strong>)</span><br/>
			Reads binary file-like object <span class="code"><em>infile</em></span> by calling <span class="code"><em>infile</em></span><span class="code">.readline</span> until end-of-file (i.e., until a call to <span class="code"><em>infile</em></span><span class="code">.readline</span> returns an empty string), encodes the data thus read in QP, and writes the encoded ASCII text to binary file-like object <span class="code"><em>outfile</em></span><em>.</em> When <span class="code"><em>quotetabs</em></span> is true, <span class="code">encode</span> also encodes spaces and tabs. When <span class="code">header</span> is true, <span class="code">encode</span> encodes spaces as <span class="code">_</span> (underscores).</td>
</tr>
<tr>
<td><span class="code">encodestring</span></td>
<td><span class="code">encodestring(<em>s</em>, quotetabs=<strong>False</strong>, header=<strong>False</strong>)</span><br/>
			Encodes bytestring <span class="code"><em>s</em></span>, which contains arbitrary bytes, and returns a bytestring with QP-encoded ASCII text. When <span class="code">quotetabs</span> is true, <span class="code">encodestring</span> also encodes spaces and tabs. When <span class="code">header</span> is true, <span class="code">encodestring</span> encodes spaces as <span class="code">_</span> (underscores).</td>
</tr>
</tbody>
</table>
</div></section>
<section class="pagebreak-before" data-pdf-bookmark="The uu Module" data-type="sect2"><div class="sect2" id="the_uu_module">
<h2 class="less_space">The uu Module</h2>
<p>The<a contenteditable="false" data-primary="uu module" data-type="indexterm" id="idm44924484781456"/><a contenteditable="false" data-primary="standard library modules" data-secondary="uu" data-type="indexterm" id="idm44924484779936"/> <span class="code">uu</span> module<sup><a data-type="noteref" href="ch21.xhtml#ch01fn157" id="ch01fn157-marker">1</a></sup> supports the classic <em>Unix-to-Unix</em> (UU) encoding, as implemented by the Unix programs <em>uuencode</em> and <em>uudecode</em>. UU starts encoded data with a <span class="code">begin</span> line, which includes the filename and permissions of the file being encoded, and ends it with an <span class="code">end</span> line. Therefore, UU encoding lets you embed encoded data in otherwise unstructured text, while Base64 encoding (discussed in <a data-type="xref" href="#the_basesixfour_module">“The base64 Module”</a>) relies on the existence of other indications of where the encoded data starts and finishes. The <span class="code">uu</span> module supplies two functions, listed in <a data-type="xref" href="#functions_of_the_uu_module">Table 21-9</a>.</p>
<table class="border" id="functions_of_the_uu_module">
<caption><span class="label">Table 21-9. </span>Functions of the <span class="code">uu</span> module</caption>
<tbody>
<tr>
<td><span class="code">decode</span></td>
<td><span class="code">decode(<em>infile</em>, outfile=<strong>None</strong>, mode=<strong>None</strong>)</span><br/>
			Reads the file-like object <span class="code"><em>infile</em></span> by calling <span class="code"><em>infile</em></span><span class="code">.readline</span> until end-of-file (i.e., until a call to <span class="code"><em>infile</em></span><span class="code">.readline</span> returns an empty string) or until a terminator line (the string <span class="code">'end'</span> surrounded by any amount of whitespace). <span class="code">decode</span> decodes the UU-encoded text thus read and writes the decoded data to the file-like object <span class="code">outfile</span>. When <span class="code">outfile</span> is <span class="code"><strong>None</strong></span>, <span class="code">decode</span> creates the file specified in the UU-format <span class="code">begin</span> line, with the permission bits given by <span class="code">mode</span> (the permission bits specified in the <span class="code">begin</span> line, when <span class="code">mode</span> is <span class="code"><strong>None</strong></span>). In this case, <span class="code">decode</span> raises an exception if the file already exists.</td>
</tr>
<tr>
<td><span class="code">encode</span></td>
<td><span class="code">encode(<em>infile</em>,</span> <span class="code"><em>outfile</em></span><span class="code">, name='-', mode=0o666)</span><br/>
			Reads the file-like object <span class="code"><em>infile</em></span> by calling <span class="code"><em>infile</em></span><span class="code">.read</span> (45 bytes at a time, which is the amount of data that UU encodes into 60 characters in each output line) until end-of-file (i.e., until a call to <span class="code"><em>infile</em></span><span class="code">.read</span> returns an empty string). It encodes the data thus read in UU and writes the encoded text to file-like object <span class="code"><em>outfile</em></span>. <span class="code">encode</span> also writes a UU-format <span class="code">begin</span> line before the text and a UU-format <span class="code">end</span> line after the text. In the <span class="code">begin</span> line, <span class="code">encode</span> specifies the filename as <span class="code">name</span> and the mode as <span class="code">mode</span>.<a contenteditable="false" data-primary="" data-startref="binaryencode21" data-type="indexterm" id="idm44924484737296"/><a contenteditable="false" data-primary="" data-startref="ascii21" data-type="indexterm" id="idm44924484735888"/><a contenteditable="false" data-primary="" data-startref="enbin21" data-type="indexterm" id="idm44924484734512"/><a contenteditable="false" data-primary="" data-startref="NEbinary21" data-type="indexterm" id="idm44924484733136"/></td>
</tr>
</tbody>
</table>
</div></section>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="ch01fn157"><sup><a href="ch21.xhtml#ch01fn157-marker">1</a></sup> Deprecated in Python 3.11, to be removed in Python 3.13; the online docs direct users to update existing code to use the <span class="code">base64</span> module for data content and MIME headers for metadata.</p></div></div></section></div></body></html>