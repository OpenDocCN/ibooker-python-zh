<html><head></head><body><section data-pdf-bookmark="Chapter 2. Automating Files and the Filesystem" data-type="chapter" epub:type="chapter"><div class="chapter" id="automating_files_and_the_filesystem">&#13;
<h1><span class="label">Chapter 2. </span>Automating Files and the Filesystem</h1>&#13;
&#13;
&#13;
<p><a data-primary="automating files and the filesystem" data-type="indexterm" id="ix_ch02-asciidoc0"/>One of Python’s most powerful features is its ability to manipulate text and files. In the DevOps world, you are continually parsing, searching, and changing the text in files, whether you’re searching application logs or propagating configuration files. Files are a means of persisting the state of your data, code, and configuration; they are how you look back at what happened in logs and how you control what happens with configuration.&#13;
 With Python, you can create, read, and change files and text in the code that you can use repeatedly. Automating these tasks is indeed one aspect of modern DevOps that separates it from traditional system administration. Rather than keeping a set of instructions that you have to follow manually, you can write code. This diminishes your chances of missing steps or doing them out of order. If you are confident that your system uses the same steps every time you run it, you can have greater understanding and confidence in the process.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Reading and Writing Files" data-type="sect1"><div class="sect1" id="idm46691346530728">&#13;
<h1>Reading and Writing Files</h1>&#13;
&#13;
<p><a data-primary="automating files and the filesystem" data-secondary="reading/writing files" data-type="indexterm" id="ix_ch02-asciidoc1"/><a data-primary="reading a file" data-type="indexterm" id="ix_ch02-asciidoc2"/><a data-primary="writing a file" data-type="indexterm" id="ix_ch02-asciidoc3"/>You can use the <a data-primary="open() function" data-type="indexterm" id="idm46691346524776"/><code>open</code> function to create a file object that can read and write files. It takes two arguments, the path of the file and the mode (mode optionally defaults to reading). You use the mode to indicate, among other things, if you want to read or write a file and if it is text or binary data. You can open a text file using the mode <em>r</em> to read its contents. The file object has a <code>read</code> method that returns the contents of the file as a string:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="n">file_path</code> <code class="o">=</code> <code class="s1">'bookofdreams.txt'</code>&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="n">open_file</code> <code class="o">=</code> <code class="nb">open</code><code class="p">(</code><code class="n">file_path</code><code class="p">,</code> <code class="s1">'r'</code><code class="p">)</code>&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">text</code> <code class="o">=</code> <code class="n">open_file</code><code class="o">.</code><code class="n">read</code><code class="p">()</code>&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="nb">len</code><code class="p">(</code><code class="n">text</code><code class="p">)</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="mi">476909</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="n">text</code><code class="p">[</code><code class="mi">56</code><code class="p">]</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="s1">'s'</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="n">open_file</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="o">&lt;</code><code class="n">_io</code><code class="o">.</code><code class="n">TextIOWrapper</code> <code class="n">name</code><code class="o">=</code><code class="s1">'bookofdreams.txt'</code> <code class="n">mode</code><code class="o">=</code><code class="s1">'r'</code> <code class="n">encoding</code><code class="o">=</code><code class="s1">'UTF-8'</code><code class="o">&gt;</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="n">open_file</code><code class="o">.</code><code class="n">close</code><code class="p">()</code></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>It is a good practice to close a file when you finish with it. Python closes a file when it is out of scope, but until then the file consumes resources and may prevent other processes from opening it.</p>&#13;
</div>&#13;
&#13;
<p>You can also read a file using the <a data-primary="readlines() method" data-type="indexterm" id="idm46691346388440"/><code>readlines</code> method. This method reads the file and splits its contents on newline characters. It returns a list of strings. Each string is one line of the original text:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">8</code><code class="p">]:</code> <code class="n">open_file</code> <code class="o">=</code> <code class="nb">open</code><code class="p">(</code><code class="n">file_path</code><code class="p">,</code> <code class="s1">'r'</code><code class="p">)</code>&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">9</code><code class="p">]:</code> <code class="n">text</code> <code class="o">=</code> <code class="n">open_file</code><code class="o">.</code><code class="n">readlines</code><code class="p">()</code>&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">10</code><code class="p">]:</code> <code class="nb">len</code><code class="p">(</code><code class="n">text</code><code class="p">)</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">10</code><code class="p">]:</code> <code class="mi">8796</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">11</code><code class="p">]:</code> <code class="n">text</code><code class="p">[</code><code class="mi">100</code><code class="p">]</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">11</code><code class="p">]:</code> <code class="s1">'science, when it admits the possibility of occasional hallucinations</code><code class="se">\n</code><code class="s1">'</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">12</code><code class="p">]:</code> <code class="n">open_file</code><code class="o">.</code><code class="n">close</code><code class="p">()</code></pre>&#13;
&#13;
<p>A handy way of opening files is to use <code>with</code> statements. You do not need to close a file explicitly in this case. Python closes it and releases the file resource at the end of the indented block:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">13</code><code class="p">]:</code> <code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="n">file_path</code><code class="p">,</code> <code class="s1">'r'</code><code class="p">)</code> <code class="k">as</code> <code class="n">open_file</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>     <code class="n">text</code> <code class="o">=</code> <code class="n">open_file</code><code class="o">.</code><code class="n">readlines</code><code class="p">()</code>&#13;
    <code class="o">...</code><code class="p">:</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">14</code><code class="p">]:</code> <code class="n">text</code><code class="p">[</code><code class="mi">101</code><code class="p">]</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">14</code><code class="p">]:</code> <code class="s1">'in the sane and healthy, also admits, of course, the existence of</code><code class="se">\n</code><code class="s1">'</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">15</code><code class="p">]:</code> <code class="n">open_file</code><code class="o">.</code><code class="n">closed</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">15</code><code class="p">]:</code> <code class="bp">True</code></pre>&#13;
&#13;
<p>Different operating systems use different escaped characters to represent line endings. Unix systems use <code>\n</code> and Windows systems use <code>\r\n</code>. Python converts these to <code>\n</code> when you open a file as text. If you are opening a binary file, such as a <em>.jpeg</em> image, you are likely to corrupt the data by this conversion if you open it as text. You can, however, read binary files by appending a <em>b</em> to mode:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">15</code><code class="p">]:</code> <code class="n">file_path</code> <code class="o">=</code> <code class="s1">'bookofdreamsghos00lang.pdf'</code>&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">16</code><code class="p">]:</code> <code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="n">file_path</code><code class="p">,</code> <code class="s1">'rb'</code><code class="p">)</code> <code class="k">as</code> <code class="n">open_file</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>     <code class="n">btext</code> <code class="o">=</code> <code class="n">open_file</code><code class="o">.</code><code class="n">read</code><code class="p">()</code>&#13;
    <code class="o">...</code><code class="p">:</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">17</code><code class="p">]:</code> <code class="n">btext</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">17</code><code class="p">]:</code> <code class="mi">37</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">18</code><code class="p">]:</code> <code class="n">btext</code><code class="p">[:</code><code class="mi">25</code><code class="p">]</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">18</code><code class="p">]:</code> <code class="s-Affix">b</code><code class="s1">'%PDF-1.5</code><code class="se">\n</code><code class="s1">%</code><code class="se">\xec\xf5\xf2\xe1\xe4\xef\xe3\xf5\xed\xe5\xee\xf4\n</code><code class="s1">18'</code></pre>&#13;
&#13;
<p>Adding this opens the file without any line-ending conversion.</p>&#13;
&#13;
<p>To write to a file, use the write mode, represented as the argument <code>w</code>. The tool <a data-primary="direnv" data-type="indexterm" id="idm46691346110152"/><code>direnv</code> is used to automatically set up some development environments. You can define environment variables and application runtimes in a file named <em>.envrc</em>; <code>direnv</code> uses it to set these things up when you enter the directory with the file. You can set the environment variable <code>STAGE</code> to <code>PROD</code> and <code>TABLE_ID</code> to <code>token-storage-1234</code> in such a file in Python by using <code>open</code> with the <code>write</code> flag:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">19</code><code class="p">]:</code> <code class="n">text</code> <code class="o">=</code> <code class="s1">'''export STAGE=PROD</code>&#13;
<code class="s1">    ...: export TABLE_ID=token-storage-1234'''</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">20</code><code class="p">]:</code> <code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="s1">'.envrc'</code><code class="p">,</code> <code class="s1">'w'</code><code class="p">)</code> <code class="k">as</code> <code class="n">opened_file</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>     <code class="n">opened_file</code><code class="o">.</code><code class="n">write</code><code class="p">(</code><code class="n">text</code><code class="p">)</code>&#13;
    <code class="o">...</code><code class="p">:</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">21</code><code class="p">]:</code> <code class="err">!</code><code class="n">cat</code> <code class="o">.</code><code class="n">envrc</code>&#13;
<code class="n">export</code> <code class="n">STAGE</code><code class="o">=</code><code class="n">PROD</code>&#13;
<code class="n">export</code> <code class="n">TABLE_ID</code><code class="o">=</code><code class="n">token</code><code class="o">-</code><code class="n">storage</code><code class="o">-</code><code class="mi">1234</code></pre>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>Be warned that <code>pathlib</code>’s <code>write</code> method will overwrite a file if it already exists.</p>&#13;
</div>&#13;
&#13;
<p>The <a data-primary="open() function" data-type="indexterm" id="idm46691346010008"/><code>open</code> function creates a file if it does not already exist and overwrites if it does. If you want to keep existing contents and only append the file, use the append flag <code>a</code>. This flag appends new text to the end of the file while keeping the original content. If you are writing nontext content, such as the contents of a <em>.jpeg</em> file, you are likely to corrupt it if you use either the <code>w</code> or <code>a</code> flag. This corruption is likely as Python converts line endings to platform-specific ones when it  writes text data. To write binary data, you can safely use <code>wb</code> or <code>ab</code>.</p>&#13;
&#13;
<p><a data-type="xref" href="ch03.html#working_with_the_command_line">Chapter 3</a> covers <code>pathlib</code> in depth. Two useful features are convenience functions for reading and writing files. <a data-primary="pathlib" data-type="indexterm" id="idm46691346004296"/><code>pathlib</code> handles the file object behind the scenes. The following allows you to read text from a file:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">35</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">pathlib</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">36</code><code class="p">]:</code> <code class="n">path</code> <code class="o">=</code> <code class="n">pathlib</code><code class="o">.</code><code class="n">Path</code><code class="p">(</code>&#13;
           <code class="s2">"/Users/kbehrman/projects/autoscaler/check_pending.py"</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">37</code><code class="p">]:</code> <code class="n">path</code><code class="o">.</code><code class="n">read_text</code><code class="p">()</code></pre>&#13;
&#13;
<p>To read binary data, use the <code>path.read_bytes</code> method.</p>&#13;
&#13;
<p>When you want to overwrite a file or write a new file, there are methods for writing text and for writing binary data:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">38</code><code class="p">]:</code> <code class="n">path</code> <code class="o">=</code> <code class="n">pathlib</code><code class="o">.</code><code class="n">Path</code><code class="p">(</code><code class="s2">"/Users/kbehrman/sp.config"</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">39</code><code class="p">]:</code> <code class="n">path</code><code class="o">.</code><code class="n">write_text</code><code class="p">(</code><code class="s2">"LOG:DEBUG"</code><code class="p">)</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">39</code><code class="p">]:</code> <code class="mi">9</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">40</code><code class="p">]:</code> <code class="n">path</code> <code class="o">=</code> <code class="n">pathlib</code><code class="o">.</code><code class="n">Path</code><code class="p">(</code><code class="s2">"/Users/kbehrman/sp"</code><code class="p">)</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">41</code><code class="p">]:</code> <code class="mi">8</code></pre>&#13;
&#13;
<p>Reading and writing using the file object’s <a data-primary="read() function" data-type="indexterm" id="idm46691345988616"/><a data-primary="write() function" data-type="indexterm" id="idm46691345869448"/><code>read</code> and <code>write</code> functions is usually adequate for unstructured text, but what if you are dealing with more complex data? The <a data-primary="JSON (Javascript Object Notation)" data-secondary="about" data-type="indexterm" id="idm46691345867848"/>Javascript Object Notation (JSON) format is widely used to store simple structured data in modern web services. It uses two data structures: a mapping of key-value pairs similar to a Python <code>dict</code> and a list of items somewhat similar to a Python <code>list</code>. It defines data types for numbers, strings, <em>booleans</em> (which hold true/false values), and <em>nulls</em> (empty values).&#13;
<a data-primary="Amazon Identity and Access Management (IAM) service" data-type="indexterm" id="idm46691345864808"/><a data-primary="IAM (Identity and Access Management) service" data-type="indexterm" id="idm46691345863976"/>The AWS Identity and Access Management (IAM) web service allows you to control access to AWS resources. It uses JSON files to define access policies, as in this sample file:</p>&#13;
&#13;
<pre data-code-language="json" data-type="programlisting"><code class="p">{</code>&#13;
    <code class="nt">"Version"</code><code class="p">:</code> <code class="s2">"2012-10-17"</code><code class="p">,</code>&#13;
    <code class="nt">"Statement"</code><code class="p">:</code> <code class="p">{</code>&#13;
        <code class="nt">"Effect"</code><code class="p">:</code> <code class="s2">"Allow"</code><code class="p">,</code>&#13;
        <code class="nt">"Action"</code><code class="p">:</code> <code class="s2">"service-prefix:action-name"</code><code class="p">,</code>&#13;
        <code class="nt">"Resource"</code><code class="p">:</code> <code class="s2">"*"</code><code class="p">,</code>&#13;
        <code class="nt">"Condition"</code><code class="p">:</code> <code class="p">{</code>&#13;
            <code class="nt">"DateGreaterThan"</code><code class="p">:</code> <code class="p">{</code><code class="nt">"aws:CurrentTime"</code><code class="p">:</code> <code class="s2">"2017-07-01T00:00:00Z"</code><code class="p">},</code>&#13;
            <code class="nt">"DateLessThan"</code><code class="p">:</code> <code class="p">{</code><code class="nt">"aws:CurrentTime"</code><code class="p">:</code> <code class="s2">"2017-12-31T23:59:59Z"</code><code class="p">}</code>&#13;
        <code class="p">}</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>You could use the standard file object <code>read</code> or <code>readlines</code> methods to get the data from such a file:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">8</code><code class="p">]:</code> <code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="s1">'service-policy.json'</code><code class="p">,</code> <code class="s1">'r'</code><code class="p">)</code> <code class="k">as</code> <code class="n">opened_file</code><code class="p">:</code>&#13;
   <code class="o">...</code><code class="p">:</code>     <code class="n">policy</code> <code class="o">=</code> <code class="n">opened_file</code><code class="o">.</code><code class="n">readlines</code><code class="p">()</code>&#13;
   <code class="o">...</code><code class="p">:</code>&#13;
   <code class="o">...</code><code class="p">:</code></pre>&#13;
&#13;
<p>The result would not be immediately usable, as it would be a single string or list of strings, depending on your chosen read method:</p>&#13;
&#13;
<pre class="pagebreak-before" data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">9</code><code class="p">]:</code> <code class="k">print</code><code class="p">(</code><code class="n">policy</code><code class="p">)</code>&#13;
<code class="p">[</code><code class="s1">'{</code><code class="se">\n</code><code class="s1">'</code><code class="p">,</code>&#13;
 <code class="s1">'    "Version": "2012-10-17",</code>&#13;
\<code class="n">n</code><code class="s1">',</code>&#13;
 <code class="s1">'    "Statement": {</code><code class="se">\n</code><code class="s1">'</code><code class="p">,</code>&#13;
 <code class="s1">'        "Effect": "Allow",</code>&#13;
\<code class="n">n</code><code class="s1">',</code>&#13;
 <code class="s1">'        "Action": "service-prefix:action-name",</code>&#13;
\<code class="n">n</code><code class="s1">',</code>&#13;
 <code class="s1">'        "Resource": "*",</code>&#13;
\<code class="n">n</code><code class="s1">',</code>&#13;
 <code class="s1">'        "Condition": {</code><code class="se">\n</code><code class="s1">'</code><code class="p">,</code>&#13;
 <code class="s1">'            "DateGreaterThan": {"aws:CurrentTime": "2017-07-01T00:00:00Z"},</code>&#13;
\<code class="n">n</code><code class="s1">',</code>&#13;
 <code class="s1">'            "DateLessThan": {"aws:CurrentTime": "2017-12-31T23:59:59Z"}</code><code class="se">\n</code><code class="s1">'</code><code class="p">,</code>&#13;
 <code class="s1">'        }</code><code class="se">\n</code><code class="s1">'</code><code class="p">,</code>&#13;
 <code class="s1">'    }</code><code class="se">\n</code><code class="s1">'</code><code class="p">,</code>&#13;
 <code class="s1">'}</code><code class="se">\n</code><code class="s1">'</code><code class="p">]</code></pre>&#13;
&#13;
<p>You would then need to parse this string (or strings) into data structures and types that match the original, which may be a great deal of work. A far better way is to use the <code>json</code> module:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">10</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">json</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">11</code><code class="p">]:</code> <code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="s1">'service-policy.json'</code><code class="p">,</code> <code class="s1">'r'</code><code class="p">)</code> <code class="k">as</code> <code class="n">opened_file</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>     <code class="n">policy</code> <code class="o">=</code> <code class="n">json</code><code class="o">.</code><code class="n">load</code><code class="p">(</code><code class="n">opened_file</code><code class="p">)</code>&#13;
    <code class="o">...</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code></pre>&#13;
&#13;
<p>This module parses the JSON format for you, returning the data in appropriate Python data structures:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">13</code><code class="p">]:</code> <code class="kn">from</code> <code class="nn">pprint</code> <code class="kn">import</code> <code class="n">pprint</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">14</code><code class="p">]:</code> <code class="n">pprint</code><code class="p">(</code><code class="n">policy</code><code class="p">)</code>&#13;
<code class="p">{</code><code class="s1">'Statement'</code><code class="p">:</code> <code class="p">{</code><code class="s1">'Action'</code><code class="p">:</code> <code class="s1">'service-prefix:action-name'</code><code class="p">,</code>&#13;
               <code class="s1">'Condition'</code><code class="p">:</code> <code class="p">{</code><code class="s1">'DateGreaterThan'</code><code class="p">:</code>&#13;
                                  <code class="p">{</code><code class="s1">'aws:CurrentTime'</code><code class="p">:</code> <code class="s1">'2017-07-01T00:00:00Z'</code><code class="p">},</code>&#13;
                             <code class="s1">'DateLessThan'</code><code class="p">:</code>&#13;
                                  <code class="p">{</code><code class="s1">'aws:CurrentTime'</code><code class="p">:</code> <code class="s1">'2017-12-31T23:59:59Z'</code><code class="p">}},</code>&#13;
               <code class="s1">'Effect'</code><code class="p">:</code> <code class="s1">'Allow'</code><code class="p">,</code>&#13;
               <code class="s1">'Resource'</code><code class="p">:</code> <code class="s1">'*'</code><code class="p">},</code>&#13;
 <code class="s1">'Version'</code><code class="p">:</code> <code class="s1">'2012-10-17'</code><code class="p">}</code></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The <code>pprint</code> module automatically formats Python objects for printing. Its output is often more easily read and is a handy way of looking at nested data structures.</p>&#13;
</div>&#13;
&#13;
<p>Now you can use the data with the original file structure. For example, here is how you would change the resource whose access this policy controls to <code>S3</code>:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">15</code><code class="p">]:</code> <code class="n">policy</code><code class="p">[</code><code class="s1">'Statement'</code><code class="p">][</code><code class="s1">'Resource'</code><code class="p">]</code> <code class="o">=</code> <code class="s1">'S3'</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">16</code><code class="p">]:</code> <code class="n">pprint</code><code class="p">(</code><code class="n">policy</code><code class="p">)</code>&#13;
<code class="p">{</code><code class="s1">'Statement'</code><code class="p">:</code> <code class="p">{</code><code class="s1">'Action'</code><code class="p">:</code> <code class="s1">'service-prefix:action-name'</code><code class="p">,</code>&#13;
               <code class="s1">'Condition'</code><code class="p">:</code> <code class="p">{</code><code class="s1">'DateGreaterThan'</code><code class="p">:</code>&#13;
                                <code class="p">{</code><code class="s1">'aws:CurrentTime'</code><code class="p">:</code> <code class="s1">'2017-07-01T00:00:00Z'</code><code class="p">},</code>&#13;
                             <code class="s1">'DateLessThan'</code><code class="p">:</code>&#13;
                                <code class="p">{</code><code class="s1">'aws:CurrentTime'</code><code class="p">:</code> <code class="s1">'2017-12-31T23:59:59Z'</code><code class="p">}},</code>&#13;
               <code class="s1">'Effect'</code><code class="p">:</code> <code class="s1">'Allow'</code><code class="p">,</code>&#13;
               <code class="s1">'Resource'</code><code class="p">:</code> <code class="s1">'S3'</code><code class="p">},</code>&#13;
 <code class="s1">'Version'</code><code class="p">:</code> <code class="s1">'2012-10-17'</code><code class="p">}</code></pre>&#13;
&#13;
<p>You can write a Python dictionary as a JSON file by using the <a data-primary="json.dump() method" data-type="indexterm" id="idm46691345491000"/><code>json.dump</code> method. This is how you would update the policy file you just modified:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">17</code><code class="p">]:</code> <code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="s1">'service-policy.json'</code><code class="p">,</code> <code class="s1">'w'</code><code class="p">)</code> <code class="k">as</code> <code class="n">opened_file</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>     <code class="n">policy</code> <code class="o">=</code> <code class="n">json</code><code class="o">.</code><code class="n">dump</code><code class="p">(</code><code class="n">policy</code><code class="p">,</code> <code class="n">opened_file</code><code class="p">)</code>&#13;
    <code class="o">...</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code></pre>&#13;
&#13;
<p>Another language commonly used in configuration files is <em>YAML</em>  (“YAML Ain’t Markup Language”). It is a superset of JSON, but has a more compact format, using whitespace similar to how Python uses it.</p>&#13;
&#13;
<p><a data-primary="Ansible" data-type="indexterm" id="idm46691345276472"/>Ansible is a tool used to automate software configuration, management, and deployment.&#13;
Ansible uses files, referred to as <em>playbooks</em>, to define actions you want to automate. These playbooks use the YAML format:</p>&#13;
&#13;
<pre data-code-language="yaml" data-type="programlisting"><code class="nn">---</code>&#13;
<code class="p-Indicator">-</code> <code class="nt">hosts</code><code class="p">:</code> <code class="l-Scalar-Plain">webservers</code>&#13;
  <code class="nt">vars</code><code class="p">:</code>&#13;
    <code class="nt">http_port</code><code class="p">:</code> <code class="l-Scalar-Plain">80</code>&#13;
    <code class="nt">max_clients</code><code class="p">:</code> <code class="l-Scalar-Plain">200</code>&#13;
  <code class="nt">remote_user</code><code class="p">:</code> <code class="l-Scalar-Plain">root</code>&#13;
  <code class="nt">tasks</code><code class="p">:</code>&#13;
  <code class="p-Indicator">-</code> <code class="nt">name</code><code class="p">:</code> <code class="l-Scalar-Plain">ensure apache is at the latest version</code>&#13;
    <code class="nt">yum</code><code class="p">:</code>&#13;
      <code class="nt">name</code><code class="p">:</code> <code class="l-Scalar-Plain">httpd</code>&#13;
      <code class="nt">state</code><code class="p">:</code> <code class="l-Scalar-Plain">latest</code>&#13;
  <code class="l-Scalar-Plain">...</code></pre>&#13;
&#13;
<p>The most commonly used library for parsing <a data-primary="YAML" data-type="indexterm" id="idm46691345384472"/>YAML files in Python is PyYAML. It is not in the Python Standard Library, but you can install it using <code>pip</code>:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>pip install PyYAML</pre>&#13;
&#13;
<p class="pagebreak-before">Once installed, you can use PyYAML to import and export YAML data much as you did with JSON:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">18</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">yaml</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">19</code><code class="p">]:</code> <code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="s1">'verify-apache.yml'</code><code class="p">,</code> <code class="s1">'r'</code><code class="p">)</code> <code class="k">as</code> <code class="n">opened_file</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>     <code class="n">verify_apache</code> <code class="o">=</code> <code class="n">yaml</code><code class="o">.</code><code class="n">safe_load</code><code class="p">(</code><code class="n">opened_file</code><code class="p">)</code>&#13;
    <code class="o">...</code><code class="p">:</code></pre>&#13;
&#13;
<p>The data loads as familiar Python data structures (a <code>list</code> containing a <code>dict</code>):</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">20</code><code class="p">]:</code> <code class="n">pprint</code><code class="p">(</code><code class="n">verify_apache</code><code class="p">)</code>&#13;
<code class="p">[{</code><code class="s1">'handlers'</code><code class="p">:</code> <code class="p">[{</code><code class="s1">'name'</code><code class="p">:</code> <code class="s1">'restart apache'</code><code class="p">,</code>&#13;
                <code class="s1">'service'</code><code class="p">:</code> <code class="p">{</code><code class="s1">'name'</code><code class="p">:</code> <code class="s1">'httpd'</code><code class="p">,</code> <code class="s1">'state'</code><code class="p">:</code> <code class="s1">'restarted'</code><code class="p">}}],</code>&#13;
  <code class="s1">'hosts'</code><code class="p">:</code> <code class="s1">'webservers'</code><code class="p">,</code>&#13;
  <code class="s1">'remote_user'</code><code class="p">:</code> <code class="s1">'root'</code><code class="p">,</code>&#13;
  <code class="s1">'tasks'</code><code class="p">:</code> <code class="p">[{</code><code class="s1">'name'</code><code class="p">:</code> <code class="s1">'ensure apache is at the latest version'</code><code class="p">,</code>&#13;
             <code class="s1">'yum'</code><code class="p">:</code> <code class="p">{</code><code class="s1">'name'</code><code class="p">:</code> <code class="s1">'httpd'</code><code class="p">,</code> <code class="s1">'state'</code><code class="p">:</code> <code class="s1">'latest'</code><code class="p">}},</code>&#13;
            <code class="p">{</code><code class="s1">'name'</code><code class="p">:</code> <code class="s1">'write the apache config file'</code><code class="p">,</code>&#13;
             <code class="s1">'notify'</code><code class="p">:</code> <code class="p">[</code><code class="s1">'restart apache'</code><code class="p">],</code>&#13;
             <code class="s1">'template'</code><code class="p">:</code> <code class="p">{</code><code class="s1">'dest'</code><code class="p">:</code> <code class="s1">'/etc/httpd.conf'</code><code class="p">,</code> <code class="s1">'src'</code><code class="p">:</code> <code class="s1">'/srv/httpd.j2'</code><code class="p">}},</code>&#13;
            <code class="p">{</code><code class="s1">'name'</code><code class="p">:</code> <code class="s1">'ensure apache is running'</code><code class="p">,</code>&#13;
             <code class="s1">'service'</code><code class="p">:</code> <code class="p">{</code><code class="s1">'name'</code><code class="p">:</code> <code class="s1">'httpd'</code><code class="p">,</code> <code class="s1">'state'</code><code class="p">:</code> <code class="s1">'started'</code><code class="p">}}],</code>&#13;
  <code class="s1">'vars'</code><code class="p">:</code> <code class="p">{</code><code class="s1">'http_port'</code><code class="p">:</code> <code class="mi">80</code><code class="p">,</code> <code class="s1">'max_clients'</code><code class="p">:</code> <code class="mi">200</code><code class="p">}}]</code></pre>&#13;
&#13;
<p>You can also save Python data to a file in YAML format:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">22</code><code class="p">]:</code> <code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="s1">'verify-apache.yml'</code><code class="p">,</code> <code class="s1">'w'</code><code class="p">)</code> <code class="k">as</code> <code class="n">opened_file</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>     <code class="n">yaml</code><code class="o">.</code><code class="n">dump</code><code class="p">(</code><code class="n">verify_apache</code><code class="p">,</code> <code class="n">opened_file</code><code class="p">)</code>&#13;
    <code class="o">...</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code></pre>&#13;
&#13;
<p>Another language widely used for representing structured data is <a data-primary="XML (Extensible Markup Language)" data-type="indexterm" id="idm46691344929816"/>Extensible Markup Language (XML). It consists of hierarchical documents of tagged elements. Historically, many web systems used XML to transport data. One such use is for Real Simple Syndication (RSS) feeds. RSS feeds are used to track and notify users of updates to websites and have been used to track the publication of articles from various sources. RSS feeds use XML-formatted pages.&#13;
Python offers the <code>xml</code> library for dealing with XML documents. It maps the XML documents’ hierarchical structure to a tree-like data structure. The nodes of the tree are elements, and a parent-child relationship is used to model the hierarchy. The top parent node is referred to as the root element. To parse an RSS XML document and get its root:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">xml.etree.ElementTree</code> <code class="kn">as</code> <code class="nn">ET</code>&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="n">tree</code> <code class="o">=</code> <code class="n">ET</code><code class="o">.</code><code class="n">parse</code><code class="p">(</code><code class="s1">'http_feeds.feedburner.com_oreilly_radar_atom.xml'</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">root</code> <code class="o">=</code> <code class="n">tree</code><code class="o">.</code><code class="n">getroot</code><code class="p">()</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">root</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="o">&lt;</code><code class="n">Element</code> <code class="s1">'{http://www.w3.org/2005/Atom}feed'</code> <code class="n">at</code> <code class="mh">0x11292c958</code><code class="o">&gt;</code></pre>&#13;
&#13;
<p>You can walk down the tree by iterating over the child nodes:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="k">for</code> <code class="n">child</code> <code class="ow">in</code> <code class="n">root</code><code class="p">:</code>&#13;
   <code class="o">...</code><code class="p">:</code>     <code class="k">print</code><code class="p">(</code><code class="n">child</code><code class="o">.</code><code class="n">tag</code><code class="p">,</code> <code class="n">child</code><code class="o">.</code><code class="n">attrib</code><code class="p">)</code>&#13;
   <code class="o">...</code><code class="p">:</code>&#13;
<code class="p">{</code><code class="n">http</code><code class="p">:</code><code class="o">//</code><code class="n">www</code><code class="o">.</code><code class="n">w3</code><code class="o">.</code><code class="n">org</code><code class="o">/</code><code class="mi">2005</code><code class="o">/</code><code class="n">Atom</code><code class="p">}</code><code class="n">title</code> <code class="p">{}</code>&#13;
<code class="p">{</code><code class="n">http</code><code class="p">:</code><code class="o">//</code><code class="n">www</code><code class="o">.</code><code class="n">w3</code><code class="o">.</code><code class="n">org</code><code class="o">/</code><code class="mi">2005</code><code class="o">/</code><code class="n">Atom</code><code class="p">}</code><code class="nb">id</code> <code class="p">{}</code>&#13;
<code class="p">{</code><code class="n">http</code><code class="p">:</code><code class="o">//</code><code class="n">www</code><code class="o">.</code><code class="n">w3</code><code class="o">.</code><code class="n">org</code><code class="o">/</code><code class="mi">2005</code><code class="o">/</code><code class="n">Atom</code><code class="p">}</code><code class="n">updated</code> <code class="p">{}</code>&#13;
<code class="p">{</code><code class="n">http</code><code class="p">:</code><code class="o">//</code><code class="n">www</code><code class="o">.</code><code class="n">w3</code><code class="o">.</code><code class="n">org</code><code class="o">/</code><code class="mi">2005</code><code class="o">/</code><code class="n">Atom</code><code class="p">}</code><code class="n">subtitle</code> <code class="p">{}</code>&#13;
<code class="p">{</code><code class="n">http</code><code class="p">:</code><code class="o">//</code><code class="n">www</code><code class="o">.</code><code class="n">w3</code><code class="o">.</code><code class="n">org</code><code class="o">/</code><code class="mi">2005</code><code class="o">/</code><code class="n">Atom</code><code class="p">}</code><code class="n">link</code> <code class="p">{</code><code class="s1">'href'</code><code class="p">:</code> <code class="s1">'https://www.oreilly.com'</code><code class="p">}</code>&#13;
<code class="p">{</code><code class="n">http</code><code class="p">:</code><code class="o">//</code><code class="n">www</code><code class="o">.</code><code class="n">w3</code><code class="o">.</code><code class="n">org</code><code class="o">/</code><code class="mi">2005</code><code class="o">/</code><code class="n">Atom</code><code class="p">}</code><code class="n">link</code> <code class="p">{</code><code class="s1">'rel'</code><code class="p">:</code> <code class="s1">'hub'</code><code class="p">,</code>&#13;
                                   <code class="s1">'href'</code><code class="p">:</code> <code class="s1">'http://pubsubhubbub.appspot.com/'</code><code class="p">}</code>&#13;
<code class="p">{</code><code class="n">http</code><code class="p">:</code><code class="o">//</code><code class="n">www</code><code class="o">.</code><code class="n">w3</code><code class="o">.</code><code class="n">org</code><code class="o">/</code><code class="mi">2003</code><code class="o">/</code><code class="mo">01</code><code class="o">/</code><code class="n">geo</code><code class="o">/</code><code class="n">wgs84_pos</code><code class="c1">#}long {}</code>&#13;
<code class="p">{</code><code class="n">http</code><code class="p">:</code><code class="o">//</code><code class="n">rssnamespace</code><code class="o">.</code><code class="n">org</code><code class="o">/</code><code class="n">feedburner</code><code class="o">/</code><code class="n">ext</code><code class="o">/</code><code class="mf">1.0</code><code class="p">}</code><code class="n">emailServiceId</code> <code class="p">{}</code>&#13;
<code class="o">...</code></pre>&#13;
&#13;
<p>XML allows for <a data-primary="namespacing" data-type="indexterm" id="idm46691344880120"/><em>namespacing</em> (using tags to group data). XML prepends tags with namespaces enclosed in brackets. If you know the structure of the hierarchy, you can search for elements by using their paths.  You can supply a dictionary that defines namespaces  as a convenience:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">108</code><code class="p">]:</code> <code class="n">ns</code> <code class="o">=</code> <code class="p">{</code><code class="s1">'default'</code><code class="p">:</code><code class="s1">'http://www.w3.org/2005/Atom'</code><code class="p">}</code>&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">106</code><code class="p">]:</code> <code class="n">authors</code> <code class="o">=</code> <code class="n">root</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s2">"default:entry/default:author/default:name"</code><code class="p">,</code> <code class="n">ns</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">107</code><code class="p">]:</code> <code class="k">for</code> <code class="n">author</code> <code class="ow">in</code> <code class="n">authors</code><code class="p">:</code>&#13;
     <code class="o">...</code><code class="p">:</code>     <code class="k">print</code><code class="p">(</code><code class="n">author</code><code class="o">.</code><code class="n">text</code><code class="p">)</code>&#13;
     <code class="o">...</code><code class="p">:</code>&#13;
<code class="n">Nat</code> <code class="n">Torkington</code>&#13;
<code class="n">VM</code> <code class="n">Brasseur</code>&#13;
<code class="n">Adam</code> <code class="n">Jacob</code>&#13;
<code class="n">Roger</code> <code class="n">Magoulas</code>&#13;
<code class="n">Pete</code> <code class="n">Skomoroch</code>&#13;
<code class="n">Adrian</code> <code class="n">Cockcroft</code>&#13;
<code class="n">Ben</code> <code class="n">Lorica</code>&#13;
<code class="n">Nat</code> <code class="n">Torkington</code>&#13;
<code class="n">Alison</code> <code class="n">McCauley</code>&#13;
<code class="n">Tiffani</code> <code class="n">Bell</code>&#13;
<code class="n">Arun</code> <code class="n">Gupta</code></pre>&#13;
&#13;
<p>You may find yourself dealing with data stored as comma-separated values (CSV). This format is common for spreadsheet data. You can use the Python <code>csv</code> module to read these easily:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">16</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">csv</code>&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">17</code><code class="p">]:</code> <code class="n">file_path</code> <code class="o">=</code> <code class="s1">'/Users/kbehrman/Downloads/registered_user_count_ytd.csv'</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">18</code><code class="p">]:</code> <code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="n">file_path</code><code class="p">,</code> <code class="n">newline</code><code class="o">=</code><code class="s1">''</code><code class="p">)</code> <code class="k">as</code> <code class="n">csv_file</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>     <code class="n">off_reader</code> <code class="o">=</code> <code class="n">csv</code><code class="o">.</code><code class="n">reader</code><code class="p">(</code><code class="n">csv_file</code><code class="p">,</code> <code class="n">delimiter</code><code class="o">=</code><code class="s1">','</code><code class="p">)</code>&#13;
    <code class="o">...</code><code class="p">:</code>     <code class="k">for</code> <code class="n">_</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">5</code><code class="p">):</code>&#13;
    <code class="o">...</code><code class="p">:</code>         <code class="k">print</code><code class="p">(</code><code class="nb">next</code><code class="p">(</code><code class="n">off_reader</code><code class="p">))</code>&#13;
    <code class="o">...</code><code class="p">:</code>&#13;
<code class="p">[</code><code class="s1">'Date'</code><code class="p">,</code> <code class="s1">'PreviousUserCount'</code><code class="p">,</code> <code class="s1">'UserCountTotal'</code><code class="p">,</code> <code class="s1">'UserCountDay'</code><code class="p">]</code>&#13;
<code class="p">[</code><code class="s1">'2014-01-02'</code><code class="p">,</code> <code class="s1">'61'</code><code class="p">,</code> <code class="s1">'5336'</code><code class="p">,</code> <code class="s1">'5275'</code><code class="p">]</code>&#13;
<code class="p">[</code><code class="s1">'2014-01-03'</code><code class="p">,</code> <code class="s1">'42'</code><code class="p">,</code> <code class="s1">'5378'</code><code class="p">,</code> <code class="s1">'5336'</code><code class="p">]</code>&#13;
<code class="p">[</code><code class="s1">'2014-01-04'</code><code class="p">,</code> <code class="s1">'26'</code><code class="p">,</code> <code class="s1">'5404'</code><code class="p">,</code> <code class="s1">'5378'</code><code class="p">]</code>&#13;
<code class="p">[</code><code class="s1">'2014-01-05'</code><code class="p">,</code> <code class="s1">'65'</code><code class="p">,</code> <code class="s1">'5469'</code><code class="p">,</code> <code class="s1">'5404'</code><code class="p">]</code></pre>&#13;
&#13;
<p>The <code>csv</code> reader object iterates through the <em>.csv</em> file one line at a time, allowing you to process the data one row at a time. Processing a file this way is especially useful for large <em>.csv</em> files that you do not want to read into memory all at once. Of course, if you need to do multiple row calculations across columns and the file is not overly large, you should load it all at once.</p>&#13;
&#13;
<p>The <a data-primary="Pandas package" data-type="indexterm" id="idm46691344433688"/>Pandas package is a mainstay in the data science world. It includes a data structure, the <code>pandas.DataFrame</code>, which acts like a data table, similar to a very powerful spreadsheet. If you have table-like data on which you want to do statistical analysis or that you want to manipulate by rows and columns, DataFrames is the tool for you.&#13;
It is a third-party library, so you need to install it with <code>pip</code>. You can use a variety of methods to load data into the DataFrames; one of the most common is from a <em>.csv</em> file:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">54</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">pandas</code> <code class="kn">as</code> <code class="nn">pd</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">55</code><code class="p">]:</code> <code class="n">df</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="s1">'sample-data.csv'</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">56</code><code class="p">]:</code> <code class="nb">type</code><code class="p">(</code><code class="n">df</code><code class="p">)</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">56</code><code class="p">]:</code> <code class="n">pandas</code><code class="o">.</code><code class="n">core</code><code class="o">.</code><code class="n">frame</code><code class="o">.</code><code class="n">DataFrame</code></pre>&#13;
&#13;
<p>You can take a look at the top rows of your DataFrame using the <a data-primary="head() method" data-type="indexterm" id="idm46691344348888"/><code>head</code> method:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">57</code><code class="p">]:</code> <code class="n">df</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">3</code><code class="p">)</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">57</code><code class="p">]:</code>&#13;
   <code class="n">Attributes</code>     <code class="nb">open</code>       <code class="n">high</code>        <code class="n">low</code>      <code class="n">close</code>     <code class="n">volume</code>&#13;
<code class="mi">0</code>     <code class="n">Symbols</code>        <code class="n">F</code>          <code class="n">F</code>          <code class="n">F</code>          <code class="n">F</code>          <code class="n">F</code>&#13;
<code class="mi">1</code>        <code class="n">date</code>      <code class="n">NaN</code>        <code class="n">NaN</code>        <code class="n">NaN</code>        <code class="n">NaN</code>        <code class="n">NaN</code>&#13;
<code class="mi">2</code>  <code class="mi">2018</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">02</code>  <code class="mf">11.3007</code>    <code class="mf">11.4271</code>    <code class="mf">11.2827</code>    <code class="mf">11.4271</code>   <code class="mi">20773320</code></pre>&#13;
&#13;
<p>You can get a statistical insight using the <a data-primary="describe() method" data-type="indexterm" id="idm46691344364488"/><code>describe</code> method:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">58</code><code class="p">]:</code> <code class="n">df</code><code class="o">.</code><code class="n">describe</code><code class="p">()</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">58</code><code class="p">]:</code>&#13;
        <code class="n">Attributes</code>    <code class="nb">open</code>      <code class="n">high</code>    <code class="n">low</code>     <code class="n">close</code>     <code class="n">volume</code>&#13;
<code class="n">count</code>          <code class="mi">357</code>     <code class="mi">356</code>       <code class="mi">356</code>    <code class="mi">356</code>       <code class="mi">356</code>        <code class="mi">356</code>&#13;
<code class="n">unique</code>         <code class="mi">357</code>     <code class="mi">290</code>       <code class="mi">288</code>    <code class="mi">297</code>       <code class="mi">288</code>        <code class="mi">356</code>&#13;
<code class="n">top</code>     <code class="mi">2018</code><code class="o">-</code><code class="mi">10</code><code class="o">-</code><code class="mi">18</code>  <code class="mf">10.402</code>    <code class="mf">8.3363</code>   <code class="mf">10.2</code>    <code class="mf">9.8111</code>   <code class="mi">36298597</code>&#13;
<code class="n">freq</code>             <code class="mi">1</code>       <code class="mi">5</code>         <code class="mi">4</code>      <code class="mi">3</code>         <code class="mi">4</code>          <code class="mi">1</code></pre>&#13;
&#13;
<p>Alternatively, you can view a single column of data by using its name in square <span class="keep-together">brackets:</span></p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">59</code><code class="p">]:</code> <code class="n">df</code><code class="p">[</code><code class="s1">'close'</code><code class="p">]</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">59</code><code class="p">]:</code>&#13;
<code class="mi">0</code>            <code class="n">F</code>&#13;
<code class="mi">1</code>          <code class="n">NaN</code>&#13;
<code class="mi">2</code>      <code class="mf">11.4271</code>&#13;
<code class="mi">3</code>      <code class="mf">11.5174</code>&#13;
<code class="mi">4</code>      <code class="mf">11.7159</code>&#13;
        <code class="o">...</code>&#13;
<code class="mi">352</code>       <code class="mf">9.83</code>&#13;
<code class="mi">353</code>       <code class="mf">9.78</code>&#13;
<code class="mi">354</code>       <code class="mf">9.71</code>&#13;
<code class="mi">355</code>       <code class="mf">9.74</code>&#13;
<code class="mi">356</code>       <code class="mf">9.52</code>&#13;
<code class="n">Name</code><code class="p">:</code> <code class="n">close</code><code class="p">,</code> <code class="n">Length</code><code class="p">:</code> <code class="mi">357</code><code class="p">,</code> <code class="n">dtype</code><code class="p">:</code> <code class="nb">object</code></pre>&#13;
&#13;
<p>Pandas has many more methods for analyzing and manipulating table-like data, and there are many books on its use. It is a tool you should be aware of if you have the need to do data analysis.<a data-startref="ix_ch02-asciidoc3" data-type="indexterm" id="idm46691344133176"/><a data-startref="ix_ch02-asciidoc2" data-type="indexterm" id="idm46691344071784"/><a data-startref="ix_ch02-asciidoc1" data-type="indexterm" id="idm46691344071176"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using Regular Expressions to Search Text" data-type="sect1"><div class="sect1" id="idm46691346529176">&#13;
<h1>Using Regular Expressions to Search Text</h1>&#13;
&#13;
<p><a data-primary="automating files and the filesystem" data-secondary="searching text with regular expressions" data-type="indexterm" id="idm46691344069960"/><a data-primary="regular expressions" data-secondary="pulling information from log with" data-type="indexterm" id="idm46691344069048"/><a data-primary="searching" data-type="indexterm" id="idm46691344068136"/>The <a data-primary="Apache HTTP server" data-type="indexterm" id="idm46691344067336"/>Apache HTTP server is an open source web server widely used to serve web content. The web server can be configured to save log files in different formats. One widely used format is the Common Log Format (CLF). A variety of log analysis tools can understand this format. Below is the layout of this format:</p>&#13;
&#13;
<pre data-type="programlisting">&lt;IP Address&gt; &lt;Client Id&gt; &lt;User Id&gt; &lt;Time&gt; &lt;Request&gt; &lt;Status&gt; &lt;Size&gt;</pre>&#13;
&#13;
<p>What follows is an example line from a log in this format:</p>&#13;
&#13;
<pre class="small" data-type="programlisting">127.0.0.1 - swills [13/Nov/2019:14:43:30 -0800] "GET /assets/234 HTTP/1.0" 200 2326</pre>&#13;
&#13;
<p><a data-type="xref" href="ch01.html#python_essentials_for_devops">Chapter 1</a> introduced you to regular expressions and the Python <code>re</code> module, so let’s use it to pull information from a log in the common log format. One trick to constructing regular expressions is to do it in sections. Doing so enables you to get each subexpression working without the complication of debugging the whole expression. You can create a regular expression using named groups to pull out the IP address from a line:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="n">line</code> <code class="o">=</code> <code class="s1">'127.0.0.1 - rj [13/Nov/2019:14:43:30] "GET HTTP/1.0" 200'</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="n">re</code><code class="o">.</code><code class="n">search</code><code class="p">(</code><code class="s-Affix">r</code><code class="s1">'(?P&lt;IP&gt;\d+\.\d+\.\d+\.\d+)'</code><code class="p">,</code> <code class="n">line</code><code class="p">)</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="o">&lt;</code><code class="n">re</code><code class="o">.</code><code class="n">Match</code> <code class="nb">object</code><code class="p">;</code> <code class="n">span</code><code class="o">=</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">9</code><code class="p">),</code> <code class="n">match</code><code class="o">=</code><code class="s1">'127.0.0.1'</code><code class="o">&gt;</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">m</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">search</code><code class="p">(</code><code class="s-Affix">r</code><code class="s1">'(?P&lt;IP&gt;\d+\.\d+\.\d+\.\d+)'</code><code class="p">,</code> <code class="n">line</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">(</code><code class="s1">'IP'</code><code class="p">)</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="s1">'127.0.0.1'</code></pre>&#13;
&#13;
<p>You can also create a regular expression to get the time:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="n">r</code> <code class="o">=</code> <code class="s-Affix">r</code><code class="s1">'\[(?P&lt;Time&gt;\d\d/\w{3}/\d{4}:\d{2}:\d{2}:\d{2})\]'</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="n">m</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">search</code><code class="p">(</code><code class="n">r</code><code class="p">,</code> <code class="n">line</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">(</code><code class="s1">'Time'</code><code class="p">)</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="s1">'13/Nov/2019:14:43:30'</code></pre>&#13;
&#13;
<p>You can grab multiple elements, as has been done here: the IP, user, time, and request:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">8</code><code class="p">]:</code>  <code class="n">r</code> <code class="o">=</code> <code class="s-Affix">r</code><code class="s1">'(?P&lt;IP&gt;\d+\.\d+\.\d+\.\d+)'</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">9</code><code class="p">]:</code> <code class="n">r</code> <code class="o">+=</code> <code class="s-Affix">r</code><code class="s1">' - (?P&lt;User&gt;\w+) '</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">10</code><code class="p">]:</code> <code class="n">r</code> <code class="o">+=</code> <code class="s-Affix">r</code><code class="s1">'\[(?P&lt;Time&gt;\d\d/\w{3}/\d{4}:\d{2}:\d{2}:\d{2})\]'</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">11</code><code class="p">]:</code> <code class="n">r</code> <code class="o">+=</code> <code class="s-Affix">r</code><code class="s1">' (?P&lt;Request&gt;".+")'</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">12</code><code class="p">]:</code>  <code class="n">m</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">search</code><code class="p">(</code><code class="n">r</code><code class="p">,</code> <code class="n">line</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">13</code><code class="p">]:</code> <code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">(</code><code class="s1">'IP'</code><code class="p">)</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">13</code><code class="p">]:</code> <code class="s1">'127.0.0.1'</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">14</code><code class="p">]:</code> <code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">(</code><code class="s1">'User'</code><code class="p">)</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">14</code><code class="p">]:</code> <code class="s1">'rj'</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">15</code><code class="p">]:</code> <code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">(</code><code class="s1">'Time'</code><code class="p">)</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">15</code><code class="p">]:</code> <code class="s1">'13/Nov/2019:14:43:30'</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">16</code><code class="p">]:</code> <code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">(</code><code class="s1">'Request'</code><code class="p">)</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">16</code><code class="p">]:</code> <code class="s1">'"GET HTTP/1.0"'</code></pre>&#13;
&#13;
<p>Parsing a single line of a log is interesting but not terribly useful. However, you can use this regular expression as a basis for designing one to pull information from the whole log. Let’s say you want to pull all of the IP addresses for <code>GET</code> requests that happened on November 8, 2019. Using the preceding expression, you make modifications based on the specifics of your request:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">62</code><code class="p">]:</code> <code class="n">r</code> <code class="o">=</code> <code class="s-Affix">r</code><code class="s1">'(?P&lt;IP&gt;\d+\.\d+\.\d+\.\d+)'</code>&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">63</code><code class="p">]:</code> <code class="n">r</code> <code class="o">+=</code> <code class="s-Affix">r</code><code class="s1">'- (?P&lt;User&gt;\w+)'</code>&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">64</code><code class="p">]:</code> <code class="n">r</code> <code class="o">+=</code> <code class="s-Affix">r</code><code class="s1">'\[(?P&lt;Time&gt;08/Nov/\d{4}:\d{2}:\d{2}:\d{2} [-+]\d{4})\]'</code>&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">65</code><code class="p">]:</code> <code class="n">r</code> <code class="o">+=</code> <code class="s-Affix">r</code><code class="s1">' (?P&lt;Request&gt;"GET .+")'</code></pre>&#13;
&#13;
<p>Use the <a data-primary="finditer() method" data-type="indexterm" id="idm46691343682840"/><code>finditer</code> method to process the log,  printing the IP addresses of the matching lines:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">66</code><code class="p">]:</code> <code class="n">matched</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">finditer</code><code class="p">(</code><code class="n">r</code><code class="p">,</code> <code class="n">access_log</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">67</code><code class="p">]:</code> <code class="k">for</code> <code class="n">m</code> <code class="ow">in</code> <code class="n">matched</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>     <code class="k">print</code><code class="p">(</code><code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">(</code><code class="s1">'IP'</code><code class="p">))</code>&#13;
    <code class="o">...</code><code class="p">:</code>&#13;
<code class="mf">127.0</code><code class="o">.</code><code class="mf">0.1</code>&#13;
<code class="mf">342.3</code><code class="o">.</code><code class="mf">2.33</code></pre>&#13;
&#13;
<p>There is a lot that you can do with regular expressions and texts of all sorts.  If they do not daunt you, you will find them one of the most powerful tools in dealing with text.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Dealing with Large Files" data-type="sect1"><div class="sect1" id="idm46691346528584">&#13;
<h1>Dealing with Large Files</h1>&#13;
&#13;
<p><a data-primary="automating files and the filesystem" data-secondary="large files" data-type="indexterm" id="idm46691343595304"/><a data-primary="large files, automating" data-type="indexterm" id="idm46691343594360"/>There are times that you need to process very large files. If the files contain data that can be processed one line at a time, the task is easy with Python. Rather than loading the whole file into memory as you have done up until now, you can read one line at a time, process the line, and then move to the next. The lines are removed from memory automatically by Python’s garbage collector, freeing up memory.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Python automatically allocates and frees memory. <a data-primary="garbage collection" data-type="indexterm" id="idm46691343592152"/>Garbage collection is one means of doing this. The Python garbage collector can be controlled using the <code>gc</code> package, though this is rarely needed.</p>&#13;
</div>&#13;
&#13;
<p>The fact that operating systems use alternate line endings can be a hassle when reading a file created on a different OS. Windows-created files have <code>\r</code> characters in addition to <code>\n</code>. These show up as part of the text on a Linux-based system. If you have a large file and you want to correct the line endings to fit your current OS, you can open the file, read one line at a time, and save it to a new file. Python handles the line-ending translation for you:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">23</code><code class="p">]:</code> <code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="s1">'big-data.txt'</code><code class="p">,</code> <code class="s1">'r'</code><code class="p">)</code> <code class="k">as</code> <code class="n">source_file</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>     <code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="s1">'big-data-corrected.txt'</code><code class="p">,</code> <code class="s1">'w'</code><code class="p">)</code> <code class="k">as</code> <code class="n">target_file</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>         <code class="k">for</code> <code class="n">line</code> <code class="ow">in</code> <code class="n">source_file</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>             <code class="n">target_file</code><code class="o">.</code><code class="n">write</code><code class="p">(</code><code class="n">line</code><code class="p">)</code>&#13;
    <code class="o">...</code><code class="p">:</code></pre>&#13;
&#13;
<p>Notice that you can nest the <code>with</code> statements to open two files at once and loop through the source file object one line at a time. You can define a generator function to handle this, especially if you need to parse multiple files a single line at a time:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">46</code><code class="p">]:</code> <code class="k">def</code> <code class="nf">line_reader</code><code class="p">(</code><code class="n">file_path</code><code class="p">):</code>&#13;
    <code class="o">...</code><code class="p">:</code>     <code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="n">file_path</code><code class="p">,</code> <code class="s1">'r'</code><code class="p">)</code> <code class="k">as</code> <code class="n">source_file</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>         <code class="k">for</code> <code class="n">line</code> <code class="ow">in</code> <code class="n">source_file</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>             <code class="k">yield</code> <code class="n">line</code>&#13;
    <code class="o">...</code><code class="p">:</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">47</code><code class="p">]:</code> <code class="n">reader</code> <code class="o">=</code> <code class="n">line_reader</code><code class="p">(</code><code class="s1">'big-data.txt'</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">48</code><code class="p">]:</code> <code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="s1">'big-data-corrected.txt'</code><code class="p">,</code> <code class="s1">'w'</code><code class="p">)</code> <code class="k">as</code> <code class="n">target_file</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>     <code class="k">for</code> <code class="n">line</code> <code class="ow">in</code> <code class="n">reader</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>         <code class="n">target_file</code><code class="o">.</code><code class="n">write</code><code class="p">(</code><code class="n">line</code><code class="p">)</code>&#13;
    <code class="o">...</code><code class="p">:</code></pre>&#13;
&#13;
<p>If you do not or cannot use line endings as a means of breaking up your data, as in the case of a large binary file, you can read your data in chunks.  You pass the number of bytes read in each chunk to the file objects <code>read</code> method. When there is nothing left to read, the expression returns an empty string:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">27</code><code class="p">]:</code> <code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="s1">'bb141548a754113e.jpg'</code><code class="p">,</code> <code class="s1">'rb'</code><code class="p">)</code> <code class="k">as</code> <code class="n">source_file</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>     <code class="k">while</code> <code class="bp">True</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>         <code class="n">chunk</code> <code class="o">=</code> <code class="n">source_file</code><code class="o">.</code><code class="n">read</code><code class="p">(</code><code class="mi">1024</code><code class="p">)</code>&#13;
    <code class="o">...</code><code class="p">:</code>         <code class="k">if</code> <code class="n">chunk</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>             <code class="n">process_data</code><code class="p">(</code><code class="n">chunk</code><code class="p">)</code>&#13;
    <code class="o">...</code><code class="p">:</code>         <code class="k">else</code><code class="p">:</code>&#13;
    <code class="o">...</code><code class="p">:</code>             <code class="k">break</code>&#13;
    <code class="o">...</code><code class="p">:</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Encrypting Text" data-type="sect1"><div class="sect1" id="idm46691343402920">&#13;
<h1>Encrypting Text</h1>&#13;
&#13;
<p><a data-primary="automating files and the filesystem" data-secondary="encrypting text" data-type="indexterm" id="ix_ch02-asciidoc4"/><a data-primary="encrypting text" data-type="indexterm" id="ix_ch02-asciidoc5"/>There are many times you need to encrypt text to ensure security. In addition to Python’s built-in package <code>hashlib</code>, there is a widely used third-party package called <code>cryptography</code>. Let’s take a look at both.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Hashing with Hashlib" data-type="sect2"><div class="sect2" id="idm46691343287016">&#13;
<h2>Hashing with Hashlib</h2>&#13;
&#13;
<p><a data-primary="automating files and the filesystem" data-secondary="hashing with hashlib" data-type="indexterm" id="idm46691343285816"/><a data-primary="encrypting text" data-secondary="hashing with hashlib" data-type="indexterm" id="idm46691343284648"/><a data-primary="hashing" data-type="indexterm" id="idm46691343283704"/><a data-primary="hashlib" data-type="indexterm" id="idm46691343283032"/>To be secure, user passwords must be stored encrypted. A common way to handle this is to use a one-way function to encrypt the password into a bit string, which is very hard to reverse engineer.&#13;
Functions that do this are called <a data-primary="hash functions" data-type="indexterm" id="idm46691343281992"/><em>hash functions</em>. In addition to obscuring passwords, hash functions ensure that documents sent over the web are unchanged during transmission. You run the hash function on the document and send the result along with the document. The recipient can then confirm that the value is the same when they hash the document. The <code>hashlib</code> includes secure algorithms for doing this, including <em>SHA1</em>, <em>SHA224</em>, <em>SHA384</em>, <em>SHA512</em>, and RSA’s <em>MD5</em>. This is how you would hash a password using the MD5 algorithm:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">62</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">hashlib</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">63</code><code class="p">]:</code> <code class="n">secret</code> <code class="o">=</code> <code class="s2">"This is the password or document text"</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">64</code><code class="p">]:</code> <code class="n">bsecret</code> <code class="o">=</code> <code class="n">secret</code><code class="o">.</code><code class="n">encode</code><code class="p">()</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">65</code><code class="p">]:</code> <code class="n">m</code> <code class="o">=</code> <code class="n">hashlib</code><code class="o">.</code><code class="n">md5</code><code class="p">()</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">66</code><code class="p">]:</code> <code class="n">m</code><code class="o">.</code><code class="n">update</code><code class="p">(</code><code class="n">bsecret</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">67</code><code class="p">]:</code> <code class="n">m</code><code class="o">.</code><code class="n">digest</code><code class="p">()</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">67</code><code class="p">]:</code> <code class="s-Affix">b</code><code class="s1">' </code><code class="se">\xf5\x06\xe6\xfc\x1c\xbe\x86\xdd</code><code class="s1">j</code><code class="se">\x96</code><code class="s1">C</code><code class="se">\x10\x0f</code><code class="s1">5E'</code></pre>&#13;
&#13;
<p>Notice that if your password or document is a string, you need to turn it into a binary string by using the <code>encode</code> method.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Encryption with Cryptography" data-type="sect2"><div class="sect2" id="idm46691343274664">&#13;
<h2>Encryption with Cryptography</h2>&#13;
&#13;
<p><a data-primary="cryptography library" data-type="indexterm" id="ix_ch02-asciidoc6"/><a data-primary="encrypting text" data-secondary="cryptography library" data-type="indexterm" id="ix_ch02-asciidoc7"/>The <code>cryptography</code> library is a popular choice for handling encryption problems in Python. It is a third-party package, so you must install it with <code>pip</code>.&#13;
<a data-primary="symmetric key encryption" data-type="indexterm" id="idm46691343201192"/><em>Symmetric key encryption</em> is a group of encryption algorithms based on shared keys. These <span class="keep-together">algorithms</span> include Advanced Encryption Algorithm (AES), Blowfish, Data Encryption Standard (DES), Serpent, and Twofish. A shared key is similar to a password that is used to both encrypt and decrypt text.&#13;
The fact that both the creator and the reader of an encrypted file need to share the key is a drawback when compared to <a data-primary="asymmetric key encryption" data-type="indexterm" id="idm46691343199112"/><em>asymmetric key encryption</em>, which we will touch on later. However, symmetric key encryption is faster and more straightforward, and so is appropriate for encrypting large files. Fernet is an implementation of the popular AES algorithm.&#13;
You first need to generate a key:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="kn">from</code> <code class="nn">cryptography.fernet</code> <code class="kn">import</code> <code class="n">Fernet</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="n">key</code> <code class="o">=</code> <code class="n">Fernet</code><code class="o">.</code><code class="n">generate_key</code><code class="p">()</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">key</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="s-Affix">b</code><code class="s1">'q-fEOs2JIRINDR8toMG7zhQvVhvf5BRPx3mj5Atk5B8='</code></pre>&#13;
&#13;
<p>You need to store this key securely, as you need it to decrypt. Keep in mind that anyone who has access to it is also able to decrypt your files. If you choose to save the key to a file, use the binary data type. The next step is to encrypt the data using the <span class="keep-together"><code>Fernet</code></span> object:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">f</code> <code class="o">=</code> <code class="n">Fernet</code><code class="p">(</code><code class="n">key</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="n">message</code> <code class="o">=</code> <code class="s-Affix">b</code><code class="s2">"Secrets go here"</code>&#13;
&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="n">encrypted</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="n">encrypt</code><code class="p">(</code><code class="n">message</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="n">encrypted</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="s-Affix">b</code><code class="s1">'gAAAAABdPyg4 ... plhkpVkC8ezOHaOLIA=='</code></pre>&#13;
&#13;
<p>You can decrypt the data using a <code>Fernet</code> object created with the same key:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="n">f</code> <code class="o">=</code> <code class="n">Fernet</code><code class="p">(</code><code class="n">key</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="n">f</code><code class="o">.</code><code class="n">decrypt</code><code class="p">(</code><code class="n">encrypted</code><code class="p">)</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="s-Affix">b</code><code class="s1">'Secrets go here'</code></pre>&#13;
&#13;
<p>Asymmetric key encryption uses a pair of keys, one public and one private. The public key is designed to be widely shared, while a single user holds the private one. The only way you can decrypt messages that have been encrypted using your public key is by using your private key. This style of encryption is widely used to pass information confidentially both on local networks and across the internet. One very popular asymmetric key algorithm is Rivest-Shamir-Adleman (RSA), which is widely used for communication across networks. The cryptography library offers the ability to create public/private key pairs:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="kn">from</code> <code class="nn">cryptography.hazmat.backends</code> <code class="kn">import</code> <code class="n">default_backend</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="kn">from</code> <code class="nn">cryptography.hazmat.primitives.asymmetric</code> <code class="kn">import</code> <code class="n">rsa</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">private_key</code> <code class="o">=</code> <code class="n">rsa</code><code class="o">.</code><code class="n">generate_private_key</code><code class="p">(</code><code class="n">public_exponent</code><code class="o">=</code><code class="mi">65537</code><code class="p">,</code>&#13;
                                               <code class="n">key_size</code><code class="o">=</code><code class="mi">4096</code><code class="p">,</code>&#13;
                                               <code class="n">backend</code><code class="o">=</code><code class="n">default_backend</code><code class="p">())</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">private_key</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="o">&lt;</code><code class="n">cryptography</code><code class="o">.</code><code class="n">hazmat</code><code class="o">.</code><code class="n">backends</code><code class="o">.</code><code class="n">openssl</code><code class="o">.</code><code class="n">rsa</code><code class="o">.</code><code class="n">_RSAPrivateKey</code> <code class="n">at</code> <code class="mh">0x10d377c18</code><code class="o">&gt;</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="n">public_key</code> <code class="o">=</code> <code class="n">private_key</code><code class="o">.</code><code class="n">public_key</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="n">public_key</code> <code class="o">=</code> <code class="n">private_key</code><code class="o">.</code><code class="n">public_key</code><code class="p">()</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="n">public_key</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="o">&lt;</code><code class="n">cryptography</code><code class="o">.</code><code class="n">hazmat</code><code class="o">.</code><code class="n">backends</code><code class="o">.</code><code class="n">openssl</code><code class="o">.</code><code class="n">rsa</code><code class="o">.</code><code class="n">_RSAPublicKey</code> <code class="n">at</code> <code class="mh">0x10da642b0</code><code class="o">&gt;</code></pre>&#13;
&#13;
<p>You can then use the public key to encrypt:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">8</code><code class="p">]:</code> <code class="n">message</code> <code class="o">=</code> <code class="s-Affix">b</code><code class="s2">"More secrets go here"</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">9</code><code class="p">]:</code> <code class="kn">from</code> <code class="nn">cryptography.hazmat.primitives.asymmetric</code> <code class="kn">import</code> <code class="n">padding</code>&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">11</code><code class="p">]:</code> <code class="kn">from</code> <code class="nn">cryptography.hazmat.primitives</code> <code class="kn">import</code> <code class="n">hashes</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">12</code><code class="p">]:</code> <code class="n">encrypted</code> <code class="o">=</code> <code class="n">public_key</code><code class="o">.</code><code class="n">encrypt</code><code class="p">(</code><code class="n">message</code><code class="p">,</code>&#13;
    <code class="o">...</code><code class="p">:</code>    <code class="n">padding</code><code class="o">.</code><code class="n">OAEP</code><code class="p">(</code><code class="n">mgf</code><code class="o">=</code><code class="n">padding</code><code class="o">.</code><code class="n">MGF1</code><code class="p">(</code><code class="n">algorithm</code><code class="o">=</code><code class="n">hashes</code><code class="o">.</code><code class="n">SHA256</code><code class="p">()),</code>&#13;
    <code class="o">...</code><code class="p">:</code>    <code class="n">algorithm</code><code class="o">=</code><code class="n">hashes</code><code class="o">.</code><code class="n">SHA256</code><code class="p">(),</code>&#13;
    <code class="o">...</code><code class="p">:</code>    <code class="n">label</code><code class="o">=</code><code class="bp">None</code><code class="p">))</code></pre>&#13;
&#13;
<p>You can use the private key to decrypt messages<a data-startref="ix_ch02-asciidoc7" data-type="indexterm" id="idm46691342839448"/><a data-startref="ix_ch02-asciidoc6" data-type="indexterm" id="idm46691342838840"/>:<a data-startref="ix_ch02-asciidoc5" data-type="indexterm" id="idm46691342813240"/><a data-startref="ix_ch02-asciidoc4" data-type="indexterm" id="idm46691342812536"/></p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">13</code><code class="p">]:</code> <code class="n">decrypted</code> <code class="o">=</code> <code class="n">private_key</code><code class="o">.</code><code class="n">decrypt</code><code class="p">(</code><code class="n">encrypted</code><code class="p">,</code>&#13;
    <code class="o">...</code><code class="p">:</code>    <code class="n">padding</code><code class="o">.</code><code class="n">OAEP</code><code class="p">(</code><code class="n">mgf</code><code class="o">=</code><code class="n">padding</code><code class="o">.</code><code class="n">MGF1</code><code class="p">(</code><code class="n">algorithm</code><code class="o">=</code><code class="n">hashes</code><code class="o">.</code><code class="n">SHA256</code><code class="p">()),</code>&#13;
    <code class="o">...</code><code class="p">:</code>    <code class="n">algorithm</code><code class="o">=</code><code class="n">hashes</code><code class="o">.</code><code class="n">SHA256</code><code class="p">(),</code>&#13;
    <code class="o">...</code><code class="p">:</code>    <code class="n">label</code><code class="o">=</code><code class="bp">None</code><code class="p">))</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">14</code><code class="p">]:</code> <code class="n">decrypted</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">14</code><code class="p">]:</code> <code class="s-Affix">b</code><code class="s1">'More secrets go here'</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The os Module" data-type="sect1"><div class="sect1" id="idm46691344995400">&#13;
<h1>The os Module</h1>&#13;
&#13;
<p><a data-primary="automating files and the filesystem" data-secondary="os module features" data-type="indexterm" id="ix_ch02-asciidoc8"/><a data-primary="os module" data-type="indexterm" id="ix_ch02-asciidoc9"/>The <code>os</code> module is one of the most used modules in Python. This module handles many low-level operating system calls and attempts to offer a consistent interface across multiple operating systems, which is important if you think your application might run on both Windows and Unix-based systems. It does offer some operating-specific features (<code>os.O_TEXT</code> for Windows and <code>os.O_CLOEXEC</code> on Linux) that are not available across platforms. Use these only if you are confident that your application does not need to be portable across operating systems.&#13;
<a data-type="xref" href="#Example-2-1">Example 2-1</a> shows some of the most useful additional methods of the <code>os</code> module.</p>&#13;
<div data-type="example" id="Example-2-1">&#13;
<h5><span class="label">Example 2-1. </span>More os methods</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">listdir</code><code class="p">(</code><code class="s1">'</code><code class="s1">.</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO1-1" id="co_automating_files_and_the_filesystem_CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">:</code><code> </code><code class="p">[</code><code class="s1">'</code><code class="s1">__init__.py</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">os_path_example.py</code><code class="s1">'</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">rename</code><code class="p">(</code><code class="s1">'</code><code class="s1">_crud_handler</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">crud_handler</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO1-2" id="co_automating_files_and_the_filesystem_CO1-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">chmod</code><code class="p">(</code><code class="s1">'</code><code class="s1">my_script.py</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="n">o777</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO1-3" id="co_automating_files_and_the_filesystem_CO1-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">mkdir</code><code class="p">(</code><code class="s1">'</code><code class="s1">/tmp/holding</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO1-4" id="co_automating_files_and_the_filesystem_CO1-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">makedirs</code><code class="p">(</code><code class="s1">'</code><code class="s1">/Users/kbehrman/tmp/scripts/devops</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO1-5" id="co_automating_files_and_the_filesystem_CO1-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">remove</code><code class="p">(</code><code class="s1">'</code><code class="s1">my_script.py</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO1-6" id="co_automating_files_and_the_filesystem_CO1-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">7</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">rmdir</code><code class="p">(</code><code class="s1">'</code><code class="s1">/tmp/holding</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO1-7" id="co_automating_files_and_the_filesystem_CO1-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">removedirs</code><code class="p">(</code><code class="s1">'</code><code class="s1">/Users/kbehrman/tmp/scripts/devops</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO1-8" id="co_automating_files_and_the_filesystem_CO1-8"><img alt="8" src="assets/8.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">9</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">stat</code><code class="p">(</code><code class="s1">'</code><code class="s1">crud_handler</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO1-9" id="co_automating_files_and_the_filesystem_CO1-9"><img alt="9" src="assets/9.png"/></a><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">9</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">stat_result</code><code class="p">(</code><code class="n">st_mode</code><code class="o">=</code><code class="mi">16877</code><code class="p">,</code><code>&#13;
</code><code>                       </code><code class="n">st_ino</code><code class="o">=</code><code class="mi">4359290300</code><code class="p">,</code><code>&#13;
</code><code>                       </code><code class="n">st_dev</code><code class="o">=</code><code class="mi">16777220</code><code class="p">,</code><code>&#13;
</code><code>                       </code><code class="n">st_nlink</code><code class="o">=</code><code class="mi">18</code><code class="p">,</code><code>&#13;
</code><code>                       </code><code class="n">st_uid</code><code class="o">=</code><code class="mi">501</code><code class="p">,</code><code>&#13;
</code><code>                       </code><code class="n">st_gid</code><code class="o">=</code><code class="mi">20</code><code class="p">,</code><code>&#13;
</code><code>                       </code><code class="n">st_size</code><code class="o">=</code><code class="mi">576</code><code class="p">,</code><code>&#13;
</code><code>                       </code><code class="n">st_atime</code><code class="o">=</code><code class="mi">1544115987</code><code class="p">,</code><code>&#13;
</code><code>                       </code><code class="n">st_mtime</code><code class="o">=</code><code class="mi">1541955837</code><code class="p">,</code><code>&#13;
</code><code>                       </code><code class="n">st_ctime</code><code class="o">=</code><code class="mi">1567266289</code><code class="p">)</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO1-1" id="callout_automating_files_and_the_filesystem_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>List the contents of a directory.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO1-2" id="callout_automating_files_and_the_filesystem_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Rename a file or directory.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO1-3" id="callout_automating_files_and_the_filesystem_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Change the permission settings of a file or directory.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO1-4" id="callout_automating_files_and_the_filesystem_CO1-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Create a directory.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO1-5" id="callout_automating_files_and_the_filesystem_CO1-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Recursively create a directory path.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO1-6" id="callout_automating_files_and_the_filesystem_CO1-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Delete a file.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO1-7" id="callout_automating_files_and_the_filesystem_CO1-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>Delete a single directory.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO1-8" id="callout_automating_files_and_the_filesystem_CO1-8"><img alt="8" src="assets/8.png"/></a></dt>&#13;
<dd><p>Delete a tree of directories, starting with the leaf directory and working up the tree. The operation stops with the first nonempty directory.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO1-9" id="callout_automating_files_and_the_filesystem_CO1-9"><img alt="9" src="assets/9.png"/></a></dt>&#13;
<dd><p>Get stats about the file or directory. These stats include <code>st_mode</code>, the file type and permissions, and <code>st_atime</code>, the time the item was last accessed.<a data-startref="ix_ch02-asciidoc9" data-type="indexterm" id="idm46691342276328"/><a data-startref="ix_ch02-asciidoc8" data-type="indexterm" id="idm46691342275720"/></p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Managing Files and Directories Using os.path" data-type="sect1"><div class="sect1" id="idm46691342274984">&#13;
<h1>Managing Files and Directories Using os.path</h1>&#13;
&#13;
<p><a data-primary="automating files and the filesystem" data-secondary="managing files and directories with os.path" data-type="indexterm" id="ix_ch02-asciidoc10"/><a data-primary="os.path" data-type="indexterm" id="ix_ch02-asciidoc11"/>In Python, you can use strings (binary or otherwise) to represent paths. The <code>os.path</code> module offers a plethora of path-related methods for creating and manipulating paths as strings. As previously mentioned, the <code>os</code> module tries to offer cross-platform behaviors, and the <code>os.path</code> submodule is no exception. This module interprets paths based on the current operating system, using forward slashes to separate directories in Unix-like systems and backward slashes in Windows. Your program can construct paths on the fly that work on the current system, whichever it is.&#13;
The ability to easily split and join paths is probably the most used functionality of <code>os.path</code>. The three methods used to split paths are <a data-primary="basename() method" data-type="indexterm" id="idm46691342269176"/><a data-primary="dirname() method" data-type="indexterm" id="idm46691342268568"/><a data-primary="split() method" data-type="indexterm" id="idm46691342267960"/><code>split</code>, <code>basename</code>, and <code>dirname</code>:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">os</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">cur_dir</code><code> </code><code class="o">=</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">getcwd</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO2-1" id="co_automating_files_and_the_filesystem_CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">cur_dir</code><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">/Users/kbehrman/Google-Drive/projects/python-devops/samples/chapter4</code><code class="s1">'</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">split</code><code class="p">(</code><code class="n">cur_dir</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO2-2" id="co_automating_files_and_the_filesystem_CO2-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code> </code><code class="p">(</code><code class="s1">'</code><code class="s1">/Users/kbehrman/Google-Drive/projects/python-devops/samples</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>         </code><code class="s1">'</code><code class="s1">chapter4</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">dirname</code><code class="p">(</code><code class="n">cur_dir</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO2-3" id="co_automating_files_and_the_filesystem_CO2-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">/Users/kbehrman/Google-Drive/projects/python-devops/samples</code><code class="s1">'</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">basename</code><code class="p">(</code><code class="n">cur_dir</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO2-4" id="co_automating_files_and_the_filesystem_CO2-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">chapter4</code><code class="s1">'</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO2-1" id="callout_automating_files_and_the_filesystem_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Get the current working directory.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO2-2" id="callout_automating_files_and_the_filesystem_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p><code>os.path.split</code> splits the leaf level of the path from the parent path.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO2-3" id="callout_automating_files_and_the_filesystem_CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p><code>os.path.dirname</code> returns the parent path.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO2-4" id="callout_automating_files_and_the_filesystem_CO2-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p><code>os.path.basename</code> returns the leaf name.</p></dd>&#13;
</dl>&#13;
&#13;
<p>You can easily use <code>os.path.dirname</code> to walk up a directory tree:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="k">while</code> <code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">basename</code><code class="p">(</code><code class="n">cur_dir</code><code class="p">):</code>&#13;
   <code class="o">...</code><code class="p">:</code>     <code class="n">cur_dir</code> <code class="o">=</code> <code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">dirname</code><code class="p">(</code><code class="n">cur_dir</code><code class="p">)</code>&#13;
   <code class="o">...</code><code class="p">:</code>     <code class="k">print</code><code class="p">(</code><code class="n">cur_dir</code><code class="p">)</code>&#13;
   <code class="o">...</code><code class="p">:</code>&#13;
<code class="o">/</code><code class="n">Users</code><code class="o">/</code><code class="n">kbehrman</code><code class="o">/</code><code class="n">projects</code><code class="o">/</code><code class="n">python</code><code class="o">-</code><code class="n">devops</code><code class="o">/</code><code class="n">samples</code>&#13;
<code class="o">/</code><code class="n">Users</code><code class="o">/</code><code class="n">kbehrman</code><code class="o">/</code><code class="n">projects</code><code class="o">/</code><code class="n">python</code><code class="o">-</code><code class="n">devops</code>&#13;
<code class="o">/</code><code class="n">Users</code><code class="o">/</code><code class="n">kbehrman</code><code class="o">/</code><code class="n">projects</code>&#13;
<code class="o">/</code><code class="n">Users</code><code class="o">/</code><code class="n">kbehrman</code>&#13;
<code class="o">/</code><code class="n">Users</code>&#13;
<code class="o">/</code></pre>&#13;
&#13;
<p>Using files to configure an application at runtime is a common practice; files in Unix-like systems are named by convention as dotfiles ending with <em>rc</em>. Vim’s <em>.vimrc</em> file and the Bash shell’s <em>.bashrc</em> are two common examples. You can store these files in different locations. Often programs will define a hierarchy of locations to check. For example, your tool might look first for an environment variable that defines which <em>rc</em> file to use, and in its absence, check the working directory, and then the user’s home directory. In <a data-type="xref" href="#Example-2-2">Example 2-2</a> we try to locate an <em>rc</em> file in these locations. We use the <code><em>file</em></code> variable that Python automatically sets when Python code runs from a file. This variable is populated with a path relative to the current working directory, not an absolute or full path. Python does not automatically expand paths, as is common in Unix-like systems, so we must expand this path before we use it to construct the path to check our <em>rc</em> file. Similarly, Python does not automatically expand environment variables in paths, so we must expand these explicitly.</p>&#13;
<div data-type="example" id="Example-2-2">&#13;
<h5><span class="label">Example 2-2. </span>find_rc method</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code><code> </code><code class="nf">find_rc</code><code class="p">(</code><code class="n">rc_name</code><code class="o">=</code><code class="s2">"</code><code class="s2">.examplerc</code><code class="s2">"</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># Check for Env variable</code><code>&#13;
</code><code>    </code><code class="n">var_name</code><code> </code><code class="o">=</code><code> </code><code class="s2">"</code><code class="s2">EXAMPLERC_DIR</code><code class="s2">"</code><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="n">var_name</code><code> </code><code class="ow">in</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">environ</code><code class="p">:</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO3-1" id="co_automating_files_and_the_filesystem_CO3-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">var_path</code><code> </code><code class="o">=</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">${var_name}</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="n">rc_name</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO3-2" id="co_automating_files_and_the_filesystem_CO3-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">config_path</code><code> </code><code class="o">=</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">expandvars</code><code class="p">(</code><code class="n">var_path</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO3-3" id="co_automating_files_and_the_filesystem_CO3-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">Checking {config_path}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">exists</code><code class="p">(</code><code class="n">config_path</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO3-4" id="co_automating_files_and_the_filesystem_CO3-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>            </code><code class="k">return</code><code> </code><code class="n">config_path</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># Check the current working directory</code><code>&#13;
</code><code>    </code><code class="n">config_path</code><code> </code><code class="o">=</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="n">os</code><code class="o">.</code><code class="n">getcwd</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">rc_name</code><code class="p">)</code><code>  </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO3-5" id="co_automating_files_and_the_filesystem_CO3-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">Checking {config_path}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">exists</code><code class="p">(</code><code class="n">config_path</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="n">config_path</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># Check user home directory</code><code>&#13;
</code><code>    </code><code class="n">home_dir</code><code> </code><code class="o">=</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">expanduser</code><code class="p">(</code><code class="s2">"</code><code class="s2">~/</code><code class="s2">"</code><code class="p">)</code><code>  </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO3-6" id="co_automating_files_and_the_filesystem_CO3-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>    </code><code class="n">config_path</code><code> </code><code class="o">=</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="n">home_dir</code><code class="p">,</code><code> </code><code class="n">rc_name</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">Checking {config_path}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">exists</code><code class="p">(</code><code class="n">config_path</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="n">config_path</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># Check Directory of This File</code><code>&#13;
</code><code>    </code><code class="n">file_path</code><code> </code><code class="o">=</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">abspath</code><code class="p">(</code><code class="nv-Magic">__file__</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO3-7" id="co_automating_files_and_the_filesystem_CO3-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>    </code><code class="n">parent_path</code><code> </code><code class="o">=</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">dirname</code><code class="p">(</code><code class="n">file_path</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO3-8" id="co_automating_files_and_the_filesystem_CO3-8"><img alt="8" src="assets/8.png"/></a><code>&#13;
</code><code>    </code><code class="n">config_path</code><code> </code><code class="o">=</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="n">parent_path</code><code class="p">,</code><code> </code><code class="n">rc_name</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">Checking {config_path}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">exists</code><code class="p">(</code><code class="n">config_path</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="n">config_path</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">File {rc_name} has not been found</code><code class="s2">"</code><code class="p">)</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO3-1" id="callout_automating_files_and_the_filesystem_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Check whether the environment variable exists in the current environment.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO3-2" id="callout_automating_files_and_the_filesystem_CO3-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Use <code>join</code> to construct a path with the environment variable name. This will look something like <code>$EXAMPLERC_DIR/.examplerc</code>.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO3-3" id="callout_automating_files_and_the_filesystem_CO3-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Expand the environment variable to insert its value into the path.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO3-4" id="callout_automating_files_and_the_filesystem_CO3-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Check to see if the file exists.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO3-5" id="callout_automating_files_and_the_filesystem_CO3-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Construct a path using the current working directory.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO3-6" id="callout_automating_files_and_the_filesystem_CO3-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Use the <a data-primary="expanduser() function" data-type="indexterm" id="idm46691341704328"/><code>expanduser</code> function to get the path to the user’s home directory.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO3-7" id="callout_automating_files_and_the_filesystem_CO3-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>Expand the relative path stored in <code><em>file</em></code> to an absolute path.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO3-8" id="callout_automating_files_and_the_filesystem_CO3-8"><img alt="8" src="assets/8.png"/></a></dt>&#13;
<dd><p>Use <a data-primary="dirname() method" data-type="indexterm" id="idm46691341697864"/><code>dirname</code> to get the path to the directory holding the current file.</p></dd>&#13;
</dl>&#13;
&#13;
<p>The <code>path</code> submodule also offers ways to interrogate stats about a path. You can determine if a path is a file, a directory, a link, or a mount. You can get stats such as it’s size or time of last access or modification. In <a data-type="xref" href="#Example-2-3">Example 2-3</a> we use <code>path</code> to walk down a directory tree and report on the size and last access time of all files therein.</p>&#13;
<div data-type="example" id="Example-2-3">&#13;
<h5><span class="label">Example 2-3. </span>os_path_walk.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c-Hashbang">#!/usr/bin/env python</code><code>&#13;
</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">fire</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">os</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">walk_path</code><code class="p">(</code><code class="n">parent_path</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">Checking: {parent_path}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="n">childs</code><code> </code><code class="o">=</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">listdir</code><code class="p">(</code><code class="n">parent_path</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO4-1" id="co_automating_files_and_the_filesystem_CO4-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="k">for</code><code> </code><code class="n">child</code><code> </code><code class="ow">in</code><code> </code><code class="n">childs</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="n">child_path</code><code> </code><code class="o">=</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="n">parent_path</code><code class="p">,</code><code> </code><code class="n">child</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO4-2" id="co_automating_files_and_the_filesystem_CO4-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">isfile</code><code class="p">(</code><code class="n">child_path</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO4-3" id="co_automating_files_and_the_filesystem_CO4-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>            </code><code class="n">last_access</code><code> </code><code class="o">=</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">getatime</code><code class="p">(</code><code class="n">child_path</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO4-4" id="co_automating_files_and_the_filesystem_CO4-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>            </code><code class="n">size</code><code> </code><code class="o">=</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">getsize</code><code class="p">(</code><code class="n">child_path</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO4-5" id="co_automating_files_and_the_filesystem_CO4-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>            </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">File: {child_path}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>            </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="se">\t</code><code class="s2">last accessed: {last_access}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>            </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="se">\t</code><code class="s2">size: {size}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="k">elif</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">isdir</code><code class="p">(</code><code class="n">child_path</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO4-6" id="co_automating_files_and_the_filesystem_CO4-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>            </code><code class="n">walk_path</code><code class="p">(</code><code class="n">child_path</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO4-7" id="co_automating_files_and_the_filesystem_CO4-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="k">if</code><code> </code><code class="nv-Magic">__name__</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">__main__</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">fire</code><code class="o">.</code><code class="n">Fire</code><code class="p">(</code><code class="p">)</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO4-1" id="callout_automating_files_and_the_filesystem_CO4-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p><code>os.listdir</code> returns the contents of a directory.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO4-2" id="callout_automating_files_and_the_filesystem_CO4-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Construct the full path of an item in the parent directory.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO4-3" id="callout_automating_files_and_the_filesystem_CO4-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Check to see if the path represents a file.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO4-4" id="callout_automating_files_and_the_filesystem_CO4-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Get the last time the file was accessed.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO4-5" id="callout_automating_files_and_the_filesystem_CO4-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Get the size of the file.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO4-6" id="callout_automating_files_and_the_filesystem_CO4-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Check if the path represents a directory.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO4-7" id="callout_automating_files_and_the_filesystem_CO4-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>Check the tree from this directory down.</p></dd>&#13;
</dl>&#13;
&#13;
<p>You could use a script like this to identify large files or files that have not been accessed and then report, move, or delete them.<a data-startref="ix_ch02-asciidoc11" data-type="indexterm" id="idm46691341413432"/><a data-startref="ix_ch02-asciidoc10" data-type="indexterm" id="idm46691341412824"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Walking Directory Trees Using os.walk" data-type="sect1"><div class="sect1" id="idm46691342274392">&#13;
<h1>Walking Directory Trees Using os.walk</h1>&#13;
&#13;
<p><a data-primary="automating files and the filesystem" data-secondary="walking directory trees with os.walk" data-type="indexterm" id="idm46691341411208"/><a data-primary="os.walk" data-type="indexterm" id="idm46691341410136"/><a data-primary="walking directory trees" data-type="indexterm" id="idm46691341409528"/>The <code>os</code> module offers a convenience function for walking directory trees called <code>os.walk</code>. This function returns a generator that in turn returns a tuple for each iteration. The tuple consists of the current path, a list of directories, and a list of files. In <a data-type="xref" href="#Example-2-4">Example 2-4</a> we rewrite our <code>walk_path</code> function from <a data-type="xref" href="#Example-2-3">Example 2-3</a> to use <code>os.walk</code>. As you can see in this example, with <code>os.walk</code> you don’t need to test which paths are files or recall the function with every subdirectory.</p>&#13;
<div data-type="example" id="Example-2-4">&#13;
<h5><span class="label">Example 2-4. </span>Rewrite walk_path</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">walk_path</code><code class="p">(</code><code class="n">parent_path</code><code class="p">):</code>&#13;
    <code class="k">for</code> <code class="n">parent_path</code><code class="p">,</code> <code class="n">directories</code><code class="p">,</code> <code class="n">files</code> <code class="ow">in</code> <code class="n">os</code><code class="o">.</code><code class="n">walk</code><code class="p">(</code><code class="n">parent_path</code><code class="p">):</code>&#13;
        <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"Checking: {parent_path}"</code><code class="p">)</code>&#13;
        <code class="k">for</code> <code class="n">file_name</code> <code class="ow">in</code> <code class="n">files</code><code class="p">:</code>&#13;
            <code class="n">file_path</code> <code class="o">=</code> <code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="n">parent_path</code><code class="p">,</code> <code class="n">file_name</code><code class="p">)</code>&#13;
            <code class="n">last_access</code> <code class="o">=</code> <code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">getatime</code><code class="p">(</code><code class="n">file_path</code><code class="p">)</code>&#13;
            <code class="n">size</code> <code class="o">=</code> <code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">getsize</code><code class="p">(</code><code class="n">file_path</code><code class="p">)</code>&#13;
            <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"File: {file_path}"</code><code class="p">)</code>&#13;
            <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="se">\t</code><code class="s2">last accessed: {last_access}"</code><code class="p">)</code>&#13;
            <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="se">\t</code><code class="s2">size: {size}"</code><code class="p">)</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Paths as Objects with Pathlib" data-type="sect1"><div class="sect1" id="idm46691341402936">&#13;
<h1>Paths as Objects with Pathlib</h1>&#13;
&#13;
<p><a data-primary="automating files and the filesystem" data-secondary="paths as object with pathlib" data-type="indexterm" id="idm46691341401928"/><a data-primary="objects" data-secondary="paths as" data-type="indexterm" id="idm46691341327176"/><a data-primary="pathlib" data-type="indexterm" id="idm46691341326264"/><a data-primary="paths, as object with pathlib" data-type="indexterm" id="idm46691341325592"/>The <code>pathlib</code> library represents paths as objects rather than strings. In <a data-type="xref" href="#Example-2-5">Example 2-5</a> we rewrite <a data-type="xref" href="#Example-2-2">Example 2-2</a> using <code>pathlib</code> rather than <code>os.path</code>.</p>&#13;
<div data-type="example" id="Example-2-5">&#13;
<h5><span class="label">Example 2-5. </span>rewrite find_rc</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code><code> </code><code class="nf">find_rc</code><code class="p">(</code><code class="n">rc_name</code><code class="o">=</code><code class="s2">"</code><code class="s2">.examplerc</code><code class="s2">"</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># Check for Env variable</code><code>&#13;
</code><code>    </code><code class="n">var_name</code><code> </code><code class="o">=</code><code> </code><code class="s2">"</code><code class="s2">EXAMPLERC_DIR</code><code class="s2">"</code><code>&#13;
</code><code>    </code><code class="n">example_dir</code><code> </code><code class="o">=</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">environ</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="n">var_name</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO5-1" id="co_automating_files_and_the_filesystem_CO5-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="n">example_dir</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="n">dir_path</code><code> </code><code class="o">=</code><code> </code><code class="n">pathlib</code><code class="o">.</code><code class="n">Path</code><code class="p">(</code><code class="n">example_dir</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO5-2" id="co_automating_files_and_the_filesystem_CO5-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">config_path</code><code> </code><code class="o">=</code><code> </code><code class="n">dir_path</code><code> </code><code class="o">/</code><code> </code><code class="n">rc_name</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO5-3" id="co_automating_files_and_the_filesystem_CO5-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">Checking {config_path}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="n">config_path</code><code class="o">.</code><code class="n">exists</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO5-4" id="co_automating_files_and_the_filesystem_CO5-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>            </code><code class="k">return</code><code> </code><code class="n">config_path</code><code class="o">.</code><code class="n">as_postix</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO5-5" id="co_automating_files_and_the_filesystem_CO5-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># Check the current working directory</code><code>&#13;
</code><code>    </code><code class="n">config_path</code><code> </code><code class="o">=</code><code> </code><code class="n">pathlib</code><code class="o">.</code><code class="n">Path</code><code class="o">.</code><code class="n">cwd</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">/</code><code> </code><code class="n">rc_name</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO5-6" id="co_automating_files_and_the_filesystem_CO5-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">Checking {config_path}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="n">config_path</code><code class="o">.</code><code class="n">exists</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="n">config_path</code><code class="o">.</code><code class="n">as_postix</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># Check user home directory</code><code>&#13;
</code><code>    </code><code class="n">config_path</code><code> </code><code class="o">=</code><code> </code><code class="n">pathlib</code><code class="o">.</code><code class="n">Path</code><code class="o">.</code><code class="n">home</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">/</code><code> </code><code class="n">rc_name</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO5-7" id="co_automating_files_and_the_filesystem_CO5-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">Checking {config_path}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="n">config_path</code><code class="o">.</code><code class="n">exists</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="n">config_path</code><code class="o">.</code><code class="n">as_postix</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># Check Directory of This File</code><code>&#13;
</code><code>    </code><code class="n">file_path</code><code> </code><code class="o">=</code><code> </code><code class="n">pathlib</code><code class="o">.</code><code class="n">Path</code><code class="p">(</code><code class="nv-Magic">__file__</code><code class="p">)</code><code class="o">.</code><code class="n">resolve</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO5-8" id="co_automating_files_and_the_filesystem_CO5-8"><img alt="8" src="assets/8.png"/></a><code>&#13;
</code><code>    </code><code class="n">parent_path</code><code> </code><code class="o">=</code><code> </code><code class="n">file_path</code><code class="o">.</code><code class="n">parent</code><code> </code><a class="co" href="#callout_automating_files_and_the_filesystem_CO5-9" id="co_automating_files_and_the_filesystem_CO5-9"><img alt="9" src="assets/9.png"/></a><code>&#13;
</code><code>    </code><code class="n">config_path</code><code> </code><code class="o">=</code><code> </code><code class="n">parent_path</code><code> </code><code class="o">/</code><code> </code><code class="n">rc_name</code><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">Checking {config_path}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="n">config_path</code><code class="o">.</code><code class="n">exists</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="n">config_path</code><code class="o">.</code><code class="n">as_postix</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">File {rc_name} has not been found</code><code class="s2">"</code><code class="p">)</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO5-1" id="callout_automating_files_and_the_filesystem_CO5-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>As of this writing, <code>pathlib</code> does not expand environment variables. Instead you grab the value of the variable from <code>os.environ</code>.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO5-2" id="callout_automating_files_and_the_filesystem_CO5-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>This creates a <code>pathlib.Path</code> object appropriate for the currently running operating system.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO5-3" id="callout_automating_files_and_the_filesystem_CO5-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>You can construct new <code>pathlib.Path</code> objects by following a parent path with forward slashes and strings.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO5-4" id="callout_automating_files_and_the_filesystem_CO5-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>The <code>pathlib.Path</code> object itself has an <code>exists</code> method.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO5-5" id="callout_automating_files_and_the_filesystem_CO5-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Call <code>as_postix</code> to return the path as a string. Depending on your use case, you can return the <code>pathlib.Path</code> object itself.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO5-6" id="callout_automating_files_and_the_filesystem_CO5-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>The class method <code>pathlib.Path.cwd</code> returns a <code>pathlib.Path</code> object for the current working directory. This object is used immediately here to create the <code>config_path</code> by joining it with the string <code>rc_name</code>.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO5-7" id="callout_automating_files_and_the_filesystem_CO5-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>The class method <code>pathlib.Path.home</code> returns a <code>pathlib.Path</code> object for the current user’s home directory.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO5-8" id="callout_automating_files_and_the_filesystem_CO5-8"><img alt="8" src="assets/8.png"/></a></dt>&#13;
<dd><p>Create a <code>pathlib.Path</code> object using the relative path stored in <code><em>file</em></code> and then call its <code>resolve</code> method to get the absolute path.</p></dd>&#13;
<dt><a class="co" href="#co_automating_files_and_the_filesystem_CO5-9" id="callout_automating_files_and_the_filesystem_CO5-9"><img alt="9" src="assets/9.png"/></a></dt>&#13;
<dd><p>This returns a parent <code>pathlib.Path</code> object directly from the object itself.<a data-startref="ix_ch02-asciidoc0" data-type="indexterm" id="idm46691340956360"/></p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>