<html><head></head><body>
<div id="sbo-rt-content"><section data-nutshell-tab="Client-Side Modules" data-pdf-bookmark="Chapter 19. Client-Side Network Protocol Modules" data-type="chapter" epub:type="chapter"><div class="chapter" id="client_side_network_protocol_modules">
<h1><span class="label">Chapter 19. </span>Client-Side Network <span class="keep-together">Protocol Modules</span></h1>
<p>Python’s standard library<a contenteditable="false" data-primary="network protocol modules (client-side)" data-secondary="availability of" data-type="indexterm" id="idm44924488745072"/> supplies several modules to simplify the use of internet protocols on both the client and server sides. These days, the<a contenteditable="false" data-primary="Python Package Index (PyPI)" data-type="indexterm" id="idm44924488743600"/><a contenteditable="false" data-primary="PyPI (Python Package Index)" data-type="indexterm" id="idm44924488742528"/> <a href="https://oreil.ly/PGIim">Python Package Index</a>, best known as <em>PyPI</em>, offers many more such packages. Because many of the standard library modules date back to the previous century, you will find that nowadays third-party packages support a wider array of protocols, and several offer better APIs than the standard library’s equivalents. When you need to use a network protocol that’s missing from the standard library, or covered by the standard library in a way you think is not satisfactory, be sure to search PyPI—you’re likely to find better solutions there.</p>
<p>In this chapter, we cover some standard library packages that allow relatively simple uses of network protocols: these let you code without requiring third-party packages, making your application or library easier to install on other machines. You may therefore come across them when dealing with legacy code, and their simplicity also makes them interesting reading for the Python student. We also mention a few third-party packages covering important network protocols not included in the standard library, but we do not cover third-party packages using asynchronous programming.</p>
<p>For the very frequent use case of HTTP clients and other network resources (such as anonymous FTP sites) best accessed via URLs, the third-party <a href="https://oreil.ly/t4X8r"><span class="code">requests</span> package</a> is even recommended in the Python documentation, so we cover that and recommend its use instead of standard library modules.</p>
<section class="pagebreak-before" data-pdf-bookmark="Email Protocols" data-type="sect1"><div class="sect1" id="email_protocols">
<h1 class="less_space">Email Protocols</h1>
<p>Most<a contenteditable="false" data-primary="network protocol modules (client-side)" data-secondary="email protocols" data-type="indexterm" id="NPMemail19"/><a contenteditable="false" data-primary="email protocols" data-type="indexterm" id="eprot19"/> email today is <em>sent</em> via servers implementing the<a contenteditable="false" data-primary="Simple Mail Transport Protocol (SMTP)" data-type="indexterm" id="idm44924488696352"/><a contenteditable="false" data-primary="SMTP (Simple Mail Transport Protocol)" data-type="indexterm" id="idm44924488695376"/> Simple Mail Transport Protocol (SMTP) and <em>received</em> via servers and clients using<a contenteditable="false" data-primary="Post Office Protocol version 3 (POP3)" data-type="indexterm" id="idm44924488693888"/><a contenteditable="false" data-primary="POP3 (Post Office Protocol version 3)" data-type="indexterm" id="idm44924488692912"/> Post Office Protocol version 3 (POP3) and/or<a contenteditable="false" data-primary="Internet Message Access Protocol version 4 (IMAP4)" data-type="indexterm" id="idm44924488691808"/><a contenteditable="false" data-primary="IMAP4 (Internet Message Access Protocol version 4)" data-type="indexterm" id="idm44924488690800"/> Internet Message Access Protocol version 4 (IMAP4).<sup><a data-type="noteref" href="ch19.xhtml#ch01fn140" id="ch01fn140-marker">1</a></sup> Clients for these protocols are supported by the Python standard library modules <span class="code">smtplib</span>, <span class="code">poplib</span>, and<a contenteditable="false" data-primary="imaplib module" data-type="indexterm" id="idm44924488685792"/><a contenteditable="false" data-primary="standard library modules" data-secondary="imaplib" data-type="indexterm" id="idm44924488684656"/> <span class="code">imaplib</span>, respectively, the first two of which we cover in this book. When you need to handle <em>parsing</em> or <em>generating</em> email messages, use the <span class="code">email</span> package, covered in <a data-type="xref" href="ch21.xhtml#emailcomma_mimecomma_and_other_network">Chapter 21</a>.</p>
<p>If you need to write a client that can connect via either POP3 or IMAP4, a standard recommendation would be to pick IMAP4, since it is more powerful and—according to Python’s own online docs—often more accurately implemented on the server side. Unfortunately, <span class="code">imaplib</span> is very complex, and far too vast to cover in this book. If you do choose to go that route, use the <a href="https://oreil.ly/3ncIi">online docs</a>, inevitably complemented by the IMAP RFCs, and possibly other related RFCs, such as 5161 and 6855 for capabilities and 2342 for namespaces. Using the RFCs in addition to the online docs for the standard library module can’t be avoided: many of the arguments passed to <span class="code">imaplib</span> functions and methods, and results from calling them, are strings with formats that are only documented in the RFCs, not in Python’s own docs. A highly recommended alternative is to use the simpler, higher-abstraction-level third-party package <a href="https://oreil.ly/xTc4T">IMAPClient</a>, available with a <span class="code"><strong>pip install</strong></span> and well documented <a href="https://oreil.ly/SuiI_">online</a>.</p>
<section data-pdf-bookmark="The poplib Module" data-type="sect2"><div class="sect2" id="the_poplib_module">
<h2>The poplib Module</h2>
<p>The<a contenteditable="false" data-primary="poplib module" data-type="indexterm" id="idm44924488673296"/><a contenteditable="false" data-primary="standard library modules" data-secondary="poplib" data-type="indexterm" id="idm44924488672160"/> <span class="code">poplib</span> module supplies a class, <span class="code">POP3</span>, to access a POP mailbox.<sup><a data-type="noteref" href="ch19.xhtml#ch01fn141" id="ch01fn141-marker">2</a></sup> The constructor has the following signature:</p>
<table class="border">
<tbody>
<tr>
<td><span class="code">POP3</span></td>
<td><span class="code"><strong>class</strong></span> <span class="code">POP3(<em>host</em>, port=110)</span><br/>
			Returns an instance <span class="code"><em>p</em></span> of class <span class="code">POP3</span> connected to the specified <span class="code"><em>host</em></span> and <span class="code">port</span>. The class <span class="code">POP3_SSL</span> behaves just the same, but connects to the host (by default on port 995) over a secure TLS channel; it’s needed to connect to email servers that demand some minimum security, such as <span class="code">pop.gmail.com</span>.<sup><a data-type="noteref" href="ch19.xhtml#ch01fn142" id="ch01fn142-marker">a</a></sup></td>
</tr>
</tbody>
<tbody><tr class="footnotes"><td colspan="2"><p data-type="footnote" id="ch01fn142"><sup><a href="ch19.xhtml#ch01fn142-marker">a</a></sup> To connect to a Gmail account, in particular, you need to configure that account to enable POP, “allow less secure apps,” and avoid two-step verification—things that in general we don’t recommend, as they weaken your email’s security.</p></td></tr></tbody></table>
<p>An instance <span class="code"><em>p</em></span> of the class <span class="code">POP3</span> supplies many methods; the most frequently used are listed in <a data-type="xref" href="#methods_of_an_instance_p_of_popthree">Table 19-1</a>. In each case, <span class="code"><em>msgnum</em></span>, the identifying number of a message, can be a string containing an integer value or an <span class="code">int</span>.</p>
<table class="border" id="methods_of_an_instance_p_of_popthree">
<caption><span class="label">Table 19-1. </span>Methods of an instance <span class="code">p</span> of <span class="code">POP3</span></caption>
<tbody>
<tr>
<td><span class="code">dele</span></td>
<td><span class="code"><em>p</em></span><span class="code">.dele(<em>msgnum</em>)</span><br/>
			Marks message <span class="code"><em>msgnum</em></span> for deletion and returns the server response string. The server queues such deletion requests, and executes them only when you terminate this connection by calling <span class="code"><em>p</em></span><span class="code">.quit</span>.<sup><a data-type="noteref" href="ch19.xhtml#ch01fn143" id="ch01fn143-marker">a</a></sup></td>
</tr>
<tr>
<td><span class="code">list</span></td>
<td><span class="code"><em>p</em></span><span class="code">.list(<em>msgnum</em>=<strong>None</strong>)</span><br/>
			Returns a three-item tuple <span class="code">(<em>response</em>,</span> <span class="code"><em>messages</em></span><span class="code">,</span> <span class="code"><em>octets</em></span><span class="code">)</span>, where <span class="code"><em>response</em></span> is the server response string; <span class="code"><em>messages</em></span> a list of bytestrings, each of two words <span class="code">b'<em>msgnum</em></span> <span class="code"><em>bytes</em>'</span>, the message number and length, in bytes, of each message in the mailbox; and <span class="code"><em>octets</em></span> is the length, in bytes, of the total response. When <span class="code"><em>msgnum</em></span> is not <span class="code"><strong>None</strong></span>, <span class="code">list</span> returns a string, the response for the given <span class="code"><em>msgnum</em></span>, not a tuple.</td>
</tr>
<tr>
<td><span class="code">pass_</span></td>
<td><span class="code"><em>p</em></span><span class="code">.pass_(<em>password</em>)</span><br/>
			Sends the password to the server, and returns the server response string. Must be called after <span class="code"><em>p</em></span><span class="code">.user</span>. The trailing underscore in the name is needed because <span class="code"><strong>pass</strong></span> is a Python keyword.</td>
</tr>
<tr>
<td><span class="code">quit</span></td>
<td><span class="code"><em>p</em></span><span class="code">.quit()</span><br/>
			Ends the session and tells the server to perform deletions that were requested by calls to <span class="code"><em>p</em></span><span class="code">.dele</span>. Returns the server response string.</td>
</tr>
<tr>
<td><span class="code">retr</span></td>
<td><span class="code"><em>p</em></span><span class="code">.retr(<em>msgnum</em>)</span><br/>
			Returns a three-item tuple <span class="code">(<em>response</em>,</span> <span class="code"><em>lines</em></span><span class="code">,</span> <span class="code"><em>bytes</em></span><span class="code">)</span>, where <span class="code"><em>response</em></span> is the server response string, <span class="code"><em>lines</em></span> is the list of all lines in message <span class="code"><em>msgnum</em></span> as bytestrings, and <span class="code"><em>bytes</em></span> is the total number of bytes in the message.</td>
</tr>
<tr>
<td><span class="code">s⁠e⁠t⁠_​d⁠e⁠b⁠u⁠g⁠l⁠e⁠v⁠e⁠l</span></td>
<td><span class="code"><em>p</em></span><span class="code">.set_debuglevel(<em>debug_level</em>)</span><br/>
			Sets the debug level to <span class="code"><em>debug_level</em></span>, an <span class="code">int</span> with value <span class="code">0</span> (the default) for no debugging, <span class="code">1</span> for a modest amount of debugging output, or <span class="code">2</span> or more for a complete output trace of all control information exchanged with the server.</td>
</tr>
<tr>
<td><span class="code">stat</span></td>
<td><span class="code"><em>p</em></span><span class="code">.stat()</span><br/>
			Returns a pair <span class="code">(<em>num_msgs</em>,</span> <span class="code"><em>bytes</em></span><span class="code">)</span>, where <span class="code"><em>num_msgs</em></span> is the number of messages in the mailbox and <span class="code"><em>bytes</em></span> is the total number of bytes.</td>
</tr>
<tr>
<td><span class="code">top</span></td>
<td><span class="code"><em>p</em></span><span class="code">.top(<em>msgnum</em>,</span> <span class="code"><em>maxlines</em></span><span class="code">)</span><br/>
			Like <span class="code">retr</span>, but returns at most <span class="code"><em>maxlines</em></span> lines from the message’s body (in addition to all the lines from the headers). Can be useful for peeking at the start of long messages.</td>
</tr>
<tr>
<td><span class="code">user</span></td>
<td><span class="code"><em>p</em></span><span class="code">.user(<em>username</em>)</span><br/>
			Sends the server the username; invariably followed up by a call to <span class="code"><em>p</em></span><span class="code">.pass_</span>.</td>
</tr>
</tbody>
<tbody><tr class="footnotes"><td colspan="2"><p data-type="footnote" id="ch01fn143"><sup><a href="ch19.xhtml#ch01fn143-marker">a</a></sup> The standard states that if disconnection occurs before the <span class="code">quit</span> call, the deletions should not be actioned. Despite this, some servers will perform the deletion after any disconnection, planned or unplanned.</p></td></tr></tbody></table>
</div></section>
<section data-pdf-bookmark="The smtplib Module" data-type="sect2"><div class="sect2" id="the_smtplib_module">
<h2>The smtplib Module</h2>
<p>The<a contenteditable="false" data-primary="smtplib module" data-type="indexterm" id="idm44924488575760"/><a contenteditable="false" data-primary="standard library modules" data-secondary="smtplib" data-type="indexterm" id="idm44924488574624"/> <span class="code">smtplib</span> module supplies a class, <span class="code">SMTP</span>, to send mail via an SMTP server.<sup><a data-type="noteref" href="ch19.xhtml#ch01fn144" id="ch01fn144-marker">3</a></sup> The constructor has the following signature:</p>
<table class="border">
<tbody>
<tr>
<td><span class="code">SMTP</span></td>
<td><span class="code">class SMTP([<em>host</em>, port=25])</span><br/>
			Returns an instance <span class="code"><em>s</em></span> of the class <span class="code">SMTP</span>. When <span class="code"><em>host</em></span> (and optionally <span class="code">port</span>) is given, implicitly calls <span class="code"><em>s</em></span><span class="code">.connect(<em>host</em>,</span> <span class="code">port)</span>. The class <span class="code">SMTP_SSL</span> behaves just the same, but connects to the host (by default on port 465) over a secure TLS channel; it’s needed to connect to email servers that demand some minimum security, such as <span class="code">smtp.gmail.com</span>.</td>
</tr>
</tbody>
</table>
<p>An instance <span class="code"><em>s</em></span> of the class <span class="code">SMTP</span> supplies many methods. The most frequently used of these are listed in <a data-type="xref" href="#methods_of_an_instance_s_of_smtp">Table 19-2</a>.</p>
<table class="border" id="methods_of_an_instance_s_of_smtp">
<caption><span class="label">Table 19-2. </span>Methods of an instance <span class="code">s</span> of <span class="code">SMTP</span></caption>
<tbody>
<tr>
<td><span class="code">connect</span></td>
<td><span class="code"><em>s</em></span><span class="code">.connect(host=127.0.0.1, port=25)</span><br/>
			Connects to an SMTP server on the given <span class="code">host</span> (by default, the local host) and <span class="code">port</span> (port <span class="code">25</span> is the default port for the SMTP service; <span class="code">465</span> is the default port for the more secure “SMTP over TLS”).</td>
</tr>
<tr>
<td><span class="code">login</span></td>
<td><span class="code"><em>s</em></span><span class="code">.login(<em>user</em>,</span> <span class="code"><em>password</em></span><span class="code">)</span><br/>
			Logs in to the server with the given <span class="code"><em>user</em></span> and <span class="code"><em>password</em></span>. Needed only if the SMTP server requires authentication (as just about all do).</td>
</tr>
<tr>
<td><span class="code">quit</span></td>
<td><span class="code"><em>s</em></span><span class="code">.quit()</span><br/>
			Terminates the SMTP session.</td>
</tr>
<tr>
<td><span class="code">sendmail</span></td>
<td><span class="code"><em>s</em></span><span class="code">.sendmail(<em>from_addr</em>,</span> <span class="code"><em>to_addrs</em></span><span class="code">,</span> <span class="code"><em>msg_string</em></span><span class="code">)</span><br/>
			Sends mail message <span class="code"><em>msg_string</em></span> from the sender whose address is in string <span class="code"><em>from_addr</em></span> to each of the recipients in the list <span class="code"><em>to_addrs</em></span>.<sup><a data-type="noteref" href="ch19.xhtml#ch01fn145" id="ch01fn145-marker">a</a></sup> <span class="code"><em>msg_string</em></span> must be a complete RFC 822 message in a single multiline bytestring: the headers, an empty line for separation, then the body. The mail transport mechanism uses only <span class="code"><em>from_addr</em></span> and <span class="code"><em>to_addrs</em></span> to determine routing, ignoring any headers in <span class="code"><em>msg_string</em></span>.<sup><a data-type="noteref" href="ch19.xhtml#ch01fn146" id="ch01fn146-marker">b</a></sup> To prepare RFC 822–compliant messages, use the package <span class="code">email</span>, covered in <a data-type="xref" href="ch21.xhtml#mime_and_email_format_handling">“MIME and Email Format Handling”</a>.</td>
</tr>
<tr>
<td><span class="code">send_message</span></td>
<td><span class="code"><em>s.</em></span><span class="code">send_message(</span><span class="code"><em>msg,</em></span> <span class="code">from_addr=<strong>None</strong>, to_addrs=<strong>None</strong>)</span><br/>
			A convenience function taking an <span class="code">email.message.Message</span> object as its first argument. If either or both of <span class="code">from_addr</span> and <span class="code">to_addrs</span> are <span class="code"><strong>None</strong></span>, they are extracted from the message instead.<a contenteditable="false" data-primary="" data-startref="NPMemail19" data-type="indexterm" id="idm44924488510960"/><a contenteditable="false" data-primary="" data-startref="eprot19" data-type="indexterm" id="idm44924488509616"/></td>
</tr>
</tbody>
<tbody><tr class="footnotes"><td colspan="2"><p data-type="footnote" id="ch01fn145"><sup><a href="ch19.xhtml#ch01fn145-marker">a</a></sup> While the standard places no limits on the number of recipients in <span class="code"><em>from_addr</em></span>, individual mail servers may well do so, often making it advisable to batch messages with a maximum number of recipients in each one.</p><p data-type="footnote" id="ch01fn146"><sup><a href="ch19.xhtml#ch01fn146-marker">b</a></sup> This allows email systems to implement Bcc (blind copy) emails, for example, as the routing does not depend on the message envelope.</p></td></tr></tbody></table>
</div></section>
</div></section>
<section data-pdf-bookmark="HTTP and URL Clients" data-type="sect1"><div class="sect1" id="http_and_url_clients">
<h1>HTTP and URL Clients</h1>
<p>Most<a contenteditable="false" data-primary="network protocol modules (client-side)" data-secondary="HTTP and URL clients" data-type="indexterm" id="NPMhttp19"/> of the time, your code uses the HTTP and FTP protocols through the higher-abstraction URL layer, supported by the modules and packages covered in the following sections. Python’s standard library also offers lower-level, protocol-specific modules that are less often used: for FTP clients, <a contenteditable="false" data-primary="ftplib module" data-type="indexterm" id="idm44924488504080"/><a contenteditable="false" data-primary="standard library modules" data-secondary="ftplib" data-type="indexterm" id="idm44924488502976"/><a href="https://oreil.ly/O_XHc">ftplib</a>; for HTTP clients, <span class="code">http.client</span> (we cover HTTP servers in <a data-type="xref" href="ch20.xhtml#serving_http">Chapter 20</a>). If you need to write an FTP server, look at the third-party module<a contenteditable="false" data-primary="pyftpdlib module" data-type="indexterm" id="idm44924488499264"/> <a href="https://oreil.ly/Qrvcn">pyftpdlib</a>. Implementations of the newer <a href="https://http2.github.io">HTTP/2</a> may not be fully mature, but your best bet as of this writing is the third-party module<a contenteditable="false" data-primary="httpx module" data-type="indexterm" id="idm44924488496432"/> <a href="https://www.python-httpx.org">HTTPX</a>. We do not cover any of these lower-level modules in this book: we focus on higher-abstraction, URL-level access throughout the following sections.</p>
<section data-pdf-bookmark="URL Access" data-type="sect2"><div class="sect2" id="url_access">
<h2>URL Access</h2>
<p>A URL is a type of<a contenteditable="false" data-primary="uniform resource identifier (URI)" data-type="indexterm" id="idm44924488492768"/><a contenteditable="false" data-primary="URI (uniform resource identifier)" data-type="indexterm" id="idm44924488491280"/> uniform resource identifier (URI). A URI is a string that <em>identifies</em> a resource (but does not necessarily <em>locate</em> it), while a<a contenteditable="false" data-primary="Uniform Resource Locator (URL)" data-type="indexterm" id="idm44924488489168"/><a contenteditable="false" data-primary="URL (Uniform Resource Locator)" data-type="indexterm" id="idm44924488487968"/> URL <em>locates</em> a resource on the internet. A URL is a string composed of several parts (some optional), called <em>components</em>: the <em>scheme, location, path, query</em>, and <em>fragment.</em> (The second component is sometimes also known as a<a contenteditable="false" data-primary="net location (netloc)" data-type="indexterm" id="idm44924488484816"/> <em>net location</em>, or <em>netloc</em> for short.) A URL with all parts looks like:</p>
<pre data-type="programlisting">
<em>scheme://lo.ca.ti.on/pa/th?qu=ery#fragment</em></pre>
<p>In <em>https://www.python.org/community/awards/psf-awards/#october-2016</em>, for example, the scheme is <em>http</em>, the location is <em>www.python.org</em>, the path is <em>/community/awards/psf-awards/</em>, there is no query, and the fragment is <em>#october-2016.</em> (Most schemes default to a <em>well-known port</em> when the port is not explicitly specified; for example, 80 is the well-known port for the HTTP scheme.) Some punctuation is part of one of the components it separates; other punctuation characters are just separators, not part of any component. Omitting punctuation implies missing components. For example, in <em>mailto:me@you.com</em>, the scheme is <em>mailto</em>, the path is <em>me@you.com</em> (<em>mailto:me@you.com</em>), and there is no location, query, or fragment. No // means the URI has no location, no <span class="code">?</span> means it has no query, and no <span class="code">#</span> means it has no fragment.</p>
<p>If the location ends with a colon followed by a number, this denotes a TCP port for the endpoint. Otherwise, the connection uses the well-known port associated with the scheme (e.g., port 80 for HTTP).</p>
</div></section>
<section class="pagebreak-before" data-pdf-bookmark="The urllib Package" data-type="sect2"><div class="sect2" id="the_urllib_package">
<h2 class="less_space">The urllib Package</h2>
<p>The<a contenteditable="false" data-primary="urllib module" data-type="indexterm" id="urlibpckg19"/><a contenteditable="false" data-primary="standard library modules" data-secondary="urlib" data-type="indexterm" id="idm44924488470896"/> <span class="code">urllib</span> package supplies several modules for parsing and utilizing URL strings and associated resources. In addition to the <span class="code">urllib.parse</span> and <span class="code">urllib.request</span> modules described here, these include the module <span class="code">urllib.robotparser</span> (for the specific purpose of parsing a site’s <em>robots.txt</em> file as per <a href="https://oreil.ly/QI7CQ">RFC 9309</a>) and the module <span class="code">urllib.error</span>, containing all exception types raised by other <span class="code">urllib</span> modules.</p>
<section data-pdf-bookmark="The urllib.parse module" data-type="sect3"><div class="sect3" id="the_urllibdotparse_module">
<h3>The urllib.parse module</h3>
<p>The <span class="code">urllib.parse</span> module supplies functions for analyzing and synthesizing URL strings, and is typically imported with <span class="code"><strong>from</strong></span> <span class="code">urllib</span> <span class="code"><strong>import</strong></span> <span class="code">parse</span> <span class="code"><strong>as</strong></span> <span class="code">urlparse</span>. Its most frequently used functions are listed in <a data-type="xref" href="#useful_functions_of_the_urllibdotparse">Table 19-3</a>.</p>
<table class="border" id="useful_functions_of_the_urllibdotparse">
<caption><span class="label">Table 19-3. </span>Useful functions of the <span class="code">urllib.parse</span> module</caption>
<tbody>
<tr>
<td class="width-15"><span class="code">urljoin</span></td>
<td><span class="code">urljoin(<em>base_url_string</em>,</span> <span class="code"><em>relative_url_string</em></span><span class="code">)</span><br/>
			Returns<a contenteditable="false" data-primary="urljoin (urllib.parse module)" data-type="indexterm" id="idm44924488448464"/> a URL string <span class="code"><em>u</em></span>, obtained by joining <span class="code"><em>relative_url_string</em></span>, which may be relative, with <span class="code"><em>base_url_string</em></span>. The joining procedure that <span class="code">urljoin</span> performs to obtain its result may be summarized as follows:
			<ul>
<li>When either of the argument strings is empty, <span class="code"><em>u</em></span> is the other argument.</li>
<li>When <span class="code"><em>relative_url_string</em></span> explicitly specifies a scheme that is different from that of <span class="code"><em>base_url_string</em></span><em>,</em> <span class="code"><em>u</em></span> is <span class="code"><em>relative_url_string</em></span>. Otherwise, <span class="code"><em>u</em></span>’s scheme is that of <span class="code"><em>base_url_string</em></span>.</li>
<li>When the scheme does not allow relative URLs (e.g., <span class="code">mailto</span>), or when <span class="code"><em>relative_url_string</em></span> explicitly specifies a location (even when it is the same as the location of <span class="code"><em>base_url_string</em></span>), all other components of <span class="code"><em>u</em></span> are those of <span class="code"><em>relative_url_string</em></span>. Otherwise, <span class="code"><em>u</em></span>’s location is that of <span class="code"><em>base_url_string</em></span>.</li>
<li><span class="code"><em>u</em></span>’s path is obtained by joining the paths of <span class="code"><em>base_url_string</em></span> and <span class="code"><em>relative_url_string</em></span> according to standard syntax for absolute and relative URL paths.<sup><a data-type="noteref" href="ch19.xhtml#ch01fn147" id="ch01fn147-marker">a</a></sup> For example:</li>
</ul>
<pre data-code-language="python" data-type="programlisting">
<code class="n">urlparse</code><code class="o">.</code><code class="n">urljoin</code><code class="p">(</code><code>
</code><code>  </code><code class="s1">'</code><code class="s1">http://host.com/some/path/here</code><code class="s1">'</code><code class="p">,</code><code class="s1">'</code><code class="s1">../other/path</code><code class="s1">'</code><code class="p">)</code><code>
</code><em><code class="c1"># Result is: 'http://host.com/some/other/path'</code></em></pre>
</td>
</tr>
<tr>
<td><span class="code">urlsplit</span></td>
<td><span class="code">urlsplit(<em>url_string</em>, default_scheme='', allow_fragments=<strong>True</strong>)</span><br/>
			Analyzes<a contenteditable="false" data-primary="urlsplit (urllib.parse module)" data-type="indexterm" id="idm44924488406992"/> <span class="code"><em>url_string</em></span> and returns a tuple (actually an instance of <span class="code">SplitResult</span>, which you can treat as a tuple or use with named attributes) with five string items: <span class="code"><em>scheme</em></span>, <span class="code"><em>netloc</em></span>, <span class="code"><em>path</em></span>, <span class="code"><em>query</em></span>, and <span class="code"><em>fragment</em></span><em>.</em> <span class="code"><em>default_scheme</em></span> is the first item when the <span class="code"><em>url_string</em></span> lacks an explicit scheme. When <span class="code">allow_fragments</span> is <span class="code"><strong>False</strong></span>, the tuple’s last item is always <span class="code">''</span>, whether or not <span class="code"><em>url_string</em></span> has a fragment. Items corresponding to missing parts are also <span class="code">''</span>. For example:
			<pre data-code-language="python" data-type="programlisting">
<code class="n">urlparse</code><code class="o">.</code><code class="n">urlsplit</code><code class="p">(</code><code>
</code><code>  </code><code class="s1">'</code><code class="s1">http://www.python.org:80/faq.cgi?src=file</code><code class="s1">'</code><code class="p">)</code><code>
</code><em><code class="c1"># Result is:</code></em><code>
</code><em><code class="c1"># 'http','www.python.org:80','/faq.cgi','src=file',''</code></em></pre>
</td>
</tr>
<tr>
<td><span class="code">urlunsplit</span></td>
<td><span class="code">urlunsplit(<em>url_tuple</em>)</span><br/>
<span class="code"><em>url_tuple</em></span> is<a contenteditable="false" data-primary="urlunsplit (urllib.parse module)" data-type="indexterm" id="idm44924488355344"/> any iterable with exactly five items, all strings. Any return value from a <span class="code">urlsplit</span> call is an acceptable argument for <span class="code">urlunsplit</span>. <span class="code">urlunsplit</span> returns a URL string with the given components and the needed separators, but with no redundant separators (e.g., there is no <span class="code">#</span> in the result when the fragment, <span class="code"><em>url_tuple</em></span>’s last item, is <span class="code">''</span> ). For example:
			<pre data-code-language="python" data-type="programlisting">
<code class="n">urlparse</code><code class="o">.</code><code class="n">urlunsplit</code><code class="p">(</code><code class="p">(</code><code>
</code><code>  </code><code class="s1">'</code><code class="s1">http</code><code class="s1">'</code><code class="p">,</code><code class="s1">'</code><code class="s1">www.python.org</code><code class="s1">'</code><code class="p">,</code><code class="s1">'</code><code class="s1">/faq.cgi</code><code class="s1">'</code><code class="p">,</code><code class="s1">'</code><code class="s1">src=fie</code><code class="s1">'</code><code class="p">,</code><code class="s1">'</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>
</code><em><code class="c1"># Result is: 'http://www.python.org/faq.cgi?src=fie'</code></em></pre>
<span class="code">urlunsplit(urlsplit(<em>x</em>))</span> returns a normalized form of URL string <span class="code"><em>x</em></span>, which is not necessarily equal to <span class="code"><em>x</em></span> because <span class="code"><em>x</em></span> need not be normalized. For example:

			<pre data-code-language="python" data-type="programlisting">
<code class="n">urlparse</code><code class="o">.</code><code class="n">urlsplit</code><code class="p">(</code><code class="s1">'</code><code class="s1">http://a.com/path/a?</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>
</code><em><code class="c1"># Result is: 'http://a.com/path/a'</code></em></pre>
			In this case, the normalization ensures that redundant separators, such as the trailing <span class="code">?</span> in the argument to <span class="code">urlsplit</span>, are not present in the result.</td>
</tr>
</tbody>
<tbody><tr class="footnotes"><td colspan="2"><p data-type="footnote" id="ch01fn147"><sup><a href="ch19.xhtml#ch01fn147-marker">a</a></sup> Per <a href="https://oreil.ly/T9v1p">RFC 1808</a>.</p></td></tr></tbody></table>
</div></section>
<section data-pdf-bookmark="The urllib.request module" data-type="sect3"><div class="sect3" id="the_urllibdotrequest_module">
<h3>The urllib.request module</h3>
<p>The <span class="code">urllib.request</span> module supplies functions for accessing data resources over standard internet protocols, the most commonly used of which are listed in <a data-type="xref" href="#useful_functions_of_the_urllibdotreques">Table 19-4</a>. (The examples in the table assume you’ve imported the module.)</p>
<table class="border" id="useful_functions_of_the_urllibdotreques">
<caption><span class="label">Table 19-4. </span>Useful functions of the <span class="code">urllib.request</span> module</caption>
<tbody>
<tr>
<td class="width-10"><span class="code">urlopen</span></td>
<td><span class="code">urlopen(<em>url</em>, data=<strong>None</strong><em>,</em></span> <span class="code">timeout</span><span class="code"><em>,</em></span> <span class="code">context=<strong>None</strong>)</span><br/>
			Returns<a contenteditable="false" data-primary="urlopen (urllib.request module)" data-type="indexterm" id="idm44924488230928"/> a response object whose type depends on the scheme in <span class="code"><em>url</em></span>:
			<ul>
<li>HTTP and HTTPS URLs return an <span class="code">http.client.HTTPResponse</span> object (with the <span class="code">msg</span> attribute modified to contain the same data as the <span class="code">reason</span> attribute; for details, see the <a href="https://oreil.ly/gWFcH">online docs</a>). Your code can use this object like an iterable, and as a context manager in a <span class="code"><strong>with</strong></span> statement.</li>
<li>FTP, file, and data URLs return a <span class="code">urllib.response.addinfourl</span> object.<br/>
<span class="code"><em>url</em></span> is the string or <span class="code">urllib.request.Request</span> object for the URL to open. <span class="code"><em>data</em></span> is an optional <span class="code">bytes</span> object, file-like object, or iterable of bytes, encoding additional data to send to the URL following <span class="code"><em>application/x-www-form-urlencoded</em></span> format. <span class="code"><em>timeout</em></span> is an optional argument for specifying, in seconds, a timeout for blocking operations of the URL opening process, applicable only for HTTP, HTTPS, and FTP URLs. When <span class="code"><em>context</em></span> is given, it must contain an <span class="code">ssl.SSLContext</span> object specifying SSL options; <span class="code"><em>context</em></span> replaces the deprecated <span class="code"><em>cafile</em></span>, <span class="code"><em>capath</em></span>, and <span class="code"><em>cadefault</em></span> arguments. The following example downloads a file from an HTTPS URL and extracts it into a local <span class="code">bytes</span> object, <span class="code">unicode_db</span>:</li>
</ul>
<pre data-code-language="python" data-type="programlisting">
<code class="n">unicode_url</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="s2">"</code><a href="https://www.unicode.org/Public/"><code class="s2">https://www.unicode.org/Public</code></a><code class="s2">"</code><code>
</code><code>               </code><code class="s2">"</code><code class="s2">/14.0.0/ucd/UnicodeData.txt</code><code class="s2">"</code><code class="p">)</code><code>
</code><strong><code class="k">with</code></strong><code> </code><code class="n">urllib</code><code class="o">.</code><code class="n">request</code><code class="o">.</code><code class="n">urlopen</code><code class="p">(</code><code class="n">unicode_url</code><code> </code><code>
</code><code>     </code><code class="p">)</code><strong><code class="k">as</code></strong><code> </code><code class="n">url_response</code><code class="p">:</code><code>
</code><code>    </code><code class="n">unicode_db</code><code> </code><code class="o">=</code><code> </code><code class="n">url_response</code><code class="o">.</code><code class="n">read</code><code class="p">(</code><code class="p">)</code></pre>
</td>
</tr>
<tr>
<td><span class="code">u⁠r⁠l​r⁠e⁠t⁠r⁠i⁠e⁠v⁠e</span></td>
<td><span class="code">urlretrieve(<em>url_string</em>, filename=<strong>None</strong>, report_hook=<strong>None</strong>, data=<strong>None</strong>)</span><br/>
			A<a contenteditable="false" data-primary="urlretrieve (urllib.request module)" data-type="indexterm" id="idm44924488174352"/> compatibility function to support migration from Python 2 legacy code. <span class="code"><em>url_string</em></span> gives the URL of the resource to download. <span class="code">filename</span> is an optional string naming the local file in which to store the data retrieved from the URL. <span class="code">report_hook</span> is a callable to support progress reporting during downloading, called once as each block of data is retrieved. <span class="code">data</span> is similar to the <span class="code">data</span> argument for <span class="code">urlopen</span>. In its simplest form, <span class="code">urlretrieve</span> is equivalent to:
			<pre data-code-language="python" data-type="programlisting">
<strong><code class="k">def</code></strong><code> </code><code class="nf">urlretrieve</code><code class="p">(</code><code class="n">url</code><code class="p">,</code><code> </code><code class="n">filename</code><code class="o">=</code><strong><code class="kc">None</code></strong><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><strong><code class="k">if</code></strong><code> </code><code class="n">filename</code><code> </code><strong><code class="ow">is</code></strong><code> </code><strong><code class="kc">None</code></strong><code class="p">:</code><code>
</code><code>        </code><code class="n">filename</code><code> </code><code class="o">=</code><code> </code><em><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="n">parse filename from url...</code></em><code>
</code><code>    </code><strong><code class="k">with</code></strong><code> </code><code class="n">urllib</code><code class="o">.</code><code class="n">request</code><code class="o">.</code><code class="n">urlopen</code><code class="p">(</code><code class="n">url</code><code> </code><code>
</code><code>         </code><code class="p">)</code><strong><code class="k">as</code></strong><code> </code><code class="n">url_response</code><code class="p">:</code><code>
</code><code>        </code><strong><code class="k">with</code></strong><code> </code><code class="nb">open</code><code class="p">(</code><code class="n">filename</code><code class="p">,</code><code> </code><code class="s2">"</code><code class="s2">wb</code><code class="s2">"</code><code class="p">)</code><code> </code><strong><code class="k">as</code></strong><code> </code><code class="n">save_file</code><code class="p">:</code><code>
</code><code>            </code><code class="n">save_file</code><code class="o">.</code><code class="n">write</code><code class="p">(</code><code class="n">url_response</code><code class="o">.</code><code class="n">read</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code>
</code><code>        </code><strong><code class="k">return</code></strong><code> </code><code class="n">filename</code><code class="p">,</code><code> </code><code class="n">url_response</code><code class="o">.</code><code class="n">info</code><code class="p">(</code><code class="p">)</code></pre>
			Since this function was developed for Python 2 compatibility, you may still see it in existing codebases. New code should use <span class="code">urlopen</span>.</td>
</tr>
</tbody>
</table>
<p>For full coverage of <span class="code">urllib.request</span> see the <a href="https://oreil.ly/Vz9IV">online docs</a> and Michael Foord’s <a href="https://oreil.ly/6Lrem">HOWTO</a>, which includes examples on downloading files given a URL. There’s a short example using <span class="code">urllib.request</span> in <a data-type="xref" href="ch22.xhtml#an_html_parsing_example_with_beautifuls">“An HTML Parsing Example with BeautifulSoup”</a>.<a contenteditable="false" data-primary="" data-startref="urlibpckg19" data-type="indexterm" id="idm44924488088640"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="The Third-Party requests Package" data-type="sect2"><div class="sect2" id="the_third_party_requests_package">
<h2>The Third-Party requests Package</h2>
<p>The<a contenteditable="false" data-primary="requests package" data-type="indexterm" id="reqpack19"/> third-party <a href="https://oreil.ly/cOiit"><span class="code">requests</span> package</a> (very well documented <a href="https://oreil.ly/MiQ76">online</a>) is how we recommend you access HTTP URLs. As usual for third-party packages, it’s best installed with a simple <span class="code"><strong>pip install requests</strong></span>. In this section, we summarize how best to use it for reasonably simple cases.</p>
<p>Natively, <span class="code">requests</span> only supports the HTTP and HTTPS transport protocols; to access URLs using other protocols, you need to install other third-party packages (known as<a contenteditable="false" data-primary="protocol adapters" data-type="indexterm" id="idm44924488079456"/> <em>protocol adapters</em>), such as <a href="https://oreil.ly/efT73">requests-ftp</a> for FTP URLs, or others supplied as part of the rich <a href="https://oreil.ly/_6nQe">requests-toolbelt</a> package of <span class="code">requests</span> utilities.</p>
<p>The <span class="code">requests</span> package’s functionality hinges mostly on three classes it supplies: <span class="code">Request</span>, modeling an HTTP request to be sent to a server; <span class="code">Response</span>, modeling a server’s HTTP response to a request; and <span class="code">Session</span>, offering continuity across a sequence of requests, also known as a <em>session.</em> For the common use case of a single request/response interaction, you don’t need continuity, so you may often just ignore <span class="code">Session</span>.</p>
<section data-pdf-bookmark="Sending requests" data-type="sect3"><div class="sect3" id="sending_requests">
<h3>Sending requests</h3>
<p>Typically, you don’t need to explicitly consider the <span class="code">Request</span> class: rather, you call the utility function <span class="code">request</span>, which internally prepares and sends the <span class="code">Request</span> and returns the <span class="code">Response</span> instance. <span class="code">request</span> has two mandatory positional arguments, both <span class="code">str</span>s: <span class="code">method</span>, the HTTP method to use, and <span class="code">url</span>, the URL to address. Then, many optional named parameters may follow (in the next section, we cover the most commonly used named parameters to the <span class="code">request</span> function).</p>
<p>For further convenience, the <span class="code">requests</span> module also supplies functions whose names are those of the HTTP methods <span class="code">delete</span>, <span class="code">get</span>, <span class="code">head</span>, <span class="code">options</span>, <span class="code">patch</span>, <span class="code">post</span>, and <span class="code">put</span>; each takes a single mandatory positional argument, <span class="code">url</span>, then the same optional named arguments as the function <span class="code">request</span>.</p>
<p>When you want some continuity across multiple requests, call <span class="code">Session</span> to make an instance <span class="code"><em>s</em></span>, then use <span class="code"><em>s</em></span>’s methods <span class="code">request</span>, <span class="code">get</span>, <span class="code">post</span>, and so on, which are just like the functions with the same names directly supplied by the <span class="code">requests</span> module (however, <span class="code"><em>s</em></span>’s methods merge <span class="code"><em>s</em></span>’s settings with the optional named parameters to prepare each request to send to the given <span class="code">url</span>).</p>
</div></section>
<section data-pdf-bookmark="request’s optional named parameters" data-type="sect3"><div class="sect3" id="requestapostrophes_optional_named_param">
<h3>request’s optional named parameters</h3>
<p>The function <span class="code">request</span> (just like the functions <span class="code">get</span>, <span class="code">post</span>, and so on, and methods with the same names on an instance <span class="code"><em>s</em></span> of class <span class="code">Session</span>) accepts many optional named parameters. Refer to the <span class="code">requests</span> package’s excellent <a href="https://oreil.ly/0rIwn">online docs</a> for the full set if you need advanced functionality such as control over proxies, authentication, special treatment of redirection, streaming, cookies, and so on. <a data-type="xref" href="#named_parameters_accepted_by_the_reques">Table 19-5</a> lists the most frequently used named parameters.</p>
<table class="border" id="named_parameters_accepted_by_the_reques">
<caption><span class="label">Table 19-5. </span>Named parameters accepted by the <span class="code">request</span> function</caption>
<tbody>
<tr>
<td><span class="code">data</span></td>
<td>A <span class="code">dict</span>, a sequence of key/value pairs, a bytestring, or a file-like object to use as the body of the request</td>
</tr>
<tr>
<td><span class="code">files</span></td>
<td>A <span class="code">dict</span> with names as keys and file-like objects or <em>file tuples</em> as values, used with the POST method to specify a multipart-encoding file upload (we cover the format of values for <span class="code">files</span> in the next section)</td>
</tr>
<tr>
<td><span class="code">headers</span></td>
<td>A <span class="code">dict</span> of HTTP headers to send in the request</td>
</tr>
<tr>
<td><span class="code">json</span></td>
<td>Python data (usually a <span class="code">dict</span>) to encode as JSON as the body of the request</td>
</tr>
<tr>
<td><span class="code">params</span></td>
<td>A <span class="code">dict</span> of <span class="code">(<em>name</em>,</span> <span class="code"><em>value</em></span><span class="code">)</span> items, or a bytestring to send as the query string with the request</td>
</tr>
<tr>
<td><span class="code">timeout</span></td>
<td>A <span class="code">float</span> number of seconds, the maximum time to wait for the response before raising an exception</td>
</tr>
</tbody>
</table>
<p><span class="code">data</span>, <span class="code">json</span>, and <span class="code">files</span> are mutually incompatible ways to specify a body for the request; you should normally use at most one of them, and only for HTTP methods that do use a body (namely PATCH, POST, and PUT). The one exception is that you can have both a <span class="code">data</span> argument passing a <span class="code">dict</span> and a <span class="code">files</span> argument. That is very common usage: in this case, both the key/value pairs in the <span class="code">dict</span> and the files form the body of the request as a single <em>multipart/form-data</em> whole.<sup><a data-type="noteref" href="ch19.xhtml#ch01fn148" id="ch01fn148-marker">4</a></sup></p>
</div></section>
<section data-pdf-bookmark="The files argument (and other ways to specify the request’s body)" data-type="sect3"><div class="sect3" id="the_files_argument_left_parenthesisand">
<h3>The files argument (and other ways to specify the request’s body)</h3>
<p>When you specify the request’s body with <span class="code">json</span> or <span class="code">data</span> (passing a bytestring or a file-like object, which must be open for reading, usually in binary mode), the resulting bytes are directly used as the request’s body. When you specify it with <span class="code">data</span> (passing a <span class="code">dict</span> or a sequence of key/value pairs), the body is built as a <em>form</em>, from the key/value pairs formatted in <em>application/x-www-form-urlencoded</em> format, according to the relevant <a href="https://oreil.ly/hHKp4">web standard</a>.</p>
<p>When you specify the request’s body with <span class="code">files</span>, the body is also built as a form, in this case with the format set to <em>multipart/form-data</em> (the only way to upload files in a PATCH, POST, or PUT HTTP request). Each file you’re uploading is formatted into its own part of the form; if, in addition, you want the form to give to the server further nonfile parameters, then in addition to <span class="code">files</span>, you need to pass a <span class="code">data</span> argument with a <span class="code">dict</span> value (or a sequence of key/value pairs) for the further parameters. Those parameters get encoded into a supplementary part of the multipart form.</p>
<p>For flexibility, the value of the <span class="code">files</span> argument can be a <span class="code">dict</span> (its items are taken as a sequence of <span class="code">(<em>name</em>,</span> <span class="code"><em>value</em></span><span class="code">)</span> pairs), or a sequence of <span class="code">(<em>name</em>,</span> <span class="code"><em>value</em></span><span class="code">)</span> pairs (order is maintained in the resulting request body).</p>
<p>Either way, each value in a <span class="code">(<em>name</em>,</span> <span class="code"><em>value</em></span><span class="code">)</span> pair can be a <span class="code">str</span> (or, better,<sup><a data-type="noteref" href="ch19.xhtml#ch01fn149" id="ch01fn149-marker">5</a></sup> a <span class="code">bytes</span> or <span class="code">bytearray</span>) to be used directly as the uploaded file’s contents, or a file-like object open for reading (then, <span class="code">requests</span> calls <span class="code">.read()</span> on it and uses the result as the uploaded file’s contents; we strongly urge that in such cases you open the file in binary mode to avoid any ambiguity regarding content length). When any of these conditions apply, <span class="code">requests</span> uses the <span class="code"><em>name</em></span> part of the pair (e.g., the key into the <span class="code">dict</span>) as the file’s name (unless it can improve on that because the open file object is able to reveal its underlying filename), takes its best guess at a content type, and uses minimal headers for the file’s form part.</p>
<p>Alternatively, the value in each <span class="code">(<em>name</em>,</span> <span class="code"><em>value</em></span><span class="code">)</span> pair can be a tuple with two to four items, <span class="code">(<em>fn</em>,</span> <span class="code"><em>fp</em></span><span class="code">[,</span> <span class="code"><em>ft</em></span><span class="code">[,</span> <span class="code"><em>fh</em></span><span class="code">]])</span> (using square brackets as metasyntax to indicate optional parts). In this case, <span class="code"><em>fn</em></span> is the file’s name, <span class="code"><em>fp</em></span> provides the contents (in just the same way as in the previous paragraph), optional <span class="code"><em>ft</em></span> provides the content type (if missing, <span class="code">requests</span> guesses it, as in the previous paragraph), and the optional <span class="code">dict</span> <span class="code"><em>fh</em></span> provides extra headers for the file’s form part.</p>
</div></section>
<section data-pdf-bookmark="How to interpret requests examples" data-type="sect3"><div class="sect3" id="how_to_interpret_requests_examples">
<h3>How to interpret requests examples</h3>
<p>In practical applications, you don’t usually need to consider the internal instance <span class="code"><em>r</em></span> of the class <span class="code">requests.Request</span>, which functions like <span class="code">requests.post</span> is building, preparing, and then sending on your behalf. However, to understand exactly what <span class="code">requests</span> is doing, working at a lower level of abstraction (building, preparing, and examining <span class="code"><em>r</em></span>—no need to send it!) is instructive. For example, after importing <span class="code">requests</span>, passing <span class="code">data</span> as in the following example:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="n">r</code> <code class="o">=</code> <code class="n">requests</code><code class="o">.</code><code class="n">Request</code><code class="p">(</code><code class="s1">'GET'</code><code class="p">,</code> <code class="s1">'http://www.example.com'</code><code class="p">,</code>
    <code class="n">data</code><code class="o">=</code><code class="p">{</code><code class="s1">'foo'</code><code class="p">:</code> <code class="s1">'bar'</code><code class="p">},</code> <code class="n">params</code><code class="o">=</code><code class="p">{</code><code class="s1">'fie'</code><code class="p">:</code> <code class="s1">'foo'</code><code class="p">})</code>
<code class="n">p</code> <code class="o">=</code> <code class="n">r</code><code class="o">.</code><code class="n">prepare</code><code class="p">()</code>
<code class="nb">print</code><code class="p">(</code><code class="n">p</code><code class="o">.</code><code class="n">url</code><code class="p">)</code>
<code class="nb">print</code><code class="p">(</code><code class="n">p</code><code class="o">.</code><code class="n">headers</code><code class="p">)</code>
<code class="nb">print</code><code class="p">(</code><code class="n">p</code><code class="o">.</code><code class="n">body</code><code class="p">)</code></pre>
<p>prints out (splitting the <span class="code"><em>p</em></span><span class="code">.headers</span> <span class="code">dict</span>’s printout for readability):</p>
<pre data-type="programlisting">
<strong>http://www.example.com/?fie=foo</strong>
<strong>{'Content-Length': '7',</strong>
<strong> 'Content-Type': 'application/x-www-form-urlencoded'}</strong>
<strong>foo=bar</strong></pre>
<p class="pagebreak-before">Similarly, when passing <span class="code">files</span>:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="n">r</code> <code class="o">=</code> <code class="n">requests</code><code class="o">.</code><code class="n">Request</code><code class="p">(</code><code class="s1">'POST'</code><code class="p">,</code> <code class="s1">'http://www.example.com'</code><code class="p">,</code>
    <code class="n">data</code><code class="o">=</code><code class="p">{</code><code class="s1">'foo'</code><code class="p">:</code> <code class="s1">'bar'</code><code class="p">},</code> <code class="n">files</code><code class="o">=</code><code class="p">{</code><code class="s1">'fie'</code><code class="p">:</code> <code class="s1">'foo'</code><code class="p">})</code>
<code class="n">p</code> <code class="o">=</code> <code class="n">r</code><code class="o">.</code><code class="n">prepare</code><code class="p">()</code>
<code class="nb">print</code><code class="p">(</code><code class="n">p</code><code class="o">.</code><code class="n">headers</code><code class="p">)</code>
<code class="nb">print</code><code class="p">(</code><code class="n">p</code><code class="o">.</code><code class="n">body</code><code class="p">)</code></pre>
<p>this prints out (with several lines split for readability):</p>
<pre data-type="programlisting">
<strong>{'Content-Length': '228',</strong>
<strong> 'Content-Type': 'multipart/form-data; boundary=dfd600d8aa58496270'}</strong>
<strong>b'--dfd600d8aa58496270\r\nContent-Disposition: form-data;</strong>
<strong>="foo"\r\n\r\nbar\r\n--dfd600d8aa584962709b936134b1cfce\r\n</strong>
<strong>Content-Disposition: form-data; name="fie" filename="fie"\r\n\r\nfoo\r\n</strong>
<strong>--dfd600d8aa584962709b936134b1cfce--\r\n'</strong></pre>
<p>Happy interactive exploring!</p>
</div></section>
<section data-pdf-bookmark="The Response class" data-type="sect3"><div class="sect3" id="the_response_class">
<h3>The Response class</h3>
<p>The<a contenteditable="false" data-primary="requests package" data-secondary="Response class" data-type="indexterm" id="idm44924487809056"/> one class from the <span class="code">requests</span> module that you always have to consider is <span class="code">Response</span>: every request, once sent to the server (typically, that’s done implicitly by methods such as <span class="code">get</span>), returns an instance <span class="code"><em>r</em></span> of <span class="code">requests.Response</span>.</p>
<p>The first thing you usually want to do is to check <span class="code"><em>r</em></span><span class="code">.status_code</span>, an <span class="code">int</span> that tells you how the request went, in typical “HTTPese”: <span class="code">200</span> means “everything’s fine,” <span class="code">404</span> means “not found,” and so on. If you’d rather just get an exception for status codes indicating some kind of error, call <span class="code"><em>r</em></span><span class="code">.raise_for_status</span>; that does nothing if the request went fine, but raises <span class="code">requests.exceptions.HTTPError</span> otherwise. (Other exceptions, not corresponding to any specific HTTP status code, can and do get raised without requiring any such explicit call: e.g., <span class="code">ConnectionError</span> for any kind of network problem, or <span class="code">TimeoutError</span> for a timeout.)</p>
<p>Next, you may want to check the response’s HTTP headers: for that, use <span class="code"><em>r</em></span><span class="code">.headers</span>, a <span class="code">dict</span> (with the special feature of having case-insensitive string-only keys indicating the header names as listed, e.g., in <a href="https://oreil.ly/_nJRX">Wikipedia</a>, per the HTTP specs). Most headers can be safely ignored, but sometimes you’d rather check. For example, you can verify whether the response specifies which natural language its body is written in, via <span class="code"><em>r</em></span><span class="code">.headers.get('content-language')</span>, to offer different presentation choices, such as the option to use some kind of language translation service to make the response more usable for the user.</p>
<p>You don’t usually need to make specific status or header checks for redirects: by default, <span class="code">requests</span> automatically follows redirects for all methods except HEAD (you can explicitly pass the <span class="code">allow_redirection</span> named parameter in the request to alter that behavior). If you allow redirects, you may want to check <span class="code"><em>r</em></span><span class="code">.history</span>, a list of all <span class="code">Response</span> instances accumulated along the way, oldest to newest, up to but excluding <span class="code"><em>r</em></span> itself (<span class="code"><em>r</em></span><span class="code">.history</span> is empty if there have been no redirects).</p>
<p>Most often, maybe after checking status and headers, you want to use the response’s body. In simple cases, just access the response’s body as a bytestring, <span class="code"><em>r</em></span><span class="code">.content</span>, or decode it as JSON (once you’ve checked that’s how it’s encoded, e.g., via <span class="code"><em>r</em></span><span class="code">.headers.get('content-type')</span>) by calling <span class="code"><em>r</em></span><span class="code">.json</span>.</p>
<p>Often, you’d rather access the response’s body as (Unicode) text, with the property <span class="code"><em>r</em></span><span class="code">.text</span>. The latter gets decoded (from the octets that actually make up the response’s body) with the codec <span class="code">requests</span> thinks is best, based on the Content-Type header and a cursory examination of the body itself. You can check what codec has been used (or is about to be used) via the attribute <span class="code"><em>r</em></span><span class="code">.encoding</span>; its value will be the name of a codec registered with the <span class="code">codecs</span> module, covered in <a data-type="xref" href="ch09.xhtml#the_codecs_module">“The codecs Module”</a>. You can even <em>override</em> the choice of codec to use by <em>assigning</em> to <span class="code"><em>r</em></span><span class="code">.encoding</span> the name of the codec you choose.</p>
<p>We do not cover other advanced issues, such as streaming, in this book; see the <span class="code">requests</span> package’s <a href="https://oreil.ly/4St1s">online docs</a> for further information.<a contenteditable="false" data-primary="" data-startref="NPMhttp19" data-type="indexterm" id="idm44924487756224"/><a contenteditable="false" data-primary="" data-startref="reqpack19" data-type="indexterm" id="idm44924487754848"/></p>
</div></section>
</div></section>
</div></section>
<section data-pdf-bookmark="Other Network Protocols" data-type="sect1"><div class="sect1" id="other_network_protocols">
<h1>Other Network Protocols</h1>
<p>Many, <em>many</em> other network protocols<a contenteditable="false" data-primary="network protocol modules (client-side)" data-secondary="other network protocols" data-type="indexterm" id="idm44924487751344"/> are in use—a few are best supported by Python’s standard library, but for most of them you’ll find better and more recent third-party modules on <a href="https://oreil.ly/PGIim">PyPI</a>.</p>
<p>To connect as if you were logging in to another machine (or a separate login session on your own node), you can use the<a contenteditable="false" data-primary="Secure Shell (SSH) protocol" data-type="indexterm" id="idm44924487748192"/><a contenteditable="false" data-primary="SSH (Secure Shell) protocol" data-type="indexterm" id="idm44924487747184"/> <a href="https://oreil.ly/HazNC">Secure Shell (SSH)</a> protocol, supported by the third-party module<a contenteditable="false" data-primary="paramiko package" data-type="indexterm" id="idm44924487745264"/> <a href="http://www.paramiko.org"><span class="code">paramiko</span></a> or the higher abstraction layer wrapper around it, the third-party module<a contenteditable="false" data-primary="spur module" data-type="indexterm" id="idm44924487742880"/> <a href="https://oreil.ly/vdmrN"><span class="code">spur</span></a>. (You can also, with some likely security risks, still use classic <a href="https://oreil.ly/5fw-y">Telnet</a>, supported by the<a contenteditable="false" data-primary="telnetlib module" data-type="indexterm" id="idm44924487739696"/><a contenteditable="false" data-primary="standard library modules" data-secondary="telnetlib" data-type="indexterm" id="idm44924487738560"/> standard library module <a href="https://oreil.ly/GYdGi"><span class="code">telnetlib</span></a>.)</p>
<p>Other network protocols include, among many others:</p>
<ul>
<li>
<p><a href="https://oreil.ly/zCBov">NNTP</a>, to<a contenteditable="false" data-primary="NNTP (Network News Transfer Protocol)" data-type="indexterm" id="idm44924487733776"/><a contenteditable="false" data-primary="Network News Transfer Protocol (NNTP)" data-type="indexterm" id="idm44924487732624"/> access Usenet News servers, supported by the standard library module <span class="code">nntplib</span></p>
</li>
<li>
<p><a href="https://oreil.ly/7vRm0">XML-RPC</a>, for<a contenteditable="false" data-primary="XML-RPC (Extensible Markup Language remote procedure call) protocol" data-type="indexterm" id="idm44924487729312"/><a contenteditable="false" data-primary="Extensible Markup Language remote procedure call (XML-RPC) protocol" data-type="indexterm" id="idm44924487728128"/> a rudimentary remote procedure call functionality, supported by <a href="https://oreil.ly/K3oDj"><span class="code">xmlrpc.client</span></a></p>
</li>
<li>
<p><a href="http://www.grpc.io">gRPC</a>, for<a contenteditable="false" data-primary="gRPC protocol" data-type="indexterm" id="idm44924487724288"/> a more modern remote procedure functionality, supported by third-party<a contenteditable="false" data-primary="grpcio module" data-type="indexterm" id="idm44924487723024"/> module <a href="https://oreil.ly/KHQHs"><span class="code">grpcio</span></a></p>
</li>
<li>
<p><a href="http://www.ntp.org">NTP</a>, to<a contenteditable="false" data-primary="standard library modules" data-secondary="ntplib" data-type="indexterm" id="idm44924487719296"/><a contenteditable="false" data-primary="NTP (Network Time Protocol)" data-type="indexterm" id="idm44924487717872"/><a contenteditable="false" data-primary="ntplib module" data-type="indexterm" id="idm44924487716752"/><a contenteditable="false" data-primary="Network Time Protocol (NTP)" data-type="indexterm" id="idm44924487715648"/> get precise time off the network, supported by third-party module <a href="https://oreil.ly/R5SDp"><span class="code">ntplib</span></a></p>
</li>
<li>
<p><a href="https://oreil.ly/nlhqH">SNMP</a>, for<a contenteditable="false" data-primary="SNMP (Simple Network Management Protocol)" data-type="indexterm" id="idm44924487711936"/><a contenteditable="false" data-primary="Simple Network Management Protocol (SNMP)" data-type="indexterm" id="idm44924487710768"/> network management, supported by third-party module<a contenteditable="false" data-primary="pysnmp module" data-type="indexterm" id="idm44924487709504"/> <a href="https://oreil.ly/syh0_"><span class="code">pysnmp</span></a></p>
</li>
</ul>
<p>No single book (not even this one!) could possibly cover all these protocols and their supporting modules. Rather, our best suggestion in the matter is a strategic one: whenever you decide that your application needs to interact with some other system via a certain networking protocol, don’t rush to implement your own modules to support that protocol. Instead, search and ask around, and you’re likely to find excellent existing Python modules (third-party or standard-library ones) supporting that protocol.<sup><a data-type="noteref" href="ch19.xhtml#ch01fn150" id="ch01fn150-marker">6</a></sup></p>
<p>Should<a contenteditable="false" data-primary="resources" data-secondary="community" data-type="indexterm" id="idm44924487705520"/><a contenteditable="false" data-primary="Python community" data-type="indexterm" id="idm44924487704112"/> you find some bug or missing feature in such modules, open a bug or feature request (and, ideally, supply a patch or pull request that would fix the problem and satisfy your application’s needs). In other words, become an active member of the open source community, rather than just a passive user: you will be welcome there, scratch your own itch, and help many others in the process. “Give forward,” since you cannot “give back” to all the awesome people who contributed to give you most of the tools you’re using!</p>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="ch01fn140"><sup><a href="ch19.xhtml#ch01fn140-marker">1</a></sup> IMAP4, per <a href="https://oreil.ly/fn5aH">RFC 1730</a>; or IMAP4rev1, per <a href="https://oreil.ly/C5N0w">RFC 2060</a>.</p><p data-type="footnote" id="ch01fn141"><sup><a href="ch19.xhtml#ch01fn141-marker">2</a></sup> The specification of the POP protocol can be found in <a href="https://oreil.ly/NLl6b">RFC 1939</a>.</p><p data-type="footnote" id="ch01fn144"><sup><a href="ch19.xhtml#ch01fn144-marker">3</a></sup> The specification of the SMTP protocol can be found in <a href="https://oreil.ly/J9aCH">RFC 2821</a>.</p><p data-type="footnote" id="ch01fn148"><sup><a href="ch19.xhtml#ch01fn148-marker">4</a></sup> According to <a href="https://oreil.ly/7xsOe">RFC 2388</a>.</p><p data-type="footnote" id="ch01fn149"><sup><a href="ch19.xhtml#ch01fn149-marker">5</a></sup> As it gives you complete, explicit control of exactly what octets are uploaded.</p><p data-type="footnote" id="ch01fn150"><sup><a href="ch19.xhtml#ch01fn150-marker">6</a></sup> Even more importantly, if you think you need to invent a brand-new protocol and implement it on top of sockets, think again, and search carefully: it’s far more likely that one or more of the huge number of existing internet protocols meets your needs just fine!</p></div></div></section></div></body></html>