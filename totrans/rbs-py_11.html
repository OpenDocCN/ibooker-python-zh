<html><head></head><body>
<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. User-Defined Types: Data Classes" class="preface"><div class="preface" id="dataclasses">
<h1 class="calibre10" id="calibre_pb_0"><span class="calibre">Chapter 9. </span>User-Defined Types: Data Classes</h1>


<p class="author1">Data classes are user-defined types that let you group related data together. Many types, such as integers, strings, and enumerations, are <em class="calibre6">scalar</em>; they represent one and only one value.<a data-type="indexterm" data-primary="user-defined types" data-secondary="data classes" id="ix_usrDTDC" class="calibre5"/><a data-type="indexterm" data-primary="data classes" id="ix_dacl" class="calibre5"/> Other types, such as lists, sets, and dictionaries, represent homogeneous collections. However, you still need to be able compose multiple fields of data into a single data type. Dictionaries and tuples are OK at this, but they suffer from a few issues. Readability is tricky, as it can be difficult knowing what a dictionary or tuple contains at runtime. This makes them hard to reason about when reading and reviewing code, which is a major blow to robustness.</p>

<p class="author1">When your data is hard to understand, readers will make incorrect assumptions and won’t be able to spot bugs as easily. Data classes are easier to read and understand, and the typechecker knows how to naturally handle them.</p>






</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. User-Defined Types: Data Classes" class="preface">
<div class="preface" id="dataclasses">
<section data-type="sect1" data-pdf-bookmark="Data Classes in Action" class="preface"><div class="preface" id="idm45644743036728">
<h1 class="calibre12" id="calibre_pb_1">Data Classes in Action</h1>

<p class="author1">Data classes represent a heterogeneous collection of variables, all rolled into a <em class="calibre6">composite type</em>. Composite types <a data-type="indexterm" data-primary="composite types" id="idm45644743034040" class="calibre5"/>are made up of multiple values, and should always represent some sort of relationship or logical grouping. For example, a <code class="calibre17">Fraction</code> is an excellent example of a composite type. <a data-type="indexterm" data-primary="data classes" data-secondary="Fraction class example" id="idm45644743032648" class="calibre5"/>It contains two scalar values: a <code class="calibre17">numerator</code> and a <code class="calibre17">denominator</code>.</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">from</code> <code class="nn">fraction</code> <code class="k">import</code> <code class="n">Fraction</code>
<code class="n">Fraction</code><code class="calibre17">(</code><code class="n">numerator</code><code class="calibre17">=</code><code class="mi">3</code><code class="calibre17">,</code> <code class="n">denominator</code><code class="calibre17">=</code><code class="mi">5</code><code class="calibre17">)</code></pre>

<p class="author1">This <code class="calibre17">Fraction</code> represents the relationship between that <code class="calibre17">numerator</code> and <code class="calibre17">denominator</code>. The <code class="calibre17">numerator</code> and <code class="calibre17">denominator</code> are independent of each other; changing one does not change the other. However, by combining them into a single type, they are grouped together to create a logical concept.</p>

<p class="author1">Data classes allow you to create these concepts quite easily. To represent a fraction with a <code class="calibre17">dataclass</code>, you do the following:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">from</code> <code class="nn">dataclasses</code> <code class="k">import</code> <code class="n">dataclass</code>
<code class="nd">@dataclass</code>
<code class="k">class</code> <code class="nc">MyFraction</code><code class="calibre17">:</code>
    <code class="n">numerator</code><code class="calibre17">:</code> <code class="nb">int</code> <code class="calibre17">=</code> <code class="mi">0</code>
    <code class="n">denominator</code><code class="calibre17">:</code> <code class="nb">int</code> <code class="calibre17">=</code> <code class="mi">1</code></pre>

<p class="author1">Simple, isn’t it? The <code class="calibre17">@dataclass</code> before the class definition is known as a <em class="calibre6">decorator</em>. <a data-type="indexterm" data-primary="@dataclass decorator" id="idm45644742972920" class="calibre5"/>You’ll learn more about decorators in <a data-type="xref" href="part0022_split_000.html#composability" class="calibre5">Chapter 17</a>, but for now, all you need to know is that putting <code class="calibre17">@dataclass</code> before your class turns it into a <code class="calibre17">dataclass</code>. Once you’ve decorated the class, you need to list out all the fields that you want to represent as a relationship. It is imperative that you provide a default value or a type, so that Python recognizes it as a member of that <code class="calibre17">dataclass</code>. In the above case, I am demonstrating both.</p>

<p class="author1">By building relationships like this, you are adding to the shared vocabulary in your codebase. Instead of developers always needing to implement each field individually, you instead provide a reusable grouping. Data classes force you to explicitly assign types to your fields, so there’s less chance of type confusion among maintainers.</p>

<p class="author1">Data classes and other <a data-type="indexterm" data-primary="data classes" data-secondary="nesting data classes and other user-defined types in" id="idm45644742949464" class="calibre5"/>user-defined types can be nested within the <code class="calibre17">dataclass</code>. Suppose I’m creating an automated soup maker and I need to group my soup ingredients together. Using <code class="calibre17">dataclass</code>, it looks like this:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">import</code><code class="calibre17"> </code><code class="nn">datetime</code><code class="calibre17">
</code><code class="k">from</code><code class="calibre17"> </code><code class="nn">dataclasses</code><code class="calibre17"> </code><code class="k">import</code><code class="calibre17"> </code><code class="n">dataclass</code><code class="calibre17">
</code><code class="k">from</code><code class="calibre17"> </code><code class="nn">enum</code><code class="calibre17"> </code><code class="k">import</code><code class="calibre17"> </code><code class="n">auto</code><code class="calibre17">,</code><code class="calibre17"> </code><code class="n">Enum</code><code class="calibre17">
</code><code class="calibre17">
</code><code class="k">class</code><code class="calibre17"> </code><code class="nc">ImperialMeasure</code><code class="calibre17">(</code><code class="n">Enum</code><code class="calibre17">)</code><code class="calibre17">:</code><code class="calibre17"> </code><a class="calibre5" id="co_user_defined_types__data_classes_CO1-1" href="part0013_split_001.html#callout_user_defined_types__data_classes_CO1-1"><img src="../images/00002.gif" alt="1" class="calibre40"/></a><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">TEASPOON</code><code class="calibre17"> </code><code class="calibre17">=</code><code class="calibre17"> </code><code class="n">auto</code><code class="calibre17">(</code><code class="calibre17">)</code><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">TABLESPOON</code><code class="calibre17"> </code><code class="calibre17">=</code><code class="calibre17"> </code><code class="n">auto</code><code class="calibre17">(</code><code class="calibre17">)</code><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">CUP</code><code class="calibre17"> </code><code class="calibre17">=</code><code class="calibre17"> </code><code class="n">auto</code><code class="calibre17">(</code><code class="calibre17">)</code><code class="calibre17">
</code><code class="calibre17">
</code><code class="k">class</code><code class="calibre17"> </code><code class="nc">Broth</code><code class="calibre17">(</code><code class="n">Enum</code><code class="calibre17">)</code><code class="calibre17">:</code><code class="calibre17"> </code><a class="calibre5" id="co_user_defined_types__data_classes_CO1-2" href="part0013_split_001.html#callout_user_defined_types__data_classes_CO1-2"><img src="../images/00005.gif" alt="2" class="calibre40"/></a><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">VEGETABLE</code><code class="calibre17"> </code><code class="calibre17">=</code><code class="calibre17"> </code><code class="n">auto</code><code class="calibre17">(</code><code class="calibre17">)</code><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">CHICKEN</code><code class="calibre17"> </code><code class="calibre17">=</code><code class="calibre17"> </code><code class="n">auto</code><code class="calibre17">(</code><code class="calibre17">)</code><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">BEEF</code><code class="calibre17"> </code><code class="calibre17">=</code><code class="calibre17"> </code><code class="n">auto</code><code class="calibre17">(</code><code class="calibre17">)</code><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">FISH</code><code class="calibre17"> </code><code class="calibre17">=</code><code class="calibre17"> </code><code class="n">auto</code><code class="calibre17">(</code><code class="calibre17">)</code><code class="calibre17">
</code><code class="calibre17">
</code><code class="nd">@dataclass</code><code class="calibre17">(</code><code class="n">frozen</code><code class="calibre17">=</code><code class="nb">True</code><code class="calibre17">)</code><code class="calibre17"> </code><a class="calibre5" id="co_user_defined_types__data_classes_CO1-3" href="part0013_split_001.html#callout_user_defined_types__data_classes_CO1-3"><img src="../images/00006.gif" alt="3" class="calibre40"/></a><code class="calibre17">
</code><code class="c"># Ingredients added into the broth</code><code class="calibre17">
</code><code class="k">class</code><code class="calibre17"> </code><code class="nc">Ingredient</code><code class="calibre17">:</code><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">name</code><code class="calibre17">:</code><code class="calibre17"> </code><code class="nb">str</code><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">amount</code><code class="calibre17">:</code><code class="calibre17"> </code><code class="nb">float</code><code class="calibre17"> </code><code class="calibre17">=</code><code class="calibre17"> </code><code class="mi">1</code><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">units</code><code class="calibre17">:</code><code class="calibre17"> </code><code class="n">ImperialMeasure</code><code class="calibre17"> </code><code class="calibre17">=</code><code class="calibre17"> </code><code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">CUP</code><code class="calibre17">
</code><code class="calibre17">
</code><code class="nd">@dataclass</code><code class="calibre17">
</code><code class="k">class</code><code class="calibre17"> </code><code class="nc">Recipe</code><code class="calibre17">:</code><code class="calibre17"> </code><a class="calibre5" id="co_user_defined_types__data_classes_CO1-4" href="part0013_split_001.html#callout_user_defined_types__data_classes_CO1-4"><img src="../images/00007.gif" alt="4" class="calibre40"/></a><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">aromatics</code><code class="calibre17">:</code><code class="calibre17"> </code><code class="nb">set</code><code class="calibre17">[</code><code class="n">Ingredient</code><code class="calibre17">]</code><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">broth</code><code class="calibre17">:</code><code class="calibre17"> </code><code class="n">Broth</code><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">vegetables</code><code class="calibre17">:</code><code class="calibre17"> </code><code class="nb">set</code><code class="calibre17">[</code><code class="n">Ingredient</code><code class="calibre17">]</code><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">meats</code><code class="calibre17">:</code><code class="calibre17"> </code><code class="nb">set</code><code class="calibre17">[</code><code class="n">Ingredient</code><code class="calibre17">]</code><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">starches</code><code class="calibre17">:</code><code class="calibre17"> </code><code class="nb">set</code><code class="calibre17">[</code><code class="n">Ingredient</code><code class="calibre17">]</code><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">garnishes</code><code class="calibre17">:</code><code class="calibre17"> </code><code class="nb">set</code><code class="calibre17">[</code><code class="n">Ingredient</code><code class="calibre17">]</code><code class="calibre17">
</code><code class="calibre17">    </code><code class="n">time_to_cook</code><code class="calibre17">:</code><code class="calibre17"> </code><code class="n">datetime</code><code class="calibre17">.</code><code class="n">timedelta</code></pre>
<dl class="calibre13">
<dt class="calibre14"><a class="calibre5" id="callout_user_defined_types__data_classes_CO1-1" href="part0013_split_001.html#co_user_defined_types__data_classes_CO1-1"><img src="../images/00002.gif" alt="1" class="calibre40"/></a></dt>
<dd class="calibre41"><p class="calibre42">An enumeration to track different liquid measure sizes</p></dd>
<dt class="calibre14"><a class="calibre5" id="callout_user_defined_types__data_classes_CO1-2" href="part0013_split_001.html#co_user_defined_types__data_classes_CO1-2"><img src="../images/00005.gif" alt="2" class="calibre40"/></a></dt>
<dd class="calibre41"><p class="calibre42">An enumeration to track which broth is used in the soup</p></dd>
<dt class="calibre14"><a class="calibre5" id="callout_user_defined_types__data_classes_CO1-3" href="part0013_split_001.html#co_user_defined_types__data_classes_CO1-3"><img src="../images/00006.gif" alt="3" class="calibre40"/></a></dt>
<dd class="calibre41"><p class="calibre42">A <code class="calibre17">dataclass</code> representing an individual ingredient to be put in the soup. Note that the parameter <code class="calibre17">frozen=True</code> is a special property of data classes to indicate that this <code class="calibre17">dataclass</code> is immutable (more on that later). This does not mean the ingredients come from the freezer section of the supermarket.</p></dd>
<dt class="calibre14"><a class="calibre5" id="callout_user_defined_types__data_classes_CO1-4" href="part0013_split_001.html#co_user_defined_types__data_classes_CO1-4"><img src="../images/00007.gif" alt="4" class="calibre40"/></a></dt>
<dd class="calibre41"><p class="calibre42">A <code class="calibre17">dataclass</code> representing a soup recipe</p></dd>
</dl>

<p class="author1">We’re able to take multiple user-defined types (<code class="calibre17">ImperialMeasure</code>, <code class="calibre17">Broth</code>, and <code class="calibre17">Ingredient</code>) to compose them all into the composite type: <code class="calibre17">Recipe</code>. From this <code class="calibre17">Recipe</code>, you can infer multiple concepts:</p>

<ul class="printings">
<li class="calibre9">
<p class="author1">A soup recipe is a set of grouped information. Specifically, it can be defined by its ingredients (separated into specific categories), the broth used, and how long it takes to cook.</p>
</li>
<li class="calibre9">
<p class="author1">Each ingredient has a name and an amount you need for the recipe.</p>
</li>
<li class="calibre9">
<p class="author1">You have enumerations to tell you about the soup broth and measures. These are not a relationship by themselves, but they do communicate intention to the reader.</p>
</li>
<li class="calibre9">
<p class="author1">Each grouping of ingredients is a set, rather than a tuple. This means that the user can change these after construction, but still prevent duplicates.</p>
</li>
</ul>

<p class="author1">To create<a data-type="indexterm" data-primary="data classes" data-secondary="creating" id="idm45644742678056" class="calibre5"/> the <code class="calibre17">dataclass</code>, I do the following:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="n">pepper</code> <code class="calibre17">=</code> <code class="n">Ingredient</code><code class="calibre17">(</code><code class="s">"Pepper"</code><code class="calibre17">,</code> <code class="mi">1</code><code class="calibre17">,</code> <code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">TABLESPOON</code><code class="calibre17">)</code>
<code class="n">garlic</code> <code class="calibre17">=</code> <code class="n">Ingredient</code><code class="calibre17">(</code><code class="s">"Garlic"</code><code class="calibre17">,</code> <code class="mi">2</code><code class="calibre17">,</code> <code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">TEASPOON</code><code class="calibre17">)</code>
<code class="n">carrots</code> <code class="calibre17">=</code> <code class="n">Ingredient</code><code class="calibre17">(</code><code class="s">"Carrots"</code><code class="calibre17">,</code> <code class="calibre17">.</code><code class="mi">25</code><code class="calibre17">,</code> <code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">CUP</code><code class="calibre17">)</code>
<code class="n">celery</code> <code class="calibre17">=</code> <code class="n">Ingredient</code><code class="calibre17">(</code><code class="s">"Celery"</code><code class="calibre17">,</code> <code class="calibre17">.</code><code class="mi">25</code><code class="calibre17">,</code> <code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">CUP</code><code class="calibre17">)</code>
<code class="n">onions</code> <code class="calibre17">=</code> <code class="n">Ingredient</code><code class="calibre17">(</code><code class="s">"Onions"</code><code class="calibre17">,</code> <code class="calibre17">.</code><code class="mi">25</code><code class="calibre17">,</code> <code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">CUP</code><code class="calibre17">)</code>
<code class="n">parsley</code> <code class="calibre17">=</code> <code class="n">Ingredient</code><code class="calibre17">(</code><code class="s">"Parsley"</code><code class="calibre17">,</code> <code class="mi">2</code><code class="calibre17">,</code> <code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">TABLESPOON</code><code class="calibre17">)</code>
<code class="n">noodles</code> <code class="calibre17">=</code> <code class="n">Ingredient</code><code class="calibre17">(</code><code class="s">"Noodles"</code><code class="calibre17">,</code> <code class="mi">1.5</code><code class="calibre17">,</code> <code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">CUP</code><code class="calibre17">)</code>
<code class="n">chicken</code> <code class="calibre17">=</code> <code class="n">Ingredient</code><code class="calibre17">(</code><code class="s">"Chicken"</code><code class="calibre17">,</code> <code class="mi">1.5</code><code class="calibre17">,</code> <code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">CUP</code><code class="calibre17">)</code>

<code class="n">chicken_noodle_soup</code> <code class="calibre17">=</code> <code class="n">Recipe</code><code class="calibre17">(</code>
    <code class="n">aromatics</code><code class="calibre17">=</code><code class="calibre17">{</code><code class="n">pepper</code><code class="calibre17">,</code> <code class="n">garlic</code><code class="calibre17">},</code>
    <code class="n">broth</code><code class="calibre17">=</code><code class="n">Broth</code><code class="calibre17">.</code><code class="n">CHICKEN</code><code class="calibre17">,</code>
    <code class="n">vegetables</code><code class="calibre17">=</code><code class="calibre17">{</code><code class="n">celery</code><code class="calibre17">,</code> <code class="n">onions</code><code class="calibre17">,</code> <code class="n">carrots</code><code class="calibre17">},</code>
    <code class="n">meats</code><code class="calibre17">=</code><code class="calibre17">{</code><code class="n">chicken</code><code class="calibre17">},</code>
    <code class="n">starches</code><code class="calibre17">=</code><code class="calibre17">{</code><code class="n">noodles</code><code class="calibre17">},</code>
    <code class="n">garnishes</code><code class="calibre17">=</code><code class="calibre17">{</code><code class="n">parsley</code><code class="calibre17">},</code>
    <code class="n">time_to_cook</code><code class="calibre17">=</code><code class="n">datetime</code><code class="calibre17">.</code><code class="n">timedelta</code><code class="calibre17">(</code><code class="n">minutes</code><code class="calibre17">=</code><code class="mi">60</code><code class="calibre17">))</code></pre>

<p class="author1">You can also get and set individual fields:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="n">chicken_noodle_soup</code><code class="calibre17">.</code><code class="n">broth</code>
<code class="calibre17">&gt;&gt;&gt;</code> <code class="n">Broth</code><code class="calibre17">.</code><code class="n">CHICKEN</code>
<code class="n">chicken_noodle_soup</code><code class="calibre17">.</code><code class="n">garnishes</code><code class="calibre17">.</code><code class="n">add</code><code class="calibre17">(</code><code class="n">pepper</code><code class="calibre17">)</code></pre>

<p class="author1"><a data-type="xref" href="part0013_split_001.html#figure_9_1" class="calibre5">Figure 9-1</a> shows how this <code class="calibre17">dataclass</code> is constructed.</p>

<figure class="calibre36"><div id="figure_9_1" class="figure">
<img src="../images/00013.gif" alt="Construction of the dataclass" class="calibre40"/>
<h6 class="calibre37"><span class="calibre">Figure 9-1. </span>Construction of the <code class="calibre17">dataclass</code></h6>
</div></figure>

<p class="author1">Through the use of types, I have made it crystal clear what comprises a recipe. Users cannot leave off fields. Creating composite types is one of the best ways to express relationships through your codebase.</p>

<p class="author1">So far, I’ve just described the fields in a <code class="calibre17">dataclass</code>, but you are also able to add in behaviors in the form of methods.<a data-type="indexterm" data-primary="data classes" data-secondary="adding methods to" id="idm45644742521384" class="calibre5"/> Suppose I want to make any soup vegetarian by substituting vegetable broth and removing any meats. I also want to list out all the ingredients so that you can make sure that no meat products snuck in.</p>

<p class="author1">I can add methods directly to the <code class="calibre17">dataclass</code> like so:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="nd">@dataclass</code>
<code class="k">class</code> <code class="nc">Recipe</code><code class="calibre17">:</code>
    <code class="n">aromatics</code><code class="calibre17">:</code> <code class="nb">set</code><code class="calibre17">[</code><code class="n">Ingredient</code><code class="calibre17">]</code>
    <code class="n">broth</code><code class="calibre17">:</code> <code class="n">Broth</code>
    <code class="n">vegetables</code><code class="calibre17">:</code> <code class="nb">set</code><code class="calibre17">[</code><code class="n">Ingredient</code><code class="calibre17">]</code>
    <code class="n">meats</code><code class="calibre17">:</code> <code class="nb">set</code><code class="calibre17">[</code><code class="n">Ingredient</code><code class="calibre17">]</code>
    <code class="n">starches</code><code class="calibre17">:</code> <code class="nb">set</code><code class="calibre17">[</code><code class="n">Ingredient</code><code class="calibre17">]</code>
    <code class="n">garnishes</code><code class="calibre17">:</code> <code class="nb">set</code><code class="calibre17">[</code><code class="n">ingredient</code><code class="calibre17">]</code>
    <code class="n">time_to_cook</code><code class="calibre17">:</code> <code class="n">datetime</code><code class="calibre17">.</code><code class="n">timedelta</code>

    <code class="k">def</code> <code class="nf">make_vegetarian</code><code class="calibre17">(</code><code class="nb">self</code><code class="calibre17">):</code>
        <code class="nb">self</code><code class="calibre17">.</code><code class="n">meats</code><code class="calibre17">.</code><code class="n">clear</code><code class="calibre17">()</code>
        <code class="nb">self</code><code class="calibre17">.</code><code class="n">broth</code> <code class="calibre17">=</code> <code class="n">Broth</code><code class="calibre17">.</code><code class="n">VEGETABLE</code>

    <code class="k">def</code> <code class="nf">get_ingredient_names</code><code class="calibre17">(</code><code class="nb">self</code><code class="calibre17">):</code>
        <code class="n">ingredients</code> <code class="calibre17">=</code> <code class="calibre17">(</code><code class="nb">self</code><code class="calibre17">.</code><code class="n">aromatics</code> <code class="calibre17">|</code>
                       <code class="nb">self</code><code class="calibre17">.</code><code class="n">vegetables</code> <code class="calibre17">|</code>
                       <code class="nb">self</code><code class="calibre17">.</code><code class="n">meats</code> <code class="calibre17">|</code>
                       <code class="nb">self</code><code class="calibre17">.</code><code class="n">starches</code> <code class="calibre17">|</code>
                       <code class="nb">self</code><code class="calibre17">.</code><code class="n">garnishes</code><code class="calibre17">)</code>

        <code class="k">return</code> <code class="calibre17">({</code><code class="n">i</code><code class="calibre17">.</code><code class="n">name</code> <code class="k">for</code> <code class="n">i</code> <code class="calibre19">in</code> <code class="n">ingredients</code><code class="calibre17">}</code> <code class="calibre17">|</code>
                <code class="calibre17">{</code><code class="nb">self</code><code class="calibre17">.</code><code class="n">broth</code><code class="calibre17">.</code><code class="n">name</code><code class="calibre17">.</code><code class="n">capitalize</code><code class="calibre17">()</code> <code class="calibre17">+</code> <code class="s">" broth"</code><code class="calibre17">})</code></pre>

<p class="author1">This is a major improvement over raw dictionaries or tuples. I can embed functionality directly inside my <code class="calibre17">dataclass</code>, improving reusability. If a user wants to get all the ingredient names or make a recipe vegetarian, they don’t have to remember to do it on their own every time. It’s simple enough to call the function. Here’s an example of calling a function directly on a <code class="calibre17">dataclass</code>.</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">from</code> <code class="nn">copy</code> <code class="k">import</code> <code class="n">deepcopy</code>
<code class="c"># make a deep copy so that changing one soup</code>
<code class="c"># does not change the original</code>
<code class="n">noodle_soup</code> <code class="calibre17">=</code> <code class="n">deepcopy</code><code class="calibre17">(</code><code class="n">chicken_noodle_soup</code><code class="calibre17">)</code>
<code class="n">noodle_soup</code><code class="calibre17">.</code><code class="n">make_vegetarian</code><code class="calibre17">()</code>
<code class="n">noodle_soup</code><code class="calibre17">.</code><code class="n">get_ingredient_names</code><code class="calibre17">()</code>
<code class="calibre17">&gt;&gt;&gt;</code> <code class="calibre17">{</code><code class="s">'Garlic'</code><code class="calibre17">,</code> <code class="s">'Pepper'</code><code class="calibre17">,</code> <code class="s">'Carrots'</code><code class="calibre17">,</code> <code class="s">'Celery'</code><code class="calibre17">,</code> <code class="s">'Onions'</code><code class="calibre17">,</code>
     <code class="s">'Noodles'</code><code class="calibre17">,</code> <code class="s">'Parsley'</code><code class="calibre17">,</code> <code class="s">'Vegetable Broth'</code><code class="calibre17">}</code></pre>
</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. User-Defined Types: Data Classes" class="preface">
<div class="preface" id="dataclasses">
<section data-type="sect1" class="preface" data-pdf-bookmark="Usage"><div class="preface" id="idm45644742273240">
<h1 class="calibre12" id="calibre_pb_2">Usage</h1>

<p class="author1">Data classes have some built-in functions that make them really easy to work with.<a data-type="indexterm" data-primary="data classes" data-secondary="usage" id="ix_dacluse" class="calibre5"/> You’ve already seen that constructing data classes is a cinch, but what else can you do?</p>








</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. User-Defined Types: Data Classes" class="preface">
<div class="preface" id="dataclasses">
<section data-type="sect1" class="preface" data-pdf-bookmark="Usage">
<div class="preface" id="idm45644742273240">
<section data-type="sect2" data-pdf-bookmark="String Conversion" class="preface"><div class="preface" id="idm45644742255400">
<h2 class="calibre34" id="calibre_pb_3">String Conversion</h2>

<p class="author1">There are two special methods, <code class="calibre17">__str__</code> and <code class="calibre17">__repr__</code>, used to convert your object to its <a data-type="indexterm" data-primary="type conversions" data-secondary="string conversions using data classes" id="idm45644742252856" class="calibre5"/><a data-type="indexterm" data-primary="string conversions, using data classes" id="idm45644742251912" class="calibre5"/><a data-type="indexterm" data-primary="data classes" data-secondary="usage" data-tertiary="string conversions" id="ix_dacluseSC" class="calibre5"/>informal and offical string representation.<sup class="calibre11"><a data-type="noteref" id="idm45644742249656-marker" href="part0013_split_012.html#idm45644742249656" class="calibre5">1</a></sup> Note the double underscores surrounding them; they are known as <em class="calibre6">magic methods</em>. I’ll<a data-type="indexterm" data-primary="magic methods" id="idm45644742248424" class="calibre5"/> cover magic methods more in <a data-type="xref" href="part0015_split_000.html#api" class="calibre5">Chapter 11</a>, but for now, you can treat them as functions that get called when you invoke <code class="calibre17">str()</code> or <code class="calibre17">repr()</code> on an object. Data classes define these functions by default:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="c"># Both repr() and str() will return the output below</code>
<code class="nb">str</code><code class="calibre17">(</code><code class="n">chicken_noodle_soup</code><code class="calibre17">)</code>
<code class="calibre17">&gt;&gt;&gt;</code> <code class="n">Recipe</code><code class="calibre17">(</code>
    <code class="n">aromatics</code><code class="calibre17">=</code><code class="calibre17">{</code>
        <code class="n">Ingredient</code><code class="calibre17">(</code><code class="n">name</code><code class="calibre17">=</code><code class="s">'Pepper'</code><code class="calibre17">,</code> <code class="n">amount</code><code class="calibre17">=</code><code class="mi">1</code><code class="calibre17">,</code> <code class="n">units</code><code class="calibre17">=&lt;</code><code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">TABLESPOON</code><code class="calibre17">:</code> <code class="mi">2</code><code class="calibre17">&gt;</code><code class="calibre17">),</code>
        <code class="n">Ingredient</code><code class="calibre17">(</code><code class="n">name</code><code class="calibre17">=</code><code class="s">'Garlic'</code><code class="calibre17">,</code> <code class="n">amount</code><code class="calibre17">=</code><code class="mi">2</code><code class="calibre17">,</code> <code class="n">units</code><code class="calibre17">=&lt;</code><code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">TEASPOON</code><code class="calibre17">:</code> <code class="mi">1</code><code class="calibre17">&gt;</code><code class="calibre17">)},</code>
    <code class="n">broth</code><code class="calibre17">=&lt;</code><code class="n">Broth</code><code class="calibre17">.</code><code class="n">CHICKEN</code><code class="calibre17">:</code> <code class="mi">2</code><code class="calibre17">&gt;</code><code class="calibre17">,</code>
    <code class="n">vegetables</code><code class="calibre17">=</code><code class="calibre17">{</code>
        <code class="n">Ingredient</code><code class="calibre17">(</code><code class="n">name</code><code class="calibre17">=</code><code class="s">'Celery'</code><code class="calibre17">,</code> <code class="n">amount</code><code class="calibre17">=</code><code class="mi">0.25</code><code class="calibre17">,</code> <code class="n">units</code><code class="calibre17">=&lt;</code><code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">CUP</code><code class="calibre17">:</code> <code class="mi">3</code><code class="calibre17">&gt;</code><code class="calibre17">),</code>
        <code class="n">Ingredient</code><code class="calibre17">(</code><code class="n">name</code><code class="calibre17">=</code><code class="s">'Onions'</code><code class="calibre17">,</code> <code class="n">amount</code><code class="calibre17">=</code><code class="mi">0.25</code><code class="calibre17">,</code> <code class="n">units</code><code class="calibre17">=&lt;</code><code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">CUP</code><code class="calibre17">:</code> <code class="mi">3</code><code class="calibre17">&gt;</code><code class="calibre17">),</code>
        <code class="n">Ingredient</code><code class="calibre17">(</code><code class="n">name</code><code class="calibre17">=</code><code class="s">'Carrots'</code><code class="calibre17">,</code> <code class="n">amount</code><code class="calibre17">=</code><code class="mi">0.25</code><code class="calibre17">,</code> <code class="n">units</code><code class="calibre17">=&lt;</code><code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">CUP</code><code class="calibre17">:</code> <code class="mi">3</code><code class="calibre17">&gt;</code><code class="calibre17">)},</code>
    <code class="n">meats</code><code class="calibre17">=</code><code class="calibre17">{</code>
        <code class="n">Ingredient</code><code class="calibre17">(</code><code class="n">name</code><code class="calibre17">=</code><code class="s">'Chicken'</code><code class="calibre17">,</code> <code class="n">amount</code><code class="calibre17">=</code><code class="mi">1.5</code><code class="calibre17">,</code> <code class="n">units</code><code class="calibre17">=&lt;</code><code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">CUP</code><code class="calibre17">:</code> <code class="mi">3</code><code class="calibre17">&gt;</code><code class="calibre17">)},</code>
    <code class="n">starches</code><code class="calibre17">=</code><code class="calibre17">{</code>
        <code class="n">Ingredient</code><code class="calibre17">(</code><code class="n">name</code><code class="calibre17">=</code><code class="s">'Noodles'</code><code class="calibre17">,</code> <code class="n">amount</code><code class="calibre17">=</code><code class="mi">1.5</code><code class="calibre17">,</code> <code class="n">units</code><code class="calibre17">=&lt;</code><code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">CUP</code><code class="calibre17">:</code> <code class="mi">3</code><code class="calibre17">&gt;</code><code class="calibre17">)},</code>
    <code class="n">garnishes</code><code class="calibre17">=</code><code class="calibre17">{</code>
        <code class="n">Ingredient</code><code class="calibre17">(</code><code class="n">name</code><code class="calibre17">=</code><code class="s">'Parsley'</code><code class="calibre17">,</code> <code class="n">amount</code><code class="calibre17">=</code><code class="mi">2</code><code class="calibre17">,</code>
                   <code class="n">units</code><code class="calibre17">=&lt;</code><code class="n">ImperialMeasure</code><code class="calibre17">.</code><code class="n">TABLESPOON</code><code class="calibre17">:</code> <code class="mi">2</code><code class="calibre17">&gt;</code><code class="calibre17">)},</code>
    <code class="n">time_to_cook</code><code class="calibre17">=</code><code class="n">datetime</code><code class="calibre17">.</code><code class="n">timedelta</code><code class="calibre17">(</code><code class="n">seconds</code><code class="calibre17">=</code><code class="mi">3600</code><code class="calibre17">)</code>
<code class="calibre17">)</code></pre>

<p class="author1">A bit lengthy, but it means that you won’t get something uglier like <code class="calibre17">&lt;__main__.Recipe object at 0x7fef44240730&gt;</code>, which is the default string conversion for other user-defined types.</p>
</div></section>













</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. User-Defined Types: Data Classes" class="preface">
<div class="preface" id="dataclasses">
<section data-type="sect1" class="preface" data-pdf-bookmark="Usage">
<div class="preface" id="idm45644742273240">
<section data-type="sect2" data-pdf-bookmark="Equality" class="preface"><div class="preface" id="idm45644742243064">
<h2 class="calibre34" id="calibre_pb_4">Equality</h2>

<p class="author1">If you want <a data-type="indexterm" data-primary="equality checks for data classes" id="idm45644742241896" class="calibre5"/><a data-type="indexterm" data-primary="data classes" data-secondary="usage" data-tertiary="equality checks" id="idm45644741947112" class="calibre5"/>to be able to test equality (==, !=) between two data classes, you can specify <code class="calibre17">eq=True</code> when defining your <code class="calibre17">dataclass</code>:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">from</code> <code class="nn">copy</code> <code class="k">import</code> <code class="n">deepcopy</code>

<code class="nd">@dataclass</code><code class="calibre17">(</code><code class="n">eq</code><code class="calibre17">=</code><code class="nb">True</code><code class="calibre17">)</code>
<code class="k">class</code> <code class="nc">Recipe</code><code class="calibre17">:</code>
    <code class="c"># ...</code>

<code class="n">chicken_noodle_soup</code> <code class="calibre17">==</code> <code class="n">noodle_soup</code>
<code class="calibre17">&gt;&gt;&gt;</code> <code class="nb">False</code>

<code class="n">noodle_soup</code> <code class="calibre17">==</code> <code class="n">deepcopy</code><code class="calibre17">(</code><code class="n">noodle_soup</code><code class="calibre17">)</code>
<code class="calibre17">&gt;&gt;&gt;</code> <code class="nb">True</code></pre>

<p class="author1">By default, equality checks will compare every field across two instances of a <code class="calibre17">dataclass</code>. Mechanically, Python invokes a function named <code class="calibre17">__eq__</code> when doing equality checks.<a data-type="indexterm" data-primary="__eq__ function" data-primary-sortas="eq" id="idm45644741919496" class="calibre5"/> If you’d like to provide different default functionality for equality checks, you can write your own <code class="calibre17">__eq__</code> function.</p>
</div></section>













</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. User-Defined Types: Data Classes" class="preface">
<div class="preface" id="dataclasses">
<section data-type="sect1" class="preface" data-pdf-bookmark="Usage">
<div class="preface" id="idm45644742273240">
<section data-type="sect2" data-pdf-bookmark="Relational Comparison" class="preface"><div class="preface" id="idm45644741917720">
<h2 class="calibre34" id="calibre_pb_5">Relational Comparison</h2>

<p class="author1">Suppose I want to display nutritional information in my soup app for the health-conscious.<a data-type="indexterm" data-primary="data classes" data-secondary="usage" data-tertiary="relational comparisons" id="idm45644741915848" class="calibre5"/><a data-type="indexterm" data-primary="relational comparisons using data classes" id="idm45644741914600" class="calibre5"/> I want to be able to sort the soups by various axes, such as the number of calories or carbohydrates.</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="n">nutritionals</code> <code class="calibre17">=</code> <code class="calibre17">[</code><code class="n">NutritionInformation</code><code class="calibre17">(</code><code class="n">calories</code><code class="calibre17">=</code><code class="mi">100</code><code class="calibre17">,</code> <code class="n">fat</code><code class="calibre17">=</code><code class="mi">1</code><code class="calibre17">,</code> <code class="n">carbohydrates</code><code class="calibre17">=</code><code class="mi">3</code><code class="calibre17">),</code>
                <code class="n">NutritionInformation</code><code class="calibre17">(</code><code class="n">calories</code><code class="calibre17">=</code><code class="mi">50</code><code class="calibre17">,</code> <code class="n">fat</code><code class="calibre17">=</code><code class="mi">6</code><code class="calibre17">,</code> <code class="n">carbohydrates</code><code class="calibre17">=</code><code class="mi">4</code><code class="calibre17">),</code>
                <code class="n">NutritionInformation</code><code class="calibre17">(</code><code class="n">calories</code><code class="calibre17">=</code><code class="mi">125</code><code class="calibre17">,</code> <code class="n">fat</code><code class="calibre17">=</code><code class="mi">12</code><code class="calibre17">,</code> <code class="n">carbohydrates</code><code class="calibre17">=</code><code class="mi">3</code><code class="calibre17">)]</code></pre>

<p class="author1">By default, data classes do not support relational comparison (<code class="calibre17">&lt;</code>, <code class="calibre17">&gt;</code>, <code class="calibre17">&lt;=</code>, <code class="calibre17">&gt;=</code>), so you cannot sort the information:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="calibre17">&gt;&gt;&gt;</code> <code class="nb">sorted</code><code class="calibre17">(</code><code class="n">nutritionals</code><code class="calibre17">)</code></pre>
<pre class="calibre35">TypeError: '&lt;' not supported between instances of
           'NutritionInformation' and 'NutritionInformation'</pre>

<p class="author1">If you want to be able to define relational comparison (<code class="calibre17">&lt;</code>, <code class="calibre17">&gt;</code>, <code class="calibre17">&lt;=</code>, <code class="calibre17">&gt;=</code>), you need to set <code class="calibre17">eq=True</code> and <code class="calibre17">order=True</code> in the <code class="calibre17">dataclass</code> definition. The generated comparison functions will go through each field, comparing them in the order in which they were defined.</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="nd">@dataclass</code><code class="calibre17">(</code><code class="n">eq</code><code class="calibre17">=</code><code class="nb">True</code><code class="calibre17">,</code> <code class="n">order</code><code class="calibre17">=</code><code class="nb">True</code><code class="calibre17">)</code>
<code class="k">class</code> <code class="nc">NutritionInformation</code><code class="calibre17">:</code>
    <code class="n">calories</code><code class="calibre17">:</code> <code class="nb">int</code>
    <code class="n">fat</code><code class="calibre17">:</code> <code class="nb">int</code>
    <code class="n">carbohydrates</code><code class="calibre17">:</code> <code class="nb">int</code>
<code class="n">nutritionals</code> <code class="calibre17">=</code> <code class="calibre17">[</code><code class="n">NutritionInformation</code><code class="calibre17">(</code><code class="n">calories</code><code class="calibre17">=</code><code class="mi">100</code><code class="calibre17">,</code> <code class="n">fat</code><code class="calibre17">=</code><code class="mi">1</code><code class="calibre17">,</code> <code class="n">carbohydrates</code><code class="calibre17">=</code><code class="mi">3</code><code class="calibre17">),</code>
                <code class="n">NutritionInformation</code><code class="calibre17">(</code><code class="n">calories</code><code class="calibre17">=</code><code class="mi">50</code><code class="calibre17">,</code> <code class="n">fat</code><code class="calibre17">=</code><code class="mi">6</code><code class="calibre17">,</code> <code class="n">carbohydrates</code><code class="calibre17">=</code><code class="mi">4</code><code class="calibre17">),</code>
                <code class="n">NutritionInformation</code><code class="calibre17">(</code><code class="n">calories</code><code class="calibre17">=</code><code class="mi">125</code><code class="calibre17">,</code> <code class="n">fat</code><code class="calibre17">=</code><code class="mi">12</code><code class="calibre17">,</code> <code class="n">carbohydrates</code><code class="calibre17">=</code><code class="mi">3</code><code class="calibre17">)]</code>

<code class="calibre17">&gt;&gt;&gt;</code> <code class="nb">sorted</code><code class="calibre17">(</code><code class="n">nutritionals</code><code class="calibre17">)</code>
    <code class="calibre17">[</code><code class="n">NutritionInformation</code><code class="calibre17">(</code><code class="n">calories</code><code class="calibre17">=</code><code class="mi">50</code><code class="calibre17">,</code> <code class="n">fat</code><code class="calibre17">=</code><code class="mi">6</code><code class="calibre17">,</code> <code class="n">carbohydrates</code><code class="calibre17">=</code><code class="mi">4</code><code class="calibre17">),</code>
     <code class="n">NutritionInformation</code><code class="calibre17">(</code><code class="n">calories</code><code class="calibre17">=</code><code class="mi">100</code><code class="calibre17">,</code> <code class="n">fat</code><code class="calibre17">=</code><code class="mi">1</code><code class="calibre17">,</code> <code class="n">carbohydrates</code><code class="calibre17">=</code><code class="mi">3</code><code class="calibre17">),</code>
     <code class="n">NutritionInformation</code><code class="calibre17">(</code><code class="n">calories</code><code class="calibre17">=</code><code class="mi">125</code><code class="calibre17">,</code> <code class="n">fat</code><code class="calibre17">=</code><code class="mi">12</code><code class="calibre17">,</code> <code class="n">carbohydrates</code><code class="calibre17">=</code><code class="mi">3</code><code class="calibre17">)]</code></pre>

<p class="author1">If you want to control how comparison is defined, you can write your own <code class="calibre17">__le__</code>, <code class="calibre17">__lt__</code>, <code class="calibre17">__gt__</code>, and <code class="calibre17">__ge__</code> functions in the <code class="calibre17">dataclass</code>, which map to less-than-or-equals, less-than, greater-than, and greater-than-or-equals, respectively. For instance, if you wanted your <code class="calibre17">NutritionInformation</code> sorted first by fat, then carbohydrates, and then calories by default:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="nd">@dataclass</code><code class="calibre17">(</code><code class="n">eq</code><code class="calibre17">=</code><code class="nb">True</code><code class="calibre17">)</code>
<code class="k">class</code> <code class="nc">NutritionInformation</code><code class="calibre17">:</code>
    <code class="n">calories</code><code class="calibre17">:</code> <code class="nb">int</code>
    <code class="n">fat</code><code class="calibre17">:</code> <code class="nb">int</code>
    <code class="n">carbohydrates</code><code class="calibre17">:</code> <code class="nb">int</code>

    <code class="k">def</code> <code class="calibre17">__lt__</code><code class="calibre17">(</code><code class="nb">self</code><code class="calibre17">,</code> <code class="n">rhs</code><code class="calibre17">)</code> <code class="calibre17">-&gt;</code> <code class="nb">bool</code><code class="calibre17">:</code>
        <code class="k">return</code> <code class="calibre17">((</code><code class="nb">self</code><code class="calibre17">.</code><code class="n">fat</code><code class="calibre17">,</code> <code class="nb">self</code><code class="calibre17">.</code><code class="n">carbohydrates</code><code class="calibre17">,</code> <code class="nb">self</code><code class="calibre17">.</code><code class="n">calories</code><code class="calibre17">)</code> <code class="calibre17">&lt;</code>
                <code class="calibre17">(</code><code class="n">rhs</code><code class="calibre17">.</code><code class="n">fat</code><code class="calibre17">,</code> <code class="n">rhs</code><code class="calibre17">.</code><code class="n">carbohydrates</code><code class="calibre17">,</code> <code class="n">rhs</code><code class="calibre17">.</code><code class="n">calories</code><code class="calibre17">))</code>

    <code class="k">def</code> <code class="calibre17">__le__</code><code class="calibre17">(</code><code class="nb">self</code><code class="calibre17">,</code> <code class="n">rhs</code><code class="calibre17">)</code> <code class="calibre17">-&gt;</code> <code class="nb">bool</code><code class="calibre17">:</code>
        <code class="k">return</code> <code class="nb">self</code> <code class="calibre17">&lt;</code> <code class="n">rhs</code> <code class="calibre19">or</code> <code class="nb">self</code> <code class="calibre17">==</code> <code class="n">rhs</code>

    <code class="k">def</code> <code class="calibre17">__gt__</code><code class="calibre17">(</code><code class="nb">self</code><code class="calibre17">,</code> <code class="n">rhs</code><code class="calibre17">)</code> <code class="calibre17">-&gt;</code> <code class="nb">bool</code><code class="calibre17">:</code>
        <code class="k">return</code> <code class="calibre19">not</code> <code class="nb">self</code> <code class="calibre17">&lt;=</code> <code class="n">rhs</code>

    <code class="k">def</code> <code class="calibre17">__ge__</code><code class="calibre17">(</code><code class="nb">self</code><code class="calibre17">,</code> <code class="n">rhs</code><code class="calibre17">)</code> <code class="calibre17">-&gt;</code> <code class="nb">bool</code><code class="calibre17">:</code>
        <code class="k">return</code> <code class="calibre19">not</code> <code class="nb">self</code> <code class="calibre17">&lt;</code> <code class="n">rhs</code>

<code class="n">nutritionals</code> <code class="calibre17">=</code> <code class="calibre17">[</code><code class="n">NutritionInformation</code><code class="calibre17">(</code><code class="n">calories</code><code class="calibre17">=</code><code class="mi">100</code><code class="calibre17">,</code> <code class="n">fat</code><code class="calibre17">=</code><code class="mi">1</code><code class="calibre17">,</code> <code class="n">carbohydrates</code><code class="calibre17">=</code><code class="mi">3</code><code class="calibre17">),</code>
                <code class="n">NutritionInformation</code><code class="calibre17">(</code><code class="n">calories</code><code class="calibre17">=</code><code class="mi">50</code><code class="calibre17">,</code> <code class="n">fat</code><code class="calibre17">=</code><code class="mi">6</code><code class="calibre17">,</code> <code class="n">carbohydrates</code><code class="calibre17">=</code><code class="mi">4</code><code class="calibre17">),</code>
                <code class="n">NutritionInformation</code><code class="calibre17">(</code><code class="n">calories</code><code class="calibre17">=</code><code class="mi">125</code><code class="calibre17">,</code> <code class="n">fat</code><code class="calibre17">=</code><code class="mi">12</code><code class="calibre17">,</code> <code class="n">carbohydrates</code><code class="calibre17">=</code><code class="mi">3</code><code class="calibre17">)]</code>


<code class="calibre17">&gt;&gt;&gt;</code> <code class="nb">sorted</code><code class="calibre17">(</code><code class="n">nutritionals</code><code class="calibre17">)</code>
    <code class="calibre17">[</code><code class="n">NutritionInformation</code><code class="calibre17">(</code><code class="n">calories</code><code class="calibre17">=</code><code class="mi">100</code><code class="calibre17">,</code> <code class="n">fat</code><code class="calibre17">=</code><code class="mi">1</code><code class="calibre17">,</code> <code class="n">carbohydrates</code><code class="calibre17">=</code><code class="mi">3</code><code class="calibre17">),</code>
     <code class="n">NutritionInformation</code><code class="calibre17">(</code><code class="n">calories</code><code class="calibre17">=</code><code class="mi">50</code><code class="calibre17">,</code> <code class="n">fat</code><code class="calibre17">=</code><code class="mi">6</code><code class="calibre17">,</code> <code class="n">carbohydrates</code><code class="calibre17">=</code><code class="mi">4</code><code class="calibre17">),</code>
     <code class="n">NutritionInformation</code><code class="calibre17">(</code><code class="n">calories</code><code class="calibre17">=</code><code class="mi">125</code><code class="calibre17">,</code> <code class="n">fat</code><code class="calibre17">=</code><code class="mi">12</code><code class="calibre17">,</code> <code class="n">carbohydrates</code><code class="calibre17">=</code><code class="mi">3</code><code class="calibre17">)]</code></pre>
<div data-type="warning" epub:type="warning" class="calibre23"><h6 class="calibre24">Warning</h6>
<p class="author1">If you override comparison functions, do not specify <code class="calibre17">order=True</code>, as that will raise a <code class="calibre17">ValueError</code>.</p>
</div>
</div></section>













</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. User-Defined Types: Data Classes" class="preface">
<div class="preface" id="dataclasses">
<section data-type="sect1" class="preface" data-pdf-bookmark="Usage">
<div class="preface" id="idm45644742273240">
<section data-type="sect2" data-pdf-bookmark="Immutability" class="preface"><div class="preface" id="idm45644741917064">
<h2 class="calibre34" id="calibre_pb_6">Immutability</h2>

<p class="author1">Sometimes, you need to convey that a <code class="calibre17">dataclass</code> should not be able to be changed.<a data-type="indexterm" data-primary="immutability" data-secondary="specifying for data classes" id="idm45644741446168" class="calibre5"/><a data-type="indexterm" data-primary="data classes" data-secondary="usage" data-tertiary="immutability" id="idm45644741445224" class="calibre5"/> In that case, you can specify that a <code class="calibre17">dataclass</code> must be <code class="calibre17">frozen</code>, or unable to change.<a data-type="indexterm" data-primary="frozen (data classes)" id="idm45644741443048" class="calibre5"/> Anytime you change the state of a <code class="calibre17">dataclass</code>, you introduce entire classes of errors that might happen:</p>

<ul class="printings">
<li class="calibre9">
<p class="author1">Callers of your code may be unaware that the fields changed; they could erroneously assume that the fields are static.</p>
</li>
<li class="calibre9">
<p class="author1">Setting a single field to an incorrect value might be incompatible with how the other fields are set.</p>
</li>
<li class="calibre9">
<p class="author1">If there are multiple threads modifying the fields, you run the risk of a data race, which means you cannot guarantee in which order the modifications are applied in relation to one another.</p>
</li>
</ul>

<p class="author1">None of these error cases occur if your <code class="calibre17">dataclass</code> is <code class="calibre17">frozen</code>. To freeze a <code class="calibre17">dataclass</code>, add a <code class="calibre17">frozen=True</code> to the <code class="calibre17">dataclass</code> decorator:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="nd">@dataclass</code><code class="calibre17">(</code><code class="n">frozen</code><code class="calibre17">=</code><code class="nb">True</code><code class="calibre17">)</code>
<code class="k">class</code> <code class="nc">Recipe</code><code class="calibre17">:</code>
    <code class="n">aromatics</code><code class="calibre17">:</code> <code class="n">Set</code><code class="calibre17">[</code><code class="n">Ingredient</code><code class="calibre17">]</code>
    <code class="n">broth</code><code class="calibre17">:</code> <code class="n">Broth</code>
    <code class="n">vegetables</code><code class="calibre17">:</code> <code class="n">Set</code><code class="calibre17">[</code><code class="n">Ingredient</code><code class="calibre17">]</code>
    <code class="n">meats</code><code class="calibre17">:</code> <code class="n">Set</code><code class="calibre17">[</code><code class="n">Ingredient</code><code class="calibre17">]</code>
    <code class="n">starches</code><code class="calibre17">:</code> <code class="n">Set</code><code class="calibre17">[</code><code class="n">Ingredient</code><code class="calibre17">]</code>
    <code class="n">garnishes</code><code class="calibre17">:</code> <code class="n">Set</code><code class="calibre17">[</code><code class="n">Ingredient</code><code class="calibre17">]</code>
    <code class="n">time_to_cook</code><code class="calibre17">:</code> <code class="n">datetime</code><code class="calibre17">.</code><code class="n">timedelta</code></pre>

<p class="author1">If you want to use your <code class="calibre17">dataclass</code> in a set or as a key in a dictionary it must be <em class="calibre6">hashable</em>. <a data-type="indexterm" data-primary="hashable" id="idm45644741403400" class="calibre5"/>This means it must define a <code class="calibre17">__hash__</code> function that takes your object and distills it down to a number.<sup class="calibre11"><a data-type="noteref" id="idm45644741402248-marker" href="part0013_split_012.html#idm45644741402248" class="calibre5">2</a></sup> When you freeze a <code class="calibre17">dataclass</code>, it automatically becomes hashable, as long as you don’t explicitly disable equality checking and all fields are hashable.</p>

<p class="author1">There are two caveats around this immutability, however. First, when I say immutability, I am referencing the fields in the <code class="calibre17">dataclass</code>, not the variable containing the <code class="calibre17">dataclass</code> itself. For example:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="c"># assume that Recipe is immutable because</code>
<code class="c"># frozen was set to true in the decorator</code>
<code class="n">soup</code> <code class="calibre17">=</code> <code class="n">Recipe</code><code class="calibre17">(</code>
    <code class="n">aromatics</code><code class="calibre17">=</code><code class="calibre17">{</code><code class="n">pepper</code><code class="calibre17">,</code> <code class="n">garlic</code><code class="calibre17">},</code>
    <code class="n">broth</code><code class="calibre17">=</code><code class="n">Broth</code><code class="calibre17">.</code><code class="n">CHICKEN</code><code class="calibre17">,</code>
    <code class="n">vegetables</code><code class="calibre17">=</code><code class="calibre17">{</code><code class="n">celery</code><code class="calibre17">,</code> <code class="n">onions</code><code class="calibre17">,</code> <code class="n">carrots</code><code class="calibre17">},</code>
    <code class="n">meats</code><code class="calibre17">=</code><code class="calibre17">{</code><code class="n">chicken</code><code class="calibre17">},</code>
    <code class="n">starches</code><code class="calibre17">=</code><code class="calibre17">{</code><code class="n">noodles</code><code class="calibre17">},</code>
    <code class="n">garnishes</code><code class="calibre17">=</code><code class="calibre17">{</code><code class="n">parsley</code><code class="calibre17">},</code>
    <code class="n">time_to_cook</code><code class="calibre17">=</code><code class="n">datetime</code><code class="calibre17">.</code><code class="n">timedelta</code><code class="calibre17">(</code><code class="n">minutes</code><code class="calibre17">=</code><code class="mi">60</code><code class="calibre17">))</code>


<code class="c"># this is an error</code>
<code class="n">soup</code><code class="calibre17">.</code><code class="n">broth</code> <code class="calibre17">=</code>  <code class="n">Broth</code><code class="calibre17">.</code><code class="n">VEGETABLE</code>

<code class="c"># this is not an error</code>
<code class="n">soup</code> <code class="calibre17">=</code> <code class="n">Recipe</code><code class="calibre17">(</code>
    <code class="n">aromatics</code><code class="calibre17">=</code><code class="nb">set</code><code class="calibre17">(),</code>
    <code class="n">broth</code><code class="calibre17">=</code><code class="n">Broth</code><code class="calibre17">.</code><code class="n">CHICKEN</code><code class="calibre17">,</code>
    <code class="n">vegetables</code><code class="calibre17">=</code><code class="nb">set</code><code class="calibre17">(),</code>
    <code class="n">meats</code><code class="calibre17">=</code><code class="nb">set</code><code class="calibre17">(),</code>
    <code class="n">starches</code><code class="calibre17">=</code><code class="nb">set</code><code class="calibre17">(),</code>
    <code class="n">garnishes</code><code class="calibre17">=</code><code class="nb">set</code><code class="calibre17">(),</code>
    <code class="n">time_to_cook</code><code class="calibre17">=</code><code class="n">datetime</code><code class="calibre17">.</code><code class="n">timedelta</code><code class="calibre17">(</code><code class="n">seconds</code><code class="calibre17">=</code><code class="mi">3600</code><code class="calibre17">))</code>
<code class="calibre17">)</code></pre>

<p class="author1">If you would like the typechecker to error out if the variable is rebound, you can annotate <a data-type="indexterm" data-primary="Final types" id="idm45644741396072" class="calibre5"/>the variable as <code class="calibre17">Final</code> (see <a data-type="xref" href="part0007_split_000.html#constraints" class="calibre5">Chapter 4</a> for more details on <code class="calibre17">Final</code>).</p>

<p class="author1">Secondly, a <code class="calibre17">frozen</code> <code class="calibre17">dataclass</code> only prevents its members from being set. If the members are mutable, you are still able to call methods on those members to modify their values. <code class="calibre17">frozen</code> <code class="calibre17">dataclass</code>es do not extend immutability to their attributes.</p>

<p class="author1">For example, this code is perfectly fine:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="n">soup</code><code class="calibre17">.</code><code class="n">aromatics</code><code class="calibre17">.</code><code class="n">add</code><code class="calibre17">(</code><code class="n">Ingredient</code><code class="calibre17">(</code><code class="s">"Garlic"</code><code class="calibre17">))</code></pre>

<p class="author1">Even though it is modifying the <em class="calibre6">aromatics</em> field of a <code class="calibre17">frozen</code> <code class="calibre17">dataclass</code>, no error is raised. When using <code class="calibre17">frozen</code> <code class="calibre17">dataclass</code>es, make the members immutable (such as integers, strings, or other <code class="calibre17">frozen</code> <code class="calibre17">dataclass</code>es) to avoid this pitfall.<a data-type="indexterm" data-primary="data classes" data-secondary="usage" data-startref="ix_dacluse" id="idm45644741123016" class="calibre5"/></p>
</div></section>





</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. User-Defined Types: Data Classes" class="preface">
<div class="preface" id="dataclasses">
<section data-type="sect1" data-pdf-bookmark="Comparison to Other Types" class="preface"><div class="preface" id="idm45644741604824">
<h1 class="calibre12" id="calibre_pb_7">Comparison to Other Types</h1>

<p class="author1">Data classes are relatively new (introduced in Python 3.7); a lot of legacy code will not contain data classes. As you evaluate data class adoption, you need to understand where a data class shines in relation to other constructs.</p>








</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. User-Defined Types: Data Classes" class="preface">
<div class="preface" id="dataclasses">
<section data-type="sect1" data-pdf-bookmark="Comparison to Other Types" class="preface">
<div class="preface" id="idm45644741604824">
<section data-type="sect2" data-pdf-bookmark="Data Classes Versus Dictionaries" class="preface"><div class="preface" id="idm45644741120024">
<h2 class="calibre34" id="calibre_pb_8">Data Classes Versus Dictionaries</h2>

<p class="author1">As discussed in <a data-type="xref" href="part0008_split_000.html#collections" class="calibre5">Chapter 5</a>, dictionaries <a data-type="indexterm" data-primary="dictionaries" data-secondary="data classes versus" id="idm45644741113064" class="calibre5"/><a data-type="indexterm" data-primary="data classes" data-secondary="versus dictionaries" data-secondary-sortas="dictionaries" id="idm45644741112088" class="calibre5"/>are fantastic for mapping keys to values, but they are most appropriate when they are homogeneous (when all the keys are the same type and all the values are the same type). When used for heterogeneous data, dictionaries are tougher for humans to reason about. Also, typecheckers don’t know enough about the dictionary to check for errors.</p>

<p class="author1">Data classes, however, are a natural fit for fundamentally heterogeneous data. Readers of the code know the exact fields present in the type and typecheckers can check for correct usage. If you have heterogeneous data, use a data class before you reach for a dictionary.</p>
</div></section>













</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. User-Defined Types: Data Classes" class="preface">
<div class="preface" id="dataclasses">
<section data-type="sect1" data-pdf-bookmark="Comparison to Other Types" class="preface">
<div class="preface" id="idm45644741604824">
<section data-type="sect2" data-pdf-bookmark="Data Classes Versus TypedDict" class="preface"><div class="preface" id="idm45644741109464">
<h2 class="calibre34" id="calibre_pb_9">Data Classes Versus TypedDict</h2>

<p class="author1">Also discussed in <a data-type="xref" href="part0008_split_000.html#collections" class="calibre5">Chapter 5</a> was the <code class="calibre17">TypedDict</code> type.<a data-type="indexterm" data-primary="TypedDict" data-secondary="data classes versus" id="idm45644741106664" class="calibre5"/><a data-type="indexterm" data-primary="data classes" data-secondary="versus TypedDict" data-secondary-sortas="TypedDict" id="idm45644741105656" class="calibre5"/> This is another way to store heterogeneous data that makes sense for readers and typecheckers. At first glance, <span class="calibre"><code class="calibre17">TypedDict</code></span> and data classes solve a very similar problem, so it can be tough to decide which one is appropriate. My rule of thumb is to think of a <code class="calibre17">dataclass</code> as the default, as it can have functions defined on it and you can  control immutability, comparability, equality, and other operations. However, if you are already working with dictionaries (such as for working with JSON), you should reach for a <code class="calibre17">TypedDict</code>, provided that you don’t need any of the benefits of a <code class="calibre17">dataclass</code>.</p>
</div></section>













</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. User-Defined Types: Data Classes" class="preface">
<div class="preface" id="dataclasses">
<section data-type="sect1" data-pdf-bookmark="Comparison to Other Types" class="preface">
<div class="preface" id="idm45644741604824">
<section data-type="sect2" data-pdf-bookmark="Data Classes Versus namedtuple" class="preface"><div class="preface" id="idm45644741101592">
<h2 class="calibre34" id="calibre_pb_10">Data Classes Versus namedtuple</h2>

<p class="author1"><code class="calibre17">namedtuple</code> is a tuple-like collection type in the collections module.<a data-type="indexterm" data-primary="namedtuple versus data classes" id="idm45644741099688" class="calibre5"/><a data-type="indexterm" data-primary="data classes" data-secondary="versus namedtuple" data-secondary-sortas="namedTuple" id="idm45644741098920" class="calibre5"/> Unlike tuples, it allows for you to name the fields in a tuple like so:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="calibre17">&gt;&gt;&gt;</code> <code class="k">from</code> <code class="nn">collections</code> <code class="k">import</code> <code class="n">namedtuple</code>
<code class="calibre17">&gt;&gt;&gt;</code> <code class="n">NutritionInformation</code> <code class="calibre17">=</code> <code class="n">namedtuple</code><code class="calibre17">(</code><code class="s">'NutritionInformation'</code><code class="calibre17">,</code>
                                      <code class="calibre17">[</code><code class="s">'calories'</code><code class="calibre17">,</code> <code class="s">'fat'</code><code class="calibre17">,</code> <code class="s">'carbohydrates'</code><code class="calibre17">])</code>
<code class="calibre17">&gt;&gt;&gt;</code> <code class="n">nutrition</code> <code class="calibre17">=</code> <code class="n">NutritionInformation</code><code class="calibre17">(</code><code class="n">calories</code><code class="calibre17">=</code><code class="mi">100</code><code class="calibre17">,</code> <code class="n">fat</code><code class="calibre17">=</code><code class="mi">5</code><code class="calibre17">,</code> <code class="n">carbohydrates</code><code class="calibre17">=</code><code class="mi">10</code><code class="calibre17">)</code>
<code class="calibre17">&gt;&gt;&gt;</code> <code class="k">print</code><code class="calibre17">(</code><code class="n">nutrition</code><code class="calibre17">.</code><code class="n">calories</code><code class="calibre17">)</code>

<code class="mi">100</code></pre>

<p class="author1">A <code class="calibre17">namedtuple</code> goes a long way toward making a tuple more readable, but so does using a <code class="calibre17">dataclass</code> in its place. I almost always pick a <code class="calibre17">dataclass</code> instead of a <code class="calibre17">namedtuple</code>. A <code class="calibre17">dataclass</code>, like a <code class="calibre17">namedtuple</code>, provides named fields along with other benefits like:</p>

<ul class="printings">
<li class="calibre9">
<p class="author1">Explicitly type annotating your arguments</p>
</li>
<li class="calibre9">
<p class="author1">Control of immutability, comparability, and equality</p>
</li>
<li class="calibre9">
<p class="author1">Easier to define functions in the type</p>
</li>
</ul>

<p class="author1">In general, I only reach for a <code class="calibre17">namedtuple</code> if I explicitly need compatibility with Python 3.6 or before.</p>
</div></section>





</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. User-Defined Types: Data Classes" class="preface">
<div class="preface" id="dataclasses">
<section data-type="sect1" data-pdf-bookmark="Comparison to Other Types" class="preface">
<div class="preface" id="idm45644741604824">
<section data-type="sect2" data-pdf-bookmark="Data Classes Versus namedtuple" class="preface">
<div class="preface" id="idm45644741101592">
<div data-type="note" epub:type="note" class="calibre21"><h1 class="calibre38" id="calibre_pb_11">Discussion Topic</h1>
<p class="author1">What types do you use to represent <a data-type="indexterm" data-primary="heterogeneous versus homogeneous collections" data-secondary="data classes, representing heterogeneous data" id="idm45644740958216" class="calibre5"/>heterogeneous data in your codebase? If you use dictionaries, how easy is it for developers to know all the key-value pairs in the dictionary? If you use tuples, how easy is it for developers to know what the meaning of individual fields are?</p>
</div>
</div></section>





</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. User-Defined Types: Data Classes" class="preface">
<div class="preface" id="dataclasses">
<section data-type="sect1" data-pdf-bookmark="Closing Thoughts" class="preface"><div class="preface" id="idm45644740956472">
<h1 class="calibre12" id="calibre_pb_12">Closing Thoughts</h1>

<p class="author1">Data classes were a game changer when released in Python 3.7, because they allowed developers to define heterogeneous types that were fully typed while still staying lightweight.<a data-type="indexterm" data-primary="data classes" data-secondary="benefits and limitations of" id="idm45644740954984" class="calibre5"/> As I write code, I find myself reaching for data classes more and more. Whenever you encounter heterogeneous, developer-controlled dictionaries or <span class="calibre"><code class="calibre17">namedtuple</code>s</span>, a data class is more suitable. You can find a wealth of additional information in the <a href="https://oreil.ly/1toSU" class="calibre5"><code class="calibre17">dataclass</code> documentation</a>.</p>

<p class="author1">However, as great as data classes are, they should not be universally used. A data class, at its heart, represents a conceptual relationship, but it really is only appropriate when the members within the data class are independent of one another. If any of the members should be restricted depending on the other members, a data class will make it harder to reason about your code. Any developer could change the fields during your data classes’ lifetime, potentially creating an illegal state. In these cases, you need to reach for something a bit heavier. In the next chapter, I’ll teach you how to do just that with classes.<a data-type="indexterm" data-primary="user-defined types" data-secondary="data classes" data-startref="ix_usrDTDC" id="idm45644740950632" class="calibre5"/><a data-type="indexterm" data-primary="data classes" data-startref="ix_dacl" id="idm45644740949384" class="calibre5"/></p>
</div></section>







<div data-type="footnotes" class="calibre25"><p data-type="footnote" id="idm45644742249656" class="calibre26"><sup class="calibre27"><a href="part0013_split_003.html#idm45644742249656-marker" class="calibre5">1</a></sup> The informal string representation is useful for printing the object. The official string representation reproduces all information about the object so that it can be reconstructed.</p><p data-type="footnote" id="idm45644741402248" class="calibre26"><sup class="calibre27"><a href="part0013_split_006.html#idm45644741402248-marker" class="calibre5">2</a></sup> Hashing is a complicated subject, beyond the scope of this book. You can learn more about the <code class="calibre17">hash</code> function in the <a href="https://oreil.ly/JDgLO" class="calibre5">Python documentation</a>.</p></div></div></section></body></html>