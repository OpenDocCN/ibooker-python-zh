<html><head></head><body>
<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 22. Acceptance Testing" class="preface"><div class="preface" id="bdd">
<h1 class="calibre10" id="calibre_pb_0"><span class="calibre">Chapter 22. </span>Acceptance Testing</h1>


<p class="author1">As a developer, it is easy to <a data-type="indexterm" data-primary="acceptance testing" id="ix_accpt" class="calibre5"/>focus on the tests that directly surround your codebase: unit tests, integration tests, UI tests, and the like.<a data-type="indexterm" data-primary="testing" data-secondary="acceptance" id="ix_tstaccpt" class="calibre5"/><a data-type="indexterm" data-primary="unit tests" id="idm45644725970408" class="calibre5"/><a data-type="indexterm" data-primary="integration tests" id="idm45644725969736" class="calibre5"/><a data-type="indexterm" data-primary="UI tests" id="idm45644725969064" class="calibre5"/> These tests verify that the code is doing what you intend. They are an invaluable tool to keep your codebase regression free. They are also completely the <em class="calibre6">wrong</em> tool for building what a customer expects.</p>

<p class="author1">Developers write these tests with full knowledge of the code, which means the tests are biased toward that developer’s expectations. There is no guarantee that this tested behavior is actually what the <em class="calibre6">customer</em> wants, though.</p>

<p class="author1">Consider the following unit test:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">def</code> <code class="nf">test_chili_has_correct_ingredients</code><code class="calibre17">():</code>
    <code class="k">assert</code> <code class="n">make_chili</code><code class="calibre17">()</code><code class="calibre17">.</code><code class="n">ingredients</code><code class="calibre17">()</code> <code class="calibre17">==</code> <code class="calibre17">[</code>
        <code class="s">"Ground Beef"</code><code class="calibre17">,</code>
        <code class="s">"Chile Blend"</code><code class="calibre17">,</code>
        <code class="s">"Onion"</code><code class="calibre17">,</code>
        <code class="calibre17">...</code>
        <code class="s">"Tomatoes"</code><code class="calibre17">,</code>
        <code class="s">"Pinto Beans"</code>
    <code class="calibre17">]</code></pre>

<p class="author1">This test might be airtight; it passes and catches any regression made in the code. However, when presented to a customer, you might be confronted with: “No, I wanted Texas-style chili! You know, no tomatoes or beans?” All the unit tests in the world won’t save you from building the wrong thing.</p>

<p class="author1">This is where acceptance testing comes in. <em class="calibre6">Acceptance tests</em> check that you are building the correct product.<a data-type="indexterm" data-primary="acceptance tests" id="idm45644725940424" class="calibre5"/> While unit tests and integration tests are a form of <em class="calibre6">verification</em>, acceptance tests are <em class="calibre6">validation</em>. <a data-type="indexterm" data-primary="validation" data-secondary="acceptance tests as form of" id="idm45644725938792" class="calibre5"/><a data-type="indexterm" data-primary="verification, unit tests and integration tests" id="idm45644725937816" class="calibre5"/>They validate that you are building what the user expects.</p>

<p class="author1">In this chapter, you will learn about acceptance testing in Python. I’ll show you the <code class="calibre17">behave</code> framework, which<a data-type="indexterm" data-primary="behave framework" id="idm45644725936136" class="calibre5"/>  uses the Gherkin language to define requirements in a whole new fashion.<sup class="calibre11"><a data-type="noteref" id="idm45644725935272-marker" href="part0028_split_012.html#idm45644725935272" class="calibre5">1</a></sup> You’ll walk through behavior-driven development (BDD) as a tool to clarify conversations. Acceptance testing is a crucial part of building a safety net; it will protect you from building the wrong thing.</p>






</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 22. Acceptance Testing" class="preface">
<div class="preface" id="bdd">
<section data-type="sect1" data-pdf-bookmark="Behavior-Driven Development" class="preface"><div class="preface" id="idm45644725933896">
<h1 class="calibre12" id="calibre_pb_1">Behavior-Driven Development</h1>

<p class="author1">The mismatch between customer expectations and software behavior is as old as software development. <a data-type="indexterm" data-primary="acceptance testing" data-secondary="behavior-driven development" id="ix_accptBDD" class="calibre5"/><a data-type="indexterm" data-primary="behavior-driven development (BDD)" id="ix_BDD" class="calibre5"/><a data-type="indexterm" data-primary="customer expectations and software behavior, mismatch between" id="idm45644725929928" class="calibre5"/>The problem stems from translating natural language to programming language.<a data-type="indexterm" data-primary="natural language, translating to programming language" id="idm45644725929160" class="calibre5"/><a data-type="indexterm" data-primary="programming languages, translating natural language to" id="idm45644725928520" class="calibre5"/> Natural language is rife with ambiguities, inconsistencies, and nuance. Programming languages are rigid.<a data-type="indexterm" data-primary="Telephone game" id="idm45644725927560" class="calibre5"/> The computer does exactly what you tell it to do (even if it’s not what you meant). Even worse, it’s like a game of Telephone<sup class="calibre11"><a data-type="noteref" id="idm45644725926616-marker" href="part0028_split_012.html#idm45644725926616" class="calibre5">2</a></sup> as the requirements get passed through a few people (customers, sales, managers, testers) before the test is ever written.</p>

<p class="author1">As with everything in the software life cycle, this error case only gets more costly the longer it takes to fix. Ideally, you want to find out these issues as you’re coming up with user requirements. This is where behavior-driven development comes into play.</p>








</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 22. Acceptance Testing" class="preface">
<div class="preface" id="bdd">
<section data-type="sect1" data-pdf-bookmark="Behavior-Driven Development" class="preface">
<div class="preface" id="idm45644725933896">
<section data-type="sect2" data-pdf-bookmark="The Gherkin Language" class="preface"><div class="preface" id="idm45644725924904">
<h2 class="calibre34" id="calibre_pb_2">The Gherkin Language</h2>

<p class="author1"><em class="calibre6">Behavior-driven development</em>, first pioneered by <a href="https://oreil.ly/MnziJ" class="calibre5">Daniel Terhorst-North</a>, is a practice that focuses on defining the behaviors in your system. BDD focuses on clarifying communications; you iterate over the requirements with the end user, defining the behaviors they want.</p>

<p class="author1">Before you write a single lick of code, you make sure that you have agreement on what the right thing to build is. The set of defined behaviors will <em class="calibre6">drive</em> what code you write.  You work with the end user (or their proxy, such as a business analyst or product manager) to define your requirements as a specification. These specifications follow a formal language, to introduce a bit more rigidity in their definition.<a data-type="indexterm" data-primary="requirements" data-secondary="specifying using Gherkin language" id="ix_reqs" class="calibre5"/>  One of the most common languages for specifying requirements is Gherkin.<a data-type="indexterm" data-primary="acceptance testing" data-secondary="behavior-driven development" data-tertiary="Gherkin language" id="ix_accptBDDGh" class="calibre5"/><a data-type="indexterm" data-primary="Gherkin language" id="ix_Gher" class="calibre5"/><a data-type="indexterm" data-primary="behavior-driven development (BDD)" data-secondary="Gherkin language" id="ix_BDDGher" class="calibre5"/></p>

<p class="author1">Gherkin is <a data-type="indexterm" data-primary="Given-When-Then (GWT) format" id="idm45644725915224" class="calibre5"/>a specification that follows the <em class="calibre6">Given-When-Then</em> (GWT) format. Every requirement is organized as follows:</p>

<pre data-type="programlisting" class="calibre35">Feature: Name of test suite

  Scenario: A test case
    Given some precondition
    When I take some action
    Then I expect this result</pre>

<p class="author1">For instance, if I wanted to capture a requirement that checks for vegan substitution of a dish, I would write it as follows:</p>

<pre data-type="programlisting" class="calibre35">Feature: Vegan-friendly menu

  Scenario: Can substitute for vegan alternative
    Given an order containing a Cheeseburger with Fries
    When I ask for vegan substitutions
    Then I receive the meal with no animal products</pre>

<p class="author1">Another requirement might be that certain dishes can’t be made vegan:</p>

<pre data-type="programlisting" class="calibre35">  Scenario: Cannot substitute vegan alternatives for certain meals
    Given an order containing Meatloaf
    When I ask for vegan substitutions
    Then an error shows up stating the meal is not vegan substitutable</pre>
<div data-type="note" epub:type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">If the GWT format feels familiar, that’s because it’s identical to the AAA test organization you learned about in <a data-type="xref" href="part0027_split_000.html#testing_strategy" class="calibre5">Chapter 21</a>.</p>
</div>

<p class="author1">By working with your end users to write your requirements in this fashion, you benefit from a few key principles:</p>
<dl class="calibre13">
<dt class="calibre14">Write using plain language</dt>
<dd class="calibre15">
<p class="calibre16">There’s no need to delve into any programming languages or formal logic. Everything is written in a form that is intelligible to both business people and developers. This makes it incredibly easy to home in on what the end user actually wants.</p>
</dd>
<dt class="calibre14">Build a shared vocabulary</dt>
<dd class="calibre15">
<p class="calibre16">As the number of requirements increases, you find that you start having the same clauses in multiple requirements (see above with <code class="calibre17">When I ask for vegan substitutions</code>). This builds up your domain language and will make it easier for all involved parties to understand the requirements.</p>
</dd>
<dt class="calibre14">Requirements are testable</dt>
<dd class="calibre15">
<p class="calibre16">This is probably the biggest benefit of this requirement format. Because you are writing the requirement as GWT, you are inherently specifying an acceptance test to write. With the chili example used in this chapter, imagine if the Gherkin test was specified as such:</p>

<pre data-type="programlisting" class="calibre35">  Scenario: Texas-Style Chili
    Given a Chili-Making Machine
    When a Chili is dispensed
    Then that dish does not contain beans
    And that dish does not contain tomatoes</pre>

<p class="calibre16">It becomes much clearer what tests need to be written to act as acceptance tests. If the Gherkin test has any ambiguities, you can work with the end user to figure out what a concrete test should be. This can also help with traditionally vague requirements such as, “The Chili-Making Machine should be fast.” Instead, by focusing on a concrete test, you end up with a test like this:</p>

<pre data-type="programlisting" class="calibre35">Scenario: Chili order takes less than two minutes
Given a Chili-Making Machine
When a Chili is ordered
Then the Chili is dispensed to the customer within two minutes</pre>
</dd>
</dl>
<div data-type="warning" epub:type="warning" class="calibre23"><h6 class="calibre24">Warning</h6>
<p class="author1">These requirements specifications are not a silver bullet to eliminate bugs in requirements. They are instead a mitigation strategy. If you have technical and business people review them before code is written, you will have a better chance of discovering ambiguities or mismatched intentions.<a data-type="indexterm" data-primary="requirements" data-secondary="specifying using Gherkin language" data-startref="ix_reqs" id="idm45644725874040" class="calibre5"/></p>
</div>

<p class="author1">Once you start defining your tests in Gherkin, you can do something awesome: you can make your specifications <em class="calibre6">executable</em>.<a data-type="indexterm" data-primary="acceptance testing" data-secondary="behavior-driven development" data-tertiary="Gherkin language" data-startref="ix_accptBDDGh" id="idm45644725871720" class="calibre5"/><a data-type="indexterm" data-primary="Gherkin language" data-startref="ix_Gher" id="idm45644725870152" class="calibre5"/><a data-type="indexterm" data-primary="behavior-driven development (BDD)" data-secondary="Gherkin language" data-startref="ix_BDDGher" id="idm45644725869208" class="calibre5"/></p>
</div></section>













</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 22. Acceptance Testing" class="preface">
<div class="preface" id="bdd">
<section data-type="sect1" data-pdf-bookmark="Behavior-Driven Development" class="preface">
<div class="preface" id="idm45644725933896">
<section data-type="sect2" data-pdf-bookmark="Executable Specifications" class="preface"><div class="preface" id="idm45644725924344">
<h2 class="calibre34" id="calibre_pb_3">Executable Specifications</h2>

<p class="author1"><em class="calibre6">Executable specifications</em> translate a set of requirements directly to code.<a data-type="indexterm" data-primary="acceptance testing" data-secondary="behavior-driven development" data-tertiary="executable specifications" id="ix_accptBDDES" class="calibre5"/><a data-type="indexterm" data-primary="executable specifications" id="ix_exspec" class="calibre5"/> This means that not only are your requirements <em class="calibre6">testable</em>, but they are <em class="calibre6">tests</em> as well. When the requirements change, your tests will change at the same time. This is the ultimate form of <em class="calibre6">traceability</em>, or the ability to connect your requirements to specific tests or code.<a data-type="indexterm" data-primary="requirements" data-secondary="backing with concrete tests" id="idm45644725861512" class="calibre5"/></p>
</div></section>





</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 22. Acceptance Testing" class="preface">
<div class="preface" id="bdd">
<section data-type="sect1" data-pdf-bookmark="Behavior-Driven Development" class="preface">
<div class="preface" id="idm45644725933896">
<section data-type="sect2" data-pdf-bookmark="Executable Specifications" class="preface">
<div class="preface" id="idm45644725924344">
<div data-type="note" epub:type="note" class="calibre21"><h1 class="calibre38" id="calibre_pb_4">Discussion Topic</h1>
<p class="author1">How does your organization track requirements? How do you trace those requirements to test cases? How do you handle requirements changing? Discuss how your processes would change if your requirements and tests were the same thing.</p>
</div>

<p class="author1">The Python module <a href="https://oreil.ly/VywJX" class="calibre5"><code class="calibre17">behave</code></a> allows you to back your Gherkin requirements with concrete tests.<a data-type="indexterm" data-primary="behave framework" data-secondary="backing Gherkin requirements with concrete tests" id="idm45644725857720" class="calibre5"/> It does so by associating functions with specific clauses in the requirement.</p>
<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">By default, <code class="calibre17">behave</code> expects your Gherkin files to be in a folder called <em class="calibre6">features</em> and your Python functions (called steps) to be in a folder called <em class="calibre6">features/steps</em>.</p>
</div>

<p class="author1">Let’s look at the first Gherkin requirement I showed earlier in this chapter:</p>

<pre data-type="programlisting" class="calibre35">Feature: Vegan-friendly menu

  Scenario: Can substitute for vegan alternative
    Given an order containing a Cheeseburger with Fries
    When I ask for vegan substitutions
    Then I receive the meal with no animal products</pre>

<p class="author1">With <code class="calibre17">behave</code>, I can write Python<a data-type="indexterm" data-primary="behave framework" data-secondary="writing Python code mapping to Given-When-Then statements" id="idm45644725851928" class="calibre5"/><a data-type="indexterm" data-primary="Given-When-Then (GWT) format" data-secondary="writing Python code that maps to" id="idm45644725850952" class="calibre5"/> code that maps to each of these GWT statements:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">from</code> <code class="nn">behave</code> <code class="k">import</code> <code class="n">given</code><code class="calibre17">,</code> <code class="n">when</code><code class="calibre17">,</code> <code class="n">then</code>

<code class="nd">@given</code><code class="calibre17">(</code><code class="s">"an order containing a Cheeseburger with Fries"</code><code class="calibre17">)</code>
<code class="k">def</code> <code class="nf">setup_order</code><code class="calibre17">(</code><code class="n">ctx</code><code class="calibre17">):</code>
    <code class="n">ctx</code><code class="calibre17">.</code><code class="n">dish</code> <code class="calibre17">=</code> <code class="n">CheeseburgerWithFries</code><code class="calibre17">()</code>

<code class="nd">@when</code><code class="calibre17">(</code><code class="s">"I ask for vegan substitutions"</code><code class="calibre17">)</code>
<code class="k">def</code> <code class="nf">substitute_vegan</code><code class="calibre17">(</code><code class="n">ctx</code><code class="calibre17">):</code>
    <code class="n">ctx</code><code class="calibre17">.</code><code class="n">dish</code><code class="calibre17">.</code><code class="n">substitute_vegan_ingredients</code><code class="calibre17">()</code>

<code class="nd">@then</code><code class="calibre17">(</code><code class="s">"I receive the meal with no animal products"</code><code class="calibre17">)</code>
<code class="k">def</code> <code class="nf">check_all_vegan</code><code class="calibre17">(</code><code class="n">ctx</code><code class="calibre17">):</code>
    <code class="k">assert</code> <code class="nb">all</code><code class="calibre17">(</code><code class="n">is_vegan</code><code class="calibre17">(</code><code class="n">ing</code><code class="calibre17">)</code> <code class="k">for</code> <code class="n">ing</code> <code class="calibre19">in</code> <code class="n">ctx</code><code class="calibre17">.</code><code class="n">dish</code><code class="calibre17">.</code><code class="n">ingredients</code><code class="calibre17">())</code></pre>

<p class="author1">Each step is represented as a decorator that matches the clause of the Gherkin requirement.<a data-type="indexterm" data-primary="decorators" id="idm45644725792232" class="calibre5"/> The decorated function is what gets executed as part of the specification. In the above example, the Gherkin requirement would be represented by the following code (you do not have to write this; Gherkin does it for you):</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">from</code> <code class="nn">behave.runner</code> <code class="k">import</code> <code class="n">Context</code>
<code class="n">context</code> <code class="calibre17">=</code> <code class="n">Context</code><code class="calibre17">()</code>
<code class="n">setup_order</code><code class="calibre17">(</code><code class="n">context</code><code class="calibre17">)</code>
<code class="n">substitute_vegan</code><code class="calibre17">(</code><code class="n">context</code><code class="calibre17">)</code>
<code class="n">check_all_vegan</code><code class="calibre17">(</code><code class="n">context</code><code class="calibre17">)</code></pre>

<p class="author1">To run this, first install <code class="calibre17">behave</code>:</p>

<pre data-type="programlisting" class="calibre35">pip install behave</pre>

<p class="author1">Then, run <code class="calibre17">behave</code> on the folder containing your requirements and steps:</p>

<pre data-type="programlisting" class="calibre35">behave code_examples/chapter22/features</pre>

<p class="author1">You will see the following as output:</p>

<pre data-type="programlisting" class="calibre35">Feature: Vegan-friendly menu

  Scenario: Can substitute for vegan alternatives
    Given an order containing a Cheeseburger with Fries
    When I ask for vegan substitutions
    Then I receive the meal with no animal products

1 feature passed, 0 failed, 0 skipped
1 scenario passed, 0 failed, 0 skipped
3 steps passed, 0 failed, 0 skipped, 0 undefined
Took 0m0.000s</pre>

<p class="author1">When this code is run in a terminal or an IDE, all the steps show up as green. If any step fails, the step turns red and you get a stack trace of what went wrong.</p>

<p class="author1">Now you can tie your requirements directly to your acceptance tests. If an end user changes their mind, they can write a new test. If the GWT clause already exists for the new tests, that’s a win; new tests can be written without the help of a developer. If the clauses do not already exist, that’s also a win, because it kick-starts a conversation when the test immediately fails. Your end users and your business people need no Python knowledge to understand what you are testing.</p>

<p class="author1">Use the Gherkin specifications to drive conversations about the software that you need to build. <code class="calibre17">behave</code> allows you to tie your acceptance tests directly to these requirements, and they serve as a way of focusing conversations. Using BDD prevents you from jumping right into coding the wrong thing. As the popular saying goes: “Weeks of coding will save you hours of planning.”<sup class="calibre11"><a data-type="noteref" id="idm45644725698696-marker" href="part0028_split_012.html#idm45644725698696" class="calibre5">3</a></sup></p>
</div></section>





</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 22. Acceptance Testing" class="preface">
<div class="preface" id="bdd">
<section data-type="sect1" data-pdf-bookmark="Additional behave Features" class="preface"><div class="preface" id="idm45644725867064">
<h1 class="calibre12" id="calibre_pb_5">Additional behave Features</h1>

<p class="author1">The previous example was a bit bare-bones, but thankfully, <code class="calibre17">behave</code> provides some extra features to make test writing even easier.<a data-type="indexterm" data-primary="executable specifications" data-startref="ix_exspec" id="idm45644725695880" class="calibre5"/><a data-type="indexterm" data-primary="acceptance testing" data-secondary="behavior-driven development" data-tertiary="executable specifications" data-startref="ix_accptBDDES" id="idm45644725694936" class="calibre5"/><a data-type="indexterm" data-primary="acceptance testing" data-secondary="behavior-driven development" data-startref="ix_accptBDD" id="idm45644725693416" class="calibre5"/><a data-type="indexterm" data-primary="behavior-driven development (BDD)" data-startref="ix_BDD" id="idm45644725692184" class="calibre5"/><a data-type="indexterm" data-primary="acceptance testing" data-secondary="other behave features" id="ix_accptbeh" class="calibre5"/><a data-type="indexterm" data-primary="behave framework" data-secondary="additional features" id="ix_behfeat" class="calibre5"/></p>








</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 22. Acceptance Testing" class="preface">
<div class="preface" id="bdd">
<section data-type="sect1" data-pdf-bookmark="Additional behave Features" class="preface">
<div class="preface" id="idm45644725867064">
<section data-type="sect2" data-pdf-bookmark="Parameterized Steps" class="preface"><div class="preface" id="idm45644725688664">
<h2 class="calibre34" id="calibre_pb_6">Parameterized Steps</h2>

<p class="author1">You may have noticed <a data-type="indexterm" data-primary="behave framework" data-secondary="additional features" data-tertiary="parameterized steps" id="idm45644725686968" class="calibre5"/><a data-type="indexterm" data-primary="parameterized steps (behave)" id="idm45644725685688" class="calibre5"/><a data-type="indexterm" data-primary="Given-When-Then (GWT) format" data-secondary="parameterized steps in behave" id="idm45644725685000" class="calibre5"/>that I have two <code class="calibre17">Given</code> steps that are very similar:</p>

<pre data-type="programlisting" class="calibre35">Given an order containing a Cheeseburger with Fries</pre>

<p class="author1">and</p>

<pre data-type="programlisting" class="calibre35">Given an order containing Meatloaf</pre>

<p class="author1">It’d be silly to write two similar functions to link this in Python. <code class="calibre17">behave</code> lets you parameterize the steps to reduce the need for writing multiple steps:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="nd">@given</code><code class="calibre17">(</code><code class="s">"an order containing {dish_name}"</code><code class="calibre17">)</code>
<code class="k">def</code> <code class="nf">setup_order</code><code class="calibre17">(</code><code class="n">ctx</code><code class="calibre17">,</code> <code class="n">dish_name</code><code class="calibre17">):</code>
    <code class="k">if</code> <code class="n">dish_name</code> <code class="calibre17">==</code> <code class="s">"a Cheeseburger with Fries"</code><code class="calibre17">:</code>
        <code class="n">ctx</code><code class="calibre17">.</code><code class="n">dish</code> <code class="calibre17">=</code> <code class="n">CheeseburgerWithFries</code><code class="calibre17">()</code>
    <code class="k">elif</code> <code class="n">dish_name</code> <code class="calibre17">==</code> <code class="s">"Meatloaf"</code><code class="calibre17">:</code>
        <code class="n">ctx</code><code class="calibre17">.</code><code class="n">dish</code> <code class="calibre17">=</code> <code class="n">Meatloaf</code><code class="calibre17">()</code></pre>

<p class="author1">Alternatively, you can stack clauses on a function if needed:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="nd">@given</code><code class="calibre17">(</code><code class="s">"an order containing a Cheeseburger with Fries"</code><code class="calibre17">)</code>
<code class="nd">@given</code><code class="calibre17">(</code><code class="s">"a typical drive-thru order"</code><code class="calibre17">)</code>
<code class="k">def</code> <code class="nf">setup_order</code><code class="calibre17">(</code><code class="n">context</code><code class="calibre17">):</code>
    <code class="n">ctx</code><code class="calibre17">.</code><code class="n">dish</code> <code class="calibre17">=</code> <code class="n">CheeseBurgerWithFries</code><code class="calibre17">()</code></pre>

<p class="author1">Parameterizing and reusing steps will help you build up vocabulary that is intuitive to use, which will reduce the cost of writing Gherkin tests.</p>
</div></section>













</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 22. Acceptance Testing" class="preface">
<div class="preface" id="bdd">
<section data-type="sect1" data-pdf-bookmark="Additional behave Features" class="preface">
<div class="preface" id="idm45644725867064">
<section data-type="sect2" data-pdf-bookmark="Table-Driven Requirements" class="preface"><div class="preface" id="idm45644725688072">
<h2 class="calibre34" id="calibre_pb_7">Table-Driven Requirements</h2>

<p class="author1">In <a data-type="xref" href="part0027_split_000.html#testing_strategy" class="calibre5">Chapter 21</a>, I mentioned <a data-type="indexterm" data-primary="requirements" data-secondary="table-driven, in behave" id="idm45644725510792" class="calibre5"/><a data-type="indexterm" data-primary="behave framework" data-secondary="additional features" data-tertiary="table-driven requirements" id="idm45644725568904" class="calibre5"/><a data-type="indexterm" data-primary="table-driven requirements" id="idm45644725567672" class="calibre5"/>how you can parameterize tests so that all your pre-conditions and assertions are defined in a table. <code class="calibre17">behave</code> offers something very similar:</p>

<pre data-type="programlisting" class="calibre35">Feature: Vegan-friendly menu

Scenario Outline: Vegan Substitutions
  Given an order containing &lt;dish_name&gt;,
  When I ask for vegan substitutions
  Then &lt;result&gt;

 Examples: Vegan Substitutable
   | dish_name                  | result |
   | a Cheeseburger with Fries  | I receive the meal with no animal products  |
   | Cobb Salad                 | I receive the meal with no animal products  |
   | French Fries               | I receive the meal with no animal products  |
   | Lemonade                   | I receive the meal with no animal products  |

 Examples: Not Vegan Substitutable
   | dish_name     | result |
   | Meatloaf      | a non-vegan-substitutable error shows up |
   | Meatballs     | a non-vegan-substitutable error shows up |
   | Fried Shrimp  | a non-vegan-substitutable error shows up |</pre>

<p class="author1"><code class="calibre17">behave</code> will automatically run a test for each table entry. This is a great way to run the same test on very similar data.</p>
</div></section>













</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 22. Acceptance Testing" class="preface">
<div class="preface" id="bdd">
<section data-type="sect1" data-pdf-bookmark="Additional behave Features" class="preface">
<div class="preface" id="idm45644725867064">
<section data-type="sect2" class="preface" data-pdf-bookmark="Step Matching"><div class="preface" id="idm45644725563752">
<h2 class="calibre34" id="calibre_pb_8">Step Matching</h2>

<p class="author1">Sometimes, the basic decorators don’t have enough flexibility to capture what you are trying to express.<a data-type="indexterm" data-primary="behave framework" data-secondary="additional features" data-tertiary="step matching" id="idm45644725561960" class="calibre5"/><a data-type="indexterm" data-primary="step matching (behave)" id="idm45644725560712" class="calibre5"/><a data-type="indexterm" data-primary="regular expression parsing in decorators" id="idm45644725560040" class="calibre5"/><a data-type="indexterm" data-primary="decorators" data-secondary="regular expression parsing in behave" id="idm45644725559400" class="calibre5"/> You can tell <code class="calibre17">behave</code> to use regular expression parsing in your decorators. This is useful to make the Gherkin specifications feel more natural to write (especially getting around complex data formats or wonky grammar issues). Here’s an example that allows you to specify dishes with an optional “a” or “an” beforehand (so that dish names can be simplified).</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">from</code> <code class="nn">behave</code> <code class="k">import</code> <code class="n">use_context_matcher</code>

<code class="n">use_step_matcher</code><code class="calibre17">(</code><code class="s">"re"</code><code class="calibre17">)</code>

<code class="nd">@given</code><code class="calibre17">(</code><code class="s">"an order containing [a |an ]?(?P&lt;dish_name&gt;.*)"</code><code class="calibre17">)</code>
<code class="k">def</code> <code class="nf">setup_order</code><code class="calibre17">(</code><code class="n">ctx</code><code class="calibre17">,</code> <code class="n">dish_name</code><code class="calibre17">):</code>
    <code class="n">ctx</code><code class="calibre17">.</code><code class="n">dish</code> <code class="calibre17">=</code> <code class="n">create_dish</code><code class="calibre17">(</code><code class="n">dish_name</code><code class="calibre17">)</code></pre>
</div></section>













</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 22. Acceptance Testing" class="preface">
<div class="preface" id="bdd">
<section data-type="sect1" data-pdf-bookmark="Additional behave Features" class="preface">
<div class="preface" id="idm45644725867064">
<section data-type="sect2" data-pdf-bookmark="Customizing the Test Life Cycle" class="preface"><div class="preface" id="idm45644725581160">
<h2 class="calibre34" id="calibre_pb_9">Customizing the Test Life Cycle</h2>

<p class="author1">Sometimes you need to run code before or after your tests run.<a data-type="indexterm" data-primary="testing" data-secondary="customizing test lifecycle in behave" id="idm45644725476344" class="calibre5"/><a data-type="indexterm" data-primary="behave framework" data-secondary="additional features" data-tertiary="customizing test lifecycle" id="idm45644725475464" class="calibre5"/> Say you need to set up a database before all the specifications are set, or tell a service to clear its cache between test runs.  Just like <code class="calibre17">setUp</code> and <code class="calibre17">tearDown</code> in the built-in <code class="calibre17">unittest</code> module, <code class="calibre17">behave</code> offers functions that let you hook in functions before or after steps, features, or the entire test run. Use this to consolidate common setup code. To take full advantage of this functionality, you can define specifically named functions in a file named <em class="calibre6">environment.py</em>.</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">def</code> <code class="nf">before_all</code><code class="calibre17">(</code><code class="n">ctx</code><code class="calibre17">):</code>
    <code class="n">ctx</code><code class="calibre17">.</code><code class="n">database</code> <code class="calibre17">=</code> <code class="n">setup_database</code><code class="calibre17">()</code>

<code class="k">def</code> <code class="nf">before_feature</code><code class="calibre17">(</code><code class="n">ctx</code><code class="calibre17">,</code> <code class="n">feature</code><code class="calibre17">):</code>
    <code class="n">ctx</code><code class="calibre17">.</code><code class="n">database</code><code class="calibre17">.</code><code class="n">empty_tables</code><code class="calibre17">()</code>

<code class="k">def</code> <code class="nf">after_all</code><code class="calibre17">(</code><code class="n">ctx</code><code class="calibre17">):</code>
    <code class="n">ctx</code><code class="calibre17">.</code><code class="n">database</code><code class="calibre17">.</code><code class="n">cleanup</code><code class="calibre17">()</code></pre>

<p class="author1">Check out the <a href="https://oreil.ly/NjEtf" class="calibre5"><code class="calibre17">behave</code> documentation</a> for more information on controlling your environment. If you are more comfortable with <code class="calibre17">pytest</code> fixtures, check out <code class="calibre17">behave</code> <a href="https://oreil.ly/6ZZA4" class="calibre5">fixtures</a> for very similar ideas.</p>
<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">Functions like <code class="calibre17">before_feature</code> and <code class="calibre17">before_scenario</code> get the feature or scenario, respectively, passed to them. You can key off the names of these features and scenarios to do specific actions for specific parts of your tests.</p>
</div>
</div></section>













</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 22. Acceptance Testing" class="preface">
<div class="preface" id="bdd">
<section data-type="sect1" data-pdf-bookmark="Additional behave Features" class="preface">
<div class="preface" id="idm45644725867064">
<section data-type="sect2" data-pdf-bookmark="Using Tags to Selectively Run Tests" class="preface"><div class="preface" id="idm45644725403224">
<h2 class="calibre34" id="calibre_pb_10">Using Tags to Selectively Run Tests</h2>

<p class="author1"><code class="calibre17">behave</code> also offers the ability to tag certain tests with arbitrary text.<a data-type="indexterm" data-primary="behave framework" data-secondary="additional features" data-tertiary="using tags to selectively run tests" id="idm45644725401176" class="calibre5"/><a data-type="indexterm" data-primary="tags, using in behave to selectively run tests" id="idm45644725399960" class="calibre5"/> These tags can be anything you want: <code class="calibre17">@wip</code> for work in progress, <code class="calibre17">@slow</code> for slow running tests, <code class="calibre17">@smoke</code> for a select few tests for running on each check-in, and so on.</p>

<p class="author1">To tag a test in <code class="calibre17">behave</code>, just decorate your Gherkin scenario:</p>

<pre data-type="programlisting" class="calibre35">Feature: Vegan-friendly Menu


  @smoke
  @wip
  Scenario: Can substitute for vegan alternatives
    Given an order containing a Cheeseburger with Fries
    When I ask for vegan substitutions
    Then I receive the meal with no animal products</pre>

<p class="author1">To run just tests with a specific tag, you can pass a <code class="calibre17">--tags</code> flag to your <code class="calibre17">behave</code> <span class="calibre">invocation</span>:</p>

<pre data-type="programlisting" class="calibre35">behave code_examples/chapter22 --tags=smoke</pre>
<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">If you’d like to exclude tests from being run, prefix the tags with a hyphen, as seen in this example where I exclude tests tagged with <code class="calibre17">wip</code> from being run:</p>

<p class="author1"><code class="calibre17">behave code_examples/chapter22 --tags=-wip</code></p>
</div>
</div></section>













</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 22. Acceptance Testing" class="preface">
<div class="preface" id="bdd">
<section data-type="sect1" data-pdf-bookmark="Additional behave Features" class="preface">
<div class="preface" id="idm45644725867064">
<section data-type="sect2" data-pdf-bookmark="Report Generation" class="preface"><div class="preface" id="idm45644725390856">
<h2 class="calibre34" id="calibre_pb_11">Report Generation</h2>

<p class="author1">Using <code class="calibre17">behave</code> and BDD to drive your acceptance testing will not pay off if you are not involving your end users or their proxies.<a data-type="indexterm" data-primary="behave framework" data-secondary="additional features" data-tertiary="report generation" id="idm45644725388744" class="calibre5"/><a data-type="indexterm" data-primary="report generation in behave" id="idm45644725387496" class="calibre5"/> Find ways to make it easy for them to understand and use the Gherkin requirements.</p>

<p class="author1">You can get a list of all step definitions by invoking <code class="calibre17">behave --steps-catalog</code>.</p>

<p class="author1">Of course, you also need a way of showing test results to give your end users an idea of what is working and what is not. <code class="calibre17">behave</code> lets you format outputs in a variety of different ways (and you can define your own).<a data-type="indexterm" data-primary="JUnit" data-secondary="generating test reports from, in behave" id="idm45644725384872" class="calibre5"/> Out of the box, there is also the ability to create reports from <a href="https://junit.org/junit5" class="calibre5">JUnit</a>, a unit-testing framework designed for the Java language. JUnit writes its test results as a XML file, and a lot of tools were built to ingest and visualize the test results.</p>

<p class="author1">To generate a JUnit test report, you can pass <code class="calibre17">--junit</code> to your <code class="calibre17">behave</code> invocation. Then, you can use a tool <a href="https://github.com/inorton/junit2html" class="calibre5"><code class="calibre17">junit2html</code></a> to get a report for all of your test cases:</p>

<pre data-type="programlisting" class="calibre35">pip install junit2html
behave code_examples/chapter22/features/ --junit
# xml files are in the reports folder
junit2html &lt;filename&gt;</pre>

<p class="author1">An example output is shown in <a data-type="xref" href="part0028_split_011.html#behave_output" class="calibre5">Figure 22-1</a>.</p>

<figure class="calibre36"><div id="behave_output" class="figure">
<img src="../images/00041.jpeg" alt="ropy 2201" class="calibre40"/>
<h6 class="calibre37"><span class="calibre">Figure 22-1. </span>Example <code class="calibre17">behave</code> report with <code class="calibre17">junit2html</code></h6>
</div></figure>

<p class="author1">There are plenty of JUnit report generators, so look around for one you like and use it to produce HTML reports of your test results.<a data-type="indexterm" data-primary="acceptance testing" data-secondary="other behave features" data-startref="ix_accptbeh" id="idm45644725375224" class="calibre5"/><a data-type="indexterm" data-primary="behave framework" data-secondary="additional features" data-startref="ix_behfeat" id="idm45644725373976" class="calibre5"/></p>
</div></section>





</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 22. Acceptance Testing" class="preface">
<div class="preface" id="bdd">
<section data-type="sect1" data-pdf-bookmark="Closing Thoughts" class="preface"><div class="preface" id="idm45644725372632">
<h1 class="calibre12" id="calibre_pb_12">Closing Thoughts</h1>

<p class="author1">If all your tests pass but don’t deliver what the end user wants, you have wasted time and effort. It is costly to build the right thing; you want to try and get it right the first time. Use BDD to drive crucial conversations about the requirements for your system. Once you have requirements, use <code class="calibre17">behave</code> and the Gherkin language to write acceptance tests. These acceptance tests become your safety net for ensuring that you deliver what the end user wants.<a data-type="indexterm" data-primary="testing" data-secondary="acceptance" data-startref="ix_tstaccpt" id="idm45644725370424" class="calibre5"/><a data-type="indexterm" data-primary="acceptance testing" data-startref="ix_accpt" id="idm45644725369176" class="calibre5"/></p>

<p class="author1">In the next chapter, you’ll continue to learn how to repair holes in your safety net. You’ll learn about property-based testing with a Python tool called <code class="calibre17">Hypothesis</code>. It can generate test cases for you, including tests you might never have thought of. You can rest easier knowing that your tests have broader coverage than ever before.</p>
</div></section>







<div data-type="footnotes" class="calibre25"><p data-type="footnote" id="idm45644725935272" class="calibre26"><sup class="calibre27"><a href="part0028_split_000.html#idm45644725935272-marker" class="calibre5">1</a></sup> The Gherkin language was created by Aslak Hellesøy. His wife suggested that his BDD testing tool be named Cucumber (apparently for no specific reason), and he wanted to distinguish the specfication language from the testing tool itself. Since a gherkin is a small, pickled cucumber, he continued the theme, and the Gherkin specfication language was born.</p><p data-type="footnote" id="idm45644725926616" class="calibre26"><sup class="calibre27"><a href="part0028_split_001.html#idm45644725926616-marker" class="calibre5">2</a></sup> Telephone is a game where everyone sits in a circle, and one person whispers a message to another. The message continues to get whispered around the circle until it reaches the origin. Everyone has a laugh at how the message has gotten distorted.</p><p data-type="footnote" id="idm45644725698696" class="calibre26"><sup class="calibre27"><a href="part0028_split_004.html#idm45644725698696-marker" class="calibre5">3</a></sup> While this quote’s author is anonymous, I first came across it on the <a href="https://oreil.ly/rKsVj" class="calibre5">Programming Wisdom Twitter account</a>.</p></div></div></section></body></html>