<html><head></head><body>
<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Customizing Your Typechecker" class="preface"><div class="preface" id="typechecker">
<h1 class="calibre10" id="calibre_pb_0"><span class="calibre">Chapter 6. </span>Customizing Your Typechecker</h1>


<p class="author1">Typecheckers are one of your best resources for<a data-type="indexterm" data-primary="typecheckers" id="ix_typck" class="calibre5"/> building robust codebases. Jukka Lehtosalo, the lead developer of mypy, offers a beautifully concise definition of typecheckers: “In essence, [a typechecker] provides verified documentation.”<sup class="calibre11"><a data-type="noteref" id="idm45644746850088-marker" href="part0009_split_008.html#idm45644746850088" class="calibre5">1</a></sup> Type annotations provide documentation about your codebase, allowing other developers the ability to reason about your intentions. Typecheckers use those annotations to verify that the documentation matches the behavior.</p>

<p class="author1">As such, a typechecker is invaluable. Confucius once said, “The mechanic, who wishes to do his work well, must first sharpen his tools.”<sup class="calibre11"><a data-type="noteref" id="idm45644746847016-marker" href="part0009_split_008.html#idm45644746847016" class="calibre5">2</a></sup> This chapter is all about sharpening your typechecker. Great coding techniques can get you far, but it’s your surrounding tooling that takes you to the next level. Don’t stop with just learning your editor, compiler, or operating system. Learn your typechecker too. I will show you some of the more useful options to get the most out of your tools.</p>






</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Customizing Your Typechecker" class="preface">
<div class="preface" id="typechecker">
<section data-type="sect1" data-pdf-bookmark="Configuring Your Typechecker" class="preface"><div class="preface" id="idm45644746845416">
<h1 class="calibre12" id="calibre_pb_1">Configuring Your Typechecker</h1>

<p class="author1">I will focus on one of the most popular typecheckers out there: mypy.<a data-type="indexterm" data-primary="mypy typechecker" data-secondary="configuring" id="ix_mypycfg" class="calibre5"/><a data-type="indexterm" data-primary="typecheckers" data-secondary="configuring mypy" id="ix_typckcfg" class="calibre5"/> When you run a typechecker in an IDE (such as PyCharm), it typically runs mypy underneath the hood (although many IDEs will allow you to change the default typechecker). Anytime you configure mypy (or whatever your default typechecker is), your IDE will use that configuration as well.</p>

<p class="author1">Mypy offers quite a few configuration options to control the typechecker’s <em class="calibre6">strictness</em>, or the amount of errors reported. <a data-type="indexterm" data-primary="strictness (typecheckers)" id="idm45644746695144" class="calibre5"/>The stricter you make your typechecker, the more type annotations you need to write, which provides better documentation and creates fewer bugs. However, make the typechecker too strict, and you will find the minimum bar for developing code too high, incurring high costs to make changes. Mypy configuration options control these strictness levels. I’ll go through the different options available to you, and you can decide where that bar lies for you and your codebase.</p>

<p class="author1">First, you need to install mypy (if you haven’t already). The easiest way is through <code class="calibre17">pip</code> on the command line:</p>
<pre class="calibre35">pip install mypy</pre>

<p class="author1">Once you have mypy installed, you you can control configuration in one of three ways:</p>
<dl class="calibre13">
<dt class="calibre14">Command line</dt>
<dd class="calibre15">
<p class="calibre16">When instantiating mypy from a terminal, you can pass various options to configure behavior. This is great for exploring new checks in your codebase.</p>
</dd>
<dt class="calibre14">Inline configuration</dt>
<dd class="calibre15">
<p class="calibre16">You can specify configuration values at the top of a file to indicate any options you may want to set. For example:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35">    <code class="c"># mypy: disallow-any-generics</code></pre>

<p class="calibre16">Putting this line at the top of your file will tell mypy to explicitly fail if it finds any generic type annotated with <code class="calibre17">Any</code>.</p>
</dd>
<dt class="calibre14">Configuration file</dt>
<dd class="calibre15">
<p class="calibre16">You can set up a configuration file to use the same options every time mypy runs. This is extremely useful when needing to share the same options across a team. This file is typically stored in version control alongside the code.</p>
</dd>
</dl>








</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Customizing Your Typechecker" class="preface">
<div class="preface" id="typechecker">
<section data-type="sect1" data-pdf-bookmark="Configuring Your Typechecker" class="preface">
<div class="preface" id="idm45644746845416">
<section data-type="sect2" data-pdf-bookmark="Configuring mypy" class="preface"><div class="preface" id="idm45644746666392">
<h2 class="calibre34" id="calibre_pb_2">Configuring mypy</h2>

<p class="author1">When running mypy, it looks in your current directory for a configuration file named <em class="calibre6">mypy.ini</em>. <a data-type="indexterm" data-primary="mypy typechecker" data-secondary="configuring" data-tertiary="sample mypy.ini file" id="idm45644746664568" class="calibre5"/>This file will define which options you have set up for the project. Some options will be global, applied to every file, and other options will be per-module. A sample <em class="calibre6">mypy.ini</em> file might look as follows:</p>
<pre class="calibre35"># Global options:

[mypy]
python_version = 3.9
warn_return_any = True

# Per-module options:

[mypy-mycode.foo.*]
disallow_untyped_defs = True

[mypy-mycode.bar]
warn_return_any = False

[mypy-somelibrary]
ignore_missing_imports = True</pre>
<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">You can use the <code class="calibre17">--config-file</code> command-line option to specify config files in different places.<a data-type="indexterm" data-primary="config files, specifying in different places (mypy)" id="idm45644746679976" class="calibre5"/> Also, mypy will look for configuration files in specific home directories if it can’t find a local config file, in case you want the same settings across multiple projects. For more information, check out the <a href="https://oreil.ly/U1JO9" class="calibre5">mypy documentation</a>.</p>
</div>

<p class="author1">As a note, I won’t cover too much more about the configuration file. Most options that I’ll talk about work in both a configuration file and on the command line, and for the sake of simplicity, I’ll show you how to run the commands on mypy invocations.</p>

<p class="author1">In the following pages, I will cover a multitude of typechcecker configurations; you do not need to apply every single one of them to see value in a typechecker. Most typecheckers provide immense value right out of the box. However, feel free to consider the following options to improve a typechecker’s likelihood of finding errors.</p>










<section data-type="sect3" data-pdf-bookmark="Catching dynamic behavior" class="preface"><div class="preface" id="idm45644746676424">
<h3 class="calibre44">Catching dynamic behavior</h3>

<p class="author1">As mentioned before, Python’s dynamically typed nature will make maintenance hard on codebases that last a long time.<a data-type="indexterm" data-primary="typecheckers" data-secondary="configuring mypy" data-tertiary="catching dynamic behavior" id="idm45644746674376" class="calibre5"/><a data-type="indexterm" data-primary="mypy typechecker" data-secondary="configuring" data-tertiary="catching dynamic behavior" id="idm45644746673160" class="calibre5"/><a data-type="indexterm" data-primary="dynamic typing" data-secondary="typecheckers catching dynamic behavior" id="idm45644746671976" class="calibre5"/><a data-type="indexterm" data-primary="Any type" data-secondary="flagging instances of in typechecker" id="idm45644746671064" class="calibre5"/> Variables are free to be rebound to values with different types at any time. When this happens, the variable is essentially an <code class="calibre17">Any</code> type. <code class="calibre17">Any</code> types indicate that you should make no assumptions about what type that variable is. This makes it tricky to reason about: your typechecker won’t be of much use in preventing errors and you aren’t communicating anything special to future <span class="calibre">developers</span>.</p>

<p class="author1">Mypy comes with a set of flags that you can turn on to flag instances of the <code class="calibre17">Any</code> type.</p>

<p class="author1">For instance, you can turn on the <code class="calibre17">--disallow-any-expr</code> option to flag any expression that has an <code class="calibre17">Any</code> type. The following code will fail with that option turned on:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">from</code> <code class="nn">typing</code> <code class="k">import</code> <code class="n">Any</code>
<code class="n">x</code><code class="calibre17">:</code> <code class="n">Any</code> <code class="calibre17">=</code> <code class="mi">1</code>
<code class="n">y</code> <code class="calibre17">=</code> <code class="n">x</code> <code class="calibre17">+</code> <code class="mi">1</code></pre>
<pre class="calibre35">test.py:4: error: Expression has type "Any"
Found 1 error in 1 file (checked 1 source file)</pre>

<p class="author1">Another option I like for disallowing <code class="calibre17">Any</code> in type declarations (such as in collections) is <code class="calibre17">--disallow-any-generics</code>. <a data-type="indexterm" data-primary="generics" data-secondary="disallowing Any type for" id="idm45644746624296" class="calibre5"/>This catches the use of <code class="calibre17">Any</code> for anything using a generic (such as collection types). The following code fails to typecheck with this option turned on:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="n">x</code><code class="calibre17">:</code> <code class="nb">list</code> <code class="calibre17">=</code> <code class="calibre17">[</code><code class="mi">1</code><code class="calibre17">,</code><code class="mi">2</code><code class="calibre17">,</code><code class="mi">3</code><code class="calibre17">,</code><code class="mi">4</code><code class="calibre17">]</code></pre>

<p class="author1">You would need to use <code class="calibre17">list[int]</code> explicitly to get this code to work.</p>

<p class="author1">You can check out all the ways to disable the use of <code class="calibre17">Any</code> in the <a href="https://oreil.ly/Fmspo" class="calibre5">mypy dynamic typing documentation</a>.</p>

<p class="author1">Be careful with disabling <code class="calibre17">Any</code> too broadly, though. There is a valid use case of <code class="calibre17">Any</code> that <a data-type="indexterm" data-primary="Any type" data-secondary="valid use case for" id="idm45644746609320" class="calibre5"/>you don’t want to flag erroneously. <code class="calibre17">Any</code> should be reserved for when you absolutely don’t care what type something is and that it is up to the caller to verify the type. A prime example is a heterogeneous key-value store (perhaps a general-purpose cache).</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Requiring types" class="preface"><div class="preface" id="idm45644746675800">
<h3 class="calibre44">Requiring types</h3>

<p class="author1">An expression is <em class="calibre6">untyped</em> if there is no type annotation. <a data-type="indexterm" data-primary="typecheckers" data-secondary="configuring mypy" data-tertiary="requiring types" id="idm45644746605464" class="calibre5"/><a data-type="indexterm" data-primary="mypy typechecker" data-secondary="configuring" data-tertiary="requiring types" id="idm45644746583848" class="calibre5"/><a data-type="indexterm" data-primary="types" data-secondary="requiring with typechecker" id="idm45644746582632" class="calibre5"/><a data-type="indexterm" data-primary="untyped expressions" id="idm45644746581720" class="calibre5"/>In these cases, mypy treats the result of that expression as an <code class="calibre17">Any</code> type if it can’t otherwise infer the type. However, the previous checks for disallowing <code class="calibre17">Any</code> will not catch where a function is left untyped. There is a separate set of flags for checking for untyped functions.</p>

<p class="author1">This code will not error out in a typechecker unless the <code class="calibre17">--disallow-untyped-defs</code> option is set:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">def</code> <code class="nf">plus_four</code><code class="calibre17">(</code><code class="n">x</code><code class="calibre17">):</code>
    <code class="k">return</code> <code class="n">x</code> <code class="calibre17">+</code> <code class="mi">4</code></pre>

<p class="author1">With that option set, you receive the following error:</p>
<pre class="calibre35">test.py:4: error: Function is missing a type annotation</pre>

<p class="author1">If this is too severe for you, you might want to check out <code class="calibre17">--disallow-incomplete-defs</code>, which only flags functions if they only have some variables/return values annotated (but not all), or <code class="calibre17">--disallow-untyped-calls</code>, which only flags calls from annotated functions to unannotated functions. You’ll find all the different options concerning untyped functions in the <a href="https://oreil.ly/pOvWs" class="calibre5">mypy documentation</a>.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Handling None/Optional" class="preface"><div class="preface" id="idm45644746575768">
<h3 class="calibre44">Handling None/Optional</h3>

<p class="author1">In <a data-type="xref" href="part0007_split_000.html#constraints" class="calibre5">Chapter 4</a>, you learned how easy it was to make the “billion-dollar mistake” when using <code class="calibre17">None</code> values.<a data-type="indexterm" data-primary="typecheckers" data-secondary="configuring mypy" data-tertiary="handling None/Optional" id="idm45644746537128" class="calibre5"/><a data-type="indexterm" data-primary="None values" data-secondary="handling with typechecker" id="idm45644746535848" class="calibre5"/><a data-type="indexterm" data-primary="Optional types" data-secondary="handling with typechecker" id="idm45644746534936" class="calibre5"/><a data-type="indexterm" data-primary="mypy typechecker" data-secondary="configuring" data-tertiary="handling None/Optional" id="idm45644746534024" class="calibre5"/> If you turn on no other options, make sure that you have <span class="calibre"><code class="calibre17">--strict-optional</code></span> turned on in your typechecker to catch these costly errors. You absolutely want to be checking that your use of <code class="calibre17">None</code> is not hiding any latent bugs.</p>

<p class="author1">When using <code class="calibre17">--strict-optional</code>, you must explicitly perform <code class="calibre17">is None</code> checks; otherwise, your code will fail typechecking.</p>

<p class="author1">If <code class="calibre17">--strict-optional</code> is set (the default is different depending on the mypy version, so be sure to double-check), this code should fail:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">from</code> <code class="nn">typing</code> <code class="k">import</code> <code class="n">Optional</code>
<code class="n">x</code><code class="calibre17">:</code> <code class="n">Optional</code><code class="calibre17">[</code><code class="nb">int</code><code class="calibre17">]</code> <code class="calibre17">=</code> <code class="nb">None</code>
<code class="k">print</code><code class="calibre17">(</code><code class="n">x</code> <code class="calibre17">+</code> <code class="mi">5</code><code class="calibre17">)</code></pre>
<pre class="calibre35">test.py:3: error: Unsupported operand types for + ("None" and "int")
test.py:3: note: Left operand is of type "Optional[int]"</pre>

<p class="author1">It’s worth noting that mypy also treats <code class="calibre17">None</code> values as <code class="calibre17">Optional</code>s implicitly. I recommend turning this off, so that you are being more explicit in your code. For example:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">def</code> <code class="nf">foo</code><code class="calibre17">(</code><code class="n">x</code><code class="calibre17">:</code> <code class="nb">int</code> <code class="calibre17">=</code> <code class="nb">None</code><code class="calibre17">)</code> <code class="calibre17">-&gt;</code> <code class="nb">None</code><code class="calibre17">:</code>
    <code class="k">print</code><code class="calibre17">(</code><code class="n">x</code><code class="calibre17">)</code></pre>

<p class="author1">The parameter <code class="calibre17">x</code> is implicitly converted to an <code class="calibre17">Optional[int]</code>, since <code class="calibre17">None</code> is a valid value for it. If you were to do any integer operations on <code class="calibre17">x</code>, the typechecker would flag it. However, it’s better to be more explicit and express that a value can be <code class="calibre17">None</code> (to disambiguate for future readers).</p>

<p class="author1">You can set <code class="calibre17">--no-implicit-optional</code> in order to get an error, forcing you to specify <code class="calibre17">Optional</code>. If you were to typecheck the above code with this option set, you would see:</p>
<pre class="calibre35">test.py:2: error: Incompatible default for argument "x"
          (default has type "None", argument has type "int")</pre>
</div></section>



</div></section>













</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Customizing Your Typechecker" class="preface">
<div class="preface" id="typechecker">
<section data-type="sect1" data-pdf-bookmark="Configuring Your Typechecker" class="preface">
<div class="preface" id="idm45644746845416">
<section data-type="sect2" data-pdf-bookmark="Mypy Reporting" class="preface"><div class="preface" id="idm45644746575144">
<h2 class="calibre34" id="calibre_pb_3">Mypy Reporting</h2>

<p class="author1">If a typechecker fails in the forest and nobody is around to see it, does it print an error message? <a data-type="indexterm" data-primary="typecheckers" data-secondary="configuring mypy" data-tertiary="reporting by mypy" id="idm45644746475160" class="calibre5"/><a data-type="indexterm" data-primary="reporting (mypy)" id="idm45644746473912" class="calibre5"/><a data-type="indexterm" data-primary="mypy typechecker" data-secondary="configuring" data-tertiary="reporting" id="idm45644746442792" class="calibre5"/>How do you know that mypy is actually checking your files, and that it will actually catch errors? Use mypy’s built-in reporting techniques to better visualize results.</p>

<p class="author1">First, you can get an HTML report about how many lines of code mypy was able to check by passing in <code class="calibre17">--html-report</code> to mypy. This produces a HTML file that will provide a table similar to the one pictured in <a data-type="xref" href="part0009_split_003.html#mypy_report" class="calibre5">Figure 6-1</a>.</p>

<figure class="calibre36"><div id="mypy_report" class="figure">
<img src="../images/00009.jpeg" alt="HTML report from running mypy on the mypy source code" class="calibre40"/>
<h6 class="calibre37"><span class="calibre">Figure 6-1. </span>HTML report from running mypy on the mypy source code</h6>
</div></figure>
<div data-type="tip" class="calibre21"><h6 class="calibre22">Tip</h6>
<p class="author1">If you want a plain-text file, you can use <code class="calibre17">--linecount-report</code> instead.</p>
</div>

<p class="author1">Mypy also allows you to track explicit <code class="calibre17">Any</code> expressions to understand how you are doing on a line-by-line basis.<a data-type="indexterm" data-primary="Any type" data-secondary="mypy tracking of Any expressions" id="idm45644746434696" class="calibre5"/> When using the <code class="calibre17">--any-exprs-report</code> command-line option, mypy will create a text file enumerating per-module statistics for how many times you use <code class="calibre17">Any</code>. This is very useful for seeing how explicit your type annotations are across a codebase. Here are the first few lines from running the <code class="calibre17">--any-exprs-report</code> option on the mypy codebase itself:</p>
<pre class="calibre35">                  Name   Anys    Exprs   Coverage
--------------------------------------------------
         mypy.__main__      0       29    100.00%
              mypy.api      0       57    100.00%
        mypy.applytype      0      169    100.00%
           mypy.argmap      0      394    100.00%
           mypy.binder      0      817    100.00%
       mypy.bogus_type      0       10    100.00%
            mypy.build     97     6257     98.45%
          mypy.checker     10    12914     99.92%
        mypy.checkexpr     18    10646     99.83%
      mypy.checkmember      6     2274     99.74%
   mypy.checkstrformat     53     2271     97.67%
    mypy.config_parser     16      737     97.83%</pre>

<p class="author1">If you’d like more machine-readable formats, you can use the <code class="calibre17">--junit-xml</code> option to create an XML file in the JUnit format<a data-type="indexterm" data-primary="XML file in JUnit format (mypy reporting)" id="idm45644746430184" class="calibre5"/>. Most continuous integration systems can parse this format, making it ideal for automated report generation as part of your build system. To learn about all the different reporting options, check out the mypy <a href="https://oreil.ly/vVRsm" class="calibre5">report-generation documentation</a>.</p>
</div></section>













</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Customizing Your Typechecker" class="preface">
<div class="preface" id="typechecker">
<section data-type="sect1" data-pdf-bookmark="Configuring Your Typechecker" class="preface">
<div class="preface" id="idm45644746845416">
<section data-type="sect2" data-pdf-bookmark="Speeding Up mypy" class="preface"><div class="preface" id="idm45644746428248">
<h2 class="calibre34" id="calibre_pb_4">Speeding Up mypy</h2>

<p class="author1">One of the common complaints about mypy is the time it takes to typecheck large codebases.<a data-type="indexterm" data-primary="typecheckers" data-secondary="configuring mypy" data-tertiary="speeding up mypy" id="idm45644746403000" class="calibre5"/><a data-type="indexterm" data-primary="mypy typechecker" data-secondary="configuring" data-tertiary="speeding up mypy" id="idm45644746401912" class="calibre5"/><a data-type="indexterm" data-primary="speeding up mypy" id="idm45644746400824" class="calibre5"/><a data-type="indexterm" data-primary="caches (mypy)" id="idm45644746400216" class="calibre5"/> By default, mypy <em class="calibre6">incrementally</em> checks files. That is, it uses a cache (typically a <em class="calibre6">.mypy_cache</em> folder, but the location is also configurable) to check only what has changed since last typecheck. This does speed up typechecking, but as your codebase gets larger, your typechecker will take longer to run, no matter what. This is detrimental for fast feedback during development cycles. The longer a tool takes to provide useful feedback to developers, the less often developers will run the tool, thus defeating the purpose. It is in everyone’s interest for typecheckers to run as fast as possible, so that developers are getting type errors at near real time.</p>

<p class="author1">In order to speed up mypy even more, you may want to consider a <em class="calibre6">remote cache</em>. A remote cache provides a way of caching your mypy typechecks somewhere accessible to your entire team.<a data-type="indexterm" data-primary="remote cache (mypy)" id="idm45644746397112" class="calibre5"/> This way, you can cache results based on specific commit IDs in your version control and share typechecker information. Building this system is outside the scope of this book, but the <a href="https://oreil.ly/5gO9N" class="calibre5">remote cache documentation</a> in mypy will provide a solid start.</p>

<p class="author1">You also should consider mypy in daemon mode.<a data-type="indexterm" data-primary="daemon mode (mypy)" id="idm45644746394872" class="calibre5"/> Daemon mode is when mypy runs as a standalone process, and keeps the previous mypy state in memory rather than on a file system (or across a network link). You can start a mypy daemon by running <code class="calibre17">dmypy run -- mypy-flags &lt;mypy-files&gt;</code>. Once the daemon is running, you can run the exact same command to check the files again.</p>

<p class="author1">For instance, I ran mypy on the mypy source code itself. My initial run took 23 seconds. Subsequent typechecks on my system took between 16 and 18 seconds. This is <em class="calibre6">technically</em> faster, but I would not consider it fast. When I use the mypy daemon, though, my subsequent runs ended up being under half a second. With times like that, I can run my typechecker much more often to get feedback faster.<a data-type="indexterm" data-primary="typecheckers" data-secondary="configuring mypy" data-startref="ix_typckcfg" id="idm45644746392072" class="calibre5"/><a data-type="indexterm" data-primary="mypy typechecker" data-secondary="configuring" data-startref="ix_mypycfg" id="idm45644746390824" class="calibre5"/> Check out more about dmypy in the <a href="https://oreil.ly/6Coxe" class="calibre5">mypy daemon mode documentation</a>.</p>
</div></section>





</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Customizing Your Typechecker" class="preface">
<div class="preface" id="typechecker">
<section data-type="sect1" data-pdf-bookmark="Alternative Typecheckers" class="preface"><div class="preface" id="idm45644746844824">
<h1 class="calibre12" id="calibre_pb_5">Alternative Typecheckers</h1>

<p class="author1">Mypy is highly <a data-type="indexterm" data-primary="typecheckers" data-secondary="alternatives to mypy" id="ix_typckalt" class="calibre5"/>configurable, and its wealth of options will let you decide on the exact behavior you are looking for,  but it won’t meet all of your needs all of the time. It isn’t the only typechecker out there. I’d like to introduce two other typecheckers: Pyre (written by Facebook) and Pyright (written by Microsoft).</p>








</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Customizing Your Typechecker" class="preface">
<div class="preface" id="typechecker">
<section data-type="sect1" data-pdf-bookmark="Alternative Typecheckers" class="preface">
<div class="preface" id="idm45644746844824">
<section data-type="sect2" data-pdf-bookmark="Pyre" class="preface"><div class="preface" id="idm45644746385576">
<h2 class="calibre34" id="calibre_pb_6">Pyre</h2>

<p class="author1">You can install <a data-type="indexterm" data-primary="typecheckers" data-secondary="alternatives to mypy" data-tertiary="Pyre" id="ix_typckaltPyre" class="calibre5"/><a data-type="indexterm" data-primary="Pyre typechecker" id="ix_Pyre" class="calibre5"/>Pyre with <code class="calibre17">pip</code>:</p>

<pre data-type="programlisting" class="calibre35">pip install pyre-check</pre>

<p class="author1"><a href="https://pyre-check.org" class="calibre5">Pyre</a> runs very similarly to mypy’s daemon mode. A separate process will run, from which you can ask for typechecking results. To typecheck your code, you need to set up Pyre (by running <code class="calibre17">pyre init</code>) in your project directory, and then run <code class="calibre17">pyre</code> to start the daemon. From here, the information you receive is pretty similar to mypy. However, there are two features that set Pyre apart from other typecheckers: codebase querying and the Python Static Analyzer (Pysa) framework.</p>










<section data-type="sect3" data-pdf-bookmark="Codebase querying" class="preface"><div class="preface" id="idm45644746377864">
<h3 class="calibre44">Codebase querying</h3>

<p class="author1">Once the <code class="calibre17">pyre</code> daemon is running, there are a lot of cool queries you can make to inspect your codebase.<a data-type="indexterm" data-primary="Pyre typechecker" data-secondary="codebase querying" id="idm45644746375640" class="calibre5"/><a data-type="indexterm" data-primary="codebase querying with Pyre" id="idm45644746374664" class="calibre5"/> I’ll use the mypy codebase as an example codebase for all of the following queries.<a data-type="indexterm" data-primary="classes" data-secondary="attributes of, Pyre query of codebase for" id="idm45644746373848" class="calibre5"/></p>

<p class="author1">For instance, I can learn about the attributes of any class in my codebase:</p>
<pre class="calibre35">pyre query "attributes(mypy.errors.CompileError)" <a class="calibre5" id="co_customizing_your_typechecker_CO1-1" href="part0009_split_006.html#callout_customizing_your_typechecker_CO1-1"><img src="../images/00002.gif" alt="1" class="calibre40"/></a>

{
   "response": {
       "attributes": [
           {
               "name": "__init__", <a class="calibre5" id="co_customizing_your_typechecker_CO1-2" href="part0009_split_006.html#callout_customizing_your_typechecker_CO1-2"><img src="../images/00005.gif" alt="2" class="calibre40"/></a>
               "annotation": "BoundMethod[
				typing.Callable(
                                   mypy.errors.CompileError.__init__)
                              [[Named(self, mypy.errors.CompileError),
                                Named(messages, typing.list[str]),
                                Named(use_stdout, bool, default),
                                Named(module_with_blocker,
                                typing.Optional[str], default)], None],
                                mypy.errors.CompileError]",
               "kind": "regular",
               "final": false
           },
           {
               "name": "messages", <a class="calibre5" id="co_customizing_your_typechecker_CO1-3" href="part0009_split_006.html#callout_customizing_your_typechecker_CO1-3"><img src="../images/00006.gif" alt="3" class="calibre40"/></a>
               "annotation": "typing.list[str]",
               "kind": "regular",
               "final": false
           },
           {
               "name": "module_with_blocker", <a class="calibre5" id="co_customizing_your_typechecker_CO1-4" href="part0009_split_006.html#callout_customizing_your_typechecker_CO1-4"><img src="../images/00007.gif" alt="4" class="calibre40"/></a>
               "annotation": "typing.Optional[str]",
               "kind": "regular",
               "final": false
           },
           {
               "name": "use_stdout", <a class="calibre5" id="co_customizing_your_typechecker_CO1-5" href="part0009_split_006.html#callout_customizing_your_typechecker_CO1-5"><img src="../images/00008.gif" alt="5" class="calibre40"/></a>
               "annotation": "bool",
               "kind": "regular",
               "final": false
           }
       ]
   }
}</pre>
<dl class="calibre13">
<dt class="calibre14"><a class="calibre5" id="callout_customizing_your_typechecker_CO1-1" href="part0009_split_006.html#co_customizing_your_typechecker_CO1-1"><img src="../images/00002.gif" alt="1" class="calibre40"/></a></dt>
<dd class="calibre41"><p class="calibre42">Pyre query for attributes</p></dd>
<dt class="calibre14"><a class="calibre5" id="callout_customizing_your_typechecker_CO1-2" href="part0009_split_006.html#co_customizing_your_typechecker_CO1-2"><img src="../images/00005.gif" alt="2" class="calibre40"/></a></dt>
<dd class="calibre41"><p class="calibre42">A description of the constructor</p></dd>
<dt class="calibre14"><a class="calibre5" id="callout_customizing_your_typechecker_CO1-3" href="part0009_split_006.html#co_customizing_your_typechecker_CO1-3"><img src="../images/00006.gif" alt="3" class="calibre40"/></a></dt>
<dd class="calibre41"><p class="calibre42">A list of strings for messages</p></dd>
<dt class="calibre14"><a class="calibre5" id="callout_customizing_your_typechecker_CO1-4" href="part0009_split_006.html#co_customizing_your_typechecker_CO1-4"><img src="../images/00007.gif" alt="4" class="calibre40"/></a></dt>
<dd class="calibre41"><p class="calibre42">An <code class="calibre17">Optional</code> string describing a module with blocker</p></dd>
<dt class="calibre14"><a class="calibre5" id="callout_customizing_your_typechecker_CO1-5" href="part0009_split_006.html#co_customizing_your_typechecker_CO1-5"><img src="../images/00008.gif" alt="5" class="calibre40"/></a></dt>
<dd class="calibre41"><p class="calibre42">A flag indicating printing to a screen</p></dd>
</dl>

<p class="author1">Look at all this information I can find out about the attributes in a class! I can see their type annotations to understand how the tool sees these attributes. This is incredibly handy in exploring classes as well.</p>

<p class="author1">Another<a data-type="indexterm" data-primary="Pyre typechecker" data-secondary="codebase querying" data-tertiary="getting callees of any function" id="idm45644746346648" class="calibre5"/> cool query is the <code class="calibre17">callees</code> of any function:</p>
<pre class="calibre35">pyre query "callees(mypy.errors.remove_path_prefix)"

{
   "response": {
       "callees": [
           {
               "kind": "function", <a class="calibre5" id="co_customizing_your_typechecker_CO2-1" href="part0009_split_006.html#callout_customizing_your_typechecker_CO2-1"><img src="../images/00002.gif" alt="1" class="calibre40"/></a>
               "target": "len"
           },
           {
               "kind": "method", <a class="calibre5" id="co_customizing_your_typechecker_CO2-2" href="part0009_split_006.html#callout_customizing_your_typechecker_CO2-2"><img src="../images/00005.gif" alt="2" class="calibre40"/></a>
               "is_optional_class_attribute": false,
               "direct_target": "str.__getitem__",
               "class_name": "str",
               "dispatch": "dynamic"
           },
           {
               "kind": "method", <a class="calibre5" id="co_customizing_your_typechecker_CO2-3" href="part0009_split_006.html#callout_customizing_your_typechecker_CO2-3"><img src="../images/00006.gif" alt="3" class="calibre40"/></a>
               "is_optional_class_attribute": false,
               "direct_target": "str.startswith",
               "class_name": "str",
               "dispatch": "dynamic"
           },
           {
               "kind": "method", <a class="calibre5" id="co_customizing_your_typechecker_CO2-4" href="part0009_split_006.html#callout_customizing_your_typechecker_CO2-4"><img src="../images/00007.gif" alt="4" class="calibre40"/></a>
               "is_optional_class_attribute": false,
               "direct_target": "slice.__init__",
               "class_name": "slice",
               "dispatch": "static"
           }
       ]
   }
}</pre>
<dl class="calibre13">
<dt class="calibre14"><a class="calibre5" id="callout_customizing_your_typechecker_CO2-1" href="part0009_split_006.html#co_customizing_your_typechecker_CO2-1"><img src="../images/00002.gif" alt="1" class="calibre40"/></a></dt>
<dd class="calibre41"><p class="calibre42">Calls the length function</p></dd>
<dt class="calibre14"><a class="calibre5" id="callout_customizing_your_typechecker_CO2-2" href="part0009_split_006.html#co_customizing_your_typechecker_CO2-2"><img src="../images/00005.gif" alt="2" class="calibre40"/></a></dt>
<dd class="calibre41"><p class="calibre42">Calls the string.<em class="calibre6">getitem</em> function (such as <code class="calibre17">str[0]</code>)</p></dd>
<dt class="calibre14"><a class="calibre5" id="callout_customizing_your_typechecker_CO2-3" href="part0009_split_006.html#co_customizing_your_typechecker_CO2-3"><img src="../images/00006.gif" alt="3" class="calibre40"/></a></dt>
<dd class="calibre41"><p class="calibre42">Calls the <code class="calibre17">startswith</code> function on a string</p></dd>
<dt class="calibre14"><a class="calibre5" id="callout_customizing_your_typechecker_CO2-4" href="part0009_split_006.html#co_customizing_your_typechecker_CO2-4"><img src="../images/00007.gif" alt="4" class="calibre40"/></a></dt>
<dd class="calibre41"><p class="calibre42">Initializes a list slice (such as <code class="calibre17">str[3:8]</code>)</p></dd>
</dl>

<p class="author1">The typechecker needs to store all this information to do its job. It’s a huge bonus that you can query the information as well. I could write a whole extra book on what you can do with this information, but for now, check out the <a href="https://oreil.ly/X4h0h" class="calibre5">Pyre query documentation</a>. You will learn about different queries you can execute, such as observing class hierarchies, call graphs, and more.<a data-type="indexterm" data-primary="Pyre typechecker" data-secondary="query documentation" id="idm45644746322040" class="calibre5"/> These queries allow you to learn more about your codebase or to build new tools to better understand your codebase (and catch other types of errors that a typechecker can’t, such as temporal dependencies, which I’ll cover in <a data-type="xref" href="part0019.html#part_3" class="calibre5">Part III</a>).</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Python Static Analyzer (Pysa)" class="preface"><div class="preface" id="idm45644746377240">
<h3 class="calibre44">Python Static Analyzer (Pysa)</h3>

<p class="author1"><em class="calibre6">Pysa</em> (pronounced like the Leaning Tower of Pisa) is a static code analyzer built into Pyre.<a data-type="indexterm" data-primary="Pyre typechecker" data-secondary="Pysa" id="ix_PyrePysa" class="calibre5"/><a data-type="indexterm" data-primary="Pysa (Python Static Analyzer)" id="ix_Pysa" class="calibre5"/> Pysa specializes in a type of security static analysis known as <em class="calibre6">taint analysis</em>. Taint analysis is the tracking of potentially tainted data, such as user-supplied input.<a data-type="indexterm" data-primary="taint analysis" id="idm45644746315160" class="calibre5"/> The tainted data is tracked for the entire life cycle of the data; Pyre makes sure that any tainted data cannot propagate to a system in an insecure fashion.</p>

<p class="author1">Let me walk you through the process to catch a simple security flaw (modified from the <a href="https://oreil.ly/l8gK8" class="calibre5">Pyre documentation</a>). Consider the case where a user creates a new recipe in a filesystem:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">import</code> <code class="nn">os</code>

<code class="k">def</code> <code class="nf">create_recipe</code><code class="calibre17">():</code>
   <code class="n">recipe</code> <code class="calibre17">=</code> <code class="nb">input</code><code class="calibre17">(</code><code class="s">"Enter in recipe"</code><code class="calibre17">)</code>
   <code class="n">create_recipe_on_disk</code><code class="calibre17">(</code><code class="n">recipe</code><code class="calibre17">)</code>

<code class="k">def</code> <code class="nf">create_recipe_on_disk</code><code class="calibre17">(</code><code class="n">recipe</code><code class="calibre17">):</code>
   <code class="n">command</code> <code class="calibre17">=</code> <code class="s">"touch ~/food_data/{}.json"</code><code class="calibre17">.</code><code class="n">format</code><code class="calibre17">(</code><code class="n">recipe</code><code class="calibre17">)</code>
   <code class="k">return</code> <code class="n">os</code><code class="calibre17">.</code><code class="n">system</code><code class="calibre17">(</code><code class="n">command</code><code class="calibre17">)</code></pre>

<p class="author1">This looks pretty innocuous. A user can enter in <code class="calibre17">carrots</code> to create the file <span class="calibre"><em class="calibre6">~/food_data/carrots.json</em></span>. But what if a user enters in <code class="calibre17">carrots; ls ~;</code>? If this were entered, it would print out the entire home directory (the command becomes <code class="calibre17">touch ~/food_data/carrots; ls ~;.json</code>). Based on input, a malicious user could enter in arbitrary commands on your server (this is known as remote code execution [RCE]), which is a huge security risk.</p>

<p class="author1">Pysa provides tools to check this. I can specify that anything coming from <code class="calibre17">input()</code> is potentially tainted data (known as a <em class="calibre6">taint source</em>), and anything passed to <code class="calibre17">os.system</code> should not be tainted (known as a <em class="calibre6">taint sink</em>).<a data-type="indexterm" data-primary="taint analysis" data-secondary="taint source, taint sink, and taint model" id="idm45644746269128" class="calibre5"/> With this information, I need to build a <em class="calibre6">taint model</em>, which is a set of rules for detecting potential security holes.  First, I must specify a <em class="calibre6">taint.config</em> file:</p>
<pre class="calibre35">{
  sources: [
    {
      name: "UserControlled", <a class="calibre5" id="co_customizing_your_typechecker_CO3-1" href="part0009_split_006.html#callout_customizing_your_typechecker_CO3-1"><img src="../images/00002.gif" alt="1" class="calibre40"/></a>
      comment: "use to annotate user input"
    }
  ],

  sinks: [
    {
      name: "RemoteCodeExecution", <a class="calibre5" id="co_customizing_your_typechecker_CO3-2" href="part0009_split_006.html#callout_customizing_your_typechecker_CO3-2"><img src="../images/00005.gif" alt="2" class="calibre40"/></a>
      comment: "use to annotate execution of code"
    }
  ],

  features: [],

  rules: [
    {
      name: "Possible shell injection", <a class="calibre5" id="co_customizing_your_typechecker_CO3-3" href="part0009_split_006.html#callout_customizing_your_typechecker_CO3-3"><img src="../images/00006.gif" alt="3" class="calibre40"/></a>
      code: 5001,
      sources: [ "UserControlled" ],
      sinks: [ "RemoteCodeExecution" ],
      message_format: "Data from [{$sources}] source(s) may reach " +
                      "[{$sinks}] sink(s)"
    }
  ]
}</pre>
<dl class="calibre13">
<dt class="calibre14"><a class="calibre5" id="callout_customizing_your_typechecker_CO3-1" href="part0009_split_006.html#co_customizing_your_typechecker_CO3-1"><img src="../images/00002.gif" alt="1" class="calibre40"/></a></dt>
<dd class="calibre41"><p class="calibre42">Specify an annotation for user-controlled input.</p></dd>
<dt class="calibre14"><a class="calibre5" id="callout_customizing_your_typechecker_CO3-2" href="part0009_split_006.html#co_customizing_your_typechecker_CO3-2"><img src="../images/00005.gif" alt="2" class="calibre40"/></a></dt>
<dd class="calibre41"><p class="calibre42">Specify an annotation for RCE flaws.</p></dd>
<dt class="calibre14"><a class="calibre5" id="callout_customizing_your_typechecker_CO3-3" href="part0009_split_006.html#co_customizing_your_typechecker_CO3-3"><img src="../images/00006.gif" alt="3" class="calibre40"/></a></dt>
<dd class="calibre41"><p class="calibre42">Specify a rule that makes any tainted data from <code class="calibre17">UserControlled</code> sources an error if it ends up in a <code class="calibre17">RemoteCodeExecution</code> sink.</p></dd>
</dl>

<p class="author1">From there, I must specify a taint model to annotate these sources as tainted:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="c"># stubs/taint/general.pysa</code>

 <code class="c"># model for raw_input</code>
<code class="k">def</code> <code class="nf">input</code><code class="calibre17">(</code><code class="n">__prompt</code> <code class="calibre17">=</code> <code class="calibre17">...</code><code class="calibre17">)</code> <code class="calibre17">-&gt;</code> <code class="n">TaintSource</code><code class="calibre17">[</code><code class="n">UserControlled</code><code class="calibre17">]:</code> <code class="calibre17">...</code>

<code class="c"># model for os.system</code>
<code class="k">def</code> <code class="nf">os</code><code class="calibre17">.</code><code class="n">system</code><code class="calibre17">(</code><code class="n">command</code><code class="calibre17">:</code> <code class="n">TaintSink</code><code class="calibre17">[</code><code class="n">RemoteCodeExecution</code><code class="calibre17">]):</code> <code class="calibre17">...</code></pre>

<p class="author1">These stubs tell Pysa through type annotations about where your taint sources and sinks are in your system.</p>

<p class="author1">Finally, you need to tell Pyre to detect tainted information by modifying the <code class="calibre17">.pyre_configuration</code> to add in your directory:</p>
<pre class="calibre35">"source_directories": ["."],
"taint_models_path": ["stubs/taint"]</pre>

<p class="author1">Now, when I run <code class="calibre17">pyre analyze</code> on that code, Pysa flags an error.</p>
<pre class="calibre35">[
    {
        "line": 9,
        "column": 26,
        "stop_line": 9,
        "stop_column": 32,
        "path": "insecure.py",
        "code": 5001,
        "name": "Possible shell injection",
        "description":
            "Possible shell injection [5001]: " +
            "Data from [UserControlled] source(s) may reach " +
            "[RemoteCodeExecution] sink(s)",
        "long_description":
            "Possible shell injection [5001]: " +
            "Data from [UserControlled] source(s) may reach " +
            "[RemoteCodeExecution] sink(s)",
        "concise_description":
            "Possible shell injection [5001]: " +
            "Data from [UserControlled] source(s) may reach " + "
            "[RemoteCodeExecution] sink(s)",
        "inference": null,
        "define": "insecure.create_recipe"
    }
]</pre>

<p class="author1">In order to fix this, I either need to make this data flow impossible or run tainted data through a <em class="calibre6">sanitizer</em> function. Sanitizer functions take untrusted data and inspect/modify it so that it can be<a data-type="indexterm" data-primary="sanitizer functions" id="idm45644746191784" class="calibre5"/> trusted. Pysa allows you decorate functions with <code class="calibre17">@sanitize</code> to specify your sanitizers.<sup class="calibre11"><a data-type="noteref" id="idm45644746190568-marker" href="part0009_split_008.html#idm45644746190568" class="calibre5">3</a></sup></p>

<p class="author1">This was admittedly a simple example, but Pysa allows you to annotate your codebase to catch more complicated problems (such as SQL injection and cookie mismanagement). To learn everything that Pysa can do (including built-in common security flaw checking), check out the <a href="https://oreil.ly/lw7BP" class="calibre5">complete documentation</a>.<a data-type="indexterm" data-primary="Pyre typechecker" data-secondary="Pysa" data-startref="ix_PyrePysa" id="idm45644746187528" class="calibre5"/><a data-type="indexterm" data-primary="Pysa (Python Static Analyzer)" data-startref="ix_Pysa" id="idm45644746186248" class="calibre5"/><a data-type="indexterm" data-primary="typecheckers" data-secondary="alternatives to mypy" data-tertiary="Pyre" data-startref="ix_typckaltPyre" id="idm45644746185240" class="calibre5"/><a data-type="indexterm" data-primary="Pyre typechecker" data-startref="ix_Pyre" id="idm45644746183752" class="calibre5"/></p>
</div></section>



</div></section>













</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Customizing Your Typechecker" class="preface">
<div class="preface" id="typechecker">
<section data-type="sect1" data-pdf-bookmark="Alternative Typecheckers" class="preface">
<div class="preface" id="idm45644746844824">
<section data-type="sect2" class="preface" data-pdf-bookmark="Pyright"><div class="preface" id="idm45644746319336">
<h2 class="calibre34" id="calibre_pb_7">Pyright</h2>

<p class="author1"><a href="https://oreil.ly/VhZBj" class="calibre5">Pyright</a> is a typechecker designed by Microsoft.<a data-type="indexterm" data-primary="Pyright typechecker" id="idm45644746180312" class="calibre5"/><a data-type="indexterm" data-primary="typecheckers" data-secondary="alternatives to mypy" data-tertiary="Pyright" id="idm45644746179608" class="calibre5"/> I have found it to be the most configurable of the typecheckers I’ve come across. If you would like more control than your current typechecker, explore the <a href="https://oreil.ly/nwkne" class="calibre5">Pyright configuration documentation</a> for all that you can do. However, Pyright has an additional awesome feature: VS Code integration.</p>

<p class="author1">VS Code (also built by Microsoft) is an immensely popular code editor for developers.<a data-type="indexterm" data-primary="VS Code, Pylance extension" id="idm45644746176936" class="calibre5"/><a data-type="indexterm" data-primary="Pylance" id="idm45644746176168" class="calibre5"/> Microsoft leveraged the ownership of both tools to create a VS Code extension called <a href="https://oreil.ly/Y6WAC" class="calibre5">Pylance</a>. You can install Pylance from your VS Code extensions browser. Pylance is built upon Pyright and uses type annotations to provide a better code-editing experience. Before, I mentioned that autocomplete was a benefit of type annotations in IDEs, but Pylance takes it to the next level. Pylance offers the following features:</p>

<ul class="printings">
<li class="calibre9">
<p class="author1">Automatic insertion of imports based on your types</p>
</li>
<li class="calibre9">
<p class="author1">Tooltips with full type annotations based on signatures</p>
</li>
<li class="calibre9">
<p class="author1">Codebase browsing such as finding references or browsing a call graph</p>
</li>
<li class="calibre9">
<p class="author1">Real-time diagnostic checking</p>
</li>
</ul>

<p class="author1">It’s this last feature that sells Pylance/Pyright for me. Pylance has a setting that allows you to constantly run diagnostics in your whole workspace. This means that every time you edit a file, <code class="calibre17">pyright</code> will run across your entire workspace (and it runs fast, too) to look for additional areas that you broke. You don’t need to manually run any commands; it happens automatically. As someone who likes to refactor often, I find this tool invaluable for finding breakages early. Remember, you want to find your errors in as close to real time as possible.</p>

<p class="author1">I’ve pulled up the mypy source codebase again and have Pylance enabled and in workplace diagnostics mode. I want to change one type on line 19 from a <code class="calibre17">sequence</code> to a <code class="calibre17">tuple</code> and see how Pylance handles the change. The code snippet I’m changing is shown in <a data-type="xref" href="part0009_split_007.html#VS_code_before_editing" class="calibre5">Figure 6-2</a>.</p>

<figure class="calibre36"><div id="VS_code_before_editing" class="figure">
<img src="../images/00010.jpeg" alt="Problems in VS Code before editing" class="calibre40"/>
<h6 class="calibre37"><span class="calibre">Figure 6-2. </span>Problems in VS Code before editing</h6>
</div></figure>

<p class="author1">Notice at the bottom where my “Problems” are listed. The current view is showing issues in another file that imports and uses the current function I’m editing. Once I change the <code class="calibre17">paths</code> parameter from <code class="calibre17">sequence</code> to a <code class="calibre17">tuple</code>, see how the “Problems” change in <a data-type="xref" href="part0009_split_007.html#VS_code_after_editing" class="calibre5">Figure 6-3</a>.</p>

<p class="author1">Within half a second of saving my file, new errors have shown up in my “Problems” pane, telling me that I’ve just broken assumptions in calling code. I don’t have to wait to run a typechecker manually, or wait for a continuous integration (CI) process to yell at me; my errors show up right in my editor. If that doesn’t lead me to finding errors earlier, I don’t know what will.<a data-type="indexterm" data-primary="typecheckers" data-secondary="alternatives to mypy" data-startref="ix_typckalt" id="idm45644746133896" class="calibre5"/></p>

<figure class="calibre36"><div id="VS_code_after_editing" class="figure">
<img src="../images/00011.jpeg" alt="Problems in VS Code after editing" class="calibre40"/>
<h6 class="calibre37"><span class="calibre">Figure 6-3. </span>Problems in VS Code after editing</h6>
</div></figure>
</div></section>





</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Customizing Your Typechecker" class="preface">
<div class="preface" id="typechecker">
<section data-type="sect1" data-pdf-bookmark="Closing Thoughts" class="preface"><div class="preface" id="idm45644746130520">
<h1 class="calibre12" id="calibre_pb_8">Closing Thoughts</h1>

<p class="author1">Python typecheckers put a wealth of options at your disposal, and you need to be comfortable with advanced configuration to get the most out of your tooling. You can control severity options and reporting, or even use different typecheckers to reap benefits. As you evaluate tools and options, ask yourself how strict you want your typecheckers to be. As you increase the scope of errors that can be caught, you will increase the amount of time and effort needed to make your codebase compliant. However, the more informative you can make your code, the more robust it will be in its lifetime.</p>

<p class="author1">In the next chapter, I will talk about how to assess the trade-offs between benefits and costs associated with typechecking. You’ll learn how to identify important areas to typecheck and use strategies to mitigate your pain.<a data-type="indexterm" data-primary="typecheckers" data-startref="ix_typck" id="idm45644746127992" class="calibre5"/></p>
</div></section>







<div data-type="footnotes" class="calibre25"><p data-type="footnote" id="idm45644746850088" class="calibre26"><sup class="calibre27"><a href="part0009_split_000.html#idm45644746850088-marker" class="calibre5">1</a></sup> Jukka Lehtosalo. “Our Journey to Type Checking 4 Million Lines of Python.” <em class="calibre6">Dropbox.Tech</em> (blog). Dropbox, September 5, 2019. <a href="https://oreil.ly/4BK3k" class="calibre5"><em class="calibre6">https://oreil.ly/4BK3k</em></a>.</p><p data-type="footnote" id="idm45644746847016" class="calibre26"><sup class="calibre27"><a href="part0009_split_000.html#idm45644746847016-marker" class="calibre5">2</a></sup> Confucius and Arthur Waley. <em class="calibre6">The Analects of Confucius</em>. New York, NY: Random House, 1938.</p><p data-type="footnote" id="idm45644746190568" class="calibre26"><sup class="calibre27"><a href="part0009_split_006.html#idm45644746190568-marker" class="calibre5">3</a></sup> You can learn more about sanitizers at <a href="https://oreil.ly/AghGg" class="calibre5"><em class="calibre6">https://oreil.ly/AghGg</em></a>.</p></div></div></section></body></html>