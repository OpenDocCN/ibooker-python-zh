<html><head></head><body><section data-pdf-bookmark="Chapter 12. Wrangle and Mangle Data" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch_munging">&#13;
<h1><span class="label">Chapter 12. </span>Wrangle and Mangle Data</h1>&#13;
&#13;
<blockquote>&#13;
<p>If you torture the data enough, nature will always confess.</p>&#13;
<p data-type="attribution">Ronald Coase</p>&#13;
</blockquote>&#13;
&#13;
<p>Up to this point,&#13;
we’ve talked mainly about the Python language itself—its data types, code structures, syntax, and so on.&#13;
The rest of this book is about application of these&#13;
to real-world problems.</p>&#13;
&#13;
<p>In this chapter,&#13;
you’ll learn many practical techniques for taming data.&#13;
Sometimes, this is called <em>data munging</em>,&#13;
or the more businesslike <em>ETL</em>&#13;
(extract/transform/load) of the database world.&#13;
Although programming books usually don’t cover the topic&#13;
explicitly, programmers spend a lot of time trying to mold&#13;
data into the right shape for their purposes.</p>&#13;
&#13;
<p><a data-primary="data science" data-type="indexterm" id="idm45794991560888"/>The specialty called <em>data science</em> has become&#13;
very popular in the past few years.&#13;
A <em>Harvard Business Review</em> article called data scientist&#13;
the “sexiest job of the 21st century.”&#13;
If this meant in demand and well paying,&#13;
then okay, but there’s also more than enough drudgery.&#13;
Data science goes beyond the ETL requirements of databases,&#13;
often involving <em>machine learning</em> to unearth insights&#13;
that were not visible to human eyes.</p>&#13;
&#13;
<p>I’ll start with basic data formats and then work up to&#13;
the most useful new tools for data science.</p>&#13;
&#13;
<p>Data formats fall roughly into two categories:&#13;
<em>text</em> and <em>binary</em>.&#13;
Python <em>strings</em> are used for text data,&#13;
and this chapter includes string information that we’ve&#13;
skipped so far:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><em>Unicode</em> characters</p>&#13;
</li>&#13;
<li>&#13;
<p><em>Regular expression</em> pattern matching.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p class="pagebreak-before">Then, we jump to binary data, and two more of&#13;
Python’s built-in types:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><em>Bytes</em> for immutable eight-bit values</p>&#13;
</li>&#13;
<li>&#13;
<p><em>Bytearrays</em> for mutable ones</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Text Strings: Unicode" data-type="sect1"><div class="sect1" id="unicode">&#13;
<h1>Text Strings: Unicode</h1>&#13;
&#13;
<p><a data-primary="strings" data-secondary="Unicode" data-type="indexterm" id="ix_ch12-munging-asciidoc0"/><a data-primary="Unicode text strings" data-type="indexterm" id="ix_ch12-munging-asciidoc1"/>You saw the basics of Python strings in <a data-type="xref" href="ch05.html#ch_strings">Chapter 5</a>.&#13;
Now it’s time to really dig into <span class="keep-together">Unicode.</span></p>&#13;
&#13;
<p>Python 3 strings are Unicode character sequences,&#13;
not byte arrays.&#13;
This is, by far,&#13;
the single largest language change from Python 2.</p>&#13;
&#13;
<p><a data-primary="ASCII" data-type="indexterm" id="idm45794991543320"/>All of the text examples in this book thus far have&#13;
been plain old ASCII&#13;
(American Standard Code for Information Interchange).&#13;
ASCII was defined in the 1960s,&#13;
before mullets roamed the earth.&#13;
Computers then were the size of refrigerators,&#13;
and only slightly smarter.</p>&#13;
&#13;
<p><a data-primary="bytes" data-type="indexterm" id="idm45794991541944"/>The basic unit of computer storage is the <em>byte</em>,&#13;
which can store 256 unique values in its eight <em>bits</em>.&#13;
For various reasons, ASCII used only seven bits&#13;
(128 unique values):&#13;
26 uppercase letters,&#13;
26 lowercase letters,&#13;
10 digits,&#13;
some punctuation symbols,&#13;
some spacing characters,&#13;
and some nonprinting control codes.</p>&#13;
&#13;
<p>Unfortunately, the world&#13;
has more letters than ASCII provides.&#13;
You could have a hot dog at a diner,&#13;
but never a&#13;
Gewürztraminer<sup><a data-type="noteref" href="ch12.html#idm45794991539400" id="idm45794991539400-marker">1</a></sup>&#13;
at a café.&#13;
Many attempts have been made to cram more&#13;
letters and symbols into eight bits,&#13;
and you’ll see them at times.&#13;
Just a couple of those include:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><em>Latin-1</em>, or <em>ISO 8859-1</em></p>&#13;
</li>&#13;
<li>&#13;
<p>Windows code page <em>1252</em></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Each of these uses all eight bits, but even that’s&#13;
not enough, especially when you need non-European languages.&#13;
<em>Unicode</em> is an ongoing international standard to define&#13;
the characters of all the world’s languages,&#13;
plus symbols from mathematics and other fields.&#13;
And emojis!</p>&#13;
<blockquote>&#13;
<p>Unicode provides a unique number for every character,&#13;
no matter what the platform,&#13;
no matter what the program,&#13;
no matter what the language.</p>&#13;
<p data-type="attribution">The Unicode Consortium</p>&#13;
</blockquote>&#13;
&#13;
<p>The <a href="http://www.unicode.org/charts">Unicode Code Charts page</a>&#13;
has links to&#13;
all the currently defined character sets with images.&#13;
The latest version (12.0) defines more than 137,000 characters,&#13;
each with a unique name and identification number.&#13;
Python 3.8 handles all of these.&#13;
The characters are divided into eight-bit&#13;
sets called <em>planes</em>.&#13;
The first 256 planes are the <em>basic <span class="keep-together">multilingual</span> planes</em>.&#13;
See the Wikipedia page about&#13;
<a href="http://bit.ly/unicode-plane">Unicode planes</a>&#13;
for details.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Python 3 Unicode Strings" data-type="sect2"><div class="sect2" id="idm45794991528504">&#13;
<h2>Python 3 Unicode Strings</h2>&#13;
&#13;
<p><a data-primary="Python 3" data-secondary="Unicode text strings" data-type="indexterm" id="ix_ch12-munging-asciidoc2"/><a data-primary="Unicode text strings" data-secondary="in Python 3 strings" data-type="indexterm" id="ix_ch12-munging-asciidoc3"/>If you know the Unicode ID or name for a character,&#13;
you can use it in a Python string.&#13;
Here are some examples:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a data-primary="\u" data-type="indexterm" id="idm45794991522952"/>A <code>\u</code> followed by <em>four</em>&#13;
hex&#13;
numbers<sup><a data-type="noteref" href="ch12.html#idm45794991521032" id="idm45794991521032-marker">2</a></sup>&#13;
specifies&#13;
a character in one of Unicode’s 256 basic multilingual planes.&#13;
The first two are the plane number (<code>00</code> to <code>FF</code>),&#13;
and the next two are the index of the&#13;
character within the plane.&#13;
Plane <code>00</code> is good old ASCII,&#13;
and the character positions within that plane&#13;
are the same as ASCII.</p>&#13;
</li>&#13;
<li>&#13;
<p><a data-primary="\U" data-type="indexterm" id="idm45794991516424"/>For characters in the higher planes, we need more bits.&#13;
The Python escape sequence for these is <code>\U</code>&#13;
followed by <em>eight</em> hex characters;&#13;
the leftmost ones need to be <code>0</code>.</p>&#13;
</li>&#13;
<li>&#13;
<p><a data-primary="\N{name}" data-type="indexterm" id="idm45794991513304"/>For all characters,&#13;
<code>\N{<em><code>name</code></em>}</code> lets you&#13;
specify it by its standard <em>name</em>.&#13;
The&#13;
<a href="http://www.unicode.org/charts/charindex.html">Unicode Character&#13;
Name Index page</a>&#13;
lists these.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p><a data-primary="lookup() function" data-type="indexterm" id="idm45794991509512"/><a data-primary="name() function" data-type="indexterm" id="idm45794991508808"/><a data-primary="unicodedata module" data-type="indexterm" id="idm45794991508136"/>The Python <code>unicodedata</code> module has functions&#13;
that translate in both directions:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>lookup()</code>—Takes a case-insensitive name&#13;
and returns a Unicode character</p>&#13;
</li>&#13;
<li>&#13;
<p><code>name()</code>—Takes a Unicode character&#13;
and returns an uppercase name</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>In the following example,&#13;
we’ll write a test function that takes a Python Unicode character,&#13;
looks up its name,&#13;
and looks up the character again from the name&#13;
(it should match the original character):</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="k">def</code> <code class="nf">unicode_test</code><code class="p">(</code><code class="n">value</code><code class="p">):</code>&#13;
<code class="gp">... </code>    <code class="kn">import</code> <code class="nn">unicodedata</code>&#13;
<code class="gp">... </code>    <code class="n">name</code> <code class="o">=</code> <code class="n">unicodedata</code><code class="o">.</code><code class="n">name</code><code class="p">(</code><code class="n">value</code><code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="n">value2</code> <code class="o">=</code> <code class="n">unicodedata</code><code class="o">.</code><code class="n">lookup</code><code class="p">(</code><code class="n">name</code><code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="k">print</code><code class="p">(</code><code class="s">'value="</code><code class="si">%s</code><code class="s">", name="</code><code class="si">%s</code><code class="s">", value2="</code><code class="si">%s</code><code class="s">"'</code> <code class="o">%</code> <code class="p">(</code><code class="n">value</code><code class="p">,</code> <code class="n">name</code><code class="p">,</code> <code class="n">value2</code><code class="p">))</code>&#13;
<code class="gp">...</code></pre>&#13;
&#13;
<p>Let’s try some characters,&#13;
beginning with a plain ASCII letter:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">unicode_test</code><code class="p">(</code><code class="s">'A'</code><code class="p">)</code>&#13;
<code class="go">value="A", name="LATIN CAPITAL LETTER A", value2="A"</code></pre>&#13;
&#13;
<p class="pagebreak-before">ASCII punctuation:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">unicode_test</code><code class="p">(</code><code class="s">'$'</code><code class="p">)</code>&#13;
<code class="go">value="$", name="DOLLAR SIGN", value2="$"</code></pre>&#13;
&#13;
<p>A Unicode currency character:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">unicode_test</code><code class="p">(</code><code class="s">'</code><code class="se">\u00a2</code><code class="s">'</code><code class="p">)</code>&#13;
<code class="go">value="¢", name="CENT SIGN", value2="¢"</code></pre>&#13;
&#13;
<p>Another Unicode currency character:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">unicode_test</code><code class="p">(</code><code class="s">'</code><code class="se">\u20ac</code><code class="s">'</code><code class="p">)</code>&#13;
<code class="go">value="€", name="EURO SIGN", value2="€"</code></pre>&#13;
&#13;
<p>The only problem you could potentially run into is&#13;
limitations in the font you’re&#13;
using to display text.&#13;
Few fonts have images for all Unicode characters,&#13;
and might display some placeholder character&#13;
for missing ones.&#13;
For instance, here’s the Unicode symbol for <code>SNOWMAN</code>,&#13;
like symbols in dingbat fonts:</p>&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="o">&gt;&gt;&gt;</code> <code class="n">unicode_test</code><code class="p">(</code><code class="s">'</code><code class="se">\u2603</code><code class="s">'</code><code class="p">)</code>&#13;
<code class="n">value</code><code class="o">=</code>"☃"<code class="p">,</code> <code class="n">name</code><code class="o">=</code><code class="s">"SNOWMAN"</code><code class="p">,</code> <code class="n">value2</code><code class="o">=</code>"☃"</pre>&#13;
&#13;
<p>Suppose that we want to save the word <code>café</code> in a Python string.&#13;
One way is to copy and paste it from a file or website&#13;
and hope that it works:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">place</code> <code class="o">=</code> <code class="s">'café'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">place</code>&#13;
<code class="go">'café'</code></pre>&#13;
&#13;
<p>This worked because I copied and pasted from a source&#13;
that used UTF-8 encoding&#13;
(which we look at in a few pages) for its text.</p>&#13;
&#13;
<p>How can we specify that final <code>é</code> character?&#13;
If you look at the character index for&#13;
<a href="http://bit.ly/e-index">E</a>,&#13;
you see that the name&#13;
<code>E WITH ACUTE,</code> <code>LATIN SMALL LETTER</code>&#13;
has the value <code>00E9</code>.&#13;
Let’s check with the <code>name()</code> and <code>lookup()</code>&#13;
functions that we were just playing with.&#13;
First give the code to get the name:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">unicodedata</code><code class="o">.</code><code class="n">name</code><code class="p">(</code><code class="s">'</code><code class="se">\u00e9</code><code class="s">'</code><code class="p">)</code>&#13;
<code class="go">'LATIN SMALL LETTER E WITH ACUTE'</code></pre>&#13;
&#13;
<p>Next, give the name to look up the code:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">unicodedata</code><code class="o">.</code><code class="n">lookup</code><code class="p">(</code><code class="s">'E WITH ACUTE, LATIN SMALL LETTER'</code><code class="p">)</code>&#13;
<code class="gt">Traceback (most recent call last):</code>&#13;
  File <code class="nb">"&lt;stdin&gt;"</code>, line <code class="m">1</code>, in <code class="n">&lt;module&gt;</code>&#13;
<code class="gr">KeyError</code>: <code class="n">"undefined character name 'E WITH ACUTE, LATIN SMALL LETTER'"</code></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The names listed on the Unicode Character Name Index page&#13;
were reformatted to make them sort nicely for display.&#13;
To convert them to their real Unicode names&#13;
(the ones that Python uses),&#13;
remove the comma and move the&#13;
part of the name that was after the comma to the beginning.&#13;
Accordingly, change <code>E WITH ACUTE, LATIN SMALL LETTER</code>&#13;
to <code>LATIN SMALL LETTER E WITH ACUTE</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">unicodedata</code><code class="o">.</code><code class="n">lookup</code><code class="p">(</code><code class="s">'LATIN SMALL LETTER E WITH ACUTE'</code><code class="p">)</code>&#13;
<code class="go">'é'</code></pre>&#13;
</div>&#13;
&#13;
<p>Now we can specify the string <code>café</code> by code or by name:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">place</code> <code class="o">=</code> <code class="s">'caf</code><code class="se">\u00e9</code><code class="s">'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">place</code>&#13;
<code class="go">'café'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">place</code> <code class="o">=</code> <code class="s">'caf</code><code class="se">\N{LATIN SMALL LETTER E WITH ACUTE}</code><code class="s">'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">place</code>&#13;
<code class="go">'café'</code></pre>&#13;
&#13;
<p>In the preceding snippet,&#13;
we inserted the é directly in the string,&#13;
but we can also build a string by appending:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">u_umlaut</code> <code class="o">=</code> <code class="s">'</code><code class="se">\N{LATIN SMALL LETTER U WITH DIAERESIS}</code><code class="s">'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">u_umlaut</code>&#13;
<code class="go">'ü'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">drink</code> <code class="o">=</code> <code class="s">'Gew'</code> <code class="o">+</code> <code class="n">u_umlaut</code> <code class="o">+</code> <code class="s">'rztraminer'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">print</code><code class="p">(</code><code class="s">'Now I can finally have my'</code><code class="p">,</code> <code class="n">drink</code><code class="p">,</code> <code class="s">'in a'</code><code class="p">,</code> <code class="n">place</code><code class="p">)</code>&#13;
<code class="go">Now I can finally have my Gewürztraminer in a café</code></pre>&#13;
&#13;
<p><a data-primary="len() function" data-secondary="counting Unicode characters with" data-type="indexterm" id="idm45794991052552"/>The string <code>len()</code> function counts Unicode <em>characters</em>,&#13;
not bytes:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="nb">len</code><code class="p">(</code><code class="s">'$'</code><code class="p">)</code>&#13;
<code class="go">1</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="nb">len</code><code class="p">(</code><code class="s">'</code><code class="se">\U0001f47b</code><code class="s">'</code><code class="p">)</code>&#13;
<code class="go">1</code></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>If you know the Unicode numeric ID,&#13;
you can use the standard <code>ord()</code> and <code>chr()</code>&#13;
functions to quickly&#13;
convert between integer IDs and&#13;
single-character Unicode strings:<a data-startref="ix_ch12-munging-asciidoc3" data-type="indexterm" id="idm45794991081752"/><a data-startref="ix_ch12-munging-asciidoc2" data-type="indexterm" id="idm45794991031016"/></p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="nb">chr</code><code class="p">(</code><code class="mi">233</code><code class="p">)</code>&#13;
<code class="go">'é'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="nb">chr</code><code class="p">(</code><code class="mh">0xe9</code><code class="p">)</code>&#13;
<code class="go">'é'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="nb">chr</code><code class="p">(</code><code class="mh">0x1fc6</code><code class="p">)</code>&#13;
<code class="go">'ῆ'</code></pre>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="UTF-8" data-type="sect2"><div class="sect2" id="utf8">&#13;
<h2>UTF-8</h2>&#13;
&#13;
<p><a data-primary="Unicode text strings" data-secondary="UTF-8 encoding" data-type="indexterm" id="idm45794991070040"/>You don’t need to worry about how Python stores&#13;
each Unicode character&#13;
when you do normal string processing.</p>&#13;
&#13;
<p>However, when you exchange data with the outside world,&#13;
you need a couple of things:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>A way to <em>encode</em> character strings to bytes</p>&#13;
</li>&#13;
<li>&#13;
<p>A way to <em>decode</em> bytes to character strings</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>If there were fewer than 65,536 characters in Unicode,&#13;
we could stuff each Unicode character ID into two bytes.&#13;
Unfortunately, there are more.&#13;
We could encode every ID&#13;
into four bytes, but that would increase the memory and disk&#13;
storage space needs for common text strings&#13;
by four times.</p>&#13;
&#13;
<p>Ken Thompson and Rob Pike,&#13;
whose names will be familiar to Unix developers,&#13;
designed the <em>UTF-8</em> dynamic encoding scheme&#13;
one night on a placemat in a New Jersey diner.&#13;
It uses one to four bytes per Unicode character:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>One byte for ASCII</p>&#13;
</li>&#13;
<li>&#13;
<p>Two bytes for most Latin-derived (but not Cyrillic) languages</p>&#13;
</li>&#13;
<li>&#13;
<p>Three bytes for the rest of the basic multilingual plane</p>&#13;
</li>&#13;
<li>&#13;
<p>Four bytes for the rest,&#13;
including some Asian languages and symbols</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>UTF-8 is the standard text encoding in Python, Linux,&#13;
and HTML. It’s fast, complete, and works well.&#13;
If you use UTF-8 encoding throughout your code,&#13;
life will be much easier&#13;
than trying to hop in and out of various encodings.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>If you create a Python string by copying and pasting&#13;
from another source such as a web page, be sure the source&#13;
is encoded in the UTF-8 format. It’s <em>very</em>&#13;
common to see text that was encoded as Latin-1 or&#13;
Windows 1252 copied into a Python string, which&#13;
causes an exception later with an invalid byte sequence.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Encode" data-type="sect2"><div class="sect2" id="encode">&#13;
<h2>Encode</h2>&#13;
&#13;
<p><a data-primary="encode() function" data-type="indexterm" id="idm45794991000968"/><a data-primary="Unicode text strings" data-secondary="encode() function" data-type="indexterm" id="idm45794991000040"/>You <em>encode</em> a <em>string</em> to <em>bytes</em>.&#13;
The string <code>encode()</code> function’s first argument&#13;
is the encoding name.&#13;
The choices include those presented in <a data-type="xref" href="#table_12-1">Table 12-1</a>.</p>&#13;
<table id="table_12-1">&#13;
<caption><span class="label">Table 12-1. </span>Encodings</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Encoding name</th>&#13;
<th>Description</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>'ascii'</code></p></td>&#13;
<td><p>Good old seven-bit ASCII</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>'utf-8'</code></p></td>&#13;
<td><p>Eight-bit variable-length encoding, and what you almost always want to use</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>'latin-1'</code></p></td>&#13;
<td><p>Also known as ISO 8859-1</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>'cp-1252'</code></p></td>&#13;
<td><p>A common Windows encoding</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>'unicode-escape'</code></p></td>&#13;
<td><p>Python Unicode literal format, `\u`<em>xxxx</em> or `\U`<em>xxxxxxxx</em></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>You can encode anything as UTF-8.&#13;
Let’s assign the Unicode string <code>'\u2603'</code> to the name <code>snowman</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">snowman</code> <code class="o">=</code> <code class="s">'</code><code class="se">\u2603</code><code class="s">'</code></pre>&#13;
&#13;
<p><code>snowman</code>&#13;
is a Python Unicode string with a single character,&#13;
regardless of how many bytes might be needed to store&#13;
it internally:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="nb">len</code><code class="p">(</code><code class="n">snowman</code><code class="p">)</code>&#13;
<code class="go">1</code></pre>&#13;
&#13;
<p>Next, let’s encode this Unicode character to a sequence of bytes:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">ds</code> <code class="o">=</code> <code class="n">snowman</code><code class="o">.</code><code class="n">encode</code><code class="p">(</code><code class="s">'utf-8'</code><code class="p">)</code></pre>&#13;
&#13;
<p>As I mentioned earlier,&#13;
UTF-8 is a variable-length encoding.&#13;
In this case, it used three bytes to encode the single&#13;
<code>snowman</code> Unicode character:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="nb">len</code><code class="p">(</code><code class="n">ds</code><code class="p">)</code>&#13;
<code class="go">3</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">ds</code>&#13;
<code class="go">b'\xe2\x98\x83'</code></pre>&#13;
&#13;
<p>Now, <code>len()</code> returns the number of bytes (3)&#13;
because <code>ds</code> is&#13;
a <code>bytes</code> variable.</p>&#13;
&#13;
<p>You can use encodings other than UTF-8,&#13;
but you’ll get errors if the Unicode string can’t&#13;
be handled by the encoding.&#13;
For example, if you use the <code>ascii</code> encoding,&#13;
it will fail unless your Unicode characters happen&#13;
to be valid ASCII characters, as well:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">ds</code> <code class="o">=</code> <code class="n">snowman</code><code class="o">.</code><code class="n">encode</code><code class="p">(</code><code class="s">'ascii'</code><code class="p">)</code>&#13;
<code class="gt">Traceback (most recent call last):</code>&#13;
  File <code class="nb">"&lt;stdin&gt;"</code>, line <code class="m">1</code>, in <code class="n">&lt;module&gt;</code>&#13;
<code class="gr">UnicodeEncodeError</code>: <code class="n">'ascii' codec can't encode character '\u2603'</code>&#13;
<code class="go">in position 0: ordinal not in range(128)</code></pre>&#13;
&#13;
<p>The <code>encode()</code> function takes a second argument to&#13;
help you avoid encoding exceptions.&#13;
Its default value, which you can see in the previous example,&#13;
is <code>'strict'</code>;&#13;
it raises a <code>UnicodeEncodeError</code>&#13;
if it sees a non-ASCII character.&#13;
There are other encodings.&#13;
Use <code>'ignore'</code> to throw away anything that won’t encode:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">snowman</code><code class="o">.</code><code class="n">encode</code><code class="p">(</code><code class="s">'ascii'</code><code class="p">,</code> <code class="s">'ignore'</code><code class="p">)</code>&#13;
<code class="go">b''</code></pre>&#13;
&#13;
<p>Use <code>'replace'</code> to substitute <code>?</code> for unknown characters:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">snowman</code><code class="o">.</code><code class="n">encode</code><code class="p">(</code><code class="s">'ascii'</code><code class="p">,</code> <code class="s">'replace'</code><code class="p">)</code>&#13;
<code class="go">b'?'</code></pre>&#13;
&#13;
<p>Use <code>'backslashreplace'</code> to produce a Python Unicode character&#13;
string, like <code>unicode-escape</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">snowman</code><code class="o">.</code><code class="n">encode</code><code class="p">(</code><code class="s">'ascii'</code><code class="p">,</code> <code class="s">'backslashreplace'</code><code class="p">)</code>&#13;
<code class="go">b'\\u2603'</code></pre>&#13;
&#13;
<p>You would use this if you needed a printable version of the Unicode&#13;
escape sequence.</p>&#13;
&#13;
<p>Use <code>'xmlcharrefreplace'</code>&#13;
to make HTML-safe strings:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">snowman</code><code class="o">.</code><code class="n">encode</code><code class="p">(</code><code class="s">'ascii'</code><code class="p">,</code> <code class="s">'xmlcharrefreplace'</code><code class="p">)</code>&#13;
<code class="go">b'&amp;#9731;'</code></pre>&#13;
&#13;
<p>I provide more details on HTML conversion in&#13;
<a data-type="xref" href="#html_entities">“HTML Entities”</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Decode" data-type="sect2"><div class="sect2" id="decode">&#13;
<h2>Decode</h2>&#13;
&#13;
<p><a data-primary="decode() function" data-type="indexterm" id="idm45794990739304"/><a data-primary="Unicode text strings" data-secondary="decoding" data-type="indexterm" id="idm45794990738600"/>We <em>decode</em> byte strings to Unicode text strings.&#13;
Whenever we get text from some external source&#13;
(files, databases, websites,&#13;
network APIs, and so on),&#13;
it’s encoded as byte strings.&#13;
The tricky part is knowing which encoding was actually used,&#13;
so we can <em>run it backward</em> and get Unicode strings.</p>&#13;
&#13;
<p>The problem is that nothing in the byte string itself&#13;
says what encoding was used.&#13;
I mentioned the perils of copying and pasting&#13;
from websites earlier.&#13;
You’ve probably visited websites with&#13;
odd characters where plain old ASCII characters&#13;
should be.</p>&#13;
&#13;
<p>Let’s create a Unicode string called&#13;
<code>place</code> with the value <code>'café'</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">place</code> <code class="o">=</code> <code class="s">'caf</code><code class="se">\u00e9</code><code class="s">'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">place</code>&#13;
<code class="go">'café'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="nb">type</code><code class="p">(</code><code class="n">place</code><code class="p">)</code>&#13;
<code class="go">&lt;class 'str'&gt;</code></pre>&#13;
&#13;
<p>Encode it in UTF-8 format in a&#13;
<code>bytes</code> variable called <code>place_bytes</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">place_bytes</code> <code class="o">=</code> <code class="n">place</code><code class="o">.</code><code class="n">encode</code><code class="p">(</code><code class="s">'utf-8'</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">place_bytes</code>&#13;
<code class="go">b'caf\xc3\xa9'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="nb">type</code><code class="p">(</code><code class="n">place_bytes</code><code class="p">)</code>&#13;
<code class="go">&lt;class 'bytes'&gt;</code></pre>&#13;
&#13;
<p>Notice that <code>place_bytes</code> has five bytes.&#13;
The first three are the same as ASCII&#13;
(a strength of UTF-8), and the final two encode the <code>'é'</code>.&#13;
Now let’s decode that byte string back to a Unicode string:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">place2</code> <code class="o">=</code> <code class="n">place_bytes</code><code class="o">.</code><code class="n">decode</code><code class="p">(</code><code class="s">'utf-8'</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">place2</code>&#13;
<code class="go">'café'</code></pre>&#13;
&#13;
<p>This worked because we encoded to UTF-8 and decoded from UTF-8.&#13;
What if we told it to decode from some other encoding?</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">place3</code> <code class="o">=</code> <code class="n">place_bytes</code><code class="o">.</code><code class="n">decode</code><code class="p">(</code><code class="s">'ascii'</code><code class="p">)</code>&#13;
<code class="gt">Traceback (most recent call last):</code>&#13;
  File <code class="nb">"&lt;stdin&gt;"</code>, line <code class="m">1</code>, in <code class="n">&lt;module&gt;</code>&#13;
<code class="gr">UnicodeDecodeError</code>: <code class="n">'ascii' codec can't decode byte 0xc3 in position 3:</code>&#13;
<code class="go">ordinal not in range(128)</code></pre>&#13;
&#13;
<p>The ASCII decoder threw an exception because&#13;
the byte value <code>0xc3</code> is illegal in ASCII.&#13;
There are some 8-bit character set encodings&#13;
in which values between 128 (hex <code>80</code>)&#13;
and 255 (hex <code>FF</code>) are legal but not the same as UTF-8:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">place4</code> <code class="o">=</code> <code class="n">place_bytes</code><code class="o">.</code><code class="n">decode</code><code class="p">(</code><code class="s">'latin-1'</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">place4</code>&#13;
<code class="go">'cafÃ©'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">place5</code> <code class="o">=</code> <code class="n">place_bytes</code><code class="o">.</code><code class="n">decode</code><code class="p">(</code><code class="s">'windows-1252'</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">place5</code>&#13;
<code class="go">'cafÃ©'</code></pre>&#13;
&#13;
<p>Urk.</p>&#13;
&#13;
<p>The moral of this story: whenever possible, use UTF-8 encoding.&#13;
It works,&#13;
is supported everywhere,&#13;
can express every Unicode character,&#13;
and is quickly decoded and encoded.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><a data-primary="fonts, Unicode characters and" data-type="indexterm" id="idm45794990517768"/>Even though you can specify any Unicode character,&#13;
that doesn’t mean that your computer will display all of them.&#13;
That depends on the <em>font</em> that you’re using,&#13;
which may display nothing or some fill-in image for&#13;
many characters.&#13;
Apple created the&#13;
<a href="https://oreil.ly/q5EZD">Last Resort Font</a>&#13;
for the Unicode Consortium,&#13;
and uses it in its own operating systems.&#13;
This <a href="https://oreil.ly/Zm_uZ">Wikipedia page</a>&#13;
has a few more details.&#13;
Another font with everything between <code>\u0000</code> and <code>\uffff</code>,&#13;
and a few more,&#13;
is&#13;
<a href="https://oreil.ly/APKlj">Unifont</a>.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="HTML Entities" data-type="sect2"><div class="sect2" id="html_entities">&#13;
<h2>HTML Entities</h2>&#13;
&#13;
<p><a data-primary="HTML (Hypertext Markup Language)" data-type="indexterm" id="idm45794990475928"/><a data-primary="Unicode text strings" data-secondary="HTML entities" data-type="indexterm" id="idm45794990475256"/>Python 3.4 added another way to convert to and from Unicode&#13;
but using HTML&#13;
<em>character entities</em>.<sup><a data-type="noteref" href="ch12.html#idm45794990473800" id="idm45794990473800-marker">3</a></sup>&#13;
This may be easier to use than looking up Unicode names,&#13;
especially if you’re working on the web:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">html</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">html</code><code class="o">.</code><code class="n">unescape</code><code class="p">(</code><code class="s">"&amp;egrave;"</code><code class="p">)</code>&#13;
<code class="go">'è'</code></pre>&#13;
&#13;
<p>This conversion also works with numbered entities,&#13;
decimal or hex:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">html</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">html</code><code class="o">.</code><code class="n">unescape</code><code class="p">(</code><code class="s">"&amp;#233;"</code><code class="p">)</code>&#13;
<code class="go">'é'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">html</code><code class="o">.</code><code class="n">unescape</code><code class="p">(</code><code class="s">"&amp;#xe9;"</code><code class="p">)</code>&#13;
<code class="go">'é'</code></pre>&#13;
&#13;
<p>You can even import the named entity&#13;
translations as a dictionary&#13;
and do the conversion yourself.&#13;
Drop the initial <code>'&amp;'</code> for the dictionary key&#13;
(you can also drop the final <code>';'</code>,&#13;
but it seems to work either way):</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">from</code> <code class="nn">html.entities</code> <code class="kn">import</code> <code class="n">html5</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">html5</code><code class="p">[</code><code class="s">"egrave"</code><code class="p">]</code>&#13;
<code class="go">'è'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">html5</code><code class="p">[</code><code class="s">"egrave;"</code><code class="p">]</code>&#13;
<code class="go">'è'</code></pre>&#13;
&#13;
<p>To go the other direction&#13;
(from a single Python Unicode character to an HTML entity name),&#13;
first get the decimal value of the character with <code>ord()</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">html</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">char</code> <code class="o">=</code> <code class="s">'</code><code class="se">\u00e9</code><code class="s">'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">dec_value</code> <code class="o">=</code> <code class="nb">ord</code><code class="p">(</code><code class="n">char</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">html</code><code class="o">.</code><code class="n">entities</code><code class="o">.</code><code class="n">codepoint2name</code><code class="p">[</code><code class="n">dec_value</code><code class="p">]</code>&#13;
<code class="go">'eacute'</code></pre>&#13;
&#13;
<p>For Unicode strings with more than one character,&#13;
use this two-step conversion:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">place</code> <code class="o">=</code> <code class="s">'caf</code><code class="se">\u00e9</code><code class="s">'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">byte_value</code> <code class="o">=</code> <code class="n">place</code><code class="o">.</code><code class="n">encode</code><code class="p">(</code><code class="s">'ascii'</code><code class="p">,</code> <code class="s">'xmlcharrefreplace'</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">byte_value</code>&#13;
<code class="go">b'caf&amp;#233;'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">byte_value</code><code class="o">.</code><code class="n">decode</code><code class="p">()</code>&#13;
<code class="go">'caf&amp;#233;'</code></pre>&#13;
&#13;
<p>The expression <code>place.encode('ascii', 'xmlcharrefreplace')</code>&#13;
returned ASCII characters but as type <code>bytes</code>&#13;
(because it <em>en</em>coded).&#13;
The following <code>byte_value.decode()</code> is needed to&#13;
convert <code>byte_value</code> to an HTML-compatible string.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Normalization" data-type="sect2"><div class="sect2" id="unicode_normalization">&#13;
<h2>Normalization</h2>&#13;
&#13;
<p><a data-primary="normalization, of Unicode characters" data-type="indexterm" id="idm45794990243480"/><a data-primary="Unicode text strings" data-secondary="normalization" data-type="indexterm" id="idm45794990242808"/>Some Unicode characters can be represented by more than one&#13;
Unicode encoding.&#13;
They’ll look the same, but won’t compare the same&#13;
because they have different internal byte sequences.&#13;
For example, take the acute accented&#13;
<code>'é'</code> in <code>'café'</code>.&#13;
Let’s make a single-character <code>'é'</code> in multiple ways:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">eacute1</code> <code class="o">=</code> <code class="s">'é'</code>                              <code class="c"># UTF-8, pasted</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">eacute2</code> <code class="o">=</code> <code class="s">'</code><code class="se">\u00e9</code><code class="s">'</code>                         <code class="c"># Unicode code point</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">eacute3</code> <code class="o">=</code> \                                <code class="c"># Unicode name</code>&#13;
<code class="gp">... </code>    <code class="s">'</code><code class="se">\N{LATIN SMALL LETTER E WITH ACUTE}</code><code class="s">'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">eacute4</code> <code class="o">=</code> <code class="nb">chr</code><code class="p">(</code><code class="mi">233</code><code class="p">)</code>                         <code class="c"># decimal byte value</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">eacute5</code> <code class="o">=</code> <code class="nb">chr</code><code class="p">(</code><code class="mh">0xe9</code><code class="p">)</code>                        <code class="c"># hex byte value</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">eacute1</code><code class="p">,</code> <code class="n">eacute2</code><code class="p">,</code> <code class="n">eacute3</code><code class="p">,</code> <code class="n">eacute4</code><code class="p">,</code> <code class="n">eacute5</code>&#13;
<code class="go">('é', 'é', 'é', 'é', 'é')</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">eacute1</code> <code class="o">==</code> <code class="n">eacute2</code> <code class="o">==</code> <code class="n">eacute3</code> <code class="o">==</code> <code class="n">eacute4</code> <code class="o">==</code> <code class="n">eacute5</code>&#13;
<code class="go">True</code></pre>&#13;
&#13;
<p>Try a few sanity checks:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">unicodedata</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">unicodedata</code><code class="o">.</code><code class="n">name</code><code class="p">(</code><code class="n">eacute1</code><code class="p">)</code>&#13;
<code class="go">'LATIN SMALL LETTER E WITH ACUTE'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="nb">ord</code><code class="p">(</code><code class="n">eacute1</code><code class="p">)</code>             <code class="c"># as a decimal integer</code>&#13;
<code class="go">233</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="mh">0xe9</code>                     <code class="c"># Unicode hex integer</code>&#13;
<code class="go">233</code></pre>&#13;
&#13;
<p>Now let’s make an accented <code>e</code> by combining a plain <code>e</code>&#13;
with an acute accent:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">eacute_combined1</code> <code class="o">=</code> <code class="s">"e</code><code class="se">\u0301</code><code class="s">"</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">eacute_combined2</code> <code class="o">=</code> <code class="s">"e</code><code class="se">\N{COMBINING ACUTE ACCENT}</code><code class="s">"</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">eacute_combined3</code> <code class="o">=</code> <code class="s">"e"</code> <code class="o">+</code> <code class="s">"</code><code class="se">\u0301</code><code class="s">"</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">eacute_combined1</code><code class="p">,</code> <code class="n">eacute_combined2</code><code class="p">,</code> <code class="n">eacute_combined3</code>&#13;
<code class="go">('é', 'é', 'é'))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">eacute_combined1</code> <code class="o">==</code> <code class="n">eacute_combined2</code> <code class="o">==</code> <code class="n">eacute_combined3</code>&#13;
<code class="go">True</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="nb">len</code><code class="p">(</code><code class="n">eacute_combined1</code><code class="p">)</code>&#13;
<code class="go">2</code></pre>&#13;
&#13;
<p>We built a Unicode character from two characters,&#13;
and it looks the same as the original <code>'é'</code>.&#13;
But as they say on Sesame Street,&#13;
one of these things is not like the other:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">eacute1</code> <code class="o">==</code> <code class="n">eacute_combined1</code>&#13;
<code class="go">False</code></pre>&#13;
&#13;
<p>If you had two different Unicode text strings from different&#13;
sources, one using <code>eacute1</code> and another <code>eacute_combined1</code>,&#13;
they would appear the same,&#13;
but would mysteriously not act the same.</p>&#13;
&#13;
<p>You can fix this with the <code>normalize()</code> function&#13;
in the <code>unicodedata</code> module:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">unicodedata</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">eacute_normalized</code> <code class="o">=</code> <code class="n">unicodedata</code><code class="o">.</code><code class="n">normalize</code><code class="p">(</code><code class="s">'NFC'</code><code class="p">,</code> <code class="n">eacute_combined1</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="nb">len</code><code class="p">(</code><code class="n">eacute_normalized</code><code class="p">)</code>&#13;
<code class="go">1</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">eacute_normalized</code> <code class="o">==</code> <code class="n">eacute1</code>&#13;
<code class="go">True</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">unicodedata</code><code class="o">.</code><code class="n">name</code><code class="p">(</code><code class="n">eacute_normalized</code><code class="p">)</code>&#13;
<code class="go">'LATIN SMALL LETTER E WITH ACUTE'</code></pre>&#13;
&#13;
<p>That <code>'NFC'</code> means <em>normal form, composed</em>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="For More Information" data-type="sect2"><div class="sect2" id="unicode_more">&#13;
<h2>For More Information</h2>&#13;
&#13;
<p>If you would like to learn more about Unicode,&#13;
these links are particularly helpful:<a data-startref="ix_ch12-munging-asciidoc1" data-type="indexterm" id="idm45794989926840"/><a data-startref="ix_ch12-munging-asciidoc0" data-type="indexterm" id="idm45794989926168"/></p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="http://bit.ly/unicode-howto">Unicode HOWTO</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://bit.ly/pragmatic-uni">Pragmatic Unicode</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://bit.ly/jspolsky">The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets (No Excuses!)</a></p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Text Strings: Regular Expressions" data-type="sect1"><div class="sect1" id="regex">&#13;
<h1>Text Strings: Regular Expressions</h1>&#13;
&#13;
<p><a data-primary="regular expressions" data-type="indexterm" id="ix_ch12-munging-asciidoc4"/><a data-primary="strings" data-secondary="regular expressions" data-type="indexterm" id="ix_ch12-munging-asciidoc5"/><a data-type="xref" href="ch05.html#ch_strings">Chapter 5</a> discussed simple string operations.&#13;
Armed with that introductory information,&#13;
<a data-primary="* (asterisk)" data-secondary="wildcard" data-type="indexterm" id="idm45794989915640"/><a data-primary="asterisk (*)" data-secondary="wildcard" data-type="indexterm" id="idm45794989914696"/><a data-primary="wildcard patterns (*)" data-type="indexterm" id="idm45794989913752"/>you’ve probably used simple “wildcard” patterns on&#13;
the command line,&#13;
such as the UNIX command <code>ls *.py</code>, which means&#13;
<em>list all filenames ending in .py</em>.</p>&#13;
&#13;
<p><a data-primary="regular expressions" data-secondary="basics" data-type="indexterm" id="idm45794989911848"/>It’s time to explore more complex pattern matching&#13;
by using <em>regular expressions</em>.&#13;
These are provided in the standard module <code>re</code>,&#13;
which we’ll import.&#13;
You define a string <em>pattern</em> that you want to match,&#13;
and the <em>source</em> string to match against.&#13;
For simple matches, usage looks like this:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">re</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">result</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">match</code><code class="p">(</code><code class="s">'You'</code><code class="p">,</code> <code class="s">'Young Frankenstein'</code><code class="p">)</code></pre>&#13;
&#13;
<p>Here, <code>'You'</code> is the <em>pattern</em> we’re looking for,&#13;
and <code>'Young Frankenstein'</code> is the&#13;
<em>source</em> (the string we want to search).&#13;
<code>match()</code> checks whether the&#13;
<em>source</em> begins with the <em>pattern</em>.</p>&#13;
&#13;
<p>For more complex matches, you can <em>compile</em> your pattern&#13;
first to speed up the match later:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">re</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">youpattern</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">compile</code><code class="p">(</code><code class="s">'You'</code><code class="p">)</code></pre>&#13;
&#13;
<p>Then, you can perform your match against the compiled pattern:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">re</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">result</code> <code class="o">=</code> <code class="n">youpattern</code><code class="o">.</code><code class="n">match</code><code class="p">(</code><code class="s">'Young Frankenstein'</code><code class="p">)</code></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Because this is a common Python gotcha,&#13;
I’ll say it again here: <code>match()</code> only matches a pattern starting at&#13;
the <em>beginning</em> of the source. <code>search()</code> matches a pattern <em>anywhere</em> in the source.</p>&#13;
</div>&#13;
&#13;
<p><code>match()</code> is not the only way to compare the pattern and source.&#13;
Here are several other methods you can use (we discuss each in the following sections):</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>search()</code> returns the first match, if any.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>findall()</code> returns a list of all non-overlapping matches,&#13;
if any.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>split()</code> splits <em>source</em> at matches with <em>pattern</em>&#13;
and returns a list of the string pieces.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>sub()</code> takes another <em>replacement</em> argument, and&#13;
changes all parts of <em>source</em> that are matched by&#13;
<em>pattern</em> to <em>replacement</em>.</p>&#13;
</li>&#13;
</ul>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Most of the regular expression examples here use ASCII,&#13;
but Python’s string functions, including regular expressions,&#13;
work with any Python string and any Unicode characters.</p>&#13;
</div>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Find Exact Beginning Match with match()" data-type="sect2"><div class="sect2" id="regex_match">&#13;
<h2>Find Exact Beginning Match with match()</h2>&#13;
&#13;
<p><a data-primary="match() function" data-secondary="exact matches" data-type="indexterm" id="idm45794989782968"/><a data-primary="regular expressions" data-secondary="exact matches" data-type="indexterm" id="idm45794989781992"/>Does the string <code>'Young Frankenstein'</code>&#13;
begin with the word <code>'You'</code>?&#13;
Here’s some code with comments:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">re</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">source</code> <code class="o">=</code> <code class="s">'Young Frankenstein'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">match</code><code class="p">(</code><code class="s">'You'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>  <code class="c"># match starts at the beginning of source</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">if</code> <code class="n">m</code><code class="p">:</code>  <code class="c"># match returns an object; do this to see what matched</code>&#13;
<code class="gp">... </code>    <code class="k">print</code><code class="p">(</code><code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">())</code>&#13;
<code class="gp">...</code>&#13;
<code class="go">You</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">match</code><code class="p">(</code><code class="s">'^You'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code> <code class="c"># start anchor does the same</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">if</code> <code class="n">m</code><code class="p">:</code>&#13;
<code class="gp">... </code>    <code class="k">print</code><code class="p">(</code><code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">())</code>&#13;
<code class="gp">...</code>&#13;
<code class="go">You</code></pre>&#13;
&#13;
<p>How about <code>'Frank'</code>?</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">re</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">source</code> <code class="o">=</code> <code class="s">'Young Frankenstein'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">match</code><code class="p">(</code><code class="s">'Frank'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">if</code> <code class="n">m</code><code class="p">:</code>&#13;
<code class="gp">... </code>    <code class="k">print</code><code class="p">(</code><code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">())</code>&#13;
<code class="gp">...</code></pre>&#13;
&#13;
<p>This time, <code>match()</code> returned nothing, so the <code>if</code> did not run the&#13;
<code>print</code> statement.</p>&#13;
&#13;
<p>As I mentioned in <a data-type="xref" href="ch04.html#walrus">“New: I Am the Walrus”</a>,&#13;
in Python 3.8 you can shorten&#13;
this example with the so-called <em>walrus operator</em>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">re</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">source</code> <code class="o">=</code> <code class="s">'Young Frankenstein'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">if</code> <code class="n">m</code> <code class="p">:</code><code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">match</code><code class="p">(</code><code class="s">'Frank'</code><code class="p">,</code> <code class="n">source</code><code class="p">):</code>&#13;
<code class="gp">... </code>    <code class="k">print</code><code class="p">(</code><code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">())</code>&#13;
<code class="gp">...</code></pre>&#13;
&#13;
<p>Okay, now let’s use <code>search()</code> to see whether <code>'Frank'</code>&#13;
is anywhere in the source string:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">re</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">source</code> <code class="o">=</code> <code class="s">'Young Frankenstein'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">search</code><code class="p">(</code><code class="s">'Frank'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">if</code> <code class="n">m</code><code class="p">:</code>&#13;
<code class="gp">... </code>     <code class="k">print</code><code class="p">(</code><code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">())</code>&#13;
<code class="gp">...</code>&#13;
<code class="go">Frank</code></pre>&#13;
&#13;
<p>Let’s change the pattern and try a beginning match with&#13;
<code>match()</code> again:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">re</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">source</code> <code class="o">=</code> <code class="s">'Young Frankenstein'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">match</code><code class="p">(</code><code class="s">'.*Frank'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">if</code> <code class="n">m</code><code class="p">:</code>  <code class="c"># match returns an object</code>&#13;
<code class="gp">... </code>    <code class="k">print</code><code class="p">(</code><code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">())</code>&#13;
<code class="gp">...</code>&#13;
<code class="go">Young Frank</code></pre>&#13;
&#13;
<p>Here’s a brief explanation of how our new&#13;
<code>'.*Frank'</code> pattern works:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>.</code> means <em>any single character</em>.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>*</code> means <em>zero or more of the preceding thing</em>. Together,&#13;
<code>.*</code> mean <em>any number of characters</em> (even zero).</p>&#13;
</li>&#13;
<li>&#13;
<p><code>Frank</code> is the phrase that we wanted to match, somewhere.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p><code>match()</code> returned the string&#13;
that matched <code>.*Frank</code>: <code>'Young Frank'</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Find First Match with search()" data-type="sect2"><div class="sect2" id="regex_search">&#13;
<h2>Find First Match with search()</h2>&#13;
&#13;
<p><a data-primary="regular expressions" data-secondary="first match" data-type="indexterm" id="idm45794989439368"/><a data-primary="search() function" data-type="indexterm" id="idm45794989438168"/>You can use <code>search()</code> to find the pattern <code>'Frank'</code> anywhere&#13;
in the source string <code>'Young Frankenstein'</code>,&#13;
without the need for the <code>.*</code> wildcards:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">re</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">source</code> <code class="o">=</code> <code class="s">'Young Frankenstein'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">search</code><code class="p">(</code><code class="s">'Frank'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">if</code> <code class="n">m</code><code class="p">:</code>  <code class="c"># search returns an object</code>&#13;
<code class="gp">... </code>    <code class="k">print</code><code class="p">(</code><code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">())</code>&#13;
<code class="gp">...</code>&#13;
<code class="go">Frank</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Find All Matches with findall()" data-type="sect2"><div class="sect2" id="regex_findall">&#13;
<h2>Find All Matches with findall()</h2>&#13;
&#13;
<p><a data-primary="findall() function" data-type="indexterm" id="idm45794989375896"/><a data-primary="regular expressions" data-secondary="all matches" data-type="indexterm" id="idm45794989375192"/>The preceding examples looked for one match only.&#13;
But what if you want to know how many instances of the single-letter string <code>'n'</code>&#13;
are in the string?</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">re</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">source</code> <code class="o">=</code> <code class="s">'Young Frankenstein'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'n'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code>   <code class="c"># findall returns a list</code>&#13;
<code class="go">['n', 'n', 'n', 'n']</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">print</code><code class="p">(</code><code class="s">'Found'</code><code class="p">,</code> <code class="nb">len</code><code class="p">(</code><code class="n">m</code><code class="p">),</code> <code class="s">'matches'</code><code class="p">)</code>&#13;
<code class="go">Found 4 matches</code></pre>&#13;
&#13;
<p>How about <code>'n'</code> followed by any character?</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">re</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">source</code> <code class="o">=</code> <code class="s">'Young Frankenstein'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'n.'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code>&#13;
<code class="go">['ng', 'nk', 'ns']</code></pre>&#13;
&#13;
<p>Notice that it did not match that final <code>'n'</code>.&#13;
We need to say that the character after <code>'n'</code>&#13;
is optional, with <code>?</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">re</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">source</code> <code class="o">=</code> <code class="s">'Young Frankenstein'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'n.?'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code>&#13;
<code class="go">['ng', 'nk', 'ns', 'n']</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Split at Matches with split()" data-type="sect2"><div class="sect2" id="regex_split">&#13;
<h2>Split at Matches with split()</h2>&#13;
&#13;
<p><a data-primary="regular expressions" data-secondary="split at matches" data-type="indexterm" id="idm45794989300760"/><a data-primary="split() function" data-type="indexterm" id="idm45794989213928"/>The next example shows you how to split a string into a list&#13;
by a pattern rather than a simple string&#13;
(as the normal string <code>split()</code> method would do):</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">re</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">source</code> <code class="o">=</code> <code class="s">'Young Frankenstein'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">split</code><code class="p">(</code><code class="s">'n'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code>    <code class="c"># split returns a list</code>&#13;
<code class="go">['You', 'g Fra', 'ke', 'stei', '']</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Replace at Matches with sub()" data-type="sect2"><div class="sect2" id="regex_sub">&#13;
<h2>Replace at Matches with sub()</h2>&#13;
&#13;
<p><a data-primary="regular expressions" data-secondary="replace at match" data-type="indexterm" id="idm45794989195256"/><a data-primary="sub() function" data-type="indexterm" id="idm45794989194280"/>This is like the string <code>replace()</code> method,&#13;
but for patterns rather than literal strings:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">re</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">source</code> <code class="o">=</code> <code class="s">'Young Frankenstein'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s">'n'</code><code class="p">,</code> <code class="s">'?'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code>   <code class="c"># sub returns a string</code>&#13;
<code class="go">'You?g Fra?ke?stei?'</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Patterns: Special Characters" data-type="sect2"><div class="sect2" id="regex_patterns">&#13;
<h2>Patterns: Special Characters</h2>&#13;
&#13;
<p><a data-primary="regular expressions" data-secondary="special characters" data-type="indexterm" id="ix_ch12-munging-asciidoc6"/><a data-primary="special characters" data-type="indexterm" id="ix_ch12-munging-asciidoc7"/>Many descriptions of regular expressions start with&#13;
all the details of how to define them.&#13;
I think that’s a mistake.&#13;
Regular expressions are a not-so-little language in their&#13;
own right, with too many details to fit in your head&#13;
at once.&#13;
They use so much punctuation&#13;
that they look like cartoon characters swearing.</p>&#13;
&#13;
<p>With these expressions&#13;
(<code>match()</code>, <code>search()</code>, <code>findall()</code>, and <code>sub()</code>) under your belt,&#13;
let’s get into the details of building them.&#13;
The patterns you make apply to any of these functions.</p>&#13;
&#13;
<p>You’ve seen the basics:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Literal matches with any nonspecial characters</p>&#13;
</li>&#13;
<li>&#13;
<p>Any single character except <code>\n</code> with <code>.</code></p>&#13;
</li>&#13;
<li>&#13;
<p>Any number of the preceding character (including zero) with <code>*</code></p>&#13;
</li>&#13;
<li>&#13;
<p>Optional (zero or one) of the preceding character with <code>?</code></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>First, special characters are shown in <a data-type="xref" href="#specialchartable">Table 12-2</a>.</p>&#13;
<table id="specialchartable">&#13;
<caption><span class="label">Table 12-2. </span>Special characters</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Pattern</th>&#13;
<th>Matches</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>\d</code></p></td>&#13;
<td><p>A single digit</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>\D</code></p></td>&#13;
<td><p>A single nondigit</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>\w</code></p></td>&#13;
<td><p>An alphanumeric character</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>\W</code></p></td>&#13;
<td><p>A non-alphanumeric character</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>\s</code></p></td>&#13;
<td><p>A whitespace character</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>\S</code></p></td>&#13;
<td><p>A nonwhitespace character</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>\b</code></p></td>&#13;
<td><p>A word boundary (between a <code>\w</code> and a <code>\W</code>, in either order)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>\B</code></p></td>&#13;
<td><p>A nonword boundary</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>The Python <code>string</code> module has predefined string constants&#13;
that we can use for testing.&#13;
Let’s use <code>printable</code>, which&#13;
contains 100 printable ASCII characters,&#13;
including letters in both cases, digits, space characters,&#13;
and punctuation:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">string</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">printable</code> <code class="o">=</code> <code class="n">string</code><code class="o">.</code><code class="n">printable</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="nb">len</code><code class="p">(</code><code class="n">printable</code><code class="p">)</code>&#13;
<code class="go">100</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">printable</code><code class="p">[</code><code class="mi">0</code><code class="p">:</code><code class="mi">50</code><code class="p">]</code>&#13;
<code class="go">'0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMN'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">printable</code><code class="p">[</code><code class="mi">50</code><code class="p">:]</code>&#13;
<code class="go">'OPQRSTUVWXYZ!"#$%&amp;\'()*+,-./:;&lt;=&gt;?@[\\]^_`{|}~ \t\n\r\x0b\x0c'</code></pre>&#13;
&#13;
<p>Which characters in <code>printable</code> are digits?</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'\d'</code><code class="p">,</code> <code class="n">printable</code><code class="p">)</code>&#13;
<code class="go">['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']</code></pre>&#13;
&#13;
<p>Which characters are digits, letters, or an underscore?</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'\w'</code><code class="p">,</code> <code class="n">printable</code><code class="p">)</code>&#13;
<code class="go">['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b',</code>&#13;
<code class="go">'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',</code>&#13;
<code class="go">'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z',</code>&#13;
<code class="go">'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L',</code>&#13;
<code class="go">'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',</code>&#13;
<code class="go">'Y', 'Z', '_']</code></pre>&#13;
&#13;
<p>Which are spaces?</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'\s'</code><code class="p">,</code> <code class="n">printable</code><code class="p">)</code>&#13;
<code class="go">[' ', '\t', '\n', '\r', '\x0b', '\x0c']</code></pre>&#13;
&#13;
<p>In order, those were:&#13;
plain old space, tab, newline, carriage return,&#13;
vertical tab, and form feed.</p>&#13;
&#13;
<p>Regular expressions are not confined to ASCII.&#13;
A <code>\d</code> will match whatever Unicode calls a digit,&#13;
not just ASCII characters <code>'0'</code> through <code>'9'</code>.&#13;
Let’s add two non-ASCII <span class="keep-together">lowercase</span> letters from&#13;
<a href="http://bit.ly/unicode-letter">FileFormat.info</a>:</p>&#13;
&#13;
<p>In this test, we’ll throw in the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Three ASCII letters</p>&#13;
</li>&#13;
<li>&#13;
<p>Three punctuation symbols that should <em>not</em> match a <code>\w</code></p>&#13;
</li>&#13;
<li>&#13;
<p>A Unicode <em>LATIN SMALL LETTER E WITH CIRCUMFLEX</em> (\u00ea)</p>&#13;
</li>&#13;
<li>&#13;
<p>A Unicode <em>LATIN SMALL LETTER E WITH BREVE</em> (\u0115)</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">x</code> <code class="o">=</code> <code class="s">'abc'</code> <code class="o">+</code> <code class="s">'-/*'</code> <code class="o">+</code> <code class="s">'</code><code class="se">\u00ea</code><code class="s">'</code> <code class="o">+</code> <code class="s">'</code><code class="se">\u0115</code><code class="s">'</code></pre>&#13;
&#13;
<p>As expected, this pattern found only the letters:<a data-startref="ix_ch12-munging-asciidoc7" data-type="indexterm" id="idm45794988916408"/><a data-startref="ix_ch12-munging-asciidoc6" data-type="indexterm" id="idm45794988915912"/></p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'\w'</code><code class="p">,</code> <code class="n">x</code><code class="p">)</code>&#13;
<code class="go">['a', 'b', 'c', 'ê', 'ĕ']</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Patterns: Using Specifiers" data-type="sect2"><div class="sect2" id="regex_specifiers">&#13;
<h2>Patterns: Using Specifiers</h2>&#13;
&#13;
<p><a data-primary="regular expressions" data-secondary="pattern specifiers" data-type="indexterm" id="ix_ch12-munging-asciidoc8"/>Now let’s make “punctuation pizza,” using&#13;
the main pattern specifiers for regular expressions,&#13;
which are presented in <a data-type="xref" href="#table_12-4">Table 12-3</a>.</p>&#13;
&#13;
<p>In the table, <em>expr</em> and the other italicized words&#13;
mean any valid regular expression.</p>&#13;
<table id="table_12-4">&#13;
<caption><span class="label">Table 12-3. </span>Pattern specifiers</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Pattern</th>&#13;
<th>Matches</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>abc</code></p></td>&#13;
<td><p>Literal <code>abc</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>(</code> <em>expr</em> <code>)</code></p></td>&#13;
<td><p><em>expr</em></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><em>expr1</em> <code>|</code> <em>expr2</em></p></td>&#13;
<td><p><em>expr1</em> or <em>expr2</em></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>.</code></p></td>&#13;
<td><p>Any character except <code>\n</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>^</code></p></td>&#13;
<td><p>Start of source string</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>$</code></p></td>&#13;
<td><p>End of source string</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><em>prev</em> <code>?</code></p></td>&#13;
<td><p>Zero or one <em>prev</em></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><em>prev</em> <code>*</code></p></td>&#13;
<td><p>Zero or more <em>prev</em>, as many as possible</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><em>prev</em> <code>*?</code></p></td>&#13;
<td><p>Zero or more <em>prev</em>, as few as possible</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><em>prev</em> <code>+</code></p></td>&#13;
<td><p>One or more <em>prev</em>, as many as possible</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><em>prev</em> <code>+?</code></p></td>&#13;
<td><p>One or more <em>prev</em>, as few as possible</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><em>prev</em> <code>{</code> <em>m</em> <code>}</code></p></td>&#13;
<td><p><em>m</em> consecutive <em>prev</em></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><em>prev</em> <code>{</code> <em>m</em>, <em>n</em> <code>}</code></p></td>&#13;
<td><p><em>m</em> to <em>n</em> consecutive <em>prev</em>, as many as possible</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><em>prev</em> <code>{</code> <em>m</em>, <em>n</em> <code>}?</code></p></td>&#13;
<td><p><em>m</em> to <em>n</em> consecutive <em>prev</em>, as few as possible</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>[</code> <em>abc</em> <code>]</code></p></td>&#13;
<td><p><code>a</code> or <code>b</code> or <code>c</code> (same as <code>a|b|c</code>)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>[^</code> <em>abc</em> <code>]</code></p></td>&#13;
<td><p><em>not</em> (<code>a</code> or <code>b</code> or <code>c</code>)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><em>prev</em> <code>(?=</code> <em>next</em> <code>)</code></p></td>&#13;
<td><p><em>prev</em> if followed by <em>next</em></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><em>prev</em> <code>(?!</code> <em>next</em> <code>)</code></p></td>&#13;
<td><p><em>prev</em> if <em>not</em> followed by <em>next</em></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>(?&lt;=</code> <em>prev</em> <code>)</code> <em>next</em></p></td>&#13;
<td><p><em>next</em> if preceded by <em>prev</em></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>(?&lt;!</code> <em>prev</em> <code>)</code> <em>next</em></p></td>&#13;
<td><p><em>next</em> if <em>not</em> preceded by <em>prev</em></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>Your eyes might cross permanently when&#13;
trying to read these examples.&#13;
First, let’s define our source string:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">source</code> <code class="o">=</code> <code class="s">'''I wish I may, I wish I might</code>&#13;
<code class="gp">... </code><code class="s">Have a dish of fish tonight.'''</code></pre>&#13;
&#13;
<p>Now we apply different regular expression&#13;
pattern strings to try to match something in&#13;
the <code>source</code> string.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>In the following examples, I use plain&#13;
quoted strings&#13;
for the patterns.&#13;
A little later in this section&#13;
I show how a raw pattern string&#13;
(<code>r</code> before the initial quote)&#13;
helps avoid some&#13;
conflicts between Python’s normal string escapes&#13;
and regular expression ones.&#13;
So, to be safest,&#13;
the first argument in all the following&#13;
examples should actually be a raw string.</p>&#13;
</div>&#13;
&#13;
<p>First, find <code>wish</code> anywhere:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'wish'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="go">['wish', 'wish']</code></pre>&#13;
&#13;
<p>Next, find <code>wish</code> or <code>fish</code> anywhere:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'wish|fish'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="go">['wish', 'wish', 'fish']</code></pre>&#13;
&#13;
<p>Find <code>wish</code> at the beginning:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'^wish'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="go">[]</code></pre>&#13;
&#13;
<p>Find <code>I wish</code> at the beginning:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'^I wish'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="go">['I wish']</code></pre>&#13;
&#13;
<p>Find <code>fish</code> at the end:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'fish$'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="go">[]</code></pre>&#13;
&#13;
<p>Finally, find <code>fish tonight.</code> at the end:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'fish tonight.$'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="go">['fish tonight.']</code></pre>&#13;
&#13;
<p><a data-primary="$ (anchor)" data-type="indexterm" id="idm45794988566248"/><a data-primary="‸ (anchor)" data-type="indexterm" id="idm45794988565528"/><a data-primary="anchor ($)" data-type="indexterm" id="idm45794988564888"/>The characters <code>^</code> and <code>$</code> are called <em>anchors</em>:&#13;
<code>^</code> anchors the search to the beginning of the search string,&#13;
and <code>$</code> anchors it to the end.&#13;
<code>.$</code> matches any character at the end of the line,&#13;
including a period, so that worked.&#13;
To be more precise, we should escape the dot&#13;
to match it literally:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'fish tonight\.$'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="go">['fish tonight.']</code></pre>&#13;
&#13;
<p>Begin by finding <code>w</code> or <code>f</code> followed by <code>ish</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'[wf]ish'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="go">['wish', 'wish', 'fish']</code></pre>&#13;
&#13;
<p>Find one or more runs of <code>w</code>, <code>s</code>, or <code>h</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'[wsh]+'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="go">['w', 'sh', 'w', 'sh', 'h', 'sh', 'sh', 'h']</code></pre>&#13;
&#13;
<p>Find <code>ght</code> followed by a non-alphanumeric:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'ght\W'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="go">['ght\n', 'ght.']</code></pre>&#13;
&#13;
<p>Find <code>I</code> followed by <code>wish</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'I (?=wish)'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="go">['I ', 'I ']</code></pre>&#13;
&#13;
<p>And last, <code>wish</code> preceded by <code>I</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'(?&lt;=I) wish'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="go">[' wish', ' wish']</code></pre>&#13;
&#13;
<p>I mentioned earlier that&#13;
there are a few cases in which the regular expression&#13;
pattern rules conflict with the Python string rules.&#13;
The following pattern should match any word that begins&#13;
with <code>fish</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">'</code><code class="se">\b</code><code class="s">fish'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="go">[]</code></pre>&#13;
&#13;
<p>Why doesn’t it?&#13;
As is discussed in <a data-type="xref" href="ch05.html#ch_strings">Chapter 5</a>,&#13;
Python employs a few special&#13;
<em>escape characters</em> for strings.&#13;
For example, <code>\b</code> means backspace in strings,&#13;
but in the mini-language of regular expressions it means&#13;
the beginning of a word.&#13;
Avoid the accidental use of escape characters&#13;
by using Python’s&#13;
<em>raw strings</em> when you define your regular expression string.&#13;
Always put an <code>r</code> character before your regular expression&#13;
pattern string, and Python escape characters&#13;
will be disabled, as demonstrated here:<a data-startref="ix_ch12-munging-asciidoc8" data-type="indexterm" id="idm45794988336312"/></p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">re</code><code class="o">.</code><code class="n">findall</code><code class="p">(</code><code class="s">r'\bfish'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="go">['fish']</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Patterns: Specifying match() Output" data-type="sect2"><div class="sect2" id="regex_match_output">&#13;
<h2>Patterns: Specifying match() Output</h2>&#13;
&#13;
<p><a data-primary="match() function" data-secondary="specifying output" data-type="indexterm" id="idm45794988303816"/><a data-primary="regular expressions" data-secondary="specifying match output" data-type="indexterm" id="idm45794988302616"/>When using <code>match()</code> or <code>search()</code>,&#13;
all matches are returned from the result object <code>m</code>&#13;
as <code>m.group()</code>.&#13;
If you enclose a pattern in parentheses,&#13;
the match will be saved to its own group,&#13;
and a tuple of them will be available as <code>m.groups()</code>,&#13;
as shown here:<a data-startref="ix_ch12-munging-asciidoc5" data-type="indexterm" id="idm45794988299256"/><a data-startref="ix_ch12-munging-asciidoc4" data-type="indexterm" id="idm45794988298552"/></p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">m</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">search</code><code class="p">(</code><code class="s">r'(. dish\b).*(\bfish)'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">()</code>&#13;
<code class="go">'a dish of fish'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code><code class="o">.</code><code class="n">groups</code><code class="p">()</code>&#13;
<code class="go">('a dish', 'fish')</code></pre>&#13;
&#13;
<p>If you use this pattern&#13;
<code>(?P&lt;</code> <em><code>name</code></em> <code>&gt;</code> <em><code>expr</code></em> <code>)</code>,&#13;
it will match <em><code>expr</code></em>,&#13;
saving the match in group <em><code>name</code></em>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">m</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">search</code><code class="p">(</code><code class="s">r'(?P&lt;DISH&gt;. dish\b).*(?P&lt;FISH&gt;\bfish)'</code><code class="p">,</code> <code class="n">source</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">()</code>&#13;
<code class="go">'a dish of fish'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code><code class="o">.</code><code class="n">groups</code><code class="p">()</code>&#13;
<code class="go">('a dish', 'fish')</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">(</code><code class="s">'DISH'</code><code class="p">)</code>&#13;
<code class="go">'a dish'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">m</code><code class="o">.</code><code class="n">group</code><code class="p">(</code><code class="s">'FISH'</code><code class="p">)</code>&#13;
<code class="go">'fish'</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Binary Data" data-type="sect1"><div class="sect1" id="binary_data">&#13;
<h1>Binary Data</h1>&#13;
&#13;
<p><a data-primary="binary data" data-type="indexterm" id="ix_ch12-munging-asciidoc9"/><a data-primary="data structures" data-secondary="binary data" data-type="indexterm" id="ix_ch12-munging-asciidoc10"/>Text data can be challenging,&#13;
but binary data can be, well, interesting.&#13;
You need to know about concepts such as&#13;
<em>endianness</em> (how your computer’s processor breaks data into bytes)&#13;
and <em>sign bits</em> for integers.&#13;
You might need to delve into binary file formats&#13;
or network packets&#13;
to extract or even change data.&#13;
This section shows you the basics of&#13;
binary data wrangling in Python.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="bytes and bytearray" data-type="sect2"><div class="sect2" id="bytes">&#13;
<h2>bytes and bytearray</h2>&#13;
&#13;
<p><a data-primary="binary data" data-secondary="bytes and bytearrays" data-type="indexterm" id="ix_ch12-munging-asciidoc11"/><a data-primary="bytearrays" data-type="indexterm" id="ix_ch12-munging-asciidoc12"/><a data-primary="bytes" data-type="indexterm" id="ix_ch12-munging-asciidoc13"/>Python 3 introduced the following sequences of eight-bit integers,&#13;
with possible values from 0 to 255,&#13;
in two types:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><em>bytes</em> is immutable, like a tuple of bytes</p>&#13;
</li>&#13;
<li>&#13;
<p><em>bytearray</em> is mutable, like a list of bytes</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Beginning with a list called <code>blist</code>,&#13;
this next example creates a <code>bytes</code> variable called <code>the_bytes</code>&#13;
and a <code>bytearray</code> variable called <code>the_byte_array</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">blist</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">,</code> <code class="mi">255</code><code class="p">]</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">the_bytes</code> <code class="o">=</code> <code class="nb">bytes</code><code class="p">(</code><code class="n">blist</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">the_bytes</code>&#13;
<code class="go">b'\x01\x02\x03\xff'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">the_byte_array</code> <code class="o">=</code> <code class="nb">bytearray</code><code class="p">(</code><code class="n">blist</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">the_byte_array</code>&#13;
<code class="go">bytearray(b'\x01\x02\x03\xff')</code></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The representation of a <code>bytes</code> value begins with a <code>b</code>&#13;
and a quote character, followed by hex sequences&#13;
such as <code>\x02</code> or ASCII characters,&#13;
and ends with a matching quote character.&#13;
Python converts the hex sequences or ASCII characters&#13;
to little integers,&#13;
but shows byte values that are also valid ASCII encodings&#13;
as ASCII <span class="keep-together">characters:</span></p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">b</code><code class="s">'</code><code class="se">\x61</code><code class="s">'</code>&#13;
<code class="go">b'a'</code></pre>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">b</code><code class="s">'</code><code class="se">\x01</code><code class="s">abc</code><code class="se">\xff</code><code class="s">'</code>&#13;
<code class="go">b'\x01abc\xff'</code></pre>&#13;
</div>&#13;
&#13;
<p>This next example demonstrates that you can’t change&#13;
a <code>bytes</code> variable:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">blist</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">,</code> <code class="mi">255</code><code class="p">]</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">the_bytes</code> <code class="o">=</code> <code class="nb">bytes</code><code class="p">(</code><code class="n">blist</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">the_bytes</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code> <code class="o">=</code> <code class="mi">127</code>&#13;
<code class="gt">Traceback (most recent call last):</code>&#13;
  File <code class="nb">"&lt;stdin&gt;"</code>, line <code class="m">1</code>, in <code class="n">&lt;module&gt;</code>&#13;
<code class="gr">TypeError</code>: <code class="n">'bytes' object does not support item assignment</code></pre>&#13;
&#13;
<p>But a <code>bytearray</code> variable is mellow and mutable:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">blist</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">,</code> <code class="mi">255</code><code class="p">]</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">the_byte_array</code> <code class="o">=</code> <code class="nb">bytearray</code><code class="p">(</code><code class="n">blist</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">the_byte_array</code>&#13;
<code class="go">bytearray(b'\x01\x02\x03\xff')</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">the_byte_array</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code> <code class="o">=</code> <code class="mi">127</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">the_byte_array</code>&#13;
<code class="go">bytearray(b'\x01\x7f\x03\xff')</code></pre>&#13;
&#13;
<p>Each of these would create a 256-element result,&#13;
with values from 0 to 255:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">the_bytes</code> <code class="o">=</code> <code class="nb">bytes</code><code class="p">(</code><code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">256</code><code class="p">))</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">the_byte_array</code> <code class="o">=</code> <code class="nb">bytearray</code><code class="p">(</code><code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">256</code><code class="p">))</code></pre>&#13;
&#13;
<p>When printing <code>bytes</code> or <code>bytearray</code> data,&#13;
Python uses <code>\x</code><em><code>xx</code></em> for nonprintable bytes&#13;
and their ASCII equivalents for printable ones&#13;
(plus some common escape characters, such as <code>\n</code>&#13;
instead of <code>\x0a</code>).&#13;
Here’s the printed representation of <code>the_bytes</code>&#13;
(manually reformatted to show 16 bytes per line):</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">the_bytes</code>&#13;
<code class="go">b'\x00\x01\x02\x03\x04\x05\x06\x07\x08\t\n\x0b\x0c\r\x0e\x0f</code>&#13;
<code class="go">\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f</code>&#13;
<code class="go">!"#$%&amp;\'()*+,-./</code>&#13;
<code class="go">0123456789:;&lt;=&gt;?</code>&#13;
<code class="go">@ABCDEFGHIJKLMNO</code>&#13;
<code class="go">PQRSTUVWXYZ[\\]^_</code>&#13;
<code class="go">`abcdefghijklmno</code>&#13;
<code class="go">pqrstuvwxyz{|}~\x7f</code>&#13;
<code class="go">\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f</code>&#13;
<code class="go">\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f</code>&#13;
<code class="go">\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf</code>&#13;
<code class="go">\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf</code>&#13;
<code class="go">\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf</code>&#13;
<code class="go">\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf</code>&#13;
<code class="go">\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef</code>&#13;
<code class="go">\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff'</code></pre>&#13;
&#13;
<p>This can be confusing, because they’re bytes&#13;
(teeny integers), not characters.<a data-startref="ix_ch12-munging-asciidoc13" data-type="indexterm" id="idm45794987888072"/><a data-startref="ix_ch12-munging-asciidoc12" data-type="indexterm" id="idm45794987887464"/><a data-startref="ix_ch12-munging-asciidoc11" data-type="indexterm" id="idm45794987886856"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Convert Binary Data with struct" data-type="sect2"><div class="sect2" id="struct">&#13;
<h2>Convert Binary Data with struct</h2>&#13;
&#13;
<p><a data-primary="binary data" data-secondary="converting with struct" data-type="indexterm" id="ix_ch12-munging-asciidoc14"/><a data-primary="struct module" data-type="indexterm" id="ix_ch12-munging-asciidoc15"/>As you’ve seen, Python has many tools for manipulating text.&#13;
Tools for binary data are much less prevalent.&#13;
The standard library contains the <code>struct</code> module,&#13;
which handles data&#13;
similar to <em>structs</em> in C and C++.&#13;
Using <code>struct</code>,&#13;
you can convert binary data to and from Python data structures.</p>&#13;
&#13;
<p><a data-primary="PNG files" data-type="indexterm" id="ix_ch12-munging-asciidoc16"/>Let’s see how this works with data from a PNG file—a common image format that you’ll see along with GIF and JPEG files.&#13;
We’ll write a small program that extracts the width&#13;
and height of an image from some PNG data.</p>&#13;
&#13;
<p>We’ll use the O’Reilly logo—the little bug-eyed tarsier shown in <a data-type="xref" href="#fig_12-1">Figure 12-1</a>.</p>&#13;
&#13;
<figure><div class="figure" id="fig_12-1">&#13;
<img alt="inp2 1201" src="assets/inp2_1201.png"/>&#13;
<h6><span class="label">Figure 12-1. </span>The O’Reilly tarsier</h6>&#13;
</div></figure>&#13;
&#13;
<p>The PNG file for this image is available on <a href="http://bit.ly/orm-logo">Wikipedia</a>.&#13;
I don’t show how to read files until <a data-type="xref" href="ch14.html#ch_files">Chapter 14</a>,&#13;
so I downloaded this file,&#13;
wrote a little program to print its values as bytes,&#13;
and just typed the&#13;
values of the first 30 bytes&#13;
into a Python <code>bytes</code> variable called <code>data</code> for the example that follows.&#13;
(The PNG format specification says that&#13;
the width and height are stored within the first 24 bytes,&#13;
so we don’t need more than that for now.)</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">struct</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">valid_png_header</code> <code class="o">=</code> <code class="n">b</code><code class="s">'</code><code class="se">\x89</code><code class="s">PNG</code><code class="se">\r\n\x1a\n</code><code class="s">'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">data</code> <code class="o">=</code> <code class="n">b</code><code class="s">'</code><code class="se">\x89</code><code class="s">PNG</code><code class="se">\r\n\x1a\n\x00\x00\x00\r</code><code class="s">IHDR'</code> <code class="o">+</code> \&#13;
<code class="gp">... </code>    <code class="n">b</code><code class="s">'</code><code class="se">\x00\x00\x00\x9a\x00\x00\x00\x8d\x08\x02\x00\x00\x00\xc0</code><code class="s">'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">if</code> <code class="n">data</code><code class="p">[:</code><code class="mi">8</code><code class="p">]</code> <code class="o">==</code> <code class="n">valid_png_header</code><code class="p">:</code>&#13;
<code class="gp">... </code>    <code class="n">width</code><code class="p">,</code> <code class="n">height</code> <code class="o">=</code> <code class="n">struct</code><code class="o">.</code><code class="n">unpack</code><code class="p">(</code><code class="s">'&gt;LL'</code><code class="p">,</code> <code class="n">data</code><code class="p">[</code><code class="mi">16</code><code class="p">:</code><code class="mi">24</code><code class="p">])</code>&#13;
<code class="gp">... </code>    <code class="k">print</code><code class="p">(</code><code class="s">'Valid PNG, width'</code><code class="p">,</code> <code class="n">width</code><code class="p">,</code> <code class="s">'height'</code><code class="p">,</code> <code class="n">height</code><code class="p">)</code>&#13;
<code class="gp">... </code><code class="k">else</code><code class="p">:</code>&#13;
<code class="gp">... </code>    <code class="k">print</code><code class="p">(</code><code class="s">'Not a valid PNG'</code><code class="p">)</code>&#13;
<code class="gp">...</code>&#13;
<code class="go">Valid PNG, width 154 height 141</code></pre>&#13;
&#13;
<p>Here’s what this code does:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>data</code> contains the first 30 bytes from the PNG file. To fit&#13;
on the page, I joined two byte strings with <code>+</code>&#13;
and the continuation character (<code>\</code>).</p>&#13;
</li>&#13;
<li>&#13;
<p><code>valid_png_header</code> contains the eight-byte sequence&#13;
that marks the start of a valid PNG file.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>width</code> is extracted from bytes 16–19,&#13;
and <code>height</code> from bytes 20–23.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>The <code>&gt;LL</code> is the format string that instructs <code>unpack()</code> how to&#13;
interpret its input byte sequences and assemble them&#13;
into Python data types. Here’s the breakdown:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>The <code>&gt;</code> means that integers are stored in <em>big-endian</em> format.</p>&#13;
</li>&#13;
<li>&#13;
<p>Each <code>L</code> specifies a four-byte unsigned long integer.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>You can examine each four-byte value directly:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">data</code><code class="p">[</code><code class="mi">16</code><code class="p">:</code><code class="mi">20</code><code class="p">]</code>&#13;
<code class="go">b'\x00\x00\x00\x9a'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">data</code><code class="p">[</code><code class="mi">20</code><code class="p">:</code><code class="mi">24</code><code class="p">]</code><code class="mh">0x9a</code>&#13;
<code class="go">b'\x00\x00\x00\x8d'</code></pre>&#13;
&#13;
<p>Big-endian integers have the most significant bytes to the left.&#13;
Because the width and height are each less than 255,&#13;
they fit into&#13;
the last byte of each sequence.&#13;
You can verify that these hex values match&#13;
the expected decimal values:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="mh">0x9a</code>&#13;
<code class="go">154</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="mh">0x8d</code>&#13;
<code class="go">141</code></pre>&#13;
&#13;
<p>When you want to go in the other direction&#13;
and convert Python data to bytes,&#13;
use the <code>struct</code> <code>pack()</code> function:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">struct</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">struct</code><code class="o">.</code><code class="n">pack</code><code class="p">(</code><code class="s">'&gt;L'</code><code class="p">,</code> <code class="mi">154</code><code class="p">)</code>&#13;
<code class="go">b'\x00\x00\x00\x9a'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">struct</code><code class="o">.</code><code class="n">pack</code><code class="p">(</code><code class="s">'&gt;L'</code><code class="p">,</code> <code class="mi">141</code><code class="p">)</code>&#13;
<code class="go">b'\x00\x00\x00\x8d'</code></pre>&#13;
&#13;
<p>Tables <a data-type="xref" data-xrefstyle="select:labelnumber" href="#struct_endian_table">12-4</a> and&#13;
<a data-type="xref" data-xrefstyle="select:labelnumber" href="#struct_specifier_table">12-5</a> show the format specifiers for <code>pack()</code> and <code>unpack()</code>.</p>&#13;
&#13;
<p>The endian specifiers go first in the format string.</p>&#13;
<table id="struct_endian_table">&#13;
<caption><span class="label">Table 12-4. </span>Endian specifiers</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Specifier</th>&#13;
<th>Byte order</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>&lt;</code></p></td>&#13;
<td><p>Little endian</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>&gt;</code></p></td>&#13;
<td><p>Big endian</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<table id="struct_specifier_table">&#13;
<caption><span class="label">Table 12-5. </span>Format specifiers</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Specifier</th>&#13;
<th>Description</th>&#13;
<th>Bytes</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>x</code></p></td>&#13;
<td><p>Skip a byte</p></td>&#13;
<td><p>1</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>b</code></p></td>&#13;
<td><p>Signed byte</p></td>&#13;
<td><p>1</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>B</code></p></td>&#13;
<td><p>Unsigned byte</p></td>&#13;
<td><p>1</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>h</code></p></td>&#13;
<td><p>Signed short integer</p></td>&#13;
<td><p>2</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>H</code></p></td>&#13;
<td><p>Unsigned short integer</p></td>&#13;
<td><p>2</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>i</code></p></td>&#13;
<td><p>Signed integer</p></td>&#13;
<td><p>4</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>I</code></p></td>&#13;
<td><p>Unsigned integer</p></td>&#13;
<td><p>4</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>l</code></p></td>&#13;
<td><p>Signed long integer</p></td>&#13;
<td><p>4</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>L</code></p></td>&#13;
<td><p>Unsigned long integer</p></td>&#13;
<td><p>4</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>Q</code></p></td>&#13;
<td><p>Unsigned long long integer</p></td>&#13;
<td><p>8</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>f</code></p></td>&#13;
<td><p>Single-precision float</p></td>&#13;
<td><p>4</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>d</code></p></td>&#13;
<td><p>Double-precision float</p></td>&#13;
<td><p>8</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>p</code></p></td>&#13;
<td><p><em>count</em> and characters</p></td>&#13;
<td><p>1 + <em>count</em></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>s</code></p></td>&#13;
<td><p>Characters</p></td>&#13;
<td><p><em>count</em></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>The type specifiers follow the endian character.&#13;
Any specifier may be preceded by a number&#13;
that indicates the <em><code>count</code></em>;&#13;
<code>5B</code> is the same as <code>BBBBB</code>.</p>&#13;
&#13;
<p>You can use a <em><code>count</code></em> prefix instead of <code>&gt;LL</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">struct</code><code class="o">.</code><code class="n">unpack</code><code class="p">(</code><code class="s">'&gt;2L'</code><code class="p">,</code> <code class="n">data</code><code class="p">[</code><code class="mi">16</code><code class="p">:</code><code class="mi">24</code><code class="p">])</code>&#13;
<code class="go">(154, 141)</code></pre>&#13;
&#13;
<p>We used the slice <code>data[16:24]</code> to&#13;
grab the interesting bytes directly.&#13;
We could also use the <code>x</code> specifier to&#13;
skip the uninteresting parts:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">struct</code><code class="o">.</code><code class="n">unpack</code><code class="p">(</code><code class="s">'&gt;16x2L6x'</code><code class="p">,</code> <code class="n">data</code><code class="p">)</code>&#13;
<code class="go">(154, 141)</code></pre>&#13;
&#13;
<p>This means:<a data-startref="ix_ch12-munging-asciidoc16" data-type="indexterm" id="idm45794987458216"/><a data-startref="ix_ch12-munging-asciidoc15" data-type="indexterm" id="idm45794987457720"/></p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Use big-endian integer format (<code>&gt;</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p>Skip 16 bytes (<code>16x</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p>Read eight bytes—two unsigned long integers (<code>2L</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p>Skip the final six bytes (<code>6x</code>)</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Other Binary Data Tools" data-type="sect2"><div class="sect2" id="binary_other">&#13;
<h2>Other Binary Data Tools</h2>&#13;
&#13;
<p><a data-primary="binary data" data-secondary="third-party tools for" data-type="indexterm" id="idm45794987450136"/>Some third-party open source packages offer the following,&#13;
more-declarative&#13;
ways of defining and extracting binary data:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="http://bit.ly/py-bitstring">bitstring</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://bit.ly/py-construct">construct</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://pypi.org/project/hachoir">hachoir</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://spika.net/py/binio">binio</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://kaitai.io">kaitai struct</a></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p><a data-type="xref" href="app02.html#app_install">Appendix B</a> has details on how to download and install&#13;
external packages such as these.&#13;
For the next example, you need to install <code>construct</code>.&#13;
Here’s all you need to do:</p>&#13;
<pre>$ <strong>pip install construct</strong></pre>&#13;
&#13;
<p>Here’s how to extract the PNG dimensions&#13;
from our <code>data</code> bytestring by using&#13;
<code class="keep-together">construct</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">from</code> <code class="nn">construct</code> <code class="kn">import</code> <code class="n">Struct</code><code class="p">,</code> <code class="n">Magic</code><code class="p">,</code> <code class="n">UBInt32</code><code class="p">,</code> <code class="n">Const</code><code class="p">,</code> <code class="n">String</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="c"># adapted from code at https://github.com/construct</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fmt</code> <code class="o">=</code> <code class="n">Struct</code><code class="p">(</code><code class="s">'png'</code><code class="p">,</code>&#13;
<code class="gp">... </code>    <code class="n">Magic</code><code class="p">(</code><code class="n">b</code><code class="s">'</code><code class="se">\x89</code><code class="s">PNG</code><code class="se">\r\n\x1a\n</code><code class="s">'</code><code class="p">),</code>&#13;
<code class="gp">... </code>    <code class="n">UBInt32</code><code class="p">(</code><code class="s">'length'</code><code class="p">),</code>&#13;
<code class="gp">... </code>    <code class="n">Const</code><code class="p">(</code><code class="n">String</code><code class="p">(</code><code class="s">'type'</code><code class="p">,</code> <code class="mi">4</code><code class="p">),</code> <code class="n">b</code><code class="s">'IHDR'</code><code class="p">),</code>&#13;
<code class="gp">... </code>    <code class="n">UBInt32</code><code class="p">(</code><code class="s">'width'</code><code class="p">),</code>&#13;
<code class="gp">... </code>    <code class="n">UBInt32</code><code class="p">(</code><code class="s">'height'</code><code class="p">)</code>&#13;
<code class="gp">... </code>    <code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">data</code> <code class="o">=</code> <code class="n">b</code><code class="s">'</code><code class="se">\x89</code><code class="s">PNG</code><code class="se">\r\n\x1a\n\x00\x00\x00\r</code><code class="s">IHDR'</code> <code class="o">+</code> \&#13;
<code class="gp">... </code>    <code class="n">b</code><code class="s">'</code><code class="se">\x00\x00\x00\x9a\x00\x00\x00\x8d\x08\x02\x00\x00\x00\xc0</code><code class="s">'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">result</code> <code class="o">=</code> <code class="n">fmt</code><code class="o">.</code><code class="n">parse</code><code class="p">(</code><code class="n">data</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">print</code><code class="p">(</code><code class="n">result</code><code class="p">)</code>&#13;
<code class="go">Container:</code>&#13;
<code class="go">    length = 13</code>&#13;
<code class="go">    type = b'IHDR'</code>&#13;
<code class="go">    width = 154</code>&#13;
<code class="go">    height = 141</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">print</code><code class="p">(</code><code class="n">result</code><code class="o">.</code><code class="n">width</code><code class="p">,</code> <code class="n">result</code><code class="o">.</code><code class="n">height</code><code class="p">)</code>&#13;
<code class="go">154, 141</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Convert Bytes/Strings with binascii()" data-type="sect2"><div class="sect2" id="binascii">&#13;
<h2>Convert Bytes/Strings with binascii()</h2>&#13;
&#13;
<p><a data-primary="binary data" data-secondary="converting bytes/strings with binascii()" data-type="indexterm" id="idm45794987280904"/><a data-primary="binascii() function" data-type="indexterm" id="idm45794987279736"/>The standard <code>binascii</code> module has functions to convert&#13;
between binary data and various string representations:&#13;
hex (base 16), base 64, uuencoded, and others.&#13;
For example, in the next snippet,&#13;
let’s print that eight-byte PNG header&#13;
as a sequence of hex values,&#13;
instead of the mixture of ASCII and <code>\x</code> <em>xx</em> escapes&#13;
that Python uses to display <em>bytes</em> variables:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">binascii</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">valid_png_header</code> <code class="o">=</code> <code class="n">b</code><code class="s">'</code><code class="se">\x89</code><code class="s">PNG</code><code class="se">\r\n\x1a\n</code><code class="s">'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">print</code><code class="p">(</code><code class="n">binascii</code><code class="o">.</code><code class="n">hexlify</code><code class="p">(</code><code class="n">valid_png_header</code><code class="p">))</code>&#13;
<code class="go">b'89504e470d0a1a0a'</code></pre>&#13;
&#13;
<p>Hey, this thing works backward, too:<a data-startref="ix_ch12-munging-asciidoc14" data-type="indexterm" id="idm45794987192472"/></p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="k">print</code><code class="p">(</code><code class="n">binascii</code><code class="o">.</code><code class="n">unhexlify</code><code class="p">(</code><code class="n">b</code><code class="s">'89504e470d0a1a0a'</code><code class="p">))</code>&#13;
<code class="go">b'\x89PNG\r\n\x1a\n'</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Bit Operators" data-type="sect2"><div class="sect2" id="bit_operators">&#13;
<h2>Bit Operators</h2>&#13;
&#13;
<p><a data-primary="binary data" data-secondary="bit-level integer operators" data-type="indexterm" id="idm45794987137784"/><a data-primary="bit-level integer operators" data-type="indexterm" id="idm45794987136616"/><a data-primary="integers" data-secondary="bit-level operators" data-type="indexterm" id="idm45794987266760"/>Python provides bit-level integer operators,&#13;
similar to those in the C language.&#13;
<a data-type="xref" href="#bit_operator_table">Table 12-6</a> summarizes them&#13;
and includes examples&#13;
with the integer variables&#13;
<code>x</code> (decimal <code>5</code>, binary <code>0b0101</code>)&#13;
and&#13;
<code>y</code> (decimal <code>1</code>, binary <code>0b0001</code>).</p>&#13;
<table id="bit_operator_table">&#13;
<caption><span class="label">Table 12-6. </span>Bit-level integer operators</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Operator</th>&#13;
<th>Description</th>&#13;
<th>Example</th>&#13;
<th>Decimal result</th>&#13;
<th>Binary result</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>&amp;</code></p></td>&#13;
<td><p>And</p></td>&#13;
<td><p><code>x &amp; y</code></p></td>&#13;
<td><p><code>1</code></p></td>&#13;
<td><p><code>0b0001</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>|</code></p></td>&#13;
<td><p>Or</p></td>&#13;
<td><p><code>x | y</code></p></td>&#13;
<td><p><code>5</code></p></td>&#13;
<td><p><code>0b0101</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>^</code></p></td>&#13;
<td><p>Exclusive or</p></td>&#13;
<td><p><code>x ^ y</code></p></td>&#13;
<td><p><code>4</code></p></td>&#13;
<td><p><code>0b0100</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>~</code></p></td>&#13;
<td><p>Flip bits</p></td>&#13;
<td><p><code>~x</code></p></td>&#13;
<td><p><code>-6</code></p></td>&#13;
<td><p><em>binary representation depends on int size</em></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>&lt;&lt;</code></p></td>&#13;
<td><p>Left shift</p></td>&#13;
<td><p><code>x &lt;&lt; 1</code></p></td>&#13;
<td><p><code>10</code></p></td>&#13;
<td><p><code>0b1010</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>&gt;&gt;</code></p></td>&#13;
<td><p>Right shift</p></td>&#13;
<td><p><code>x &gt;&gt; 1</code></p></td>&#13;
<td><p><code>2</code></p></td>&#13;
<td><p><code>0b0010</code></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>These operators work something like the&#13;
set operators in <a data-type="xref" href="ch08.html#ch_dicts">Chapter 8</a>.&#13;
The <code>&amp;</code> operator returns bits that are the same in both arguments,&#13;
and <code>|</code> returns bits that are set in either of them.&#13;
The <code>^</code> operator returns bits that are in one or the other,&#13;
but not both.&#13;
The <code>~</code> operator reverses all the bits in its single argument;&#13;
this also reverses the sign because an integer’s highest bit&#13;
indicates its sign (<code>1</code> = negative)&#13;
in <em>two’s complement</em> arithmetic, used in all modern computers.&#13;
The <code>&lt;&lt;</code> and <code>&gt;&gt;</code> operators just move bits to the left or right.&#13;
A left shift of one bit is the same as multiplying by two,&#13;
and a right shift is the same as dividing by two.<a data-startref="ix_ch12-munging-asciidoc10" data-type="indexterm" id="idm45794987108488"/><a data-startref="ix_ch12-munging-asciidoc9" data-type="indexterm" id="idm45794987107816"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="A Jewelry Analogy" data-type="sect1"><div class="sect1" id="jewelry">&#13;
<h1>A Jewelry Analogy</h1>&#13;
&#13;
<p>Unicode strings are like charm bracelets,&#13;
and bytes are like strands of beads.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Coming Up" data-type="sect1"><div class="sect1" id="idm45794987105576">&#13;
<h1>Coming Up</h1>&#13;
&#13;
<p>Next is another practical chapter: how to handle dates and times.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Things to Do" data-type="sect1"><div class="sect1" id="thingstodo12">&#13;
<h1>Things to Do</h1>&#13;
&#13;
<p>12.1&#13;
<a data-primary="binary data" data-secondary="practice exercises" data-type="indexterm" id="idm45794987101832"/><a data-primary="strings" data-secondary="practice exercises" data-type="indexterm" id="idm45794987100856"/><a data-primary="Unicode text strings" data-secondary="practice exercises" data-type="indexterm" id="idm45794987099880"/>Create a Unicode string called <code>mystery</code>&#13;
and assign it the value <code>'\U0001f984'</code>.&#13;
Print <code>mystery</code> and its Unicode name.</p>&#13;
&#13;
<p>12.2&#13;
Encode <code>mystery</code>, this time using UTF-8,&#13;
into the <code>bytes</code> variable <code>pop_bytes</code>. Print <code>pop_bytes</code>.</p>&#13;
&#13;
<p>12.3&#13;
Using UTF-8, decode <code>pop_bytes</code> into the string variable&#13;
<code>pop_string</code>.&#13;
Print <code>pop_string</code>.&#13;
Is <code>pop_string</code> equal to <code>mystery</code>?</p>&#13;
&#13;
<p>12.4&#13;
When you’re working with text,&#13;
regular expressions come in very handy.&#13;
We’ll apply them in a number of ways to our featured text sample.&#13;
It’s a poem titled “Ode on the Mammoth Cheese,”&#13;
written by James McIntyre in 1866 in homage to&#13;
a seven-thousand-pound cheese that was crafted in Ontario&#13;
and sent on an international tour.&#13;
If you’d rather not type all of it,&#13;
use your favorite search engine and&#13;
cut and paste the words into your Python program, or just grab it from&#13;
<a href="http://bit.ly/mcintyre-poetry">Project Gutenberg</a>.&#13;
Call the text string <code>mammoth</code>.</p>&#13;
<div data-type="example" id="mammoth">&#13;
<h5><span class="label">Example 12-1. </span>mammoth.txt</h5>&#13;
&#13;
<pre data-type="programlisting">We have seen thee, queen of cheese,&#13;
Lying quietly at your ease,&#13;
Gently fanned by evening breeze,&#13;
Thy fair form no flies dare seize.&#13;
&#13;
All gaily dressed soon you'll go&#13;
To the great Provincial show,&#13;
To be admired by many a beau&#13;
In the city of Toronto.&#13;
&#13;
Cows numerous as a swarm of bees,&#13;
Or as the leaves upon the trees,&#13;
It did require to make thee please,&#13;
And stand unrivalled, queen of cheese.&#13;
&#13;
May you not receive a scar as&#13;
We have heard that Mr. Harris&#13;
Intends to send you off as far as&#13;
The great world's show at Paris.&#13;
&#13;
Of the youth beware of these,&#13;
For some of them might rudely squeeze&#13;
And bite your cheek, then songs or glees&#13;
We could not sing, oh! queen of cheese.&#13;
&#13;
We'rt thou suspended from balloon,&#13;
You'd cast a shade even at noon,&#13;
Folks would think it was the moon&#13;
About to fall and crush them soon.</pre></div>&#13;
&#13;
<p>12.5&#13;
Import the <code>re</code> module to use&#13;
Python’s regular expression functions.&#13;
Use the <code>re.findall()</code> to print all the words that begin with <code>c</code>.</p>&#13;
&#13;
<p>12.6&#13;
Find all four-letter words that begin with <code>c</code>.</p>&#13;
&#13;
<p>12.7&#13;
Find all the words that end with <code>r</code>.</p>&#13;
&#13;
<p>12.8&#13;
Find all words that contain exactly three vowels in a row.</p>&#13;
&#13;
<p>12.9&#13;
Use <code>unhexlify</code> to convert this hex string&#13;
(combined from two strings to fit on a page)&#13;
to a <code>bytes</code> variable called <code>gif</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="go">'47494638396101000100800000000000ffffff21f9' +</code>&#13;
<code class="go">'0401000000002c000000000100010000020144003b'</code></pre>&#13;
&#13;
<p>12.10&#13;
The bytes in <code>gif</code> define a one-pixel transparent GIF file,&#13;
one of the most common graphics file formats.&#13;
A legal GIF starts with the ASCII characters <em>GIF89a</em>.&#13;
Does <code>gif</code> match this?</p>&#13;
&#13;
<p>12.11&#13;
The pixel width of a GIF is a 16-bit little-endian integer&#13;
beginning at byte offset 6,&#13;
and the height is the same size,&#13;
starting at offset 8.&#13;
Extract and print these values for <code>gif</code>.&#13;
Are they both <code>1</code>?</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<div data-type="footnotes"><p data-type="footnote" id="idm45794991539400"><sup><a href="ch12.html#idm45794991539400-marker">1</a></sup> This wine has an umlaut in Germany, but loses it in Alsace on the way to France.</p><p data-type="footnote" id="idm45794991521032"><sup><a href="ch12.html#idm45794991521032-marker">2</a></sup> Base 16, specified with characters <code>0</code>-<code>9</code> and <code>A</code>-<code>F</code>.</p><p data-type="footnote" id="idm45794990473800"><sup><a href="ch12.html#idm45794990473800-marker">3</a></sup> See the HTML5 named-character reference <a href="https://oreil.ly/pmBWO">chart</a>.</p></div></div></section></body></html>