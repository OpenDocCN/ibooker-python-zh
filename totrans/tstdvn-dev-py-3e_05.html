<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 1. Getting Django Set Up Using a &#10;Functional Test" data-type="chapter" epub:type="chapter"><div class="chapter" id="chapter_01">
<h1><span class="label">Chapter 1. </span>Getting Django Set Up Using a 
<span class="keep-together">Functional Test</span></h1>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id201">
<h1>A Note for Early Release Readers</h1>
<p>With Early Release ebooks, you get books in their earliest form—the author’s raw and unedited content as they write—so you can take advantage of these technologies long before the official release of these titles.</p>
<p>This will be the 1st chapter of the final book. The GitHub repo is available at <a class="bare" href="https://github.com/hjwp/book-example"><em class="hyperlink">https://github.com/hjwp/book-example</em></a>.</p>
<p>If you have comments about how we might improve the content and/or examples in this book, or if you notice missing material within this chapter, please reach out to the author at <a href="mailto:obeythetestinggoat@gmail.com">obeythetestinggoat@gmail.com</a>.</p>
</div></aside>
<p>TDD isn’t something that comes naturally.
It’s a discipline, like a martial art, and just like in a Kung Fu movie,
you need a bad-tempered and unreasonable master to force you to learn the discipline.
Ours is the Testing Goat.</p>
<section data-pdf-bookmark="Obey the Testing Goat! Do Nothing Until You Have a Test" data-type="sect1"><div class="sect1" id="id71">
<h1>Obey the Testing Goat! Do Nothing Until You Have a Test</h1>
<p><a data-primary="Testing Goat" data-secondary="defined" data-type="indexterm" id="id202"/>
The Testing Goat is the unofficial mascot<sup><a data-type="noteref" href="ch01.xhtml#id203" id="id203-marker">1</a></sup>
of TDD in the Python testing community.
It probably means different things to different people,
but, to me, the Testing Goat is a voice inside my head
that keeps me on the True Path of Testing—​like
one of those little angels or demons that pop up above your shoulder in the cartoons,
but with a very niche set of concerns.
I hope, with this book, to install the Testing Goat inside your head too.</p>
<p>So we’ve decided to build a web app, even if we’re not quite sure what it’s going to do yet.
Normally the first step in web development is getting your web framework installed and configured.
<em>Download this, install that, configure the other, run the script</em>…​
but TDD requires a different mindset.
When you’re doing TDD,
you always have the Testing Goat inside
your head—​single-minded as goats are—​bleating
“Test first, test first!”</p>
<p>In TDD the first step is always the same: <em>write a test</em>.</p>
<p><em>First</em> we write the test; <em>then</em> we run it and check that it fails as expected.
<em>Only then</em> do we go ahead and build some of our app.
Repeat that to yourself in a goat-like voice.  I know I do.</p>
<p>Another thing about goats is that they take one step at a time.
That’s why they seldom fall off things, see, no matter how steep they are.
As you can see in <a data-type="xref" href="#tree_goat">Figure 1-1</a>.</p>
<figure><div class="figure" id="tree_goat">
<img alt="A picture of a goat up a tree" height="726" src="assets/twp2_0101.png" width="478"/>
<h6><span class="label">Figure 1-1. </span>Goats are more agile than you think (source: <a href="http://www.flickr.com/photos/caitlinstewart/2846642630/">Caitlin Stewart, on Flickr</a>)</h6>
</div></figure>
<p>We’ll proceed with nice small steps;
we’re going to use <em>Django</em>, which is a popular Python web framework, to build our app.</p>
<p><a data-primary="Django framework" data-secondary="set up" data-type="indexterm" id="DJFsetup01"/>
The first thing we want to do is check that we’ve got Django installed
and that it’s ready for us to work with.
The <em>way</em> we’ll check is by confirming that we can spin up Django’s development server
and actually see it serving up a web page, in our web browser, on our local computer.
We’ll use the <em>Selenium</em> browser automation tool for this.</p>
<p id="first-FT"><a data-primary="functional tests (FTs)" data-secondary="creating" data-type="indexterm" id="id204"/>
Create a new Python file called <em>functional_tests.py</em>,
wherever you want to keep the code for your project, and enter the following code.
If you feel like making a few little goat noises as you do it, it may help:</p>
<div class="sourcecode" data-type="example">
<p>functional_tests.py</p>
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">selenium</code> <code class="kn">import</code> <code class="n">webdriver</code>

<code class="n">browser</code> <code class="o">=</code> <code class="n">webdriver</code><code class="o">.</code><code class="n">Firefox</code><code class="p">()</code>
<code class="n">browser</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s2">"http://localhost:8000"</code><code class="p">)</code>

<code class="k">assert</code> <code class="s2">"Congratulations!"</code> <code class="ow">in</code> <code class="n">browser</code><code class="o">.</code><code class="n">title</code>
<code class="nb">print</code><code class="p">(</code><code class="s2">"OK"</code><code class="p">)</code></pre></div>
<p>That’s our first <em>functional test</em> (FT);
I’ll talk more about what I mean by functional tests,
and how they contrast with unit tests, in a bit.
For now, it’s enough to assure ourselves that we understand what it’s doing:</p>
<ul>
<li>
<p>Starting a Selenium “webdriver” to pop up a real Firefox browser window.</p>
</li>
<li>
<p>Using it to open up a web page which we’re expecting to be served from the local computer.</p>
</li>
<li>
<p>Checking (making a test assertion) that the page has the word “Congratulations!” in its title.</p>
</li>
<li>
<p>If all goes well we print OK.</p>
</li>
</ul>
<p>Let’s try running it:</p>
<pre data-type="programlisting">$ <strong>python functional_tests.py</strong>
Traceback (most recent call last):
  File "...goat-book/functional_tests.py", line 4, in &lt;module&gt;
    browser.get("http://localhost:8000")
  File ".../selenium/webdriver/remote/webdriver.py", line 449, in get
    self.execute(Command.GET, {"url": url})
  File ".../selenium/webdriver/remote/webdriver.py", line 440, in execute
    self.error_handler.check_response(response)
  File ".../selenium/webdriver/remote/errorhandler.py", line 245, in
check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.WebDriverException: Message: Reached error page: abo
ut:neterror?e=connectionFailure&amp;u=http%3A//localhost%3A8000/[...]
Stacktrace:
RemoteError@chrome://remote/content/shared/RemoteError.sys.mjs:8:8
WebDriverError@chrome://remote/content/shared/webdriver/Errors.sys.mjs:180:6
UnknownError@chrome://remote/content/shared/webdriver/Errors.sys.mjs:507:5
[...]</pre>
<p>You should see a browser window pop up and try to open <em>localhost:8000</em>,
and show the “Unable to connect” error page.
If you switch back to your console,
you’ll see the big ugly error message,
telling us that Selenium hit an error page.
And then, you will probably be irritated
at the fact that it left the Firefox window lying around your desktop for you to tidy up.
We’ll fix that later!</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If, instead, you see an error trying to import Selenium, or an error
    trying to find something called “geckodriver”, you might need
    to go back and have another look at the "<a data-type="xref" href="preface02.xhtml#pre-requisites">Prerequisites and Assumptions</a>" section.</p>
</div>
<p>For now though, we have a <em>failing test</em>,
so that means we’re allowed to start building our app.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id205">
<h1>Adieu to Roman Numerals!</h1>
<p>So many introductions to TDD use Roman numerals as an example
that it has become a running joke—​I even started writing one myself.
If you’re curious, you can find it
on <a href="https://github.com/hjwp/tdd-roman-numeral-calculator/">my GitHub page</a>.</p>
<p>Roman numerals, as an example, are both good and bad.
It’s a nice “toy” problem, reasonably limited in scope,
and you can explain the core of TDD quite well with it.</p>
<p>The problem is that it can be hard to relate to the real world.
That’s why I’ve decided to use building a real web app,
starting from nothing, as my example.
Although it’s a simple web app,
my hope is that it will be easier for you to carry across to your next real project.</p>
</div></aside>
</div></section>
<section data-pdf-bookmark="Getting Django Up and Running" data-type="sect1"><div class="sect1" id="id13">
<h1>Getting Django Up and Running</h1>
<p><a data-primary="Django framework" data-secondary="set up" data-tertiary="project creation" data-type="indexterm" id="id206"/>
Since you’ve definitely read “<a data-type="xref" href="preface02.xhtml#pre-requisites">Prerequisites and Assumptions</a>” by now,
you’ve already got Django installed (right?).
The first step in getting Django up and running is to create a <em>project</em>,
which will be the main container for our site.
Django provides a little command-line tool for this:</p>
<pre data-type="programlisting">$ <strong>django-admin startproject superlists .</strong></pre>
<p>Don’t forget that “.” at the end; it’s important!</p>
<p><a data-primary="superlists" data-type="indexterm" id="id207"/>
That will create a file called <em>manage.py</em> in your current folder,
and a subfolder called <em>superlists</em>, with more stuff inside it:</p>
<pre data-type="programlisting">.
├── functional_tests.py
├── geckodriver.log
├── manage.py
└── superlists
    ├── __init__.py
    ├── asgi.py
    ├── settings.py
    ├── urls.py
    └── wsgi.py</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Make sure your project folder looks exactly like this!
    If you see two nested folders called superlists,
    it’s because you forgot the “.” above.
    Delete them and try again,
    or there will be lots of confusion
    with paths and working directories.</p>
</div>
<p>The <em>superlists</em> folder is intended for stuff that applies to the whole project—​like <em>settings.py</em>,
for example, which is used to store global configuration information for the site.</p>
<p>But the main thing to notice is <em>manage.py</em>.
That’s Django’s Swiss Army knife,
and one of the things it can do is run a development server.
Let’s try that now:</p>
<pre data-type="programlisting">$ <strong>python manage.py runserver</strong>
Watching for file changes with StatReloader
Performing system checks...

System check identified no issues (0 silenced).

You have 18 unapplied migration(s). Your project may not work properly until
you apply the migrations for app(s): admin, auth, contenttypes, sessions.
Run 'python manage.py migrate' to apply them.
March 17, 2023 - 18:07:30
Django version 4.2, using settings 'superlists.settings'
Starting development server at <a class="bare" href="http://127.0.0.1:8000/"><em class="hyperlink">http://127.0.0.1:8000/</em></a>
Quit the server with CONTROL-C.</pre>
<p>That’s Django’s development server now up and running on our machine.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>It’s safe to ignore that message about “unapplied migrations” for now.
    We’ll look at migrations in <a data-type="xref" href="ch05.xhtml#chapter_post_and_database">Chapter 5</a>.</p>
</div>
<p>Leave it there and open another command shell.  Navigate to your project
folder, activate your virtualenv, and then try running our test again:</p>
<pre data-type="programlisting">$ <strong>python functional_tests.py</strong>
OK</pre>
<p>Not much action on the command line, but you should notice two things: firstly,
there was no ugly <code>AssertionError</code> and secondly, the Firefox window that
Selenium popped up had a different-looking page on it.</p>
<div data-type="tip"><h6>Tip</h6>
<p>If you see an error saying “no module named selenium”,
    you’ve forgotten to activate your virtualenv.
    Check the <a data-type="xref" href="preface02.xhtml#pre-requisites">Prerequisites and Assumptions</a> section again if you need to.</p>
</div>
<p>Well, it may not look like much, but that was our first ever passing test!
Hooray!</p>
<p>If it all feels a bit too much like magic, like it wasn’t quite real,
why not go and take a look at the dev server manually,
by opening a web browser yourself and visiting <em>http://localhost:8000</em>?
You should see something like <a data-type="xref" href="#installed_successfully_screenshot">Figure 1-2</a>.</p>
<p>You can quit the development server now if you like,
back in the original shell, using Ctrl-C.</p>
<figure><div class="figure" id="installed_successfully_screenshot">
<img alt="Screenshot of Django Installed Successfully Screen" height="944" src="assets/twp2_0102.png" width="1282"/>
<h6><span class="label">Figure 1-2. </span>It worked!</h6>
</div></figure>
</div></section>
<section data-pdf-bookmark="Starting a Git Repository" data-type="sect1"><div class="sect1" id="id14">
<h1>Starting a Git Repository</h1>
<p><a data-primary="Git" data-secondary="starting repositories" data-type="indexterm" id="id208"/>
<a data-primary="version control systems (VCSs)" data-seealso="Git" data-type="indexterm" id="id209"/>
There’s one last thing to do before we finish the chapter:
start to commit our work to a <em>version control system</em> (VCS).
If you’re an experienced programmer you don’t need to hear me preaching about version control,
but if you’re new to it please believe me when I say that VCS is a must-have.
As soon as your project gets to be more than a few weeks old and a few lines of code,
having a tool available to look back over old versions of code,
revert changes, explore new ideas safely, even just as a backup…​
It’s hard to overstate how useful that is.
TDD goes hand in hand with version control,
so I want to make sure I impart how it fits into the workflow.</p>
<p>So, our first commit!
If anything it’s a bit late; shame on us.
We’re using <em>Git</em> as our VCS, ’cos it’s the best.</p>
<p>Let’s start by doing the <code>git init</code> to start the repository:</p>
<pre data-type="programlisting">$ <strong>ls</strong>
db.sqlite3  functional_tests.py  geckodriver.log  manage.py  superlists

$ <strong>git init .</strong>
Initialised empty Git repository in ...goat-book/.git/</pre>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id210">
<h1>Our Working Directory Is Always the Folder that Contains <em>manage.py</em></h1>
<p>We’ll be using this same folder throughout the book
as our working directory—​if in doubt, it’s the one that contains <em>manage.py</em>.</p>
<p>(For simplicity, in my command listings, I’ll always show it as <em>…​goat-book/</em>,
although it will probably actually be something like
<em>/home/kind-reader-username/my-python-projects/goat-book/</em>.)</p>
<p>Whenever I show a command to type in, it will assume we’re in this directory.
Similarly, if I mention a path to a file, it will be relative to this directory.
So for example, <em>superlists/settings.py</em> means the <em>settings.py</em> inside the <em>superlists</em> folder.</p>
</div></aside>
<p><a data-primary="Git" data-secondary="commits" data-type="indexterm" id="id211"/>
Now let’s take a look and see what files we want to commit:</p>
<pre data-type="programlisting">$ <strong>ls</strong>
db.sqlite3 functional_tests.py geckodriver.log manage.py superlists</pre>
<p>There are a few things in here that we <em>don’t</em> want under version control:
<em>db.sqlite3</em> is the database file, <em>geckodriver.log</em> contains Selenium debug output,
and finally our virtualenv shouldn’t be in git either.
We’ll add all of them to a special file called <em>.gitignore</em> which, um, tells Git what to ignore:</p>
<pre data-type="programlisting">$ <strong>echo "db.sqlite3" &gt;&gt; .gitignore</strong>
$ <strong>echo "geckodriver.log" &gt;&gt; .gitignore</strong>
$ <strong>echo ".venv" &gt;&gt; .gitignore</strong></pre>
<p>Next we can add the rest of the contents of the current folder, “.”:</p>
<pre data-type="programlisting">$ <strong>git add .</strong>
$ <strong>git status</strong>
On branch main

No commits yet

Changes to be committed:
  (use "git rm --cached &lt;file&gt;..." to unstage)

        new file:   .gitignore
        new file:   functional_tests.py
        new file:   manage.py
        new file:   superlists/__init__.py
        new file:   superlists/__pycache__/__init__.cpython-311.pyc
        new file:   superlists/__pycache__/settings.cpython-311.pyc
        new file:   superlists/__pycache__/urls.cpython-311.pyc
        new file:   superlists/__pycache__/wsgi.cpython-311.pyc
        new file:   superlists/asgi.py
        new file:   superlists/settings.py
        new file:   superlists/urls.py
        new file:   superlists/wsgi.py</pre>
<p>Oops!  We’ve got a bunch of <em>.pyc</em> files in there;
it’s pointless to commit those.
Let’s remove them from Git and add them to <em>.gitignore</em> too:</p>
<pre data-type="programlisting">$ <strong>git rm -r --cached superlists/__pycache__</strong>
rm 'superlists/__pycache__/__init__.cpython-311.pyc'
rm 'superlists/__pycache__/settings.cpython-311.pyc'
rm 'superlists/__pycache__/urls.cpython-311.pyc'
rm 'superlists/__pycache__/wsgi.cpython-311.pyc'
$ <strong>echo "__pycache__" &gt;&gt; .gitignore</strong>
$ <strong>echo "*.pyc" &gt;&gt; .gitignore</strong></pre>
<p>Now let’s see where we are…​</p>
<pre data-type="programlisting">$ <strong>git status</strong>
On branch main

Initial commit

Changes to be committed:
  (use "git rm --cached &lt;file&gt;..." to unstage)

        new file:   .gitignore
        new file:   functional_tests.py
        new file:   manage.py
        new file:   superlists/__init__.py
        new file:   superlists/asgi.py
        new file:   superlists/settings.py
        new file:   superlists/urls.py
        new file:   superlists/wsgi.py

Changes not staged for commit:
  (use "git add &lt;file&gt;..." to update what will be committed)
  (use "git restore &lt;file&gt;..." to discard changes in working directory)

        modified:   .gitignore</pre>
<div data-type="tip"><h6>Tip</h6>
<p>You’ll see I’m using <code>git status</code> a lot—​so much so that
    I often alias it to <code>git st</code>…​I’m not telling you how to do that though;
    I leave you to discover the secrets of Git aliases on your own!</p>
</div>
<p>Looking good—​we’re ready to do our first commit!</p>
<pre data-type="programlisting">$ <strong>git add .gitignore</strong>
$ <strong>git commit</strong></pre>
<p>When you type <code>git commit</code>, it will pop up an editor window for you to write your commit message in.
Mine looked like <a data-type="xref" href="#first_git_commit">Figure 1-3</a>.<sup><a data-type="noteref" href="ch01.xhtml#id212" id="id212-marker">2</a></sup></p>
<figure><div class="figure" id="first_git_commit">
<img alt="Screenshot of git commit vi window" height="476" src="assets/twp2_0103.png" width="674"/>
<h6><span class="label">Figure 1-3. </span>First Git commit</h6>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If you want to really go to town on Git,
    this is the time to also learn about how to push your work
    to a cloud-based VCS hosting service like GitHub or GitLab.
    They’ll be useful if you think you want to follow along with this book on different computers.
    I leave it to you to find out how they work; they have excellent documentation.
    Alternatively, you can wait until [Link to Come] when we’ll be using one for deployment.</p>
</div>
<p>That’s it for the VCS lecture. Congratulations!
You’ve written a functional test using Selenium,
and you’ve gotten Django installed and running,
in a certifiable, test-first, goat-approved TDD way.
Give yourself a well-deserved pat on the back
before moving on to <a data-type="xref" href="ch02.xhtml#chapter_02_unittest">Chapter 2</a>.<a data-primary="" data-startref="DJFsetup01" data-type="indexterm" id="id213"/></p>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="id203"><sup><a href="ch01.xhtml#id203-marker">1</a></sup> OK more of a minor running joke from Pycon in the mid ’10s, which I am single-handedly trying to make into a Thing.</p><p data-type="footnote" id="id212"><sup><a href="ch01.xhtml#id212-marker">2</a></sup> Did a strange terminal-based editor (the dreaded vim) pop up and you had no idea what to do? Or did you see a message about account identity and <code>git config --global
user.username</code>? Check out the Git manual and its <a href="http://git-scm.com/book/en/Customizing-Git-Git-Configuration">basic configuration section.</a> PS - to quit vim, it’s Esc, then <code>:q!</code></p></div></div></section></div></body></html>