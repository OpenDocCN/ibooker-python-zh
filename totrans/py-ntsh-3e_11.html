<html><head></head><body>
<div id="sbo-rt-content"><section data-nutshell-tab="File and Text Operations" data-pdf-bookmark="Chapter 11. File and Text Operations" data-type="chapter" epub:type="chapter"><div class="chapter" id="file_and_text_operations">
<h1><span class="label">Chapter 11. </span>File and Text Operations</h1>
<p>This chapter covers issues related to files and filesystems in Python. A<a contenteditable="false" data-primary="file and text operations" data-secondary="definition of file" data-type="indexterm" id="idm44924519204144"/> <em>file</em> is a stream of text or bytes that a program can read and/or write; a<a contenteditable="false" data-primary="filesystem" data-secondary="definition of term" data-type="indexterm" id="idm44924519202416"/> <em>filesystem</em> is a hierarchical repository of files on a computer system.</p>
<div data-type="note" epub:type="note">
<h1>Other Chapters That Also Deal with Files</h1>
<p>Files<a contenteditable="false" data-primary="file and text operations" data-secondary="chapters discussing files" data-type="indexterm" id="idm44924519199392"/> are a crucial concept in programming: so, although this chapter is one of the largest in the book, other chapters also have material relevant to handling specific kinds of files. In particular, <a data-type="xref" href="ch12.xhtml#persistence_and_databases">Chapter 12</a> deals with many kinds of files related to persistence and database functionality (CSV files in <a data-type="xref" href="ch12.xhtml#persistence_and_databases">Chapter 12</a>, JSON files in <a data-type="xref" href="ch12.xhtml#the_json_module">“The json Module”</a>, pickle files in <a data-type="xref" href="ch12.xhtml#the_pickle_module">“The pickle Module”</a>, shelve files in <a data-type="xref" href="ch12.xhtml#the_shelve_module">“The shelve Module”</a>, DBM and DBM-like files in <a data-type="xref" href="ch12.xhtml#the_dbm_package">“The dbm Package”</a>, and SQLite database files in <a data-type="xref" href="ch12.xhtml#sqlite">“SQLite”</a>), <a data-type="xref" href="ch22.xhtml#structured_text_html">Chapter 22</a> deals with files in HTML format, and <a data-type="xref" href="ch23.xhtml#structured_text_xml">Chapter 23</a> deals with files in XML format.</p>
</div>
<p>Files<a contenteditable="false" data-primary="file and text operations" data-secondary="overview of" data-type="indexterm" id="idm44924519188464"/> and streams come in many flavors. Their contents can be arbitrary bytes, or text. They may be suitable for reading, writing, or both, and they may be<a contenteditable="false" data-primary="buffering" data-type="indexterm" id="idm44924519186800"/> <em>buffered,</em> so that data is temporarily held in memory on the way to or from the file. Files may also allow<a contenteditable="false" data-primary="random access" data-type="indexterm" id="idm44924519185008"/> <em>random access</em>, moving forward and back within the file, or jumping to read or write at a particular location in the file. This chapter covers each of these topics.</p>
<p>In addition, this chapter also covers the polymorphic concept of file-like objects (objects that are not actually files but behave to some extent like files), modules that deal with temporary files and file-like objects, and modules that help you access the contents of text and binary files and support compressed files and other data archives. Python’s standard library supports several kinds of<a contenteditable="false" data-primary="lossless compression" data-type="indexterm" id="idm44924519182912"/> <a href="https://oreil.ly/iwsUw">lossless compression</a>, including (ordered by the typical ratio of compression on a text file, from highest to lowest):</p>
<ul>
<li>
<p><a data-primary="LZMA  file compression" href="https://oreil.ly/DuCbU">LZMA</a> (used, for<a contenteditable="false" data-primary="LZMA  file compression" data-type="indexterm" id="idm44924519178832"/> example, by the <a href="https://tukaani.org/xz"><span class="code">xz</span></a> program), see module <a href="https://oreil.ly/Kw54K"><span class="code">lzma</span></a></p>
</li>
<li>
<p><a href="https://oreil.ly/9rUEj">bzip2</a> (used, for<a contenteditable="false" data-primary="bzip2 file compression" data-type="indexterm" id="idm44924519173936"/> example, by the <a href="http://www.bzip.org"><span class="code">bzip2</span></a> program), see module <a href="https://oreil.ly/LXyg_"><span class="code">bz2</span></a></p>
</li>
<li>
<p><a href="https://oreil.ly/k_iKs">deflate</a> (used, for<a contenteditable="false" data-primary="deflate file compression" data-type="indexterm" id="idm44924519168912"/> example, by the <a href="https://oreil.ly/kCtWx"><span class="code">gzip</span></a> and <a href="https://oreil.ly/an46l"><span class="code">zip</span></a> programs), see modules <a href="https://oreil.ly/-lWQP"><span class="code">zlib</span></a>, <a href="https://oreil.ly/WyFJf"><span class="code">gzip</span></a>, and <a href="https://oreil.ly/c7VxO"><span class="code">zipfile</span></a></p>
</li>
</ul>
<p>The <a href="https://oreil.ly/ZJlzh"><span class="code">tarfile</span> module</a> <a contenteditable="false" data-primary="tarfile module" data-type="indexterm" id="idm44924519160416"/><a contenteditable="false" data-primary="standard library modules" data-secondary="tarfile" data-type="indexterm" id="idm44924519159280"/>lets you read and write TAR files compressed with any one of these algorithms. The <span class="code">zipfile</span> module lets you read and write ZIP files and also handles bzip2 and LZMA compressions. We cover both of these modules in this chapter. We don’t cover the details of compression in this book; for details, see the <a href="https://oreil.ly/U0-Zx">online docs</a>.</p>
<p>In the rest of this chapter, we will refer to all files and file-like objects as files.</p>
<p>In<a contenteditable="false" data-primary="input/output (I/O)" data-type="indexterm" id="idm44924519155344"/><a contenteditable="false" data-primary="I/O (input/output)" data-type="indexterm" id="idm44924519154240"/> modern Python, input/output (I/O) is handled by the standard library’s <span class="code">io</span> module. The <span class="code">os</span> module supplies many of the functions that operate on the filesystem, so this chapter also introduces that module. It then covers operations on the filesystem (comparing, copying, and deleting directories and files; working with filepaths; and accessing low-level file descriptors) provided by the <span class="code">os</span> module, the <span class="code">os.path</span> module, and the new and preferable <span class="code">pathlib</span> module, which provides an object-oriented approach to filesystem paths. For a cross-platform interprocess communication (IPC) mechanism known as <em>memory-mapped files</em>, see the module <span class="code">mmap</span>, covered in <a data-type="xref" href="ch15.xhtml#concurrency_threads_and_processes">Chapter 15</a>.</p>
<p>While most modern programs rely on a graphical user interface (GUI), often via a browser or a smartphone app, text-based, nongraphical “command-line” user interfaces are still very popular for their ease, speed of use, and scriptability. This chapter concludes with a discussion of non-GUI text input and output in Python in <a data-type="xref" href="#text_input_and_output">“Text Input and Output”</a>, terminal text I/O in <a data-type="xref" href="#richer_text_isoliduso">“Richer-Text I/O”</a>, and, finally, how to build software showing text understandable to different users, across languages and cultures, in <a data-type="xref" href="#internationalization">“Internationalization”</a>.</p>
<section data-pdf-bookmark="The io Module" data-type="sect1"><div class="sect1" id="the_io_module">
<h1>The io Module</h1>
<p>As<a contenteditable="false" data-primary="file and text operations" data-secondary="io module" data-type="indexterm" id="FTiomod11"/><a contenteditable="false" data-primary="io module" data-type="indexterm" id="iomod11"/><a contenteditable="false" data-primary="standard library modules" data-secondary="io" data-type="indexterm" id="SLMio11"/> mentioned in this chapter’s introduction, <span class="code">io</span> is the standard library module in Python that provides the most common ways for your Python programs to read or write files. In modern Python, the built-in function <span class="code">open</span> is an alias for the function <span class="code">io.open</span>. Use <span class="code">io.</span><span class="code">open</span> (or its built-in alias <span class="code">open</span>) to make a Python file object to read from, and/or write to, a file as seen by the underlying operating system. The parameters you pass to open determine what type of object is returned. This object can be an instance of <span class="code">io.TextIOWrapper</span> if textual, or, if binary, one of <span class="code">io.BufferedReader</span>, <span class="code">io.BufferedWriter</span>, or <span class="code">io.BufferedRandom</span>, depending on whether it’s read-only, write-only, or read/write. This section covers the various types of file objects, as well as the important issue of making and using<a contenteditable="false" data-primary="temporary files" data-type="indexterm" id="idm44924519130112"/> <em>temporary</em> files (on disk, or even in memory).</p>
<div data-type="note" epub:type="note">
<h1>I/O Errors Raise OSError</h1>
<p>Python reacts to any I/O error related to a file object by raising an instance of built-in exception class<a contenteditable="false" data-primary="OSError" data-type="indexterm" id="idm44924519126848"/> <span class="code">OSError</span> (many useful subclasses exist, as covered in <a data-type="xref" href="ch06.xhtml#oserror_subclasses">“OSError subclasses”</a>). Errors causing this exception include a failing <span class="code">open</span> call, calls to a method on a file to which the method doesn’t apply (e.g., <span class="code">write</span> on a read-only file, or <span class="code">seek</span> on a nonseekable file), and actual I/O errors diagnosed by a file object’s methods.</p>
</div>
<p>The <span class="code">io</span> module also provides the underlying classes, both abstract and concrete, that, by inheritance and by composition (also known as<a contenteditable="false" data-primary="wrapping" data-type="indexterm" id="idm44924519120400"/> <em>wrapping</em>), make up the file objects that your program generally uses. We do not cover these advanced topics in this book. If you have access to unusual channels for data, or nonfilesystem data storage, and want to provide a file interface to those channels or storage, you can ease your task (through appropriate subclassing and wrapping) using other classes in the <span class="code">io</span> module. For assistance with such advanced tasks, consult the <a href="https://docs.python.org/3/library/io.xhtml">online docs</a>.</p>
<section data-pdf-bookmark="Creating a File Object with open" data-type="sect2"><div class="sect2" id="creating_a_file_object_with_open">
<h2>Creating a File Object with open</h2>
<p>To<a contenteditable="false" data-primary="with statement" data-type="indexterm" id="idm44924519115360"/> create a Python file object, call <span class="code">open</span> with the following syntax:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="nb">open</code><code class="p">(</code><code class="n">file</code><code class="p">,</code><code> </code><code class="n">mode</code><code class="o">=</code><code class="s1">'</code><code class="s1">r</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">buffering</code><code class="o">=</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">encoding</code><code class="o">=</code><strong><code class="kc">None</code></strong><code class="p">,</code><code> </code><code class="n">errors</code><code class="o">=</code><code class="s1">'</code><code class="s1">strict</code><code class="s1">'</code><code class="p">,</code><code> </code><code>
</code><code>     </code><code class="n">newline</code><code class="o">=</code><strong><code class="kc">None</code></strong><code class="p">,</code><code> </code><code class="n">closefd</code><code class="o">=</code><strong><code class="kc">True</code></strong><code class="p">,</code><code> </code><code class="n">opener</code><code class="o">=</code><code class="n">os</code><code class="o">.</code><code class="n">open</code><code class="p">)</code></pre>
<p><span class="code">file</span> can be a string or an instance of <span class="code">pathlib.Path</span> (any path to a file as seen by the underlying OS), or an <span class="code">int</span> (an OS-level<a contenteditable="false" data-primary="file descriptor (fd)" data-type="indexterm" id="idm44924519072032"/> <em>file descriptor</em> as returned by <span class="code">os.open</span>, or by whatever function you pass as the <span class="code">opener</span> argument). When <span class="code">file</span> is a path (a string or <span class="code">pathlib.Path</span> instance), <span class="code">open</span> opens the file thus named (possibly creating it, depending on the <span class="code">mode</span> argument—despite its name, <span class="code">open</span> is not just for opening existing files: it can also create new ones). When <span class="code">file</span> is an integer, the underlying OS file must already be open (via <span class="code">os.open</span>).</p>
<div data-type="tip">
<h1>Opening a File Pythonically</h1>
<p><span class="code">open</span><a contenteditable="false" data-primary="as (with statement)" data-type="indexterm" id="idm44924519032496"/><a contenteditable="false" data-primary="as (file opening)" data-type="indexterm" id="idm44924519031424"/> is a context manager: use<a contenteditable="false" data-primary="open (with open)" data-type="indexterm" id="idm44924519030192"/><a contenteditable="false" data-primary="with statement" data-secondary="with open" data-type="indexterm" id="idm44924519029088"/> <span class="code"><strong>with</strong></span> <span class="code">open(...)</span> <span class="code"><strong>as</strong></span> <span class="code"><em>f</em></span><span class="code">:</span>, <em>not</em> <span class="code"><em>f</em></span> = <span class="code">open(...)</span>, to ensure the file <span class="code"><em>f</em></span> gets closed as soon as the <span class="code"><strong>with</strong></span> statement’s body is done.</p>
</div>
<p><span class="code">open</span> creates and returns an instance <span class="code"><em>f</em></span> of the appropriate <span class="code">io</span> module class, depending on the mode and buffering settings. We refer to all such instances as file objects; they are polymorphic with respect to each other.</p>
<section data-pdf-bookmark="mode" data-type="sect3"><div class="sect3" id="mode">
<h3>mode</h3>
<p><span class="code">mode</span> is an optional string indicating how the file is to be opened (or created). The possible values for <span class="code">mode</span> are listed in <a data-type="xref" href="#mode_settings">Table 11-1</a>.</p>
<table class="border" id="mode_settings">
<caption><span class="label">Table 11-1. </span><span class="code">mode</span> settings</caption>
<thead>
<tr>
<th>Mode</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="code">'a'</span></td>
<td>The file is opened in write-only mode. The file is kept intact if it already exists, and the data you write is appended to the existing contents. The file is created if it does not exist. Calling <span class="code"><em>f</em></span><span class="code">.seek</span> on the file changes the result of the method <span class="code"><em>f</em></span><span class="code">.tell</span>, but does not change the write position in the file opened in this <span class="code">mode</span>: that write position always remains at the end of the file.</td>
</tr>
<tr>
<td><span class="code">'a+'</span></td>
<td>The file is opened for both reading and writing, so all methods of <span class="code"><em>f</em></span> can be called. The file is kept intact if it already exists, and the data you write is appended to the existing contents. The file is created if it does not exist. Calling <span class="code"><em>f</em></span><span class="code">.seek</span> on the file, depending on the underlying operating system, may have no effect when the next I/O operation on <span class="code"><em>f</em></span> <em>writes</em> data, but does work normally when the next I/O operation on <span class="code"><em>f</em></span> <em>reads</em> data.</td>
</tr>
<tr>
<td><span class="code">'r'</span></td>
<td>The file must already exist, and it is opened in read-only mode (this is the default).</td>
</tr>
<tr>
<td><span class="code">'r+'</span></td>
<td>The file must exist and is opened for both reading and writing, so all methods of <span class="code"><em>f</em></span> can be called.</td>
</tr>
<tr>
<td><span class="code">'w'</span></td>
<td>The file is opened in write-only mode. The file is truncated to zero length and overwritten if it already exists, or created if it does not exist.</td>
</tr>
<tr>
<td><span class="code">'w+'</span></td>
<td>The file is opened for both reading and writing, so all methods of <span class="code"><em>f</em></span> can be called. The file is truncated to zero length and overwritten if it already exists, or created if it does not exist.</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Binary and text modes" data-type="sect3"><div class="sect3" id="binary_and_text_modes">
<h3>Binary and text modes</h3>
<p>The<a contenteditable="false" data-primary="binary mode" data-type="indexterm" id="idm44924518985952"/><a contenteditable="false" data-primary="text mode" data-type="indexterm" id="idm44924518984432"/> <span class="code">mode</span> string may include any of the values in <a data-type="xref" href="#mode_settings">Table 11-1</a>, followed by a <span class="code">b</span> or <span class="code">t</span>. <span class="code">b</span> indicates that the file should be opened (or created) in binary mode, while <span class="code">t</span> indicates text mode. When neither <span class="code">b</span> nor <span class="code">t</span> is included, the default is text (i.e., <span class="code">'r'</span> is like <span class="code">'rt'</span>, <span class="code">'w+'</span> is like <span class="code">'w+t'</span>, and so on), but per <a href="https://oreil.ly/QO8-Y">The Zen of Python</a>, “explicit is better than implicit.”</p>
<p>Binary files let you read and/or write strings of type <span class="code">bytes</span>, and text files let you read and/or write Unicode text strings of type <span class="code">str</span>. For text files, when the underlying channel or storage system deals in bytes (as most do), <span class="code">encoding</span> (the name of an encoding known to Python) and <span class="code">errors</span> (an error-handler name such as <span class="code">'strict'</span>, <span class="code">'replace'</span>, and so on, as covered under <span class="code">decode</span> in <a data-type="xref" href="ch09.xhtml#significant_str_and_bytes_methods">Table 9-1</a>) matter, as they specify how to translate between text and bytes, and what to do on encoding and decoding errors.</p>
</div></section>
<section data-pdf-bookmark="Buffering" data-type="sect3"><div class="sect3" id="buffering">
<h3>Buffering</h3>
<p><span class="code">buffering</span><a contenteditable="false" data-primary="buffering" data-type="indexterm" id="idm44924518964512"/> is an integer value that denotes the buffering policy you’re requesting for the file. When <span class="code">buffering</span> is <span class="code">0</span>, the file (which must be binary mode) is unbuffered; the effect is as if the file’s buffer is flushed every time you write anything to the file. When <span class="code">buffering</span> is <span class="code">1</span>, the file (which <em>must</em> be open in text mode) is line buffered, which means the file’s buffer is flushed every time you write <span class="code">\n</span> to the file. When <span class="code">buffering</span> is greater than <span class="code">1</span>, the file uses a buffer of about <span class="code">buffering</span> bytes, often rounded up to some value convenient for the driver software. When <span class="code">buffering</span> is <span class="code">&lt;0</span>, a default is used, depending on the type of file stream. Normally, this default is line buffering for files that correspond to interactive streams, and a buffer of <span class="code">io.DEFAULT_BUFFER_SIZE</span> bytes for other files.</p>
</div></section>
<section data-pdf-bookmark="Sequential and nonsequential (“random”) access" data-type="sect3"><div class="sect3" id="sequential_and_nonsequential_left_paren">
<h3>Sequential and nonsequential (“random”) access</h3>
<p>A<a contenteditable="false" data-primary="random access" data-type="indexterm" id="idm44924518952848"/><a contenteditable="false" data-primary="sequential file access" data-type="indexterm" id="idm44924518951712"/><a contenteditable="false" data-primary="nonsequential file access" data-type="indexterm" id="idm44924518950608"/> file object <span class="code"><em>f</em></span> is inherently sequential (a stream of bytes or text). When you read, you get bytes or text in the sequential order in which they are present. When you write, the bytes or text you write are added in the order in which you write them.</p>
<p>For a file object <span class="code"><em>f</em></span> to support nonsequential access (also known as random access), it must keep track of its current position (the position in the storage where the next read or write operation starts transferring data), and the underlying storage for the file must support setting the current position. <span class="code"><em>f</em></span><span class="code">.seekable</span> returns <span class="code"><strong>True</strong></span> when <span class="code"><em>f</em></span> supports nonsequential access.</p>
<p>When you open a file, the default initial read/write position is at the start of the file. Opening <span class="code"><em>f</em></span> with a <span class="code">mode</span> of <span class="code">'a'</span> or <span class="code">'a+'</span> sets <span class="code"><em>f</em></span>’s read/write position to the end of the file before writing data to <span class="code"><em>f</em></span>. When you write or read <span class="code"><em>n</em></span> bytes to/from file object <span class="code"><em>f</em></span>, <span class="code"><em>f</em></span>’s position advances by <span class="code"><em>n</em></span>. You can query the current position by calling <span class="code"><em>f</em></span><span class="code">.tell</span>, and change the position by calling <span class="code"><em>f</em></span><span class="code">.seek</span>, both covered in the next section.</p>
<p>When calling <span class="code"><em>f</em></span><span class="code">.seek</span> on a text-mode <span class="code"><em>f</em></span>, the offset you pass must be <span class="code">0</span> (to position <span class="code"><em>f</em></span> at the start or end, depending on <span class="code"><em>f</em></span><span class="code">.seek</span>’s second parameter), or the opaque result returned by an earlier call to <span class="code"><em>f</em></span><span class="code">.tell</span>,<sup><a data-type="noteref" href="ch11.xhtml#ch01fn99" id="ch01fn99-marker">1</a></sup> to position <span class="code"><em>f</em></span> back to a spot you had thus “bookmarked” before.</p>
</div></section>
</div></section>
<section data-pdf-bookmark="Attributes and Methods of File Objects" data-type="sect2"><div class="sect2" id="attributes_and_methods_of_file_object">
<h2>Attributes and Methods of File Objects</h2>
<p>A<a contenteditable="false" data-primary="attributes" data-secondary="of file objects" data-type="indexterm" id="Afile11"/><a contenteditable="false" data-primary="methods" data-secondary="of file objects" data-type="indexterm" id="Mfileob1"/> file object <span class="code"><em>f</em></span> supplies the attributes and methods documented in <a data-type="xref" href="#attributes_and_methods_of_file_objects">Table 11-2</a>.</p>
<table class="border" id="attributes_and_methods_of_file_objects">
<caption><span class="label">Table 11-2. </span>Attributes and methods of file objects</caption>
<tbody>
<tr>
<td class="width-15"><span class="code">close</span></td>
<td><span class="code">close()</span><br/>
			Closes<a contenteditable="false" data-primary="close (file method)" data-type="indexterm" id="idm44924518910720"/> the file. You can call no other method on <span class="code"><em>f</em></span> after <span class="code"><em>f</em></span><span class="code">.close</span>. Multiple calls to <span class="code"><em>f</em></span><span class="code">.close</span> are allowed and innocuous.</td>
</tr>
<tr>
<td><span class="code">closed</span></td>
<td><span class="code"><em>f</em></span><span class="code">.closed</span> is a read-only attribute that is <span class="code"><strong>True</strong></span> when <span class="code"><em>f</em></span><span class="code">.close()</span> has been called; otherwise, it is <span class="code"><strong>False</strong></span>.</td>
</tr>
<tr>
<td><span class="code">encoding</span></td>
<td><span class="code"><em>f</em></span><span class="code">.encoding</span> is a read-only attribute, a string naming the encoding (as covered in <a data-type="xref" href="ch09.xhtml#unicode">“Unicode”</a>). The attribute does not exist on binary files.</td>
</tr>
<tr>
<td><span class="code">fileno</span></td>
<td><span class="code">fileno()</span><br/>
			Returns<a contenteditable="false" data-primary="fileno method)" data-secondary="file object" data-type="indexterm" id="idm44924518893296"/> the file descriptor of <span class="code"><em>f</em></span>’s file at operating system level (an integer). File descriptors are covered in <a data-type="xref" href="#file_and_directory_functions_of_the_os">“File and directory functions of the os module”</a>.</td>
</tr>
<tr>
<td><span class="code">flush</span></td>
<td><span class="code">flush()</span><br/>
			Requests that <span class="code"><em>f</em></span>’s buffer be written out to the operating system, so that the file as seen by the system has the exact contents that Python’s code has written. Depending on the platform and the nature of <span class="code"><em>f</em></span>’s underlying file, <span class="code"><em>f</em></span><span class="code">.flush</span> may not be able to ensure the desired effect.</td>
</tr>
<tr>
<td><span class="code">isatty</span></td>
<td><span class="code">isatty()</span><br/>
			Returns <span class="code"><strong>True</strong></span> when <span class="code"><em>f</em></span>’s underlying file is an interactive stream, such as to or from a terminal; otherwise, returns <span class="code"><strong>False</strong></span>.</td>
</tr>
<tr>
<td><span class="code">mode</span></td>
<td><span class="code"><em>f</em></span><span class="code">.mode</span> is a read-only attribute that is the value of the <span class="code">mode</span> string used in the <span class="code">io.open</span> call that created <span class="code"><em>f</em></span>.</td>
</tr>
<tr>
<td><span class="code">name</span></td>
<td><span class="code"><em>f</em></span><span class="code">.name</span> is a read-only attribute that is the value of the file (<span class="code">str</span> or <span class="code">bytes</span>) or <span class="code">int</span> used in the <span class="code">io.open</span> call that created <span class="code"><em>f</em></span>. When <span class="code">io.open</span> was called with a <span class="code">pathlib.Path</span> instance <span class="code"><em>p</em></span>, <span class="code"><em>f</em></span><span class="code">.name</span> is <span class="code">str(<em>p</em>)</span>.</td>
</tr>
<tr>
<td><span class="code">read</span></td>
<td><span class="code">read(<em>size</em>=-1, /)</span><br/>
			When<a contenteditable="false" data-primary="read (file method)" data-type="indexterm" id="idm44924518859008"/> <span class="code"><em>f</em></span> is open in binary mode, reads up to <span class="code"><em>size</em></span> bytes from <span class="code"><em>f</em></span>’s file and returns them as a bytestring. <span class="code">read</span> reads and returns less than <span class="code"><em>size</em></span> bytes if the file ends before <span class="code"><em>size</em></span> bytes are read. When <span class="code"><em>size</em></span> is less than <span class="code">0</span>, <span class="code">read</span> reads and returns all bytes up to the end of the file. <span class="code">read</span> returns an empty string when the file’s current position is at the end of the file or when <span class="code"><em>size</em></span> equals <span class="code">0</span>. When <span class="code"><em>f</em></span> is open in text mode, <span class="code"><em>size</em></span> is a number of characters, not bytes, and <span class="code">read</span> returns a text string.</td>
</tr>
<tr>
<td><span class="code">readline</span></td>
<td><span class="code">readline(<em>size</em>=-1, /)</span><br/>
			Reads<a contenteditable="false" data-primary="readline (file method)" data-type="indexterm" id="idm44924518842672"/> and returns one line from <span class="code"><em>f</em></span>’s file, up to the end of line (<span class="code">\n</span>), included. When <span class="code"><em>size</em></span> is greater than or equal to <span class="code">0</span>, reads no more than <span class="code"><em>size</em></span> bytes. In that case, the returned string might not end with <span class="code">\n</span>. <span class="code">\n</span> might also be absent when <span class="code">readline</span> reads up to the end of the file without finding <span class="code">\n</span>. <span class="code">readline</span> returns an empty string when the file’s current position is at the end of the file or when <span class="code"><em>size</em></span> equals <span class="code">0</span>.</td>
</tr>
<tr>
<td><span class="code">readlines</span></td>
<td><span class="code">readlines(<em>size</em>=-1, /)</span><br/>
			Reads<a contenteditable="false" data-primary="readlines (file method)" data-type="indexterm" id="idm44924518829264"/> and returns a list of all lines in <span class="code"><em>f</em></span>’s file, each a string ending in <span class="code">\n</span>. If <span class="code"><em>size</em></span> <span class="code">&gt; 0</span>, <span class="code">readlines</span> stops and returns the list after collecting data for a total of about <span class="code"><em>size</em></span> bytes rather than reading all the way to the end of the file; in that case, the last string in the list might not end in <span class="code">\n</span>.</td>
</tr>
<tr>
<td><span class="code">seek</span></td>
<td><span class="code">seek(<em>pos</em>,</span> <span class="code"><em>how</em></span><span class="code">=io.SEEK_SET, /)</span><br/>
			Sets <span class="code"><em>f</em></span>’s current<a contenteditable="false" data-primary="seek (file method)" data-type="indexterm" id="idm44924518816992"/> position to the integer byte offset <span class="code"><em>pos</em></span> away from a reference point. <span class="code"><em>how</em></span> indicates the reference point. The <span class="code">io</span> module has attributes named <span class="code">SEEK_SET</span>, <span class="code">SEEK_CUR</span>, and <span class="code">SEEK_END</span>, to specify that the reference point is, respectively, the file’s beginning, current position, or end.<br/>
			When <span class="code"><em>f</em></span> is opened in text mode, <span class="code"><em>f</em></span><span class="code">.seek</span> must have a <span class="code"><em>pos</em></span> of <span class="code">0</span>, or, for <span class="code">io.SEEK_SET</span> only, a <span class="code"><em>pos</em></span> that is the result of a previous call to <span class="code"><em>f</em></span><span class="code">.tell</span>.<br/>
			When <span class="code"><em>f</em></span> is opened in mode <span class="code">'a'</span> or <span class="code">'a+'</span>, on some but not all platforms, data written to <span class="code"><em>f</em></span> is appended to the data that is already in <span class="code"><em>f</em></span>, regardless of calls to <span class="code"><em>f</em></span><span class="code">.seek</span>.</td>
</tr>
<tr>
<td><span class="code">tell</span></td>
<td><span class="code">tell()</span><br/>
			Returns <span class="code"><em>f</em></span>’s current<a contenteditable="false" data-primary="tell (file method)" data-type="indexterm" id="idm44924518795168"/> position: for a binary file this is an integer offset in bytes from the start of the file, and for a text file it’s an opaque value usable in future calls to <span class="code"><em>f</em></span><span class="code">.seek</span> to position <span class="code"><em>f</em></span> back to the position that is now current.</td>
</tr>
<tr>
<td><span class="code">truncate</span></td>
<td><span class="code">truncate(<em>size</em>=None, /)</span><br/>
			Truncates <span class="code"><em>f</em></span>’s file, which must be open for writing. When <span class="code"><em>size</em></span> is present, truncates the file to be at most <span class="code"><em>size</em></span> bytes. When <span class="code"><em>size</em></span> is absent, uses <span class="code"><em>f</em></span><span class="code">.tell()</span> as the file’s new size. <span class="code"><em>size</em></span> may be larger than the current file size; in this case, the resulting behavior is platform dependent.</td>
</tr>
<tr>
<td><span class="code">write</span></td>
<td><span class="code">write(<em>s</em>, /)</span><br/>
			Writes<a contenteditable="false" data-primary="write (file method)" data-type="indexterm" id="idm44924518780032"/> the bytes of string <span class="code"><em>s</em></span> (binary or text, depending on <span class="code"><em>f</em></span>’s mode) to the file.</td>
</tr>
<tr>
<td><span class="code">writelines</span></td>
<td><span class="code">writelines(<em>lst</em>, /)</span><br/>
			Like:
			<pre data-code-language="python" data-type="programlisting">
<strong><code class="k">for</code></strong><code> </code><em><code class="n">line</code></em><code> </code><strong><code class="ow">in</code></strong><code> </code><em><code class="n">lst</code></em><code class="p">:</code><code> </code><em><code class="n">f</code></em><code class="o">.</code><code class="n">write</code><code class="p">(</code><em><code class="n">line</code></em><code class="p">)</code></pre>
			It<a contenteditable="false" data-primary="writelines (file method)" data-type="indexterm" id="idm44924518759376"/> does not matter whether the strings in iterable <em>lst</em> are lines: despite its name, the method <span class="code">writelines</span> just writes each of the strings to the file, one after the other. In particular, <span class="code">writelines</span> does not add line-ending markers: such markers, if required, must already be present in the items of <em>lst</em>.<a contenteditable="false" data-primary="" data-startref="Mfileob1" data-type="indexterm" id="idm44924518756048"/><a contenteditable="false" data-primary="" data-startref="Afile11" data-type="indexterm" id="idm44924518754640"/></td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Iteration on File Objects" data-type="sect2"><div class="sect2" id="iteration_on_file_objects">
<h2>Iteration on File Objects</h2>
<p>A file object <span class="code"><em>f</em></span>, open for reading, is also an iterator whose items are the file’s lines. Thus, the loop:</p>
<pre data-code-language="python" data-type="programlisting">
<strong><code class="k">for</code></strong><code> </code><em><code class="n">line</code></em><code> </code><strong><code class="ow">in</code></strong><code> </code><em><code class="n">f</code></em><code class="p">:</code></pre>
<p>iterates on each line of the file. Due to buffering issues, interrupting such a loop prematurely (e.g., with <span class="code"><strong>break</strong></span>), or calling <span class="code">next(<em>f</em>)</span> instead of <span class="code"><em>f</em></span><span class="code">.readline()</span>, leaves the file’s position set to an arbitrary value. If you want to switch from using <span class="code"><em>f</em></span> as an iterator to calling other reading methods on <span class="code"><em>f</em></span>, be sure to set the file’s position to a known value by appropriately calling <span class="code"><em>f</em></span><span class="code">.seek</span>. On the plus side, a loop directly on <span class="code"><em>f</em></span> has very good performance, since these specifications allow the loop to use internal buffering to minimize I/O without taking up excessive amounts of memory even for huge files.</p>
</div></section>
<section data-pdf-bookmark="File-Like Objects and Polymorphism" data-type="sect2"><div class="sect2" id="file_like_objects_and_polymorphism">
<h2>File-Like Objects and Polymorphism</h2>
<p>An<a contenteditable="false" data-primary="file-like objects" data-type="indexterm" id="idm44924518692672"/><a contenteditable="false" data-primary="polymorphism" data-type="indexterm" id="idm44924518691216"/> object <span class="code"><em>x</em></span> is file-like when it behaves <em>polymorphically</em> to a file object as returned by <span class="code">io.open</span>, meaning that we can use <span class="code"><em>x</em></span> “as if” <span class="code"><em>x</em></span> were a file. Code using such an object (known as<a contenteditable="false" data-primary="client codes" data-type="indexterm" id="idm44924518686336"/> <em>client code</em> of the object) usually gets the object as an argument, or by calling a factory function that returns the object as the result. For example, if the only method that client code calls on <span class="code"><em>x</em></span> is <span class="code"><em>x</em></span><span class="code">.read</span>, without arguments, then all <span class="code"><em>x</em></span> needs to supply in order to be file-like enough for that code is a method <span class="code">read</span> that is callable without arguments and returns a string. Other client code may need <span class="code"><em>x</em></span> to implement a larger subset of file methods. File-like objects and polymorphism are not absolute concepts: they are relative to demands placed on an object by some specific client code.</p>
<p>Polymorphism<a contenteditable="false" data-primary="object-oriented Python" data-secondary="polymorphism" data-type="indexterm" id="idm44924518679984"/> is a powerful aspect of object-oriented programming, and file-like objects are a good example of polymorphism. A client-code module that writes to or reads from files can automatically be reused for data residing elsewhere, as long as the module does not break polymorphism by type checking. When we discussed the built-ins <span class="code">type</span> and <span class="code">isinstance</span> in <a data-type="xref" href="ch08.xhtml#pythonapostrophes_core_built_in_types">Table 8-1</a>, we mentioned that type checking is often best avoided, as it blocks Python’s normal polymorphism. Often, to support polymorphism in your client code, you just need to avoid type checking.</p>
<p>You can implement a file-like object by coding your own class (as covered in <a data-type="xref" href="ch04.xhtml#object_oriented_python">Chapter 4</a>) and defining the specific methods needed by client code, such as <span class="code">read</span>. A file-like object <span class="code"><em>fl</em></span> need not implement all the attributes and methods of a true file object <span class="code"><em>f</em></span>. If you can determine which methods the client code calls on <span class="code"><em>fl</em></span>, you can choose to implement only that subset. For example, when <span class="code"><em>fl</em></span> is only going to be written, <span class="code"><em>fl</em></span> doesn’t need “reading” methods, such as <span class="code">read</span>, <span class="code">readline</span>, and <span class="code">readlines</span>.</p>
<p>If the main reason you want a file-like object instead of a real file object is to keep the data in memory, rather than on disk, use the <span class="code">io</span> module’s classes <span class="code">StringIO</span> or <span class="code">BytesIO</span>, covered in <a data-type="xref" href="#in_memory_files_iodotstringio_and_iodot">“In-Memory Files: io.StringIO and io.BytesIO”</a>. These classes supply file objects that hold data in memory and largely behave polymorphically to other file objects. If you’re running multiple processes that you want to communicate via file-like objects, consider <span class="code">mmap</span>, covered in <a data-type="xref" href="ch15.xhtml#concurrency_threads_and_processes">Chapter 15</a>.<a contenteditable="false" data-primary="" data-startref="FTiomod11" data-type="indexterm" id="idm44924518661632"/><a contenteditable="false" data-primary="" data-startref="iomod11" data-type="indexterm" id="idm44924518660256"/><a contenteditable="false" data-primary="" data-startref="SLMio11" data-type="indexterm" id="idm44924518658880"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="The tempfile Module" data-type="sect1"><div class="sect1" id="the_tempfile_module">
<h1>The tempfile Module</h1>
<p>The<a contenteditable="false" data-primary="tempfile module" data-type="indexterm" id="tempfile11"/><a contenteditable="false" data-primary="file and text operations" data-secondary="tempfile module" data-type="indexterm" id="FTtemp11"/><a contenteditable="false" data-primary="standard library modules" data-secondary="tempfile" data-type="indexterm" id="SLMtemp11"/> <span class="code">tempfile</span> module lets you create temporary files and directories in the most secure manner afforded by your platform. Temporary files are often a good idea when you’re dealing with an amount of data that might not comfortably fit in memory, or when your program must write data that another process later uses.</p>
<p>The order of the parameters for the functions in this module is a bit confusing: to make your code more readable, always call these functions with named-argument syntax. The <span class="code">tempfile</span> module exposes the functions and classes outlined in <a data-type="xref" href="#functions_and_classes_of_the_tempfile_m">Table 11-3</a>.</p>
<table class="border" id="functions_and_classes_of_the_tempfile_m">
<caption><span class="label">Table 11-3. </span>Functions and classes of the <span class="code">tempfile</span> module</caption>
<tbody>
<tr>
<td class="width-15"><span class="code">mkdtemp</span></td>
<td><span class="code">mkdtemp(suffix=<strong>None</strong>, prefix=<strong>None</strong>, dir=None)</span><br/>
			Securely<a contenteditable="false" data-primary="mkdtemp (tempfile module)" data-type="indexterm" id="idm44924518641584"/> creates a new temporary directory that is readable, writable, and searchable only by the current user, and returns the absolute path to the temporary directory. You can optionally pass arguments to specify strings to use as the start (<span class="code">prefix</span>) and end (<span class="code">suffix</span>) of the temporary file’s filename, and the path to the directory in which the temporary file is created (<span class="code">dir</span>). Ensuring that the temporary directory is removed when you’re done with it is your program’s responsibility.</td>
</tr>
<tr>
<td class="width-15"><span class="code">mkdtemp</span><br/>
<em>(cont.)</em></td>
<td>Here is a typical usage example that creates a temporary directory, passes its path to another function, and finally ensures the directory (and all contents) are removed:
			<pre data-code-language="python" data-type="programlisting">
<strong><code class="kn">import</code></strong><code> </code><code class="nn">tempfile</code><code class="o">,</code><code> </code><code class="nn">shutil</code><code>
</code><code class="n">path</code><code> </code><code class="o">=</code><code> </code><code class="n">tempfile</code><code class="o">.</code><code class="n">mkdtemp</code><code class="p">(</code><code class="p">)</code><code>
</code><strong><code class="k">try</code></strong><code class="p">:</code><code>
</code><code>    </code><code class="n">use_dirpath</code><code class="p">(</code><code class="n">path</code><code class="p">)</code><code>
</code><strong><code class="k">finally</code></strong><code class="p">:</code><code>
</code><code>    </code><code class="n">shutil</code><code class="o">.</code><code class="n">rmtree</code><code class="p">(</code><code class="n">path</code><code class="p">)</code></pre>
</td>
</tr>
<tr>
<td><span class="code">mkstemp</span></td>
<td><span class="code">mkstemp(suffix=<strong>None</strong>, prefix=<strong>None</strong>, dir=<strong>None</strong>, text=<strong>False</strong>)</span><br/>
			Securely<a contenteditable="false" data-primary="mkstemp (tempfile module)" data-type="indexterm" id="idm44924518601248"/> creates a new temporary file that is readable and writable only by the current user, is not executable, and is not inherited by subprocesses; returns a pair <span class="code">(<em>fd</em>,</span> <span class="code"><em>path</em></span><span class="code">)</span>, where <span class="code"><em>fd</em></span> is the file descriptor of the temporary file (as returned by <span class="code">os.open</span>, covered in <a data-type="xref" href="#useful_os_module_functions_to_deal_with">Table 11-18</a>) and the string <span class="code"><em>path</em></span> is the absolute path to the temporary file. The optional arguments <span class="code">suffix</span>, <span class="code">prefix</span>, and <span class="code">dir</span> are like for the function <span class="code">mkdtemp</span>. If you want the temporary file to be a text file, explicitly pass the argument <span class="code">text=<strong>True</strong></span>.<br/>
			Ensuring that the temporary file is removed when you’re done using it is up to you. <span class="code">mkstemp</span> is not a context manager, so you can’t use a <span class="code"><strong>with</strong></span> statement; it’s best to use <span class="code"><strong>try</strong>/</span><span class="code"><strong>finally</strong></span> instead. Here is a typical usage example that creates a temporary text file, closes it, passes its path to another function, and finally ensures the file is removed:
			<pre data-code-language="python" data-type="programlisting">
<strong><code class="kn">import</code></strong><code> </code><code class="nn">tempfile</code><code class="o">,</code><code> </code><code class="nn">os</code><code>
</code><code class="n">fd</code><code class="p">,</code><code> </code><code class="n">path</code><code> </code><code class="o">=</code><code> </code><code class="n">tempfile</code><code class="o">.</code><code class="n">mkstemp</code><code class="p">(</code><code class="n">suffix</code><code class="o">=</code><code class="s1">'</code><code class="s1">.txt</code><code class="s1">'</code><code class="p">,</code><code> </code><code>
</code><code>                            </code><code class="n">text</code><code class="o">=</code><strong><code class="kc">True</code></strong><code class="p">)</code><code>
</code><strong><code class="k">try</code></strong><code class="p">:</code><code>
</code><code>    </code><code class="n">os</code><code class="o">.</code><code class="n">close</code><code class="p">(</code><code class="n">fd</code><code class="p">)</code><code>
</code><code>    </code><code class="n">use_filepath</code><code class="p">(</code><code class="n">path</code><code class="p">)</code><code>
</code><strong><code class="k">finally</code></strong><code class="p">:</code><code>
</code><code>    </code><code class="n">os</code><code class="o">.</code><code class="n">unlink</code><code class="p">(</code><code class="n">path</code><code class="p">)</code></pre>
</td>
</tr>
<tr>
<td><span class="code">Nam⁠e⁠d​T⁠e⁠m⁠p⁠o⁠r⁠a⁠r⁠y​F⁠i⁠l⁠e</span></td>
<td><span class="code">NamedTemporaryFile(mode='w+b', bufsize=-1</span>,<span class="code"> suffix=<strong>None</strong>,</span><br/> <span class="code">prefix=<strong>None</strong>, dir=<strong>None</strong>)</span><br/>
			Like<a contenteditable="false" data-primary="NamedTemporaryFile class (tempfile module)" data-type="indexterm" id="idm44924518512400"/> <span class="code">TemporaryFile</span> (covered later in this table), except that the temporary file does have a name on the filesystem. Use the <span class="code">name</span> attribute of the file object to access that name. Some platforms (mainly Windows) do not allow the file to be opened again; therefore, the usefulness of the name is limited if you want to ensure that your program works cross-platform. If you need to pass the temporary file’s name to another program that opens the file, you can use the function <span class="code">mkstemp</span> instead of <span class="code">NamedTemporaryFile</span> to guarantee correct cross-platform behavior. Of course, when you choose to use <span class="code">mkstemp</span>, you do have to take care to ensure the file is removed when you’re done with it. The file object returned from <span class="code">NamedTemporaryFile</span> is a context manager, so you can use a <span class="code">with</span> statement.</td>
</tr>
<tr>
<td><span class="code">Spoo⁠l⁠e⁠d​T⁠e⁠m⁠p⁠o⁠r⁠a⁠r⁠y​F⁠i⁠l⁠e</span></td>
<td><span class="code">SpooledTemporaryFile(mode='w+b', bufsize=-1, suffix=<strong>None</strong>, prefix=<strong>None</strong>, dir=<strong>None</strong>)</span><br/>
			Like<a contenteditable="false" data-primary="SpooledTemporaryFile class (tempfile module)" data-type="indexterm" id="idm44924518471296"/> <span class="code">TemporaryFile</span> (see below), except that the file object that <span class="code">SpooledTemporaryFile</span> returns can stay in memory, if space permits, until you call its <span class="code">fileno</span> method (or its <span class="code">rollover</span> method, which ensures the file gets written to disk, whatever its size). As a result, performance can be better with <span class="code">SpooledTemporaryFile</span>, as long as you have enough memory that’s not otherwise in use.</td>
</tr>
<tr>
<td><span class="code">TemporaryDirectory</span></td>
<td><span class="code">TemporaryDirectory(suffix=None, prefix=<strong>None</strong>, dir=<strong>None</strong>, ignore_cleanup_errors=<strong>False</strong>)</span><br/>
			Creates<a contenteditable="false" data-primary="TemporaryDirectory class (tempfile module)" data-type="indexterm" id="idm44924518462640"/> a temporary directory, like <span class="code">mkdtemp</span> (passing the optional arguments <span class="code">suffix</span>, <span class="code">prefix</span>, and <span class="code">dir</span>). The returned directory object is a context manager, so you can use a <span class="code"><strong>with</strong></span> statement to ensure it’s removed as soon as you’re done with it. Alternatively, when you’re not using it as a context manager, use its built-in class method <span class="code">cleanup</span> (<em>not</em> <span class="code">shutil.rmtree</span>) to explicitly remove and clean up the directory. Set <span class="code">ignore_cleanup_errors</span> to <span class="code"><strong>True</strong></span> to ignore unhandled exceptions during cleanup. The temporary directory and its contents are removed as soon as the directory object is closed (whether implicitly on garbage collection or explicitly by a <span class="code">cleanup</span> call).</td>
</tr>
<tr>
<td><span class="code">TemporaryFile</span></td>
<td><span class="code">TemporaryFile(mode='w+b', bufsize=-1, suffix=<strong>None</strong>,</span><br/> <span class="code">prefix=<strong>None</strong>, dir=<strong>None</strong>)</span><br/>
			Creates<a contenteditable="false" data-primary="TemporaryFile class (tempfile module)" data-type="indexterm" id="idm44924518449056"/> a temporary file with <span class="code">mkstemp</span> (passing to <span class="code">mkstemp</span> the optional arguments <span class="code">suffix</span>, <span class="code">prefix</span>, and <span class="code">dir</span>), makes a file object from it with <span class="code">os.fdopen</span>, covered in <a data-type="xref" href="#useful_os_module_functions_to_deal_with">Table 11-18</a> (passing to <span class="code">fdopen</span> the optional arguments <span class="code">mode</span> and <span class="code">bufsize</span>), and returns the file object. The temporary file is removed as soon as the file object is closed (implicitly or explicitly). For greater security, the temporary file has no name on the filesystem, if your platform allows that (Unix-like platforms do; Windows doesn’t). The file object returned from <span class="code">TemporaryFile</span> is a context manager, so you can use a <span class="code"><strong>with</strong></span> statement to ensure it’s removed as soon as you’re done with it.<a contenteditable="false" data-primary="" data-startref="FTtemp11" data-type="indexterm" id="idm44924518438976"/><a contenteditable="false" data-primary="" data-startref="tempfile11" data-type="indexterm" id="idm44924518437632"/><a contenteditable="false" data-primary="" data-startref="SLMtemp11" data-type="indexterm" id="idm44924518436256"/></td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Auxiliary Modules for File I/O" data-type="sect1"><div class="sect1" id="auxiliary_modules_for_file_isoliduso">
<h1>Auxiliary Modules for File I/O</h1>
<p>File objects supply the functionality needed for file I/O. Other Python library modules, however, offer convenient supplementary functionality, making I/O even easier and handier in several important cases. We’ll look at two of those modules here.</p>
<section data-pdf-bookmark="The fileinput Module" data-type="sect2"><div class="sect2" id="the_fileinput_module">
<h2>The fileinput Module</h2>
<p>The<a contenteditable="false" data-primary="file and text operations" data-secondary="fileinput module" data-type="indexterm" id="FTfileinput11"/><a contenteditable="false" data-primary="fileinput module" data-type="indexterm" id="fileinput11"/><a contenteditable="false" data-primary="standard library modules" data-secondary="fileinput" data-type="indexterm" id="SLMfileinput11"/> <span class="code">fileinput</span> module lets you loop over all the lines in a list of text files. Performance is good—comparable to the performance of direct iteration on each file—since buffering is used to minimize I/O. You can therefore use this module for line-oriented file input whenever you find its rich functionality convenient, with no worry about performance. The key function of the module is <span class="code">input</span>; <span class="code">fileinput</span> also supplies a <span class="code">FileInput</span> class whose methods support the same functionality. Both are described in <a data-type="xref" href="#key_classes_and_functions_of_the_filein">Table 11-4</a>.</p>
<table class="border" id="key_classes_and_functions_of_the_filein">
<caption><span class="label">Table 11-4. </span>Key classes and functions of the <span class="code">fileinput</span> module</caption>
<tbody>
<tr>
<td class="width-15"><span class="code">FileInput</span></td>
<td><span class="code"><strong>class</strong></span> <span class="code">FileInput(files=<strong>None</strong>, inplace=<strong>False</strong>, backup='', mode='r', openhook=<strong>None</strong>, encoding=<strong>None</strong>, errors=<strong>None</strong>)</span><br/>
			Creates<a contenteditable="false" data-primary="FileInput class (fileinput module)" data-type="indexterm" id="idm44924518413584"/> and returns an instance <span class="code"><em>f</em></span> of class <span class="code">FileInput</span>. The arguments are the same as for <span class="code">fileinput.input</span> covered next, and methods of <span class="code"><em>f</em></span> have the same names, arguments, and semantics as the other functions of the <span class="code">fileinput</span> module (see <a data-type="xref" href="#additional_functions_of_the_fileinput_m">Table 11-5</a>). <span class="code"><em>f</em></span> also supplies a <span class="code">readline</span> method, which reads and returns the next line. Use the <span class="code">FileInput</span> class to nest or mix loops that read lines from multiple sequences of files.</td>
</tr>
<tr>
<td><span class="code">input</span></td>
<td><span class="code">input(files=None, inplace=<strong>False</strong>, backup='', mode='r',<br/> openhook=<strong>None</strong>, encoding=<strong>None</strong>, errors=<strong>None</strong>)</span><br/>
			Returns<a contenteditable="false" data-primary="input (fileinput module)" data-type="indexterm" id="idm44924518399344"/> an instance of <span class="code">FileInput</span>, an iterable yielding lines in <span class="code">files</span>; that instance is the global state, so all other functions of the <span class="code">fileinput</span> module (see <a data-type="xref" href="#additional_functions_of_the_fileinput_m">Table 11-5</a>) operate on the same shared state. Each function of the <span class="code">fileinput</span> module corresponds directly to a method of the class <span class="code">FileInput</span>.<br/>
<span class="code">files</span> is a sequence of filenames to open and read one after the other, in order. When <span class="code">files</span> is a string, it’s a single filename to open and read. When <span class="code">files</span> is <span class="code"><strong>None</strong></span>, <span class="code">input</span> uses <span class="code">sys.argv[1:]</span> as the list of filenames. The filename <span class="code">'-'</span> means standard input (<span class="code">sys.stdin</span>). When the sequence of filenames is empty, <span class="code">input</span> reads <span class="code">sys.stdin</span> instead.<br/>
			When <span class="code">inplace</span> is <span class="code"><strong>False</strong></span> (the default), <span class="code">input</span> just reads the files. When <span class="code">inplace</span> is <span class="code"><strong>True</strong></span>, <span class="code">input</span> moves each file being read (except standard input) to a backup file and redirects standard output (<span class="code">sys.stdout</span>) to write to a new file with the same path as the original one of the file being read. This way, you can simulate overwriting files in place. If <span class="code">backup</span> is a string that starts with a dot, <span class="code">input</span> uses <span class="code">backup</span> as the extension of the backup files and does not remove the backup files. If <span class="code">backup</span> is an empty string (the default), <span class="code">input</span> uses <em>.bak</em> and deletes each backup file as the input files are closed. The keyword argument <span class="code">mode</span> may be <span class="code">'r'</span>, the default, or <span class="code">'rb'</span>.<br/>
			You may optionally pass an <span class="code">openhook</span> function to use as an alternative to <span class="code">io.open</span>. For example, <span class="code">openhook=fileinput.hook_compressed</span> decompresses any input file with extension <em>.gz</em> or <em>.bz2</em> (not compatible with <span class="code">inplace=</span><span class="code"><strong>True</strong></span>). You can write your own <span class="code">openhook</span> function to decompress other file types, for example using LZMA decompression<sup><a data-type="noteref" href="ch11.xhtml#ch01fn100" id="ch01fn100-marker">a</a></sup> for <em>.xz</em> files; use the <a href="https://oreil.ly/qXxx1">Python source for <span class="code">fileinput.hook_compressed</span></a> as a template. <span class="version">3.10+</span> You can also pass <span class="code">encoding</span> and <span class="code">errors</span>, which will be passed to the hook as keyword arguments .</td>
</tr>
</tbody>
<tbody><tr class="footnotes"><td colspan="2"><p data-type="footnote" id="ch01fn100"><sup><a href="ch11.xhtml#ch01fn100-marker">a</a></sup> LZMA support may require building Python with optional additional libraries.</p></td></tr></tbody></table>
<p>The functions of the <span class="code">fileinput</span> module listed in <a data-type="xref" href="#additional_functions_of_the_fileinput_m">Table 11-5</a> work on the global state created by <span class="code">fileinput.input</span>, if any; otherwise, they raise <span class="code">RuntimeError</span>.</p>
<table class="border" id="additional_functions_of_the_fileinput_m">
<caption><span class="label">Table 11-5. </span>Additional functions of the <span class="code">fileinput</span> module</caption>
<tbody>
<tr>
<td class="width-20"><span class="code">close</span></td>
<td><span class="code">close()</span><br/>
			Closes<a contenteditable="false" data-primary="close (fileinput module)" data-type="indexterm" id="idm44924518354784"/> the whole sequence so that iteration stops and no file remains open.</td>
</tr>
<tr>
<td><span class="code">filelineno</span></td>
<td><span class="code">filelineno()</span><br/>
			Returns<a contenteditable="false" data-primary="filelineno (fileinput module)" data-type="indexterm" id="idm44924518350944"/> the number of lines read so far from the file now being read. For example, returns <span class="code">1</span> if the first line has just been read from the current file.</td>
</tr>
<tr>
<td><span class="code">filename</span></td>
<td><span class="code">filename()</span><br/>
			Returns<a contenteditable="false" data-primary="filename (fileinput module)" data-type="indexterm" id="idm44924518346544"/> the name of the file now being read, or <span class="code"><strong>None</strong></span> if no line has been read yet.</td>
</tr>
<tr>
<td><span class="code">isfirstline</span></td>
<td><span class="code">isfirstline()</span><br/>
			Returns<a contenteditable="false" data-primary="isfirstline (fileinput module)" data-type="indexterm" id="idm44924518341664"/> <span class="code"><strong>True</strong></span> or <span class="code"><strong>False</strong></span>, just like <span class="code">filelineno() == 1</span>.</td>
</tr>
<tr>
<td><span class="code">isstdin</span></td>
<td><span class="code">isstdin()</span><br/>
			Returns<a contenteditable="false" data-primary="isstdin (fileinput module)" data-type="indexterm" id="idm44924518335472"/> <span class="code"><strong>True</strong></span> when the current file being read is <span class="code">sys.stdin</span>; otherwise, returns <span class="code"><strong>False</strong></span>.</td>
</tr>
<tr>
<td><span class="code">lineno</span></td>
<td><span class="code">lineno()</span><br/>
			Returns<a contenteditable="false" data-primary="lineno (fileinput module)" data-type="indexterm" id="idm44924518329552"/> the total number of lines read since the call to <span class="code">input</span>.</td>
</tr>
<tr>
<td><span class="code">nextfile</span></td>
<td><span class="code">nextfile()</span><br/>
			Closes<a contenteditable="false" data-primary="nextfile (fileinput module)" data-type="indexterm" id="idm44924518325056"/> the file being read: the next line to read is the first one of the next file.</td>
</tr>
</tbody>
</table>
<p>Here’s a typical example of using <span class="code">fileinput</span> for a “multifile search and replace,” changing one string into another throughout the text files whose names were passed as command-line arguments to the script:</p>
<pre data-code-language="python" data-type="programlisting">
<strong><code class="kn">import</code></strong><code> </code><code class="nn">fileinput</code><code>
</code><strong><code class="k">for</code></strong><code> </code><code class="n">line</code><code> </code><strong><code class="ow">in</code></strong><code> </code><code class="n">fileinput</code><code class="o">.</code><code class="n">input</code><code class="p">(</code><code class="n">inplace</code><code class="o">=</code><strong><code class="kc">True</code></strong><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="nb">print</code><code class="p">(</code><code class="n">line</code><code class="o">.</code><code class="n">replace</code><code class="p">(</code><code class="s1">'</code><code class="s1">foo</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">bar</code><code class="s1">'</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">end</code><code class="o">=</code><code class="s1">'</code><code class="s1">'</code><code class="p">)</code></pre>
<p>In such cases it’s important to include the <span class="code">end=''</span> argument to <span class="code">print</span>, since each <span class="code">line</span> has its line-end character <span class="code">\n</span> at the end, and you need to ensure that <span class="code">print</span> doesn’t add another (or else each file would end up “double-spaced”).</p>
<p>You may also use the <span class="code">FileInput</span> instance returned by <span class="code">fileinput.input</span> as a context manager. Just as with <span class="code">io.open</span>, this will close all files opened by the <span class="code">FileInput</span> upon exiting the <span class="code"><strong>with</strong></span> statement, even if an exception<a contenteditable="false" data-primary="" data-startref="fileinput11" data-type="indexterm" id="idm44924518279424"/><a contenteditable="false" data-primary="" data-startref="FTfileinput11" data-type="indexterm" id="idm44924518249216"/><a contenteditable="false" data-primary="" data-startref="SLMfileinput11" data-type="indexterm" id="idm44924518247840"/> occurs:</p>
<pre data-code-language="python" data-type="programlisting">
<strong><code class="k">with</code></strong><code> </code><code class="n">fileinput</code><code class="o">.</code><code class="n">input</code><code class="p">(</code><code class="s1">'</code><code class="s1">file1.txt</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">file2.txt</code><code class="s1">'</code><code class="p">)</code><code> </code><strong><code class="k">as</code></strong><code> </code><code class="n">infile</code><code class="p">:</code><code>
</code><code>    </code><code class="n">dostuff</code><code class="p">(</code><code class="n">infile</code><code class="p">)</code></pre>
</div></section>
<section data-pdf-bookmark="The struct Module" data-type="sect2"><div class="sect2" id="the_struct_module">
<h2>The struct Module</h2>
<p>The<a contenteditable="false" data-primary="file and text operations" data-secondary="struct module" data-type="indexterm" id="FTstruct11"/><a contenteditable="false" data-primary="struct module" data-type="indexterm" id="strct11"/><a contenteditable="false" data-primary="standard library modules" data-secondary="struct" data-type="indexterm" id="SLMstruct11"/> <span class="code">struct</span> module lets you pack binary data into a bytestring, and unpack the bytes of such a bytestring back into the Python data they represent. This is useful for many kinds of low-level programming. Often, you use <span class="code">struct</span> to interpret data records from binary files that have some specified format, or to prepare records to write to such binary files. The module’s name comes from C’s keyword <span class="code">struct</span>, which is usable for related purposes. On any error, functions of the module <span class="code">struct</span> raise exceptions that are instances of the exception class <span class="code">struct.error</span>.</p>
<p>The <span class="code">struct</span> module relies on<a contenteditable="false" data-primary="struct format strings" data-type="indexterm" id="idm44924518191024"/> <em>struct format strings</em> following a specific syntax. The first character of a format string gives the <a href="https://oreil.ly/rqogV">byte order</a>, size, and alignment of the packed data; the options are listed in <a data-type="xref" href="#possible_first_characters_in_a_struct_f">Table 11-6</a>.</p>
<table class="border" id="possible_first_characters_in_a_struct_f">
<caption><span class="label">Table 11-6. </span>Possible first characters in a <span class="code">struct</span> format string</caption>
<thead>
<tr>
<th>Character</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="code">@</span></td>
<td>Native<a contenteditable="false" data-primary="@ (commercial at sign)" data-secondary="struct format strings" data-type="indexterm" id="idm44924518182320"/><a contenteditable="false" data-primary="at sign (@)" data-secondary="struct format strings" data-type="indexterm" id="idm44924518180944"/> byte order, native data sizes, and native alignment for the current platform; this is the default if the first character is none of the characters listed here (note that the format <span class="code">P</span> in <a data-type="xref" href="#common_format_characters_for_struct">Table 11-7</a> is available only for this kind of <span class="code">struct</span> format string). Look at the string <span class="code">sys.byteorder</span> when you need to check your system’s byte order; most CPUs today use <span class="code">'little'</span>, but <span class="code">'big'</span> is the “network standard” for TCP/IP, the core protocols of the internet.</td>
</tr>
<tr>
<td><span class="code">=</span></td>
<td>Native<a contenteditable="false" data-primary="= (equal sign)" data-secondary="struct format strings" data-type="indexterm" id="idm44924518173232"/><a contenteditable="false" data-primary="equal sign (=)" data-secondary="struct format strings" data-type="indexterm" id="idm44924518171824"/> byte order for the current platform, but standard size and alignment.</td>
</tr>
<tr>
<td><span class="code">&lt;</span></td>
<td>Little-endian<a contenteditable="false" data-primary="&lt; (little-endian byte order)" data-type="indexterm" id="idm44924518168608"/><a contenteditable="false" data-primary="little-endian byte order (&lt;)" data-type="indexterm" id="idm44924518167504"/> byte order; standard size and alignment.</td>
</tr>
<tr>
<td><span class="code">&gt;</span>, <span class="code">!</span></td>
<td>Big-endian/network<a contenteditable="false" data-primary="&gt;, ! (big endian/network standard byte order)" data-type="indexterm" id="idm44924518163808"/><a contenteditable="false" data-primary="big endian/network standard byte order (&gt;, !)" data-type="indexterm" id="idm44924518162576"/> standard byte order; standard size and alignment.</td>
</tr>
</tbody>
</table>
<p>Standard sizes are indicated in <a data-type="xref" href="#common_format_characters_for_struct">Table 11-7</a>. Standard alignment means no forced alignment, with explicit padding bytes used as needed. Native sizes and alignment are whatever the platform’s C compiler uses. Native byte order can put the most significant byte at either the lowest (big-endian) or highest (little-endian) address, depending on the platform.</p>
<p>After the optional first character, a format string is made up of one or more format characters, each optionally preceded by a count (an integer represented by decimal digits). Common format characters are listed in <a data-type="xref" href="#common_format_characters_for_struct">Table 11-7</a>; see the <a href="https://oreil.ly/yz7bI">online docs</a> for a complete list. For most format characters, the count means repetition (e.g., <span class="code">'3h'</span> is exactly the same as <span class="code">'hhh'</span>). When the format character is <span class="code">s</span> or <span class="code">p</span>—that is, a bytestring—the count is not a repetition: it’s the total number of bytes in the string. You can freely use whitespace between formats, but not between a count and its format character. The format <span class="code">s</span> means a fixed-length bytestring as long as its count (the Python string is truncated, or padded with copies of the null byte <span class="code">b'\0'</span>, if needed). The format <span class="code">p</span> means a “Pascal-like” bytestring: the first byte is the number of significant bytes that follow, and the actual contents start from the second byte. The count is the total number of bytes, including the length byte.</p>
<table class="border" id="common_format_characters_for_struct">
<caption><span class="label">Table 11-7. </span>Common format characters for <span class="code">struct</span></caption>
<thead>
<tr>
<th>Character</th>
<th>C type</th>
<th>Python type</th>
<th>Standard size</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="code">B</span></td>
<td><span class="code">unsigned char</span></td>
<td><span class="code">int</span></td>
<td>1 byte</td>
</tr>
<tr>
<td><span class="code">b</span></td>
<td><span class="code">signed char</span></td>
<td><span class="code">int</span></td>
<td>1 byte</td>
</tr>
<tr>
<td><span class="code">c</span></td>
<td><span class="code">char</span></td>
<td><span class="code">bytes</span> (length 1)</td>
<td>1 byte</td>
</tr>
<tr>
<td><span class="code">d</span></td>
<td><span class="code">double</span></td>
<td><span class="code">float</span></td>
<td>8 bytes</td>
</tr>
<tr>
<td><span class="code">f</span></td>
<td><span class="code">float</span></td>
<td><span class="code">float</span></td>
<td>4 bytes</td>
</tr>
<tr>
<td><span class="code">H</span></td>
<td><span class="code">unsigned short</span></td>
<td><span class="code">int</span></td>
<td>2 bytes</td>
</tr>
<tr>
<td><span class="code">h</span></td>
<td><span class="code">signed short</span></td>
<td><span class="code">int</span></td>
<td>2 bytes</td>
</tr>
<tr>
<td><span class="code">I</span></td>
<td><span class="code">unsigned int</span></td>
<td><span class="code">long</span></td>
<td>4 bytes</td>
</tr>
<tr>
<td><span class="code">i</span></td>
<td><span class="code">signed int</span></td>
<td><span class="code">int</span></td>
<td>4 bytes</td>
</tr>
<tr>
<td><span class="code">L</span></td>
<td><span class="code">unsigned long</span></td>
<td><span class="code">long</span></td>
<td>4 bytes</td>
</tr>
<tr>
<td><span class="code">l</span></td>
<td><span class="code">signed long</span></td>
<td><span class="code">int</span></td>
<td>4 bytes</td>
</tr>
<tr>
<td><span class="code">P</span></td>
<td><span class="code">void*</span></td>
<td><span class="code">int</span></td>
<td>N/A</td>
</tr>
<tr>
<td><span class="code">p</span></td>
<td><span class="code">char[]</span></td>
<td><span class="code">bytes</span></td>
<td>N/A</td>
</tr>
<tr>
<td><span class="code">s</span></td>
<td><span class="code">char[]</span></td>
<td><span class="code">bytes</span></td>
<td>N/A</td>
</tr>
<tr>
<td><span class="code">x</span></td>
<td><span class="code">padding byte</span></td>
<td>No value</td>
<td>1 byte</td>
</tr>
</tbody>
</table>
<p>The <span class="code">struct</span> module supplies the functions covered in <a data-type="xref" href="#functions_of_the_struct_module">Table 11-8</a>.</p>
<table class="border" id="functions_of_the_struct_module">
<caption><span class="label">Table 11-8. </span>Functions of the <span class="code">struct</span> module</caption>
<tbody>
<tr>
<td><span class="code">calcsize</span></td>
<td><span class="code">calcsize(<em>fmt</em>, /)</span><br/>
			Returns<a contenteditable="false" data-primary="calcsize (struct module)" data-type="indexterm" id="idm44924518088192"/> the size, in bytes, corresponding to format string <span class="code"><em>fmt</em></span>.</td>
</tr>
<tr>
<td><span class="code">iter_unpack</span></td>
<td><span class="code">iter_unpack(<em>fmt</em>,</span> <span class="code"><em>buffer</em></span><span class="code">, /)</span><br/>
			Unpacks iteratively from <span class="code"><em>buffer</em></span> per format string <span class="code"><em>fmt</em></span>. Returns an iterator that will read equally sized chunks from <span class="code"><em>buffer</em></span> until all its contents are consumed; each iteration yields a tuple as specified by <span class="code"><em>fmt</em></span>. <span class="code"><em>buffer</em></span>’s size must be a multiple of the size required by the format, as reflected in <span class="code">struct.calcsize(<em>fmt</em>)</span>.</td>
</tr>
<tr>
<td><span class="code">pack</span></td>
<td><span class="code">pack(<em>fmt</em>,</span> <span class="code"><em>*values</em></span><span class="code">, /)</span><br/>
			Packs<a contenteditable="false" data-primary="pack function (struct module)" data-type="indexterm" id="idm44924518071760"/> the values per format string <span class="code"><em>fmt</em></span>, and returns the resulting bytestring. <span class="code"><em>values</em></span> must match in number and type the values required by <span class="code"><em>fmt</em></span>.</td>
</tr>
<tr>
<td><span class="code">pack_into</span></td>
<td><span class="code">pack_into(<em>fmt</em>,</span> <span class="code"><em>buffer</em></span><span class="code">,</span> <span class="code"><em>offset</em></span><span class="code">,</span> <span class="code"><em>*values</em></span><span class="code">, /)</span><br/>
			Packs<a contenteditable="false" data-primary="pack_into function (struct module)" data-type="indexterm" id="idm44924518060640"/> the values per format string <span class="code"><em>fmt</em></span> into writable buffer <span class="code"><em>buffer</em></span> (usually an instance of <span class="code">bytearray</span>) starting at index <span class="code"><em>offset</em></span>. <span class="code"><em>values</em></span> must match in number and type the values required by <span class="code"><em>fmt</em></span>. <span class="code">len(buffer[offset:])</span> must be <span class="code">&gt;=struct.calcsize(<em>fmt</em>)</span>.</td>
</tr>
<tr>
<td><span class="code">unpack</span></td>
<td><span class="code">unpack(<em>fmt</em>,</span> <span class="code"><em>s</em></span><span class="code">, /)</span><br/>
			Unpacks<a contenteditable="false" data-primary="unpack function (struct module)" data-type="indexterm" id="idm44924518048320"/> bytestring <span class="code"><em>s</em></span> per format string <span class="code"><em>fmt</em></span>, and returns a tuple of values (if just one value, a one-item tuple). <span class="code">len(<em>s</em>)</span> must equal <span class="code">struct.calcsize(<em>fmt</em>)</span>.</td>
</tr>
<tr>
<td><span class="code">unpack_from</span></td>
<td><span class="code">unpack_from(<em>fmt</em>, /, buffer, offset=0<em>)</em></span><br/>
			Unpacks<a contenteditable="false" data-primary="unpack_from function (struct module)" data-type="indexterm" id="idm44924518039744"/> bytestring (or other readable buffer) <span class="code">buffer</span>, starting from offset <span class="code">offset</span>, per format string <span class="code"><em>fmt</em></span>, returning a tuple of values (if just one value, a one-item tuple). <span class="code">len(buffer[offset:])</span> must be <span class="code">&gt;=struct.calcsize(</span><span class="code"><em>fmt</em>)</span>.</td>
</tr>
</tbody>
</table>
<p>The <span class="code">struct</span> module also offers a<a contenteditable="false" data-primary="Struct class (struct module)" data-type="indexterm" id="idm44924518032304"/> <span class="code">Struct</span> class, which is instantiated with a format string as an argument. Instances of this class implement <span class="code">pack</span>, <span class="code">pack_into</span>, <span class="code">unpack</span>, <span class="code">unpack_from</span>, and <span class="code">iter_unpack</span> methods corresponding to the functions described in the preceding table; they take the same arguments as the corresponding module functions, but omitting the <span class="code"><em>fmt</em></span> argument, which was provided on instantiation. This allows the class to compile the format string once and reuse it. Struct objects also have a <span class="code">format</span> attribute that holds the format string for the object, and a <span class="code">size</span> attribute that holds the calculated size of the structure.<a contenteditable="false" data-primary="" data-startref="FTstruct11" data-type="indexterm" id="idm44924518024240"/><a contenteditable="false" data-primary="" data-startref="strct11" data-type="indexterm" id="idm44924518022784"/><a contenteditable="false" data-primary="" data-startref="SLMstruct11" data-type="indexterm" id="idm44924518021408"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="In-Memory Files: io.StringIO and io.BytesIO" data-type="sect1"><div class="sect1" id="in_memory_files_iodotstringio_and_iodot">
<h1>In-Memory Files: io.StringIO and io.BytesIO</h1>
<p>You<a contenteditable="false" data-primary="file and text operations" data-secondary="in-memory files" data-type="indexterm" id="idm44924518018448"/><a contenteditable="false" data-primary="in-memory files" data-type="indexterm" id="idm44924518016688"/><a contenteditable="false" data-primary="file-like objects" data-type="indexterm" id="idm44924518015584"/><a contenteditable="false" data-primary="io module" data-secondary="io.StringIO" data-type="indexterm" id="idm44924518014480"/><a contenteditable="false" data-primary="io module" data-secondary="io.BytesIO" data-type="indexterm" id="idm44924518013104"/> can implement file-like objects by writing Python classes that supply the methods you need. If all you want is for data to reside in memory, rather than in a file as seen by the operating system, use the classes<a contenteditable="false" data-primary="StringIO class (io module)" data-type="indexterm" id="idm44924518011600"/> <span class="code">StringIO</span> or<a contenteditable="false" data-primary="BytesIO class (io module)" data-type="indexterm" id="idm44924518009680"/> <span class="code">BytesIO</span> of the <span class="code">io</span> module. The difference between them is that instances of <span class="code">StringIO</span> are text-mode files, so reads and writes consume or produce text strings, while instances of <span class="code">BytesIO</span> are binary files, so reads and writes consume or produce bytestrings. These classes are especially useful in tests and other applications where program output should be redirected for buffering or journaling; <a data-type="xref" href="#the_print_function">“The print Function”</a> includes a useful context manager example, <span class="code">redirect</span>, that demonstrates this.</p>
<p>When you instantiate either class you can optionally pass a string argument, respectively <span class="code">str</span> or <span class="code">bytes</span>, to use as the initial content of the file. Additionally, you can pass the argument <span class="code">newline='\n'</span> to <span class="code">StringIO</span> (but not <span class="code">BytesIO</span>) to control how line endings are handled (like in <a href="https://oreil.ly/-cD05"><span class="code">TextIoWrapper</span></a>); if <span class="code">newline</span> is <span class="code">None</span>, newlines are written as <span class="code">\n</span> on all platforms. In addition to the methods described in <a data-type="xref" href="#attributes_and_methods_of_file_objects">Table 11-2</a>, an instance <span class="code"><em>f</em></span> of either class supplies one extra method:</p>
<table class="border">
<tbody>
<tr>
<td class="width-15"><span class="code">getvalue</span></td>
<td><span class="code">getvalue()</span><br/>
			Returns<a contenteditable="false" data-primary="getvalue (io.BytesIO, io.StringIO)" data-type="indexterm" id="idm44924517990768"/> the current data contents of <span class="code"><em>f</em></span> as a string (text or bytes). You cannot call <span class="code"><em>f</em></span><span class="code">.getvalue</span> after you call <span class="code"><em>f</em></span><span class="code">.close</span>: <span class="code">close</span> frees the buffer that <span class="code"><em>f</em></span> internally keeps, and <span class="code">getvalue</span> needs to return the buffer as its result.</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Archived and Compressed Files" data-type="sect1"><div class="sect1" id="archived_and_compressed_files">
<h1>Archived and Compressed Files</h1>
<p>Storage<a contenteditable="false" data-primary="file and text operations" data-secondary="archived and compressed files" data-type="indexterm" id="FTarchive11"/><a contenteditable="false" data-primary="archived files" data-type="indexterm" id="archfile11"/><a contenteditable="false" data-primary="compressed files" data-type="indexterm" id="comfile11"/> space and transmission bandwidth are increasingly cheap and abundant, but in many cases you can save such resources, at the expense of some extra computational effort, by using compression. Computational power grows cheaper and more abundant even faster than some other resources, such as bandwidth, so compression’s popularity keeps growing. Python makes it easy for your programs to support compression. We don’t cover the details of compression in this book, but you can find details on the relevant standard library modules in the <a href="https://oreil.ly/QJzCW">online docs</a>.</p>
<p>The rest of this section covers “archive” files (which collect in a single file a collection of files and optionally directories), which may or may not be compressed. Python’s stdlib offers two modules to handle two very popular archive formats: <span class="code">tarfile</span> (which, by default, does not compress the files it bundles), and <span class="code">zipfile</span> (which, by default, does compress the files it bundles).</p>
<section data-pdf-bookmark="The tarfile Module" data-type="sect2"><div class="sect2" id="the_tarfile_module">
<h2>The tarfile Module</h2>
<p>The<a contenteditable="false" data-primary="tarfile module" data-type="indexterm" id="tarfile11"/> <span class="code">tarfile</span> module lets you read and write<a href="https://oreil.ly/TvKqN">TAR files</a> (archive files compatible with those handled by popular archiving programs such as <span class="code">tar</span>), optionally with gzip, bzip2, or LZMA compression. TAR files are typically named with a <em>.tar</em> or <em>.tar.(compression type)</em> extension. <span class="version">3.8+</span> The default format of new archives is POSIX.1-2001 (pax). <span class="code"><strong>python -m tarfile</strong></span> offers a useful command-line interface to the module’s functionality: run it without arguments to get a brief help message.</p>
<p class="pagebreak-before">The <span class="code">tarfile</span> module supplies the functions listed in <a data-type="xref" href="#classes_and_functions_of_the_tarfile_mo">Table 11-9</a>. When handling invalid TAR files, functions of <span class="code">tarfile</span> raise instances of <span class="code">tarfile.TarError</span>.</p>
<table class="border" id="classes_and_functions_of_the_tarfile_mo">
<caption><span class="label">Table 11-9. </span>Classes and functions of the <span class="code">tarfile</span> module</caption>
<tbody>
<tr>
<td class="width-15"><span class="code">is_tarfile</span></td>
<td><span class="code">is_tarfile(<em>filename</em>)</span><br/>
			Returns <span class="code"><strong>True</strong></span> when the file named by <span class="code"><em>filename</em></span> (which may be a <span class="code">str</span>, <span class="version">3.9+</span> or a file or file-like object) appears to be a valid TAR file (possibly with compression), judging by the first few bytes; otherwise, returns <span class="code"><strong>False</strong></span>.</td>
</tr>
<tr>
<td><span class="code">open</span></td>
<td><span class="code">open(name=<strong>None</strong>, mode='r', fileobj=<strong>None</strong>, bufsize=10240,</span> <span class="code"><em>**kwargs</em></span><span class="code">)</span><br/>
			Creates and returns a <span class="code">TarFile</span> instance <span class="code"><em>f</em></span> to read or create a TAR file through file-like object <span class="code">fileobj</span>. When <span class="code">fileobj</span> is <span class="code"><strong>None</strong></span>, <span class="code">name</span> may be a string naming a file or a path-like object; <span class="code">open</span> opens the file with the given <span class="code">mode</span> (by default, <span class="code">'r'</span>), and <span class="code"><em>f</em></span> wraps the resulting file object. <span class="code">open</span> may be used as a context manager (e.g., <span class="code"><strong>with</strong></span> <span class="code">tarfile.open(...)</span> <span class="code"><strong>as</strong></span> <span class="code"><em>f</em></span>).
			<div data-type="note" epub:type="note">
<h1>f.close may not close fileobj</h1>
<p>Calling <span class="code"><em>f</em></span><span class="code">.close</span> does <em>not</em> close <span class="code">fileobj</span> when <span class="code"><em>f</em></span> was opened with a <span class="code">fileobj</span> that is not <span class="code"><strong>None</strong></span>. This behavior of <span class="code"><em>f</em></span><span class="code">.close</span> is important when <span class="code">fileobj</span> is an instance of <span class="code">io.BytesIO</span>: you can call <span class="code">fileobj.getvalue</span> after <span class="code"><em>f</em></span><span class="code">.close</span> to get the archived and possibly compressed data as a string. This behavior also means that you have to call <span class="code">fileobj.close</span> explicitly after calling <span class="code"><em>f</em></span><span class="code">.close</span>.</p>
</div>
<span class="code">mode</span> can be <span class="code">'r'</span> to read an existing TAR file with whatever compression it has (if any); <span class="code">'w'</span> to write a new TAR file, or truncate and rewrite an existing one, without compression; or <span class="code">'a'</span> to append to an existing TAR file, without compression. Appending to compressed TAR files is not supported. To write a new TAR file with compression, <span class="code">mode</span> can be <span class="code">'w:gz'</span> for gzip compression, <span class="code">'w:bz2'</span> for bzip2 compression, or <span class="code">'w:xz'</span> for LZMA compression. You can use mode strings <span class="code">'r:'</span> or <span class="code">'w:'</span> to read or write uncompressed, nonseekable TAR files using a buffer of <span class="code">bufsize</span> bytes; for reading TAR files use plain <span class="code">'r'</span>, since this will automatically uncompress as necessary.<br/>
			In the mode strings specifying compression, you can use a vertical bar (<span class="code">|</span>) instead of a colon (<span class="code">:</span>) to force sequential processing and fixed-size blocks; this is useful in the (admittedly very unlikely) case that you ever find yourself handling a tape device!</td>
</tr>
</tbody>
</table>
<section class="pagebreak-before" data-pdf-bookmark="The TarFile class" data-type="sect3"><div class="sect3" id="the_tarfile_class">
<h3 class="less_space">The TarFile class</h3>
<p><a href="https://oreil.ly/RwYNA"><span class="code">TarFile</span></a> is<a contenteditable="false" data-primary="TarFile class" data-type="indexterm" id="idm44924517907248"/> the underlying class for most <span class="code">tarfile</span> methods, but is not used directly. A <span class="code">TarFile</span> instance <em>f</em>, created using <span class="code">tarfile.open</span>, supplies the methods detailed in <a data-type="xref" href="#methods_of_a_tarfile_instance_f">Table 11-10</a>.</p>
<table class="border" id="methods_of_a_tarfile_instance_f">
<caption><span class="label">Table 11-10. </span>Methods of a <span class="code">TarFile</span> instance <span class="code"><em>f</em></span></caption>
<tbody>
<tr>
<td class="width-15"><span class="code">add</span></td>
<td><span class="code"><em>f</em></span><span class="code">.add(<em>name</em>, arcname=<strong>None</strong>, recursive=<strong>True</strong>, *, filter=<strong>None</strong>)</span><br/>
			Adds to archive <span class="code"><em>f</em></span> the file named by <span class="code"><em>name</em></span> (can be any type of file, a directory, or a symbolic link). When <span class="code">arcname</span> is not <span class="code"><strong>None</strong></span>, it’s used as the archive member name in lieu of <span class="code"><em>name</em></span>. When <span class="code"><em>name</em></span> is a directory, and <span class="code">recursive</span> is <span class="code"><strong>True</strong></span>, <span class="code">add</span> recursively adds the whole filesystem subtree rooted in that directory in sorted order. The optional (named-only) argument <span class="code">filter</span> is a function that is called on each object to be added. It takes a <span class="code">TarInfo</span> object argument and returns either the (possibly modified) <span class="code">TarInfo</span> object, or <span class="code"><strong>None</strong></span>. In the latter case the <span class="code">add</span> method excludes this <span class="code">TarInfo</span> object from the archive.</td>
</tr>
<tr>
<td><span class="code">addfile</span></td>
<td><span class="code"><em>f</em></span><span class="code">.addfile(<em>tarinfo</em>, fileobj=<strong>None</strong>)</span><br/>
			Adds to archive <span class="code"><em>f</em></span> a <span class="code">TarInfo</span> object <span class="code"><em>tarinfo</em></span>. If <span class="code">fileobj</span> is not <span class="code"><strong>None</strong></span>, the first <span class="code"><em>tarinfo</em></span><span class="code">.size</span> bytes of binary file-like object <span class="code">fileobj</span> are added.</td>
</tr>
<tr>
<td><span class="code">close</span></td>
<td><span class="code"><em>f</em></span><span class="code">.close()</span><br/>
			Closes archive <span class="code"><em>f</em></span>. You must call <span class="code">close</span>, or else an incomplete, unusable TAR file might be left on disk. Such mandatory finalization is best performed with a <span class="code"><strong>try</strong></span><span class="code">/</span><span class="code"><strong>finally</strong></span>, as covered in <a data-type="xref" href="ch06.xhtml#trysolidusfinally">“try/finally”</a>, or, even better, a <span class="code"><strong>with</strong></span> statement, covered in <a data-type="xref" href="ch06.xhtml#the_with_statement_and_context_managers">“The with Statement and Context Managers”</a>. Calling <span class="code"><em>f</em></span><span class="code">.close</span> does <em>not</em> close <span class="code">fileobj</span> if <span class="code"><em>f</em></span> was created with a non-<span class="code"><strong>None</strong></span> <span class="code">fileobj</span>. This matters especially when <span class="code">fileobj</span> is an instance of <span class="code">io.BytesIO</span>: you can call <span class="code">fileobj.getvalue</span> after <span class="code"><em>f</em></span><span class="code">.close</span> to get the compressed data string. So, you always have to call <span class="code">fileobj.close</span> (explicitly, or implicitly by using a <span class="code"><strong>with</strong></span> statement) <em>after</em> <span class="code"><em>f</em></span><span class="code">.close</span>.</td>
</tr>
<tr>
<td><span class="code">extract</span></td>
<td><span class="code"><em>f.</em></span><span class="code">extract(<em>member</em>, path='', set_attrs=<strong>True</strong>, numeric_owner=<strong>False</strong>)</span><br/>
			Extracts the archive member identified by <span class="code"><em>member</em></span> (a name or a <span class="code">TarInfo</span> instance) into a corresponding file in the directory (or path-like object) named by <span class="code">path</span> (the current directory by default). If <span class="code">set_attrs</span> is <span class="code"><strong>True</strong></span>, the owner and timestamps will be set as they were saved in the TAR file; otherwise, the owner and timestamps for the extracted file will be set using the current user and time values. If <span class="code">numeric_owner</span> is <span class="code"><strong>True</strong></span>, the UID and GID numbers from the TAR file are used to set the owner/group for the extracted files; otherwise, the named values from the TAR file are used. (The <a href="https://oreil.ly/Ugj8v">online docs</a> recommend using <span class="code">extractall</span> over calling <span class="code">extract</span> directly, since <span class="code">extractall</span> does additional error handling internally.)</td>
</tr>
<tr>
<td><span class="code">extractall</span></td>
<td><span class="code"><em>f</em></span><span class="code">.extractall(path='.', members=<strong>None</strong>, numeric_owner=<strong>False</strong>)</span><br/>
			Similar to calling <span class="code">extract</span> on each member of TAR file <span class="code"><em>f</em></span>, or just those listed in the <span class="code">members</span> argument, with additional error checking for <span class="code">chown</span>, <span class="code">chmod</span>, and <span class="code">utime</span> errors that occur while writing the extracted members.
			<div data-type="warning" epub:type="warning">
<h1>Don’t Use extractall on a Tarfile from an Untrusted Source</h1>
<p><span class="code">extractall</span> does not check the paths of extracted files, so there is a risk that an extracted file will have an absolute path (or include one or more <span class="code">..</span> components) and thus overwrite a potentially sensitive file.<sup><a data-type="noteref" href="ch11.xhtml#ch01fn101" id="ch01fn101-marker">a</a></sup> It is best to read each member individually and only extract it if it has a safe path (i.e., no absolute paths or relative paths with any<span class="code">..</span> path component).</p>
</div>
</td>
</tr>
<tr>
<td><span class="code">extractfile</span></td>
<td><span class="code"><em>f</em></span><span class="code">.extractfile(<em>member</em>)</span><br/>
			Extracts the archive member identified by <span class="code"><em>member</em></span> (a name or a <span class="code">TarInfo</span> instance) and returns an <span class="code">io.BufferedReader</span> object with the methods <span class="code">read</span>, <span class="code">readline</span>, <span class="code">readlines</span>, <span class="code">seek</span>, and <span class="code">tell</span>.</td>
</tr>
<tr>
<td><span class="code">getmember</span></td>
<td><span class="code"><em>f</em></span><span class="code">.getmember(<em>name</em>)</span><br/>
			Returns a <span class="code">TarInfo</span> instance with information about the archive member named by the string <span class="code"><em>name</em></span>.</td>
</tr>
<tr>
<td><span class="code">getmembers</span></td>
<td><span class="code"><em>f</em></span><span class="code">.getmembers()</span><br/>
			Returns a list of <span class="code">TarInfo</span> instances, one for each member in archive <span class="code"><em>f</em></span>, in the same order as the entries in the archive itself.</td>
</tr>
<tr>
<td><span class="code">getnames</span></td>
<td><span class="code"><em>f</em></span><span class="code">.getnames()</span><br/>
			Returns a list of strings, the names of each member in archive <span class="code"><em>f</em></span>, in the same order as the entries in the archive itself.</td>
</tr>
<tr>
<td><span class="code">gettarinfo</span></td>
<td><span class="code"><em>f</em></span><span class="code">.gettarinfo(name=<strong>None</strong>, arcname=<strong>None</strong>, fileobj=<strong>None</strong>)</span><br/>
			Returns a <span class="code">TarInfo</span> instance with information about the open file object <span class="code">fileobj</span>, when not <span class="code"><strong>None</strong></span>, or else the existing file whose path is the string <span class="code">name</span>. <span class="code">name</span> may be a path-like object. When <span class="code">arcname</span> is not <span class="code"><strong>None</strong></span>, it’s used as the <span class="code">name</span> attribute of the resulting <span class="code">TarInfo</span> instance.</td>
</tr>
<tr>
<td><span class="code">list</span></td>
<td><span class="code"><em>f</em></span><span class="code">.list(verbose=<strong>True</strong>, *, members=<strong>None</strong>)</span><br/>
			Outputs a directory of the archive <span class="code"><em>f</em></span> to <span class="code">sys.stdout</span>. If the optional argument <span class="code">verbose</span> is <span class="code"><strong>False</strong></span>, outputs only the names of the archive’s members. If the optional argument <span class="code">members</span> is given, it must be a subset of the list returned by <span class="code">getmembers</span>.</td>
</tr>
<tr>
<td><span class="code">next</span></td>
<td><span class="code"><em>f</em></span><span class="code">.next()</span><br/>
			Returns the next available archive member as a <span class="code">TarInfo</span> instance; if none are available, returns <span class="code"><strong>None</strong></span>.</td>
</tr>
</tbody>
<tbody><tr class="footnotes"><td colspan="2"><p data-type="footnote" id="ch01fn101"><sup><a href="ch11.xhtml#ch01fn101-marker">a</a></sup> Described further in <a href="https://oreil.ly/7hJ89">CVE-2007-4559</a>.</p></td></tr></tbody></table>
</div></section>
<section data-pdf-bookmark="The TarInfo class" data-type="sect3"><div class="sect3" id="the_tarinfo_class">
<h3>The TarInfo class</h3>
<p>The<a contenteditable="false" data-primary="TarInfo class" data-type="indexterm" id="idm44924517772320"/> methods <span class="code">getmember</span> and <span class="code">getmembers</span> of <span class="code">TarFile</span> instances return instances of <span class="code">TarInfo</span>, supplying information about members of the archive. You can also build a <span class="code">TarInfo</span> instance with a <span class="code">TarFile</span> instance’s method <span class="code">gettarinfo</span>. The <span class="code"><em>name</em></span> argument may be a path-like object. The most useful attributes and methods supplied by a <span class="code">TarInfo</span> instance <span class="code"><em>t</em></span> are listed in <a data-type="xref" href="#useful_attributes_of_a_tarinfo_instance">Table 11-11</a>.</p>
<table class="border" id="useful_attributes_of_a_tarinfo_instance">
<caption><span class="label">Table 11-11. </span>Useful attributes of a <span class="code">TarInfo</span> instance <span class="code"><em>t</em></span></caption>
<tbody>
<tr>
<td><span class="code">isdir()</span></td>
<td>Returns <span class="code"><strong>True</strong></span> if the file is a directory</td>
</tr>
<tr>
<td><span class="code">isfile()</span></td>
<td>Returns <span class="code"><strong>True</strong></span> if the file is a regular file</td>
</tr>
<tr>
<td><span class="code">issym()</span></td>
<td>Returns <span class="code"><strong>True</strong></span> if the file is a symbolic link</td>
</tr>
<tr>
<td><span class="code">linkname</span></td>
<td>Target file’s name (a string), when <span class="code"><em>t</em></span><span class="code">.type</span> is <span class="code">LNKTYPE</span> or <span class="code">SYMTYPE</span></td>
</tr>
<tr>
<td><span class="code">mode</span></td>
<td>Permission and other mode bits of the file identified by <span class="code"><em>t</em></span></td>
</tr>
<tr>
<td><span class="code">mtime</span></td>
<td>Time of last modification of the file identified by <span class="code"><em>t</em></span></td>
</tr>
<tr>
<td><span class="code">name</span></td>
<td>Name in the archive of the file identified by <span class="code"><em>t</em></span></td>
</tr>
<tr>
<td><span class="code">size</span></td>
<td>Size, in bytes (uncompressed), of the file identified by <span class="code"><em>t</em></span></td>
</tr>
<tr>
<td><span class="code">type</span></td>
<td>File type—one of many constants that are attributes of the <span class="code">tarfile</span> module (<span class="code">SYMTYPE</span> for symbolic links, <span class="code">REGTYPE</span> for regular files, <span class="code">DIRTYPE</span> for directories, and so on; see the <a href="https://oreil.ly/RwYNA">online docs</a> for a complete list)<a contenteditable="false" data-primary="" data-startref="tarfile11" data-type="indexterm" id="idm44924517731616"/></td>
</tr>
</tbody>
</table>
</div></section>
</div></section>
<section data-pdf-bookmark="The zipfile Module" data-type="sect2"><div class="sect2" id="the_zipfile_module">
<h2>The zipfile Module</h2>
<p>The<a contenteditable="false" data-primary="zipfile module" data-type="indexterm" id="zipmod11"/><a contenteditable="false" data-primary="standard library modules" data-secondary="zipfile" data-type="indexterm" id="SLMzipfile11"/> <span class="code">zipfile</span> module can read and write ZIP files (i.e., archive files compatible with those handled by popular compression programs such as <span class="code">zip</span> and <span class="code">unzip</span>, <span class="code">pkzip</span> and <span class="code">pkunzip</span>, <span class="code">WinZip</span>, and so on, typically named with a <em>.zip</em> extension). <span class="code"><strong>python -m zipfile</strong></span> offers a useful command-line interface to the module’s functionality: run it without further arguments to get a brief help message.</p>
<p>Detailed information about ZIP files is available on the <a href="https://oreil.ly/fVfmV">PKWARE</a> and <a href="https://oreil.ly/rMHiL">Info-ZIP</a> websites. You need to study that detailed information to perform advanced ZIP file handling with <span class="code">zipfile</span>. If you do not specifically need to interoperate with other programs using the ZIP file standard, the modules <span class="code">lzma</span>, <span class="code">gzip</span>, and <span class="code">bz2</span> are usually better ways to deal with compression, as is <span class="code">tarfile</span> to create (optionally compressed) archives.</p>
<p>The <span class="code">zipfile</span> module can’t handle multidisk ZIP files, and cannot create encrypted archives (it can decrypt them, albeit rather slowly). The module also cannot handle archive members using compression types besides the usual ones, known as <em>stored</em> (a file copied to the archive without compression) and <em>deflated</em> (a file compressed using the ZIP format’s default algorithm). <span class="code">zipfile</span> also handles the bzip2 and LZMA compression types, but beware: not all tools can handle those, so if you use them you’re sacrificing some portability to get better compression.</p>
<p>The <span class="code">zipfile</span> module supplies function <span class="code">is_zipfile</span> and class <span class="code">Path</span>, as listed in <a data-type="xref" href="#auxiliary_function_and_class_of_the_zip">Table 11-12</a>. In addition, it supplies classes <span class="code">ZipFile</span> and <span class="code">ZipInfo</span>, described later. For errors related to invalid ZIP files, functions of <span class="code">zipfile</span> raise exceptions that are instances of the exception class <span class="code">zipfile.error</span>.</p>
<table class="border" id="auxiliary_function_and_class_of_the_zip">
<caption><span class="label">Table 11-12. </span>Auxiliary function and class of the <span class="code">zipfile</span> module</caption>
<tbody>
<tr>
<td class="width-15"><span class="code">is_zipfile</span></td>
<td><span class="code">is_zipfile(<em>file</em>)</span><br/>
			Returns <span class="code"><strong>True</strong></span> when the file named by string, path-like object, or file-like object <span class="code"><em>file</em></span> seems to be a valid ZIP file, judging by the first few and last bytes of the file; otherwise, returns <span class="code"><strong>False</strong></span>.</td>
</tr>
<tr>
<td><span class="code">Path</span></td>
<td><span class="code"><strong>class</strong></span> <span class="code">Path(<em>root</em>, at='')</span><br/>
<span class="version">3.8+</span>A <span class="code">pathlib</span>-compatible wrapper for ZIP files. Returns a <span class="code">pathlib.Path</span> object <span class="code"><em>p</em></span> from <span class="code"><em>root</em></span>, a ZIP file (which may be a <span class="code">ZipFile</span> instance or file suitable for passing to the <span class="code">ZipFile</span> constructor). The string argument <span class="code">at</span> is a path to specify the location of <span class="code"><em>p</em></span> in the ZIP file: the default is the root. <span class="code"><em>p</em></span> exposes several <span class="code">pathlib.Path</span> methods: see the <a href="https://oreil.ly/sMeC_">online docs</a> for details.</td>
</tr>
</tbody>
</table>
<section data-pdf-bookmark="The ZipFile class" data-type="sect3"><div class="sect3" id="the_zipfile_class">
<h3>The ZipFile class</h3>
<p>The<a contenteditable="false" data-primary="ZipFile class (zipfile module)" data-type="indexterm" id="idm44924517680624"/> main class supplied by <span class="code">zipfile</span> is <span class="code">ZipFile</span>. Its constructor has the following signature:</p>
<table class="border">
<tbody>
<tr>
<td class="width-15"><span class="code">ZipFile</span></td>
<td><span class="code"><strong>class</strong></span> <span class="code">ZipFile(<em>file</em>, mode='r', compression=zipfile.ZIP_STORED, allowZip64=<strong>True</strong>, compresslevel=<strong>None</strong>, *, strict_timestamps=<strong>True</strong>)</span><br/>
			Opens a ZIP file named by <span class="code"><em>file</em></span> (a string, file-like object, or path-like object). <span class="code">mode</span> can be <span class="code">'r'</span> to read an existing ZIP file, <span class="code">'w'</span>, to write a new ZIP file or truncate and rewrite an existing one, or <span class="code">'a'</span> to append to an existing file. It can also be <span class="code">'x'</span>, which is like <span class="code">'w'</span> but raises an exception if the ZIP file already existed—here, <span class="code">'x'</span> stands for “exclusive.”<br/>
			When <span class="code">mode</span> is <span class="code">'a'</span>, <span class="code"><em>file</em></span> can name either an existing ZIP file (in which case new members are added to the existing archive) or an existing non-ZIP file. In the latter case, a new ZIP file-like archive is created and appended to the existing file. The main purpose of this latter case is to let you build an executable file that unpacks itself when run. The existing file must then be a pristine copy of a self-unpacking executable prefix, as supplied by <em>www.info-zip.org</em> and by other purveyors of ZIP file compression tools.<br/>
<span class="code">compression</span> is the ZIP compression method to use in writing the archive: <span class="code">ZIP_STORED</span> (the default) requests that the archive use no compression, and <span class="code">ZIP_DEFLATED</span> requests that the archive use the <em>deflation</em> mode of compression (the most usual and effective compression approach used in ZIP files). It can also be <span class="code">ZIP_BZIP2</span> or <span class="code">ZIP_LZMA</span> (sacrificing portability for more compression; these require the <span class="code">bz2</span> or <span class="code">lzma</span> module, respectively). Unrecognized values will raise <span class="code">NotImplementedError</span>.</td>
</tr>
<tr>
<td><span class="code">ZipFile</span><br/>
<em>(cont.)</em></td>
<td>When <span class="code">allowZip64</span> is <span class="code"><strong>True</strong></span> (the default), the <span class="code">ZipFile</span> instance is allowed to use the ZIP64 extensions to produce an archive larger than 4 GB; otherwise, any attempt to produce such a large archive raises a <span class="code">LargeZipFile</span> exception.<br/>
<span class="code">compresslevel</span> is an integer (ignored when using <span class="code">ZIP_STORED</span> or <span class="code">ZIP_LZMA</span>) from <span class="code">0</span> for <span class="code">ZIP_DEFLATED</span> (<span class="code">1</span> for <span class="code">ZIP_BZIP2</span>), which requests modest compression but fast operation, to <span class="code">9</span> to request the best compression at the cost of more computation.<br/>
<span class="version">3.8+</span> Set <span class="code">strict_timestamps</span> to <span class="code"><strong>False</strong></span> to store files older than 1980-01-01 (sets the timestamp to 1980-01-01) or beyond 2107-12-31 (sets the timestamp to 2107-12-31).</td>
</tr>
</tbody>
</table>
<p><span class="code">ZipFile</span> is a context manager; thus, you can use it in a <span class="code"><strong>with</strong></span> statement to ensure the underlying file gets closed when you’re done with it. For example:</p>
<pre data-code-language="python" data-type="programlisting">
<strong><code class="k">with</code></strong><code> </code><code class="n">zipfile</code><code class="o">.</code><code class="n">ZipFile</code><code class="p">(</code><code class="s1">'</code><code class="s1">archive.zip</code><code class="s1">'</code><code class="p">)</code><code> </code><strong><code class="k">as</code></strong><code> </code><code class="n">z</code><code class="p">:</code><code>    </code><code>
</code><code>    </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">z</code><code class="o">.</code><code class="n">read</code><code class="p">(</code><code class="s1">'</code><code class="s1">data.txt</code><code class="s1">'</code><code class="p">)</code></pre>
<p>In addition to the arguments with which it was instantiated, a <span class="code">ZipFile</span> instance <span class="code"><em>z</em></span> has the attributes <span class="code">fp</span> and <span class="code">filename</span>, which are the file-like object <span class="code"><em>z</em></span> works on and its filename (if known); <span class="code">comment</span>, the possibly empty string that is the archive’s comment; and <span class="code">filelist</span>, the list of <span class="code">ZipInfo</span> instances in the archive. In addition, <span class="code"><em>z</em></span> has a writable attribute called <span class="code">debug</span>, an <span class="code">int</span> from <span class="code">0</span> to <span class="code">3</span> that you can assign to control how much debugging output to emit to <span class="code">sys.stdout</span>:<sup><a data-type="noteref" href="ch11.xhtml#ch01fn102" id="ch01fn102-marker">2</a></sup> from nothing when <span class="code"><em>z</em></span><span class="code">.debug</span> is <span class="code">0</span>, to the maximum amount of information available when <span class="code"><em>z</em></span><span class="code">.debug</span> is <span class="code">3</span>.</p>
<p>A <span class="code">ZipFile</span> instance <span class="code"><em>z</em></span> supplies the methods listed in <a data-type="xref" href="#methods_supplied_by_an_instance_z_of_zi">Table 11-13</a>.</p>
<table class="border" id="methods_supplied_by_an_instance_z_of_zi">
<caption><span class="label">Table 11-13. </span>Methods supplied by an instance <span class="code"><em>z</em></span> of <span class="code">ZipFile</span></caption>
<tbody>
<tr>
<td class="width-15"><span class="code">close</span></td>
<td><span class="code">close()</span><br/>
			Closes archive file <span class="code"><em>z</em></span>. Make sure to call <em>z</em><span class="code">.close()</span>, or an incomplete and unusable ZIP file might be left on disk. Such mandatory finalization is generally best performed with a <span class="code"><strong>try</strong></span><span class="code">/</span><span class="code"><strong>finally</strong></span> statement, as covered in <a data-type="xref" href="ch06.xhtml#trysolidusfinally">“try/finally”</a>, or—even better—a <span class="code"><strong>with</strong></span> statement, covered in <a data-type="xref" href="ch06.xhtml#the_with_statement_and_context_managers">“The with Statement and Context Managers”</a>.</td>
</tr>
<tr>
<td><span class="code">extract</span></td>
<td><span class="code">extract(<em>member</em>, path=<strong>None</strong>, pwd=<strong>None</strong>)</span><br/>
			Extracts an archive member to disk, to the directory or path-like object <span class="code">path</span> or, by default, to the current working directory; <span class="code"><em>member</em></span> is the member’s full name, or an instance of <span class="code">ZipInfo</span> identifying the member. <span class="code">extract</span> normalizes path info within <span class="code"><em>member</em></span>, turning absolute paths into relative ones, removing any <span class="code">..</span> component, and, on Windows, turning characters that are illegal in filenames into underscores (<span class="code">_</span>). <span class="code">pwd</span>, if present, is the password to use to decrypt an encrypted member.<br/>
<span class="code">extract</span> returns the path to the file it has created (or overwritten if it already existed), or to the directory it has created (or left alone if it already existed). Calling <span class="code">extract</span> on a closed <span class="code">ZipFile</span> raises <span class="code">ValueError</span>.</td>
</tr>
<tr>
<td><span class="code">extractall</span></td>
<td><span class="code">extractall(path=<strong>None</strong>, members=<strong>None</strong>, pwd=<strong>None</strong>)</span><br/>
			Extracts archive members to disk (by default, all of them), to directory or path- like object <span class="code">path</span> or, by default, to the current working directory; <span class="code">members</span> optionally limits which members to extract, and must be a subset of the list of strings returned by <span class="code"><em>z</em></span><span class="code">.namelist</span>. <span class="code">extractall</span> normalizes path info within members it extracts, turning absolute paths into relative ones, removing any <span class="code">..</span> component, and, on Windows, turning characters that are illegal in filenames into underscores (<span class="code">_</span>). <span class="code">pwd</span>, if present, is the password to use to decrypt encrypted members, if any.</td>
</tr>
<tr>
<td><span class="code">getinfo</span></td>
<td><span class="code">getinfo(<em>name</em>)</span><br/>
			Returns a <span class="code">ZipInfo</span> instance that supplies information about the archive member named by the string <span class="code"><em>name</em></span>.</td>
</tr>
<tr>
<td><span class="code">infolist</span></td>
<td><span class="code">infolist()</span><br/>
			Returns a list of <span class="code">ZipInfo</span> instances, one for each member in archive <span class="code"><em>z</em></span>, in the same order as the entries in the archive.</td>
</tr>
<tr>
<td><span class="code">namelist</span></td>
<td><span class="code">namelist()</span><br/>
			Returns a list of strings, the name of each member in archive <span class="code"><em>z</em></span>, in the same order as the entries in the archive.</td>
</tr>
<tr>
<td><span class="code">open</span></td>
<td><span class="code">open(<em>name</em>, mode='r', pwd=<strong>None</strong>, *, force_zip64=<strong>False</strong>)</span><br/>
			Extracts and returns the archive member identified by <span class="code"><em>name</em></span> (a member name string or <span class="code">ZipInfo</span> instance) as a (maybe read-only) file-like object. <span class="code"><em>mode</em></span> may be <span class="code">'r'</span> or <span class="code">'w'</span>. <span class="code">pwd</span>, if present, is the password to use to decrypt an encrypted member. Pass <span class="code">force_zip64=</span><span class="code"><strong>True</strong></span> when an unknown file size may exceed 2 GiB, to ensure the header format is capable of supporting large files. When you know in advance the large file size, use a <span class="code">ZipInfo</span> instance for <span class="code"><em>name</em></span>, with <span class="code">file_size</span> set appropriately.</td>
</tr>
<tr>
<td><span class="code">printdir</span></td>
<td><span class="code">printdir()</span><br/>
			Outputs a textual directory of the archive <span class="code"><em>z</em></span> to <span class="code">sys.stdout</span>.</td>
</tr>
<tr>
<td><span class="code">read</span></td>
<td><span class="code">read(<em>name</em>,</span> <span class="code"><em>pwd</em></span><span class="code">)</span><br/>
			Extracts the archive member identified by <span class="code"><em>name</em></span> (a member name string or <span class="code">ZipInfo</span> instance) and returns the bytestring of its contents (raises <span class="code">ValueError</span> if called on a closed <span class="code">ZipFile</span>). <span class="code"><em>pwd</em></span>, if present, is the password to use to decrypt an encrypted member.</td>
</tr>
<tr>
<td><span class="code">setpassword</span></td>
<td><span class="code">setpassword(<em>pwd</em>)</span><br/>
			Sets string <span class="code"><em>pwd</em></span> as the default password to use to decrypt encrypted files.</td>
</tr>
<tr>
<td><span class="code">testzip</span></td>
<td><span class="code">testzip()</span><br/>
			Reads and checks the files in archive <span class="code"><em>z</em></span>. Returns a string with the name of the first archive member that is damaged, or <span class="code"><strong>None</strong></span> if the archive is intact.</td>
</tr>
<tr>
<td><span class="code">write</span></td>
<td><span class="code">write(<em>filename</em>, arcname=<strong>None</strong>, compress_type=<strong>None</strong>, compresslevel=<strong>None</strong>)</span><br/>
			Writes the file named by string <span class="code"><em>filename</em></span> to archive <span class="code"><em>z</em></span>, with archive member name <span class="code">arcname</span>. When <span class="code">arcname</span> is <span class="code"><strong>None</strong></span>, <span class="code">write</span> uses <span class="code"><em>filename</em></span> as the archive member name. When <span class="code">compress_type</span> or <span class="code">compresslevel</span> is <span class="code"><strong>None</strong></span> (the default), <span class="code">write</span> uses <span class="code"><em>z</em></span>’s compression type and level; otherwise, <span class="code">compress_type</span> and/or <span class="code">compresslevel</span> specify how to compress the file. <span class="code"><em>z</em></span> must be opened for modes <span class="code">'w'</span>, <span class="code">'x'</span>, or <span class="code">'a'</span>; otherwise <span class="code">ValueError</span> is raised.</td>
</tr>
<tr>
<td><span class="code">writestr</span></td>
<td><span class="code">writestr(<em>zinfo_arc</em>,</span> <span class="code"><em>data,</em></span> <span class="code">compress_type=<strong>None</strong><em>,</em></span><br/> <span class="code">compresslevel=</span><span class="code"><strong>None</strong>)</span><br/>
			Adds a member to archive <span class="code"><em>z</em></span> using the metadata specified by <span class="code"><em>zinfo_arc</em></span> and the data in <span class="code"><em>data</em></span>. <span class="code"><em>zinfo_arc</em></span> must be either a <span class="code">ZipInfo</span> instance specifying at least <span class="code"><em>filename</em></span> and <span class="code"><em>date_time</em></span>, or a string to be used as the archive member name with the date and time are set to the current moment. <span class="code"><em>data</em></span> is an instance of <span class="code">bytes</span> or <span class="code">str</span>. When <span class="code">compress_type</span> or <span class="code">compresslevel</span> is <span class="code"><strong>None</strong></span> (the default), <span class="code">writestr</span> uses <span class="code"><em>z</em></span>’s compression type and level; otherwise, <span class="code">compress_type</span> and/or <span class="code">compresslevel</span> specify how to compress the file. <span class="code"><em>z</em></span> must be opened for modes <span class="code">'w'</span>, <span class="code">'x'</span>, or <span class="code">'a'</span>; otherwise <span class="code">ValueError</span> is raised.<br/>
			When you have data in memory and need to write the data to the ZIP file archive <span class="code"><em>z</em></span>, it’s simpler and faster to use <span class="code"><em>z</em>.writestr</span> than <span class="code"><em>z</em></span><span class="code">.write</span>. The latter would require you to write the data to disk first and later remove the useless disk file; with the former you can just code:
			<pre data-code-language="python" data-type="programlisting">
<strong><code class="kn">import</code></strong><code> </code><code class="nn">zipfile</code><code>
</code><strong><code class="k">with</code></strong><code> </code><code class="n">zipfile</code><code class="o">.</code><code class="n">ZipFile</code><code class="p">(</code><code class="s1">'</code><code class="s1">z.zip</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">w</code><code class="s1">'</code><code class="p">)</code><code> </code><strong><code class="k">as</code></strong><code> </code><code class="n">zz</code><code class="p">:</code><code>
</code><code>    </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">four score</code><code class="se">\n</code><code class="s1">and seven</code><code class="se">\n</code><code class="s1">years ago</code><code class="se">\n</code><code class="s1">'</code><code>
</code><code>    </code><code class="n">zz</code><code class="o">.</code><code class="n">writestr</code><code class="p">(</code><code class="s1">'</code><code class="s1">saying.txt</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">data</code><code class="p">)</code></pre>
			Here’s how you can print a list of all files contained in the ZIP file archive created by the previous example, followed by each file’s name and contents:

			<pre data-code-language="python" data-type="programlisting">
<strong><code class="k">with</code></strong><code> </code><code class="n">zipfile</code><code class="o">.</code><code class="n">ZipFile</code><code class="p">(</code><code class="s1">'</code><code class="s1">z.zip</code><code class="s1">'</code><code class="p">)</code><code> </code><strong><code class="k">as</code></strong><code> </code><code class="n">zz</code><code class="p">:</code><code>
</code><code>    </code><code class="n">zz</code><code class="o">.</code><code class="n">printdir</code><code class="p">(</code><code class="p">)</code><code>
</code><code>    </code><strong><code class="k">for</code></strong><code> </code><code class="n">name</code><code> </code><strong><code class="ow">in</code></strong><code> </code><code class="n">zz</code><code class="o">.</code><code class="n">namelist</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>
</code><code>        </code><code class="nb">print</code><code class="p">(</code><code class="sa">f</code><code class="s1">'</code><code class="si">{</code><code class="n">name</code><code class="si">}</code><code class="s1">: </code><code class="si">{</code><code class="n">zz</code><code class="o">.</code><code class="n">read</code><code class="p">(</code><code class="n">name</code><code class="p">)</code><code class="si">!r}</code><code class="s1">'</code><code class="p">)</code></pre>
</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="The ZipInfo class" data-type="sect3"><div class="sect3" id="the_zipinfo_class">
<h3>The ZipInfo class</h3>
<p>The<a contenteditable="false" data-primary="ZipInfo class (zipfile module)" data-type="indexterm" id="idm44924517317280"/> methods <span class="code">getinfo</span> and <span class="code">infolist</span> of <span class="code">ZipFile</span> instances return instances of class <span class="code">ZipInfo</span> to supply information about members of the archive. <a data-type="xref" href="#useful_attributes_of_a_zipinfo_instance">Table 11-14</a> lists the most useful attributes supplied by a <span class="code">ZipInfo</span> instance <span class="code"><em>z</em></span>.</p>
<table class="border" id="useful_attributes_of_a_zipinfo_instance">
<caption><span class="label">Table 11-14. </span>Useful attributes of a <span class="code">ZipInfo</span> instance <span class="code">z</span></caption>
<tbody>
<tr>
<td><span class="code">comment</span></td>
<td>A string that is a comment on the archive member</td>
</tr>
<tr>
<td><span class="code">compress_size</span></td>
<td>The size, in bytes, of the compressed data for the archive member</td>
</tr>
<tr>
<td><span class="code">compress_type</span></td>
<td>An integer code recording the type of compression of the archive member</td>
</tr>
<tr>
<td><span class="code">date_time</span></td>
<td>A tuple of six integers representing the time of the last modification to the file: the items are year (<span class="code">&gt;=1980</span>), month, day (<span class="code">1+</span>), hour, minute, second (<span class="code">0+</span>)</td>
</tr>
<tr>
<td><span class="code">file_size</span></td>
<td>The size, in bytes, of the uncompressed data for the archive member</td>
</tr>
<tr>
<td><span class="code">filename</span></td>
<td>The name of the file in the archive<a contenteditable="false" data-primary="" data-startref="zipmod11" data-type="indexterm" id="idm44924517275632"/><a contenteditable="false" data-primary="" data-startref="FTarchive11" data-type="indexterm" id="idm44924517274256"/><a contenteditable="false" data-primary="" data-startref="archfile11" data-type="indexterm" id="idm44924517272880"/><a contenteditable="false" data-primary="" data-startref="comfile11" data-type="indexterm" id="idm44924517271504"/><a contenteditable="false" data-primary="" data-startref="SLMzipfile11" data-type="indexterm" id="idm44924517270128"/></td>
</tr>
</tbody>
</table>
</div></section>
</div></section>
</div></section>
<section data-pdf-bookmark="The os Module" data-type="sect1"><div class="sect1" id="the_os_module">
<h1>The os Module</h1>
<p><span class="code">os</span> is<a contenteditable="false" data-primary="file and text operations" data-secondary="os module" data-type="indexterm" id="FTOosmod11"/><a contenteditable="false" data-primary="os module" data-secondary="basics of" data-type="indexterm" id="idm44924517264032"/><a contenteditable="false" data-primary="standard library modules" data-secondary="os" data-type="indexterm" id="SLMos11"/> an umbrella module presenting a nearly uniform cross-platform view of the capabilities of various operating systems. It supplies low-level ways to create and handle files and directories, and to create, manage, and destroy processes. This section covers filesystem-related functions of <span class="code">os</span>; <a data-type="xref" href="ch15.xhtml#running_other_programs_with_the_os_modu">“Running Other Programs with the os Module”</a> covers process-related functions. Most of the time you can use other modules at higher levels of abstraction and gain productivity, but understanding what is “underneath” in the low-level <span class="code">os</span> module can still be quite useful (hence our coverage).</p>
<p>The <span class="code">os</span> module supplies a <span class="code">name</span> attribute, a string that identifies the kind of platform on which Python is being run. Common values for <span class="code">name</span> are <span class="code">'posix'</span> (all kinds of Unix-like platforms, including Linux and macOS) and <span class="code">'nt'</span> (all kinds of Windows platforms); <span class="code">'java'</span> is for the old but still-missed Jython. You can exploit some unique capabilities of a platform through functions supplied by <span class="code">os</span>. However, this book focuses on cross-platform programming, not platform-specific functionality, so we cover neither parts of <span class="code">os</span> that exist only on one platform, nor platform-specific modules: functionality covered in this book is available at least on <span class="code">'posix'</span> and <span class="code">'nt'</span> platforms. We do, though, cover some of the differences among the ways in which a given functionality is provided on various platforms.</p>
<section data-pdf-bookmark="Filesystem Operations" data-type="sect2"><div class="sect2" id="filesystem_operations">
<h2>Filesystem Operations</h2>
<p>Using<a contenteditable="false" data-primary="os module" data-secondary="filesystem operations" data-type="indexterm" id="OSMfilesys11"/> the <span class="code">os</span> module, you can manipulate the filesystem in a variety of ways: creating, copying, and deleting files and directories; comparing files; and examining filesystem information about files and directories. This section documents the attributes and methods of the <span class="code">os</span> module that you use for these purposes, and covers some related modules that operate on the filesystem.</p>
<section data-pdf-bookmark="Path-string attributes of the os module" data-type="sect3"><div class="sect3" id="path_string_attributes_of_the_os_module">
<h3>Path-string attributes of the os module</h3>
<p>A<a contenteditable="false" data-primary="filesystem operations (os module)" data-secondary="path-string attributes" data-type="indexterm" id="idm44924517243648"/><a contenteditable="false" data-primary="paths" data-type="indexterm" id="paths11"/> file or directory is identified by a string, known as its <em>path</em>, whose syntax depends on the platform. On both Unix-like and Windows platforms, Python accepts Unix syntax for paths, with a slash (<span class="code">/</span>) as the directory separator. On non-Unix-like platforms, Python also accepts platform-specific path syntax. On Windows, in particular, you may use a backslash (<span class="code">\</span>) as the separator. However, you then need to double up each backslash as <span class="code">\\</span> in string literals, or use raw string literal syntax (as covered in <a data-type="xref" href="ch03.xhtml#string">“Strings”</a>); you also needlessly lose portability. Unix path syntax is handier and usable everywhere, so we strongly recommend that you <em>always</em> use it. In the rest of this chapter, we use Unix path syntax in both explanations and examples.</p>
<p>The <span class="code">os</span> module supplies attributes that provide details about path strings on the current platform, detailed in <a data-type="xref" href="#attributes_supplied_by_the_os_module">Table 11-15</a>. You should typically use the higher-level path manipulation operations covered in <a data-type="xref" href="#the_osdotpath_module">“The os.path Module”</a><sup><a data-type="noteref" href="ch11.xhtml#ch01fn103" id="ch01fn103-marker">3</a></sup> rather than lower-level string operations based on these attributes. However, these attributes may be useful at times.</p>
<table class="border" id="attributes_supplied_by_the_os_module">
<caption><span class="label">Table 11-15. </span>Attributes supplied by the <span class="code">os</span> module</caption>
<tbody>
<tr>
<td><span class="code">curdir</span></td>
<td>The<a contenteditable="false" data-primary="curdir (os module)" data-type="indexterm" id="idm44924517227552"/> string that denotes the current directory (<span class="code">'.'</span> on Unix and Windows)</td>
</tr>
<tr>
<td><span class="code">defpath</span></td>
<td>The default search path for programs, used if the environment lacks a <span class="code">PATH</span> environment variable</td>
</tr>
<tr>
<td><span class="code">extsep</span></td>
<td>The string that separates the extension part of a file’s name from the rest of the name (<span class="code">'.'</span> on Unix and Windows)</td>
</tr>
<tr>
<td><span class="code">linesep</span></td>
<td>The<a contenteditable="false" data-primary="linesep (os module)" data-type="indexterm" id="idm44924517218768"/> string that terminates text lines (<span class="code">'\n'</span> on Unix; <span class="code">'\r\n'</span> on Windows)</td>
</tr>
<tr>
<td><span class="code">pardir</span></td>
<td>The string that denotes the parent directory (<span class="code">'..'</span> on Unix and Windows)</td>
</tr>
<tr>
<td><span class="code">pathsep</span></td>
<td>The separator between paths in lists of paths expressed as strings, such as those used for the environment variable <span class="code">PATH</span> (<span class="code">':'</span> on Unix; <span class="code">';'</span> on Windows)</td>
</tr>
<tr>
<td><span class="code">sep</span></td>
<td>The<a contenteditable="false" data-primary="sep (os module)" data-type="indexterm" id="idm44924517207920"/> separator of path components (<span class="code">'/'</span> on Unix; <span class="code">'\\'</span> on Windows)</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Permissions" data-type="sect3"><div class="sect3" id="permissions">
<h3>Permissions</h3>
<p>Unix-like<a contenteditable="false" data-primary="filesystem operations (os module)" data-secondary="permissions" data-type="indexterm" id="idm44924517203040"/><a contenteditable="false" data-primary="permission bits" data-type="indexterm" id="idm44924517201696"/> platforms associate nine bits with each file or directory: three each for the file’s owner, its group, and everybody else (aka “others” or “the world”), indicating whether the file or directory can be read, written, and executed by the given subject. These nine bits are known as the file’s <em>permission bits</em>, and are part of the file’s<a contenteditable="false" data-primary="mode (files)" data-type="indexterm" id="idm44924517200016"/> <em>mode</em> (a bit string that includes other bits that describe the file). You often display these bits in octal notation, which groups three bits per digit. For example, mode <span class="code">0o664</span> indicates a file that can be read and written by its owner and group, and that anybody else can read, but not write. When any process on a Unix-like system creates a file or directory, the operating system applies to the specified mode a bit mask known as the process’s<a contenteditable="false" data-primary="umask (file)" data-type="indexterm" id="idm44924517197648"/> <em>umask</em>, which can remove some of the permission bits.</p>
<p>Non-Unix-like platforms handle file and directory permissions in very different ways. However, the <span class="code">os</span> functions that deal with file permissions accept a <span class="code"><em>mode</em></span> argument according to the Unix-like approach described in the previous paragraph. Each platform maps the nine permission bits in a way appropriate for it. For example, on Windows, which distinguishes only between read-only and read/write files and does not record file ownership, a file’s permission bits show up as either <span class="code">0o666</span> (read/write) or <span class="code">0o444</span> (read-only). On such a platform, when creating a file, the implementation looks only at bit <span class="code">0o200</span>, making the file read/write when that bit is <span class="code">1</span> and read-only when it is <span class="code">0</span>.</p>
</div></section>
<section data-pdf-bookmark="File and directory functions of the os module" data-type="sect3"><div class="sect3" id="file_and_directory_functions_of_the_os">
<h3>File and directory functions of the os module</h3>
<p>The<a contenteditable="false" data-primary="filesystem operations (os module)" data-secondary="file and directory functions" data-type="indexterm" id="FOfiledir11"/> <span class="code">os</span> module supplies several functions (listed in <a data-type="xref" href="#os_module_functions">Table 11-16</a>) to query and set file and directory status. In all versions and platforms, the argument <span class="code"><em>path</em></span> to any of these functions can be a string giving the path of the file or directory involved, or it can be a path-like object (in particular, an instance of <span class="code">pathlib.Path</span>, covered later in this chapter). There are also some particularities on some Unix platforms:</p>
<ul>
<li>
<p>Some<a contenteditable="false" data-primary="file descriptor (fd)" data-type="indexterm" id="idm44924517181408"/> of the functions also support a <em>file descriptor</em> (<em>fd</em>)—an <span class="code">int</span> denoting a file as returned, for example, by <span class="code">os.open</span>—as the <em>path</em> argument. The module attribute <span class="code">os.supports_fd</span> is the set of functions in the <span class="code">os</span> module that support this behavior (the module attribute is missing on platforms lacking such support).</p>
</li>
<li>
<p>Some functions support the optional keyword-only argument <span class="code">follow_symlinks</span>, defaulting to <span class="code"><strong>True</strong></span>. When this argument is <span class="code"><strong>True</strong></span>, if <span class="code"><em>path</em></span> indicates a symbolic link, the function follows it to reach an actual file or directory; when it’s <span class="code"><strong>False</strong></span>, the function operates on the symbolic link itself. The module attribute <span class="code">os.supports_follow_symlinks</span>, if present, is the set of functions in the <span class="code">os</span> module that support this argument.</p>
</li>
<li>
<p>Some functions support the optional named-only argument <span class="code">dir_fd</span>, defaulting to <span class="code">None</span>. When <span class="code">dir_fd</span> is present, <span class="code"><em>path</em></span> (if relative) is taken as being relative to the directory open at that file descriptor; when missing, <span class="code"><em>path</em></span> (if relative) is taken as relative to the current working directory. If <span class="code"><em>path</em></span> is absolute, <span class="code">dir_fd</span> is ignored. The module attribute <span class="code">os.supports_dir_fd</span>, if present, is the set of functions of the <span class="code">os</span> module that support this argument.</p>
</li>
</ul>
<p>Additionally, on some platforms the named-only argument <span class="code">effective_ids</span>, defaulting to <span class="code"><strong>False</strong></span>, lets you choose to use effective rather than real user and group identifiers. Check whether it is available on your platform with <span class="code">os.supports_effective_ids</span>.</p>
<table class="border" id="os_module_functions">
<caption><span class="label">Table 11-16. </span><span class="code">os</span> module functions</caption>
<tbody>
<tr>
<td class="width-15"><span class="code">access</span></td>
<td><span class="code">access(<em>path</em>,</span> <span class="code"><em>mode</em></span><span class="code">, *, dir_fd=<strong>None</strong>, effective_ids=<strong>False</strong>,<br/> follow_symlinks=<strong>True</strong>)</span><br/>
			Returns<a contenteditable="false" data-primary="access (os module)" data-type="indexterm" id="idm44924517148560"/> <span class="code"><strong>True</strong></span> when the file or path-like object <span class="code"><em>path</em></span> has all of the permissions encoded in integer <span class="code"><em>mode</em></span>; otherwise, returns <span class="code"><strong>False</strong></span>. <span class="code"><em>mode</em></span> can be <span class="code">os.F_OK</span> to test for file existence, or one or more of <span class="code">os.R_OK</span>, <span class="code">os.W_OK</span>, and <span class="code">os.X_OK</span> (joined with the bitwise OR operator <span class="code">|</span>, if more than one) to test permissions to read, write, and execute the file. If <span class="code">dir_fd</span> is not <span class="code"><strong>None</strong></span>, <span class="code">access</span> operates on <span class="code"><em>path</em></span> relative to the provided directory (if <span class="code"><em>path</em></span> is absolute, <span class="code">dir_fd</span> is ignored). Pass the keyword-only argument <span class="code">effective_ids=</span><span class="code"><strong>True</strong></span> (the default is <span class="code"><strong>False</strong></span>) to use effective rather than real user and group identifiers (this may not work on all platforms). If you pass <span class="code">follow_symlinks=</span><span class="code"><strong>False</strong></span> and the last element of <span class="code"><em>path</em></span> is a symbolic link, <span class="code">access</span> operates on the symbolic link itself, not on the file pointed to by the link.<br/>
<span class="code">access</span> does not use the standard interpretation for its <span class="code"><em>mode</em></span> argument, covered in the previous section. Rather, <span class="code">access</span> tests only if this specific process’s real user and group identifiers have the requested permissions on the file. If you need to study a file’s permission bits in more detail, see the function <span class="code">stat</span>, covered later in this table.<br/>
			Don’t use <span class="code">access</span> to check if a user is authorized to open a file, before opening it; this might be a security hole.</td>
</tr>
<tr>
<td><span class="code">chdir</span></td>
<td><span class="code">chdir(<em>path</em>)</span><br/>
			Sets<a contenteditable="false" data-primary="chdir (os module)" data-type="indexterm" id="idm44924517122320"/> the current working directory of the process to <span class="code"><em>path</em></span>, which may be a file descriptor or path-like object.</td>
</tr>
<tr>
<td><span class="code">chmod</span>,<br/>
<span class="code">lchmod</span></td>
<td><span class="code">chmod(<em>path</em>,</span> <span class="code"><em>mode, *,</em></span> <span class="code">dir_fd=<strong>None</strong>, follow_symlinks=<strong>True</strong>)</span><br/>
<span class="code">lchmod(<em>path</em>,</span> <span class="code"><em>mode</em></span><span class="code">)</span><br/>
			Changes<a contenteditable="false" data-primary="chmod (os module)" data-type="indexterm" id="idm44924517110752"/> the permissions of the file (or file descriptor or path-like object) <span class="code"><em>path</em></span>, as encoded in integer <span class="code"><em>mode</em></span>. <span class="code"><em>mode</em></span> can be zero or more of <span class="code">os.R_OK</span>, <span class="code">os.W_OK</span>, and <span class="code">os.X_OK</span> (joined with the bitwise OR operator <span class="code">|</span>, if more than one) for read, write, and execute permissions. On Unix-like platforms, <span class="code"><em>mode</em></span> can be a richer bit pattern (as covered in the previous section) to specify different permissions for user, group, and other, as well as having other special, rarely used bits defined in the module <span class="code">stat</span> and listed in the <a href="https://oreil.ly/Ue-aa">online docs</a>. Pass <span class="code">follow_symlinks=</span><span class="code"><strong>False</strong></span> (or use <span class="code">lchmod</span>) to change permissions of a symbolic link, not the target of that link.</td>
</tr>
<tr>
<td><span class="code">DirEntry</span></td>
<td>An instance <span class="code"><em>d</em></span> of class <span class="code">DirEntry</span> supplies attributes <span class="code"><em>name</em></span> and <span class="code"><em>path</em></span>, holding the item’s base name and full path, respectively, and several methods, of which the most frequently used are <span class="code">is_dir</span>, <span class="code">is_file</span>, and <span class="code">is_symlink</span>. <span class="code">is_dir</span> and <span class="code">is_file</span> by default follow symbolic links: pass <span class="code">follow_symlinks=</span><span class="code"><strong>False</strong></span> to avoid this behavior. <span class="code"><em>d</em></span> avoids system calls as much as feasible, and when it needs one, it caches the results. If you need information that’s guaranteed to be up-to-date, you can call <span class="code">os.stat(<em>d</em>.path)</span> and use the <span class="code">stat_result</span> instance it returns; however, this sacrifices <span class="code">scandir</span>’s potential performance improvements. For more complete information, see the <a href="https://oreil.ly/4ZsbW">online docs</a>.</td>
</tr>
<tr>
<td><span class="code">getcwd</span>,<br/>
<span class="code">getcwdb</span></td>
<td><span class="code">getcwd()</span>,<br/>
<span class="code">getcwdb()</span><br/>
<span class="code">getcwd</span><a contenteditable="false" data-primary="getcwd (os module)" data-type="indexterm" id="idm44924517080064"/> returns a <span class="code">str</span>, the path of the current working directory. <span class="code">getcwdb</span> returns a <span class="code">bytes</span> string (<span class="version">3.8+</span> with UTF-8 encoding on Windows).</td>
</tr>
<tr>
<td><span class="code">link</span></td>
<td><span class="code">link(<em>src</em>,</span> <span class="code"><em>dst</em></span><span class="code">,</span> <span class="code"><em>*</em></span><span class="code">, src_dir_fd=<strong>None</strong>, dst_dir_fd=<strong>None</strong>,<br/> follow_symlinks=<strong>True</strong>)</span><br/>
			Creates<a contenteditable="false" data-primary="link (os module)" data-type="indexterm" id="idm44924517068384"/> a <em>hard</em> link named <span class="code"><em>dst</em></span>, pointing to <span class="code"><em>src</em></span>. Both may be path-like objects. Set <span class="code">src_dir_fd</span> and/or <span class="code">dst_dir_fd</span> for <span class="code">link</span> to operate on relative paths, and pass <span class="code">follow_symlinks=</span><span class="code"><strong>False</strong></span> to only operate on a symbolic link, not the target of that link. To create a symbolic (“soft”) link, use the <span class="code">symlink</span> function, covered later in this table.</td>
</tr>
<tr>
<td><span class="code">listdir</span></td>
<td><span class="code">listdir(path='.')</span><br/>
			Returns<a contenteditable="false" data-primary="listdir (os module)" data-type="indexterm" id="idm44924517058144"/> a list whose items are the names of all files and subdirectories in the directory, file descriptor (referring to a directory), or path-like object <span class="code">path</span>. The list is in arbitrary order and does <em>not</em> include the special directory names <span class="code">'.'</span> (current directory) and <span class="code">'..'</span> (parent directory). When <span class="code">path</span> is of type <span class="code">bytes</span>, the filenames returned are also of type <span class="code">bytes</span>; otherwise, they are of type <span class="code">str</span>. See also the alternative function <span class="code">scandir</span>, covered later in this table, which can offer performance improvements in some cases. Don’t remove or add files to the directory during the call of this function: that may produce unexpected results.</td>
</tr>
<tr>
<td><span class="code">mkdir</span>,<br/>
<span class="code">makedirs</span></td>
<td><span class="code">mkdir(<em>path</em>, mode=0777, dir_fd=<strong>None</strong>)</span>, <span class="code"> </span><br/>
<span class="code">makedirs(<em>path</em>, mode=0777, exist_ok=<strong>False</strong>)</span><br/>
<span class="code">mkdir</span><a contenteditable="false" data-primary="mkdir (os module)" data-type="indexterm" id="idm44924517043072"/> creates only the rightmost directory of <span class="code"><em>path</em></span> and raises <span class="code">OSError</span> if any of the previous directories in <span class="code"><em>path</em></span> do not exist. <span class="code">mkdir</span> accepts <span class="code">dir_fd</span> for paths relative to a file descriptor. <span class="code">makedirs</span> creates all directories that are part of <span class="code"><em>path</em></span> and do not yet exist (pass <span class="code">exist_ok=</span><span class="code"><strong>True</strong></span> to avoid raising <span class="code">FileExistsError</span>).<br/>
			Both functions use <span class="code">mode</span> as permission bits of directories they create, but some platforms, and some newly created intermediate-level directories, may ignore <span class="code">mode</span>; use <span class="code">chmod</span> to explicitly set permissions.</td>
</tr>
<tr>
<td><span class="code">remove</span>,<br/>
<span class="code">unlink</span></td>
<td><span class="code">remove(<em>path</em>,</span> <span class="code"><em>*</em></span><span class="code">, dir_fd<em>=</em><strong>None</strong></span><span class="code">)</span>,<br/>
<span class="code">unlink(<em>path</em>,</span> <span class="code"><em>*</em></span><span class="code">, dir_fd=<strong>None</strong>)</span><br/>
			Removes<a contenteditable="false" data-primary="remove (os module)" data-type="indexterm" id="idm44924517021808"/><a contenteditable="false" data-primary="unlink (os module)" data-type="indexterm" id="idm44924517020704"/> the file or path-like object <span class="code"><em>path</em></span> , which may be relative to <span class="code">dir_fd</span>. See <span class="code">rmdir</span> later in this table to remove a directory, rather than a file. <span class="code">unlink</span> is a synonym of <span class="code">remove</span>.</td>
</tr>
<tr>
<td><span class="code">removedirs</span></td>
<td><span class="code">removedirs(<em>path</em>)</span><br/>
			Loops from right to left over the directories that are part of <span class="code"><em>path</em></span>, which may be a path-like object, removing each one. The loop ends when a removal attempt raises an exception, generally because a directory is not empty. <span class="code">removedirs</span> does not propagate the exception, as long as it has removed at least one directory.</td>
</tr>
<tr>
<td><span class="code">rename</span>,<br/>
<span class="code">renames</span></td>
<td><span class="code">rename(src, dst,</span> <span class="code"><em>*</em></span><span class="code">, src_dir_fd=<strong>None</strong>, dst_dir_fd=<strong>None</strong>)</span>,<br/>
<span class="code">renames(<em>src</em>,</span> <span class="code"><em>dst, /</em></span><span class="code">)</span><br/>
			Renames<a contenteditable="false" data-primary="rename (os module)" data-type="indexterm" id="idm44924517002176"/> (“moves”) the file, path-like object, or directory named <span class="code">src</span> to <span class="code">dst</span>. If <span class="code">dst</span> already exists, <span class="code">rename</span> may either replace <span class="code">dst</span> or raise an exception; to guarantee replacement, instead call the function <span class="code">os.replace</span>. To use relative paths, pass <span class="code">src_dir_fd</span> and/or <span class="code">dst_dir_fd</span>.<br/>
<span class="code">renames</span> works like <span class="code">rename</span>, except it creates all intermediate directories needed for <span class="code"><em>dst</em></span>. After renaming, <span class="code">renames</span> removes empty directories from the path <span class="code"><em>src</em></span> using <span class="code">removedirs</span>. It does not propagate any resulting exception; it’s not an error if the renaming does not empty the starting directory of <span class="code"><em>src</em></span>. <span class="code">renames</span> cannot accept relative path arguments.</td>
</tr>
<tr>
<td><span class="code">rmdir</span></td>
<td><span class="code">rmdir(<em>path</em>,</span> <span class="code"><em>*</em></span><span class="code">, dir_fd=<strong>None</strong>)</span><br/>
			Removes<a contenteditable="false" data-primary="rmdir (os module)" data-type="indexterm" id="idm44924516983952"/> the empty directory or path-like object named <span class="code"><em>path</em></span> (which may be relative to <span class="code">dir_fd</span>). Raises <span class="code">OSError</span> if the removal fails, and, in particular, if the directory is not empty.</td>
</tr>
<tr>
<td><span class="code">scandir</span></td>
<td><span class="code">scandir(path='.') </span><br/>
			Returns<a contenteditable="false" data-primary="scandir (os module)" data-type="indexterm" id="idm44924516977696"/> an iterator yielding <span class="code">os.DirEntry</span> instances for each item in <span class="code">path</span>, which may be a string, a path-like object, or a file descriptor. Using <span class="code">scandir</span> and calling each resulting item’s methods to determine its characteristics can provide performance improvements compared to using <span class="code">listdir</span> and <span class="code">stat</span>, depending on the underlying platform. <span class="code">scandir</span> may be used as a context manager: e.g., <span class="code"><strong>with</strong></span> <span class="code">os.scandir(<em>path</em>)</span> <span class="code"><strong>as</strong></span> <span class="code"><em>itr</em></span><span class="code">:</span> to ensure closure of the iterator (freeing up resources) when done.</td>
</tr>
<tr>
<td><span class="code">stat</span>,<br/>
<span class="code">lstat</span>,<br/>
<span class="code">fstat</span></td>
<td><span class="code">stat(path,</span> <span class="code"><em>*</em></span><span class="code">, dir_fd=<strong>None</strong>, follow_symlinks=<strong>True</strong>)</span>,<br/>
<span class="code">lstat(path,</span> <span class="code"><em>*</em></span><span class="code">, dir_fd<em>=</em><strong>None</strong></span><span class="code">)</span>,<br/>
<span class="code">fstat(fd)</span><br/>
<span class="code">stat</span><a contenteditable="false" data-primary="stat (os module)" data-type="indexterm" id="idm44924516955344"/> returns a value <span class="code"><em>x</em></span> of type <span class="code">stat_result</span>, which provides (at least) 10 items of information about <span class="code">path</span>. <span class="code">path</span> may be a file, file descriptor (in this case you can use <span class="code">stat(fd)</span> or <span class="code">fstat</span>, which only accepts file descriptors), path-like object, or subdirectory. <span class="code"><em>path</em></span> may be a relative path of <span class="code">dir_fd</span>, or a symlink (if <span class="code">follow_symlinks=<strong>False</strong></span>, or if using <span class="code">lstat</span>; on Windows, all <a href="https://oreil.ly/AvIiq">reparse points</a> that the OS can resolve are followed unless <span class="code">follow_symlinks=</span><span class="code"><strong>False</strong><em>)</em></span>. The <span class="code">stat_result</span> value is a tuple of values that also supports named access to each of its contained values (similar to a <span class="code">collections.namedtuple</span>, though not implemented as such). Accessing the items of <span class="code">stat_result</span> by their numeric indices is possible but not advisable, because the resulting code is not readable; use the corresponding attribute names instead. <a data-type="xref" href="#items_left_parenthesisattributesright_p">Table 11-17</a> lists the main 10 attributes of a <span class="code">stat_result</span> instance and the meaning of the corresponding items.
			<table class="border" id="items_left_parenthesisattributesright_p">
<caption class="width-full"><span class="label">Table 11-17. </span>Items (attributes) of a <span class="code">stat_result</span> instance</caption>
<thead>
<tr>
<th>Item index</th>
<th>Attribute name</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="code">0</span></td>
<td><span class="code">st_mode</span></td>
<td>Protection and other mode bits</td>
</tr>
<tr>
<td><span class="code">1</span></td>
<td><span class="code">st_ino</span></td>
<td>Inode number</td>
</tr>
<tr>
<td><span class="code">2</span></td>
<td><span class="code">st_dev</span></td>
<td>Device ID</td>
</tr>
<tr>
<td><span class="code">3</span></td>
<td><span class="code">st_nlink</span></td>
<td>Number of hard links</td>
</tr>
<tr>
<td><span class="code">4</span></td>
<td><span class="code">st_uid</span></td>
<td>User ID of owner</td>
</tr>
<tr>
<td><span class="code">5</span></td>
<td><span class="code">st_gid</span></td>
<td>Group ID of owner</td>
</tr>
<tr>
<td><span class="code">6</span></td>
<td><span class="code">st_size</span></td>
<td>Size, in bytes</td>
</tr>
<tr>
<td><span class="code">7</span></td>
<td><span class="code">st_atime</span></td>
<td>Time of last access</td>
</tr>
<tr>
<td><span class="code">8</span></td>
<td><span class="code">st_mtime</span></td>
<td>Time of last modification</td>
</tr>
<tr>
<td><span class="code">9</span></td>
<td><span class="code">st_ctime</span></td>
<td>Time of last status change</td>
</tr>
</tbody>
</table>
			For example, to print the size, in bytes, of file <span class="code"><em>path</em></span>, you can use any of:

			<pre data-code-language="python" data-type="programlisting">
<strong><code class="kn">import</code></strong><code> </code><code class="nn">os</code><code>
</code><code class="nb">print</code><code class="p">(</code><code class="n">os</code><code class="o">.</code><code class="n">stat</code><code class="p">(</code><code class="n">path</code><code class="p">)</code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">)</code><code>       </code><em><code class="c1"># works but unclear</code></em><code>
</code><code class="nb">print</code><code class="p">(</code><code class="n">os</code><code class="o">.</code><code class="n">stat</code><code class="p">(</code><code class="n">path</code><code class="p">)</code><code class="o">.</code><code class="n">st_size</code><code class="p">)</code><code>  </code><em><code class="c1"># easier to understand</code></em><code>
</code><code class="nb">print</code><code class="p">(</code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">getsize</code><code class="p">(</code><code class="n">path</code><code class="p">)</code><code class="p">)</code><code>  </code><em><code class="c1"># convenience function</code></em><code>
</code><code>                            </code><em><code class="c1"># that wraps stat</code></em><code>
</code><code>						</code></pre>
			Time values are in seconds since the epoch, as covered in <a data-type="xref" href="ch13.xhtml#time_operations">Chapter 13</a> (<span class="code">int</span>, on most platforms). Platforms unable to give a meaningful value for an item use a dummy value. For other, platform-dependent attributes of <span class="code">stat_result</span> instances, see the <a href="https://oreil.ly/o7wOH">online docs</a>.</td>
</tr>
<tr>
<td><span class="code">symlink</span></td>
<td><span class="code">symlink(<em>target</em>,</span> <span class="code"><em>symlink_path</em></span><span class="code">, target_is_directory=<strong>False</strong>, *, dir_fd=<strong>None</strong>)</span><br/>
			Creates<a contenteditable="false" data-primary="symlink (os module)" data-type="indexterm" id="idm44924516857584"/> a symbolic link named <span class="code"><em>symlink_path</em></span> to the file, directory, or path-like object <span class="code"><em>target</em></span>, which may be relative to <span class="code">dir_fd</span>. <span class="code">target_is_directory</span> is used only on Windows systems, to specify whether the created symlink should represent a file or a directory; this argument is ignored on non-Windows systems. (Calling <span class="code">os.symlink</span> typically requires elevated privileges when run on Windows.)</td>
</tr>
<tr>
<td><span class="code">utime</span></td>
<td><span class="code">utime(<em>path</em>, times=<strong>None</strong>,</span> <span class="code"><em>*</em></span><span class="code">,</span> <span class="code">[<em>ns</em>,</span> <span class="code">]dir_fd=<strong>None</strong>,</span> <span class="code">follow_symlinks=<strong>True</strong>)</span><br/>
			Sets<a contenteditable="false" data-primary="utime (os module)" data-type="indexterm" id="idm44924516813232"/> the accessed and modified times of file, directory, or path-like object <span class="code"><em>path</em></span>, which may be relative to <span class="code">dir_fd</span>, and may be a symlink if <span class="code">follow_symlinks=</span><span class="code"><strong>False</strong></span>. If <span class="code">times</span> is <span class="code"><strong>None</strong></span>, <span class="code">utime</span> uses the current time. Otherwise, <span class="code">times</span> must be a pair of numbers (in seconds since the epoch, as covered in <a data-type="xref" href="ch13.xhtml#time_operations">Chapter 13</a>) in the order <span class="code">(<em>accessed</em>,</span> <span class="code"><em>modified</em></span><span class="code">)</span>. To specify nanoseconds instead, pass <span class="code"><em>ns</em></span> as <span class="code">(<em>acc_ns</em>,</span> <span class="code"><em>mod_ns</em></span><span class="code">)</span>, where each member is an <span class="code">int</span> expressing nanoseconds since the epoch. Do <em>not</em> specify both <span class="code">times</span> and <span class="code"><em>ns</em></span>.</td>
</tr>
<tr>
<td><span class="code">walk</span>,<br/>
<span class="code">fwalk</span></td>
<td><span class="code">walk(<em>top</em>,</span> <span class="code">topdown=<strong>True</strong>, onerror=<strong>None</strong>, followlinks=<strong>False</strong>)</span>,<br/>
<span class="code">fwalk(top=</span><span class="code">'.', topdown=<strong>True</strong>, onerror=<strong>None</strong>, *, follow_symlinks=<strong>False</strong>, dir_fd=<strong>None</strong>)</span><br/>
<span class="code">walk</span> is a generator yielding an item for each directory in the tree whose root is the directory or path-like object <span class="code"><em>top</em></span>. When <span class="code">topdown</span> is <span class="code"><strong>True</strong></span>, the default, <span class="code">walk</span> visits directories from the tree’s root downward; when <span class="code">topdown</span> is <span class="code"><strong>False</strong></span>, <span class="code">walk</span> visits directories from the tree’s leaves upward. By default, <span class="code">walk</span> catches and ignores any <span class="code">OSError</span> exception raised during the tree-walk; set <span class="code">onerror</span> to a callable in order to catch any <span class="code">OSError</span> exception raised during the tree-walk and pass it as the only argument in a call to <span class="code">onerror</span>, which may process it, ignore it, or <span class="code"><strong>raise</strong></span> it to terminate the tree-walk and propagate the exception (the filename is available as the <span class="code">filename</span> attribute of the exception object).<br/>
			Each item <span class="code">walk</span> yields is a tuple of three subitems: <span class="code"><em>dirpath</em></span>, a string that is the directory’s path; <span class="code"><em>dirnames</em></span>, a list of names of subdirectories that are immediate children of the directory (special directories <span class="code">'.'</span> and <span class="code">'..'</span> are <em>not</em> included); and <span class="code"><em>filenames</em></span>, a list of names of files that are directly in the directory. If <span class="code">topdown</span> is <span class="code"><strong>True</strong></span>, you can alter list <span class="code"><em>dirnames</em></span> in place, removing some items and/or reordering others, to affect the tree-walk of the subtree rooted at <span class="code"><em>dirpath</em></span>; <span class="code">walk</span> iterates only on subdirectories left in <span class="code"><em>dirnames</em></span>, in the order in which they’re left. Such alterations have no effect if <span class="code">topdown</span> is <span class="code"><strong>False</strong></span> (in this case, <span class="code">walk</span> has already visited all subdirectories by the time it visits the current directory and yields its item).</td>
</tr>
<tr>
<td><span class="code">walk</span>,<br/>
<span class="code">fwalk</span><br/>
<em>(cont.)</em></td>
<td>By default, <span class="code">walk</span> does not walk down symbolic links that resolve to directories. To get such extra walking, pass <span class="code">followlinks=</span><span class="code"><strong>True</strong></span>, but beware: this can cause infinite looping if a symbolic link resolves to a directory that is its ancestor. <span class="code">walk</span> doesn’t take precautions against this anomaly.
			<div data-type="warning" epub:type="warning">
<h1>followlinks versus follow_symlinks</h1>
<p>Note that, for <span class="code">os.walk</span> <em>only</em>, the argument that is named <span class="code">follow_symlinks</span> everywhere else is instead named <span class="code">followlinks</span>.</p>
</div>
<span class="code">fwalk</span> (Unix only) works like <span class="code">walk</span>, except that <span class="code"><em>top</em></span> may be a relative path of file descriptor <span class="code">dir_fd</span>, and <span class="code">fwalk</span> yields <em>four</em>-member tuples: the first three members (<span class="code"><em>dirpath</em></span>, <span class="code"><em>dirnames</em></span>, and <span class="code"><em>filenames</em></span>) are identical to <span class="code">walk</span>’s yielded values, and the fourth member is <span class="code"><em>dirfd</em></span>, a file descriptor of <span class="code"><em>dirpath</em></span>. Note that both <span class="code">walk</span> and <span class="code">fwalk</span> default to <em>not</em> following symlinks.<a contenteditable="false" data-primary="" data-startref="FOfiledir11" data-type="indexterm" id="idm44924516741456"/><a contenteditable="false" data-primary="" data-startref="paths11" data-type="indexterm" id="idm44924516740048"/></td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="File descriptor operations" data-type="sect3"><div class="sect3" id="file_descriptor_operations">
<h3>File descriptor operations</h3>
<p>In<a contenteditable="false" data-primary="filesystem operations (os module)" data-secondary="file descriptor operations" data-type="indexterm" id="FSOfdes11"/><a contenteditable="false" data-primary="file descriptor (fd)" data-type="indexterm" id="fdescript11"/> addition to the many functions covered earlier, the <span class="code">os</span> module supplies several that work specifically with file descriptors. A <em>file descriptor</em> is an integer that the operating system uses as an opaque handle to refer to an open file. While it is usually best to use Python file objects (covered in <a data-type="xref" href="#the_io_module">“The io Module”</a>) for I/O tasks, sometimes working with file descriptors lets you perform some operations faster, or (at the possible expense of portability) in ways not directly available with <span class="code">io.open</span>. File objects and file descriptors are not interchangeable.</p>
<p>To get the file descriptor <span class="code"><em>n</em></span> of a Python file object <span class="code"><em>f</em></span>, call <span class="code"><em>n</em></span> <span class="code">=</span> <span class="code"><em>f</em></span><span class="code">.fileno()</span>. To create a new Python file object <span class="code"><em>f</em></span> using an existing open file descriptor <span class="code"><em>fd</em></span>, use <span class="code"><em>f</em></span> <span class="code">= os.fdopen(<em>fd</em>)</span>, or pass <span class="code"><em>fd</em></span> as the first argument of <span class="code">io.open</span>. On Unix-like and Windows platforms, some file descriptors are preallocated when a process starts: <span class="code">0</span> is the file descriptor for the process’s standard input, <span class="code">1</span> for the process’s standard output, and <span class="code">2</span> for the process’s standard error. Calling <span class="code">os</span> module methods such as <span class="code">dup</span> or <span class="code">close</span> on these preallocated file descriptors can be useful for redirecting or manipulating standard input and output streams.</p>
<p class="pagebreak-before">The <span class="code">os</span> module provides many functions for dealing with file descriptors; some of the most useful are listed in <a data-type="xref" href="#useful_os_module_functions_to_deal_with">Table 11-18</a>.</p>
<table class="border" id="useful_os_module_functions_to_deal_with">
<caption><span class="label">Table 11-18. </span>Useful <span class="code">os</span> module functions to deal with file descriptors</caption>
<tbody>
<tr>
<td class="width-15"><span class="code">close</span></td>
<td><span class="code">close(<em>fd</em>)</span><br/>
			Closes file descriptor <span class="code"><em>fd</em></span>.</td>
</tr>
<tr>
<td><span class="code">closerange</span></td>
<td><span class="code">closerange(<em>fd_low</em>,</span> <span class="code"><em>fd_high</em></span><span class="code">)</span><br/>
			Closes all file descriptors from <span class="code"><em>fd_low</em></span>, included, to <span class="code"><em>fd_high</em></span>, excluded, ignoring any errors that may occur.</td>
</tr>
<tr>
<td><span class="code">dup</span></td>
<td><span class="code">dup(<em>fd</em>)</span><br/>
			Returns a file descriptor that duplicates file descriptor <span class="code"><em>fd</em></span>.</td>
</tr>
<tr>
<td><span class="code">dup2</span></td>
<td><span class="code">dup2(<em>fd</em>,</span> <span class="code"><em>fd2</em></span><span class="code">)</span><br/>
			Duplicates file descriptor <span class="code"><em>fd</em></span> to file descriptor <span class="code"><em>fd2</em></span>. When file descriptor <span class="code"><em>fd2</em></span> is already open, <span class="code">dup2</span> first closes <span class="code"><em>fd2</em></span>.</td>
</tr>
<tr>
<td><span class="code">fdopen</span></td>
<td><span class="code">fdopen(<em>fd</em>,</span> <span class="code"><em>*a</em></span><span class="code">,</span> <span class="code"><em>**k</em></span><span class="code">)</span><br/>
			Like<a contenteditable="false" data-primary="fdopen (os module)" data-type="indexterm" id="idm44924516682416"/> <span class="code">io.open</span>, except that <span class="code"><em>fd</em></span> <em>must</em> be an <span class="code">int</span> that is an open file descriptor.</td>
</tr>
<tr>
<td><span class="code">fstat</span></td>
<td><span class="code">fstat(<em>fd</em>)</span><br/>
			Returns a <span class="code">stat_result</span> instance <span class="code"><em>x</em></span>, with information about the file open on file descriptor <span class="code"><em>fd</em></span>. <a data-type="xref" href="#items_left_parenthesisattributesright_p">Table 11-17</a> covers <span class="code"><em>x</em></span>’s contents.</td>
</tr>
<tr>
<td><span class="code">lseek</span></td>
<td><span class="code">lseek(<em>fd</em>,</span> <span class="code"><em>pos</em></span><span class="code">,</span> <span class="code"><em>how</em></span><span class="code">)</span><br/>
			Sets the current position of file descriptor <span class="code"><em>fd</em></span> to the signed integer byte offset <span class="code"><em>pos</em></span> and returns the resulting byte offset from the start of the file. <span class="code"><em>how</em></span> indicates the reference (point <span class="code">0</span>). When <span class="code"><em>how</em></span> is <span class="code">os.SEEK_SET</span>, a <span class="code"><em>pos</em></span> of <span class="code">0</span> means the start of the file; for <span class="code">os.SEEK_CUR</span> it means the current position, and for <span class="code">os.SEEK_END</span> it means the end of the file. For example, <span class="code">lseek(<em>fd</em>, 0, os.SEEK_CUR</span>) returns the current position’s byte offset from the start of the file without affecting the current position. Normal disk files support seeking; calling <span class="code">lseek</span> on a file that does not support seeking (e.g., a file open for output to a terminal) raises an exception.</td>
</tr>
<tr>
<td><span class="code">open</span></td>
<td><span class="code">open(<em>file</em>,</span> <span class="code"><em>flags</em></span><span class="code">, mode=0o777)</span><br/>
			Returns a file descriptor, opening or creating a file named by string <span class="code"><em>file</em></span>. When <span class="code">open</span> creates the file, it uses <span class="code">mode</span> as the file’s permission bits. <span class="code"><em>flags</em></span> is an <span class="code">int</span>, normally the bitwise OR (with operator <span class="code">|</span>) of one or more of the following attributes of <span class="code">os</span>:
			<dl>
<dt class="plain"><span class="code">O_APPEND</span></dt>
<dd>Appends any new data to <span class="code"><em>file</em></span>’s current contents</dd>
<dt class="plain"><span class="code">O_BINARY</span></dt>
<dd>Opens <span class="code"><em>file</em></span> in binary rather than text mode on Windows platforms (raises an exception on Unix-like platforms)</dd>
<dt class="plain"><span class="code">O_CREAT</span></dt>
<dd>Creates <span class="code"><em>file</em></span> if <span class="code"><em>file</em></span> does not already exist</dd>
<dt class="plain"><span class="code">O_DSYNC</span>, <span class="code">O_RSYNC</span>, <span class="code">O_SYNC</span>, <span class="code">O_NOCTTY</span></dt>
<dd>Set the synchronization mode accordingly, if the platform supports this</dd>
<dt class="plain"><span class="code">O_EXCL</span></dt>
<dd>Raises an exception if <span class="code"><em>file</em></span> already exists</dd>
<dt class="plain"><span class="code">O_NDELAY</span>, <span class="code">O_NONBLOCK</span></dt>
<dd>Opens <span class="code"><em>file</em></span> in nonblocking mode, if the platform supports this</dd>
<dt class="plain"><span class="code">O_RDONLY</span>, <span class="code">O_WRONLY</span>, <span class="code">O_RDWR</span></dt>
<dd>Opens <span class="code"><em>file</em></span> for read-only, write-only, or read/write access, respectively (mutually exclusive: exactly one of these attributes <em>must</em> be in <span class="code"><em>flags</em></span>)</dd>
<dt class="plain"><span class="code">O_TRUNC</span></dt>
<dd>Throws away previous contents of <span class="code"><em>file</em></span> (incompatible with <span class="code">O_RDONLY</span>)</dd>
</dl>
</td>
</tr>
<tr>
<td><span class="code">pipe</span></td>
<td><span class="code">pipe()</span><br/>
			Creates a pipe and returns a pair of file descriptors <span class="code">(<em>r_fd</em>,</span> <span class="code"><em>w_fd</em></span><span class="code">)</span>, respectively open for reading and writing.</td>
</tr>
<tr>
<td><span class="code">read</span></td>
<td><span class="code">read(<em>fd, n</em>)</span><br/>
			Reads up to <span class="code"><em>n</em></span> bytes from file descriptor <span class="code"><em>fd</em></span> and returns them as a bytestring. Reads and returns <span class="code"><em>m &lt; n</em></span> bytes when only <span class="code"><em>m</em></span> more bytes are currently available for reading from the file. In particular, returns the empty string when no more bytes are currently available from the file, typically because the file is finished.</td>
</tr>
<tr>
<td><span class="code">write</span></td>
<td><span class="code">write(<em>fd</em>,</span> <span class="code"><em>s</em></span><span class="code">)</span><br/>
			Writes all bytes from bytestring <span class="code"><em>s</em></span> to file descriptor <span class="code"><em>fd</em></span> and returns the number of bytes written.<a contenteditable="false" data-primary="" data-startref="fdescript11" data-type="indexterm" id="idm44924516601712"/><a contenteditable="false" data-primary="" data-startref="FSOfdes11" data-type="indexterm" id="idm44924516600368"/><a contenteditable="false" data-primary="" data-startref="OSMfilesys11" data-type="indexterm" id="idm44924516598992"/><a contenteditable="false" data-primary="" data-startref="SLMos11" data-type="indexterm" id="idm44924516597616"/></td>
</tr>
</tbody>
</table>
</div></section>
</div></section>
<section class="pagebreak-before" data-pdf-bookmark="The os.path Module" data-type="sect2"><div class="sect2" id="the_osdotpath_module">
<h2 class="less_space">The os.path Module</h2>
<p>The<a contenteditable="false" data-primary="os module" data-secondary="os.path module" data-seealso="pathlib module" data-type="indexterm" id="OSpath11"/><a contenteditable="false" data-primary="standard library modules" data-secondary="os.path" data-type="indexterm" id="SLBospath11"/> <span class="code">os.path</span> module supplies functions to analyze and transform path strings and path-like objects. The most commonly useful functions from the module are listed in <a data-type="xref" href="#frequently_used_functions_of_the_osdotp">Table 11-19</a>.</p>
<table class="border" id="frequently_used_functions_of_the_osdotp">
<caption><span class="label">Table 11-19. </span>Frequently used functions of the <span class="code">os.path</span> module</caption>
<tbody>
<tr>
<td class="width-15"><span class="code">abspath</span></td>
<td><span class="code">abspath(<em>path</em>)</span><br/>
			Returns<a contenteditable="false" data-primary="abspath (os.path module)" data-type="indexterm" id="idm44924516582240"/> a normalized absolute path string equivalent to <span class="code"><em>path</em></span>, just like (in the case where <span class="code"><em>path</em></span> is the name of a file in the current directory):<br/>
<span class="code">os.path.normpath(os.path.join(os.getcwd(),</span> <span class="code"><em>path</em></span><span class="code">))</span><br/>
			For example, <span class="code">os.path.abspath(os.curdir)</span> is the same as <span class="code">os.getcwd()</span>.</td>
</tr>
<tr>
<td><span class="code">basename</span></td>
<td><span class="code">basename(<em>path</em>)</span><br/>
			Returns<a contenteditable="false" data-primary="basename (os.path module)" data-type="indexterm" id="idm44924516572304"/> the base name part of <span class="code"><em>path</em></span>, just like <span class="code">os.path.split(<em>path</em>)[1]</span>. For example, <span class="code">os.path.basename('b/c/d.e')</span> returns <span class="code">'d.e'</span>.</td>
</tr>
<tr>
<td><span class="code">commonpath</span></td>
<td><span class="code">commonpath(<em>list</em>)</span><br/>
			Accepts<a contenteditable="false" data-primary="commonpath (os.path module)" data-type="indexterm" id="idm44924516564656"/> a sequence of strings or path-like objects, and returns the longest common subpath. Unlike <span class="code">commonprefix</span>, only returns a valid path; raises <span class="code">ValueError</span> if <em>list</em> is empty, contains a mixture of absolute and relative paths, or contains paths on different drives.</td>
</tr>
<tr>
<td><span class="code">com⁠m⁠o⁠n​p⁠r⁠e⁠fix</span></td>
<td><span class="code">commonprefix(<em>list</em>)</span><br/>
			Accepts<a contenteditable="false" data-primary="commonprefix (os.path module)" data-type="indexterm" id="idm44924516558416"/> a list of strings or pathlike objects and returns the longest string that is a prefix of all items in the list, or <span class="code">'.'</span> if <span class="code"><em>list</em></span> is empty. For example, <span class="code">os.path.commonprefix(['foobar', 'foolish'])</span> returns <span class="code">'foo'</span>. May return an invalid path; see <span class="code">commonpath</span> if you want to avoid this.</td>
</tr>
<tr>
<td><span class="code">dirname</span></td>
<td><span class="code">dirname(<em>path</em>)</span><br/>
			Returns<a contenteditable="false" data-primary="dirname (os.path module)" data-type="indexterm" id="idm44924516550304"/> the directory part of <span class="code"><em>path</em></span>, just like <span class="code">os.path.split(<em>path</em>)[0]</span>. For example, <span class="code">os.path.dirname('b/c/d.e')</span> returns <span class="code">'b/c'</span>.</td>
</tr>
<tr>
<td><span class="code">exists</span>,<br/>
<span class="code">lexists</span></td>
<td><span class="code">exists(<em>path</em>)</span>,<span class="code"> lexists(<em>path</em>)</span><br/>
<span class="code">exists</span><a contenteditable="false" data-primary="exists (os.path module)" data-type="indexterm" id="idm44924516539824"/> returns <span class="code"><strong>True</strong></span> when <span class="code"><em>path</em></span> names an existing file or directory (<span class="code"><em>path</em></span> may also be an open file descriptor or path-like object); otherwise, returns <span class="code"><strong>False</strong></span>. In other words, <span class="code">os.path.exists(<em>x</em>)</span> is the same as <span class="code">os.access(</span><span class="code"><em>x</em></span>, <span class="code">os.F_OK)</span>. <span class="code">lexists</span> is the same, but also returns <span class="code"><strong>True</strong></span> when <span class="code"><em>path</em></span> names an existing symbolic link that indicates a nonexistent file or directory (sometimes known as a <em>broken symlink</em>), while <span class="code">exists</span> returns <span class="code"><strong>False</strong></span> in such cases. Both return <span class="code"><strong>False</strong></span> for paths containing characters or bytes that are not representable at the OS level.</td>
</tr>
<tr>
<td><span class="code">expandvars</span>, <span class="code">expanduser</span></td>
<td><span class="code">expandvars(<em>path</em>)</span>,<span class="code"> expanduser(<em>path</em>)</span><br/>
			Returns<a contenteditable="false" data-primary="expanduser (os.path module)" data-type="indexterm" id="idm44924516521568"/> a copy of string or path-like object <span class="code"><em>path</em></span>, where each substring of the form <span class="code">$<em>name</em></span> or <span class="code">${</span><span class="code"><em>name</em>}</span> (and <span class="code"><em>%name%</em></span> on Windows only) is replaced with the value of environment variable <span class="code"><em>name</em></span>. For example, if environment variable <span class="code">HOME</span> is set to <span class="code">/u/alex</span>, the following code:
			<pre data-code-language="python" data-type="programlisting">
<strong><code class="kn">import</code></strong><code> </code><code class="nn">os</code><code>
</code><code class="nb">print</code><code class="p">(</code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">expandvars</code><code class="p">(</code><code class="s1">'</code><code class="s1">$HOME/foo/</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code></pre>
			emits <span class="code">/u/alex/foo/</span>.<br/>
<span class="code">os.path.expanduser</span> expands a leading <span class="code">~</span> or <span class="code">~user</span>, if any, to the path of the home directory of the current user.</td>
</tr>
<tr>
<td><span class="code">getatime</span>,<br/>
<span class="code">getctime</span>,<br/>
<span class="code">getmtime</span>,<br/>
<span class="code">getsize</span></td>
<td><span class="code">getatime(<em>path</em>)</span>,<span class="code"> getctime(<em>path</em>)</span>,<span class="code"> getmtime(<em>path</em>)</span>,<span class="code"> getsize(<em>path</em>)</span><br/>
			Each of these functions calls <span class="code">os.stat(<em>path</em>)</span> and returns an attribute from the result: respectively, <span class="code">st_atime</span>, <span class="code">st_ctime</span>, <span class="code">st_mtime</span>, and <span class="code">st_size</span>. See <a data-type="xref" href="#items_left_parenthesisattributesright_p">Table 11-17</a> for more details about these attributes.</td>
</tr>
<tr>
<td><span class="code">isabs</span></td>
<td><span class="code">isabs(<em>path</em>)</span><br/>
			Returns<a contenteditable="false" data-primary="is keyword" data-type="indexterm" id="idm44924516456048"/> <span class="code"><strong>True</strong></span> when <span class="code"><em>path</em></span> is absolute. (A path is absolute when it starts with a (back)slash (<span class="code">/</span> or <span class="code">\</span>), or, on some non-Unix-like platforms, such as Windows, with a drive designator followed by <span class="code">os.sep</span>.) Otherwise, <span class="code">isabs</span> returns <span class="code"><strong>False</strong></span>.</td>
</tr>
<tr>
<td><span class="code">isdir</span></td>
<td><span class="code">isdir(<em>path</em>)</span><br/>
			Returns<a contenteditable="false" data-primary="isdir (os.path module)" data-type="indexterm" id="idm44924516446336"/> <span class="code"><strong>True</strong></span> when <span class="code"><em>path</em></span> names an existing directory (<span class="code">isdir</span> follows symlinks, so <span class="code">isdir</span> and <span class="code">islink</span> may both return <span class="code"><strong>True</strong></span> ); otherwise, returns <span class="code"><strong>False</strong></span>.</td>
</tr>
<tr>
<td><span class="code">isfile</span></td>
<td><span class="code">isfile(<em>path</em>)</span><br/>
			Returns<a contenteditable="false" data-primary="isfile (os.path module)" data-type="indexterm" id="idm44924516436576"/> <span class="code"><strong>True</strong></span> when <span class="code"><em>path</em></span> names an existing regular file (<span class="code">isfile</span> follows symlinks, so <span class="code">islink</span> may also be <span class="code"><strong>True</strong></span>); otherwise, returns <span class="code"><strong>False</strong></span>.</td>
</tr>
<tr>
<td><span class="code">islink</span></td>
<td><span class="code">islink(<em>path</em>)</span><br/>
			Returns <span class="code"><strong>True</strong></span> when <span class="code"><em>path</em></span> names a symbolic link; otherwise, returns <span class="code"><strong>False</strong></span>.</td>
</tr>
<tr>
<td><span class="code">ismount</span></td>
<td><span class="code">ismount(<em>path</em>)</span><br/>
			Returns <span class="code"><strong>True</strong></span> when <span class="code"><em>path</em></span> names a <a href="https://oreil.ly/JYbY5">mount point</a>; otherwise, returns <span class="code"><strong>False</strong></span>.</td>
</tr>
<tr>
<td><span class="code">join</span></td>
<td><span class="code">join(<em>path</em>,</span> <span class="code"><em>*paths</em></span><span class="code">)</span><br/>
			Returns<a contenteditable="false" data-primary="join (os.path module)" data-type="indexterm" id="idm44924516414432"/> a string that joins the arguments (strings or path-like objects) with the appropriate path separator for the current platform. For example, on Unix, exactly one slash character <span class="code">/</span> separates adjacent path components. If any argument is an absolute path, <span class="code">join</span> ignores previous arguments. For example:
			<pre data-code-language="python" data-type="programlisting">
<code class="nb">print</code><code class="p">(</code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="s1">'</code><code class="s1">a/b</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">c/d</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">e/f</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>
</code><em><code class="c1"># on Unix prints: a/b/c/d/e/f</code></em><code>
</code><code class="nb">print</code><code class="p">(</code><code class="n">os</code><code class="o">.</code><code class="n">path</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="s1">'</code><code class="s1">a/b</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">/c/d</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">e/f</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>
</code><em><code class="c1"># on Unix prints:</code></em><code class="c1"> </code><em><code class="c1">/c/d/e/f</code></em></pre>
			The second call to <span class="code">os.path.join</span> ignores its first argument <span class="code">'a/b'</span>, since its second argument <span class="code">'/c/d'</span> is an absolute path.</td>
</tr>
<tr>
<td><span class="code">normcase</span></td>
<td><span class="code">normcase(<em>path</em>)</span><br/>
			Returns a copy of <span class="code"><em>path</em></span> with case normalized for the current platform. On case-sensitive filesystems (typical in Unix-like systems), <span class="code"><em>path</em></span> is returned unchanged. On case-insensitive filesystems (typical in Windows), it lowercases the string. On Windows, <span class="code">normcase</span> also converts each <span class="code">/</span> to a <span class="code">\\</span>.</td>
</tr>
<tr>
<td><span class="code">normpath</span></td>
<td><span class="code">normpath(<em>path</em>)</span><br/>
			Returns<a contenteditable="false" data-primary="normpath (os.path module)" data-type="indexterm" id="idm44924516326784"/> a normalized pathname equivalent to <span class="code"><em>path</em></span>, removing redundant separators and path-navigation aspects. For example, on Unix, <span class="code">normpath</span> returns <span class="code">'a/b'</span> when <span class="code"><em>path</em></span> is any of <span class="code">'a//b'</span>, <span class="code">'a/./b'</span>, or <span class="code">'a/c/../b'</span>. <span class="code">normpath</span> makes path separators appropriate for the current platform. For example, on Windows, separators become <span class="code">\\</span>.</td>
</tr>
<tr>
<td><span class="code">realpath</span></td>
<td><span class="code">realpath(<em>path</em>,</span> <span class="code"><em>*</em></span><span class="code">, strict=<strong>False</strong>)</span><br/>
			Returns<a contenteditable="false" data-primary="realpath (os.path module)" data-type="indexterm" id="idm44924516314112"/> the actual path of the specified file or directory or path-like object, resolving symlinks along the way. <span class="version">3.10+</span> Set <span class="code">strict=</span><span class="code"><strong>True</strong></span> to raise <span class="code">OSError</span> when <span class="code"><em>path</em></span> doesn’t exist, or when there is a loop of symlinks.</td>
</tr>
<tr>
<td><span class="code">relpath</span></td>
<td><span class="code">relpath(<em>path</em>, start=os.curdir)</span><br/>
			Returns<a contenteditable="false" data-primary="relpath (os.path module)" data-type="indexterm" id="idm44924516306144"/> a path to the file or directory <span class="code"><em>path</em></span> (a <span class="code">str</span> or path-like object) relative to directory <span class="code">start</span>.</td>
</tr>
<tr>
<td><span class="code">samefile</span></td>
<td><span class="code">samefile(<em>path1</em>,</span> <span class="code"><em>path2</em></span><span class="code">)</span><br/>
			Returns <span class="code"><strong>True</strong></span> if both arguments (strings or path-like objects) refer to the same file or directory.</td>
</tr>
<tr>
<td><span class="code">sameopenfile</span></td>
<td><span class="code">sameopenfile(<em>fd1</em>,</span> <span class="code"><em>fd2</em></span><span class="code">)</span><br/>
			Returns <span class="code"><strong>True</strong></span> if both arguments (file descriptors) refer to the same file or directory.</td>
</tr>
<tr>
<td><span class="code">samestat</span></td>
<td><span class="code">samestat(<em>stat1</em>,</span> <span class="code"><em>stat2</em></span><span class="code">)</span><br/>
			Returns <span class="code"><strong>True</strong></span> if both arguments (instances of <span class="code">os.stat_result</span>, typically results of <span class="code">os.stat</span> calls) refer to the same file or directory.</td>
</tr>
<tr>
<td><span class="code">split</span></td>
<td><span class="code">split(<em>path</em>)</span><br/>
			Returns<a contenteditable="false" data-primary="split (os.path module)" data-type="indexterm" id="idm44924516282624"/> a pair of strings <span class="code">(<em>dir</em>,</span> <span class="code"><em>base</em></span><span class="code">)</span> such that <span class="code">join(<em>dir</em>,</span> <span class="code"><em>base</em></span><span class="code">)</span> equals <span class="code"><em>path</em></span>. <span class="code"><em>base</em></span> is the last component and never contains a path separator. When <span class="code"><em>path</em></span> ends in a separator, <span class="code"><em>base</em></span> is <span class="code">''</span>. <span class="code"><em>dir</em></span> is the leading part of <span class="code"><em>path</em></span>, up to the last separator excluded. For example, <span class="code">os.path.split('a/b/c/d')</span> returns <span class="code">('a/b/c', 'd')</span>.</td>
</tr>
<tr>
<td><span class="code">splitdrive</span></td>
<td><span class="code">splitdrive(<em>path</em>)</span><br/>
			Returns a pair of strings <span class="code">(<em>drv</em>,</span> <span class="code"><em>pth</em></span><span class="code">)</span> such that <span class="code"><em>drv</em></span><span class="code">+</span><span class="code"><em>pth</em></span> equals <span class="code"><em>path</em></span>. <span class="code"><em>drv</em></span> is a drive specification, or <span class="code">''</span>; it is always <span class="code">''</span> on platforms without drive specifications, e.g. Unix-like systems. On Windows, <span class="code">os.path.splitdrive('c:d/e')</span> returns <span class="code">('c:'</span>, <span class="code">'d/e')</span>.</td>
</tr>
<tr>
<td><span class="code">splitext</span></td>
<td><span class="code">splitext(<em>path</em>)</span><br/>
			Returns a pair <span class="code">(<em>root</em>,</span> <span class="code"><em>ext</em></span><span class="code">)</span> such that <span class="code"><em>root</em></span><span class="code">+</span><span class="code"><em>ext</em></span> equals <span class="code"><em>path</em></span>. <span class="code"><em>ext</em></span> is either <span class="code">''</span> or starts with a <span class="code">'.'</span> and has no other <span class="code">'.'</span> or path separator. For example, <span class="code">o⁠s⁠.⁠p⁠a⁠t⁠h⁠.⁠s⁠p⁠l⁠i⁠t​e⁠x⁠t⁠(⁠'⁠a⁠.⁠a⁠/⁠b⁠.⁠c⁠.⁠d⁠'⁠)</span> returns the pair <span class="code">('a.a/b.c'</span>, <span class="code">'.d')</span>.<a contenteditable="false" data-primary="" data-startref="OSpath11" data-type="indexterm" id="idm44924516242544"/><a contenteditable="false" data-primary="" data-startref="SLBospath11" data-type="indexterm" id="idm44924516241232"/></td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="OSError Exceptions" data-type="sect2"><div class="sect2" id="oserror_exceptions">
<h2>OSError Exceptions</h2>
<p>When<a contenteditable="false" data-primary="os module" data-secondary="OSError exceptions" data-type="indexterm" id="idm44924516238112"/><a contenteditable="false" data-primary="OSError" data-type="indexterm" id="idm44924516236736"/> a request to the operating system fails, <span class="code">os</span> raises an exception, an instance of <span class="code">OSError</span>. <span class="code">os</span> also exposes the built-in exception class <span class="code">OSError</span> with the synonym <span class="code">os.error</span>. Instances of <span class="code">OSError</span> expose three useful attributes, detailed in <a data-type="xref" href="#attributes_of_oserror_instances">Table 11-20</a>.</p>
<table class="border" id="attributes_of_oserror_instances">
<caption><span class="label">Table 11-20. </span>Attributes of <span class="code">OSError</span> instances</caption>
<tbody>
<tr>
<td><span class="code">errno</span></td>
<td>The numeric error code of the operating system error</td>
</tr>
<tr>
<td><span class="code">filename</span></td>
<td>The name of the file on which the operation failed (file-related functions only)</td>
</tr>
<tr>
<td><span class="code">strerror</span></td>
<td>A string that briefly describes the error</td>
</tr>
</tbody>
</table>
<p><span class="code">OSError</span> has subclasses to specify what the problem was, as discussed in <a data-type="xref" href="ch06.xhtml#oserror_subclasses">“OSError subclasses”</a>.</p>
<p><span class="code">os</span> functions can also raise other standard exceptions, such as <span class="code">TypeError</span> or <span class="code">ValueError</span>, when called with invalid argument types or values, so that they didn’t even attempt the underlying operating system functionality.</p>
</div></section>
</div></section>
<section data-pdf-bookmark="The errno Module" data-type="sect1"><div class="sect1" id="the_errno_module">
<h1>The errno Module</h1>
<p>The<a contenteditable="false" data-primary="file and text operations" data-secondary="errno module" data-type="indexterm" id="idm44924516215696"/><a contenteditable="false" data-primary="errno module" data-type="indexterm" id="idm44924516214352"/><a contenteditable="false" data-primary="standard library modules" data-secondary="errno" data-type="indexterm" id="idm44924516213216"/> <span class="code">errno</span> module supplies dozens of symbolic names for error code numbers. Use <span class="code">errno</span> to handle possible system errors selectively, based on error codes; this will enhance your program’s portability and readability. However, a selective <span class="code"><strong>except</strong></span> with the appropriate <span class="code">OSError</span> subclass often works better than <span class="code">errno</span>. For example, to handle “file not found” errors, while propagating all other kinds of errors, you could use:</p>
<pre data-code-language="python" data-type="programlisting">
<strong><code class="kn">import</code></strong><code> </code><code class="nn">errno</code><code>
</code><strong><code class="k">try</code></strong><code class="p">:</code><code>
</code><code>    </code><code class="n">os</code><code class="o">.</code><code class="n">some_os_function_or_other</code><code class="p">(</code><code class="p">)</code><code>
</code><strong><code class="k">except</code></strong><code> </code><code class="ne">FileNotFoundError</code><code> </code><strong><code class="k">as</code></strong><code> </code><code class="n">err</code><code class="p">:</code><code>
</code><code>    </code><code class="nb">print</code><code class="p">(</code><code class="sa">f</code><code class="s1">'</code><code class="s1">Warning: file </code><code class="si">{</code><code class="n">err</code><code class="o">.</code><code class="n">filename</code><code class="si">!r}</code><code class="s1"> not found; continuing</code><code class="s1">'</code><code class="p">)</code><code>
</code><strong><code class="k">except</code></strong><code> </code><code class="ne">OSError</code><code> </code><strong><code class="k">as</code></strong><code> </code><code class="n">oserr</code><code class="p">:</code><code>
</code><code>    </code><code class="nb">print</code><code class="p">(</code><code class="sa">f</code><code class="s1">'</code><code class="s1">Error </code><code class="si">{</code><code class="n">errno</code><code class="o">.</code><code class="n">errorcode</code><code class="p">[</code><code class="n">oserr</code><code class="o">.</code><code class="n">errno</code><code class="p">]</code><code class="si">}</code><code class="s1">; continuing</code><code class="s1">'</code><code class="p">)</code></pre>
<p><span class="code">errno</span> supplies a dictionary named <span class="code">errorcode</span>: the keys are error code numbers, and the corresponding values are the error names, strings such as <span class="code">'ENOENT'</span>. Displaying <span class="code">errno.errorcode[err.errno]</span> as part of the explanation behind some <span class="code">OSError</span> instance’s <span class="code">err</span> can often make the diagnosis clearer and more understandable to readers who specialize in the specific platform.</p>
</div></section>
<section data-pdf-bookmark="The pathlib Module" data-type="sect1"><div class="sect1" id="the_pathlib_module">
<h1>The pathlib Module</h1>
<p>The<a contenteditable="false" data-primary="file and text operations" data-secondary="pathlib module" data-type="indexterm" id="FTOpathlib11"/><a contenteditable="false" data-primary="pathlib module" data-type="indexterm" id="pathlib11"/><a contenteditable="false" data-primary="standard library modules" data-secondary="pathlib" data-type="indexterm" id="SLMpathlib11"/> <span class="code">pathlib</span> module provides an object-oriented approach to filesystem paths, pulling together a variety of methods for handling paths and files as objects, not as strings (unlike <span class="code">os.path</span>). For most use cases, <span class="code">pathlib.Path</span> will provide everything you’ll need. On rare occasions, you’ll want to instantiate a platform-specific path, or a “pure” path that doesn’t interact with the operating system; see the <a href="https://oreil.ly/ZWExX">online docs</a> if you need such advanced functionality. The most commonly useful functions of <span class="code">pathlib.Path</span> are listed in <a data-type="xref" href="#commonly_used_functions_of_pathlibdotpa">Table 11-21</a>, with examples for a <span class="code">pathlib</span>.<span class="code">Path</span> object <em><span class="code">p</span></em>. On Windows, <span class="code">pathlib.Path</span> objects are returned as <span class="code">WindowsPath</span>; on Unix, as <span class="code">PosixPath</span>, as shown in the examples in <a data-type="xref" href="#commonly_used_functions_of_pathlibdotpa">Table 11-21</a>. (For clarity, we are simply importing <span class="code">pathlib</span> rather than using the more common and idiomatic <span class="code"><strong>from</strong></span> <span class="code">pathlib</span> <span class="code"><strong>import</strong></span> <span class="code">Path</span>.)</p>
<div data-type="warning" epub:type="warning">
<h1>pathlib Methods Return Path Objects, Not Strings</h1>
<p>Keep in mind that <span class="code">pathlib</span> methods typically return a path object, not a string, so results of similar methods in <span class="code">os</span> and <span class="code">os.path</span> do <em>not</em> test as being identical.</p>
</div>
<table class="border" id="commonly_used_functions_of_pathlibdotpa">
<caption><span class="label">Table 11-21. </span>Commonly used methods of <span class="code">pathlib.Path</span></caption>
<tbody>
<tr>
<td><span class="code">chmod</span>, <span class="code">lchmod</span></td>
<td><span class="code"><em>p</em></span><span class="code">.chmod(<em>mode</em>, follow_symlinks=<strong>True</strong>)</span>,<br/>
<span class="code"><em>p</em></span><span class="code">.lchmod(<em>mode</em>)</span><br/>
<span class="code">chmod</span><a contenteditable="false" data-primary="chmod (pathlib.Path class)" data-type="indexterm" id="idm44924516085136"/> changes the file mode and permissions, like <span class="code">os.chmod</span> (see <a data-type="xref" href="#os_module_functions">Table 11-16</a>). On Unix platforms, <span class="version">3.10+</span> set <span class="code">follow_symlinks=<strong>False</strong></span> to change permissions on the symbolic link rather than its target, or use <span class="code">lchmod</span>. See the <a href="https://oreil.ly/23S7z">online docs</a> for more information on <span class="code">chmod</span> settings.<span class="code">lchmod</span> is like <span class="code">chmod</span> but, when <span class="code"><em>p</em></span> points to a symbolic link, changes the symbolic link rather than its target. Equivalent to <span class="code">pathlib.Path.chmod(follow_symlinks=</span><span class="code"><strong>False</strong>)</span>.</td>
</tr>
<tr>
<td><span class="code">cwd</span></td>
<td><span class="code">pathlib.Path.cwd()</span><br/>
			Returns<a contenteditable="false" data-primary="cwd (pathlib.Path class)" data-type="indexterm" id="idm44924516072144"/> the current working directory as a path object.</td>
</tr>
<tr>
<td><span class="code">exists</span></td>
<td><span class="code"><em>p</em></span><span class="code">.exists()</span><br/>
			Returns<a contenteditable="false" data-primary="exists (pathlib.Path class)" data-type="indexterm" id="idm44924516067488"/> <span class="code"><strong>True</strong></span> when <span class="code"><em>p</em></span> names an existing file or directory (or a symbolic link pointing to an existing file or directory); otherwise, returns <span class="code"><strong>False</strong></span>.</td>
</tr>
<tr>
<td><span class="code">expanduser</span></td>
<td><span class="code"><em>p</em></span><span class="code">.expanduser()</span><br/>
			Returns<a contenteditable="false" data-primary="expanduser (pathlib.Path class)" data-type="indexterm" id="idm44924516060384"/> a new path object with a leading <span class="code">~</span> expanded to the path of the home directory of the current user, or <span class="code">~user</span> expanded to the path of the home directory of the given user. See also <span class="code">home</span> later in this table.</td>
</tr>
<tr>
<td><span class="code">glob</span>,<br/>
<span class="code">rglob</span></td>
<td><span class="code"><em>p</em></span><span class="code">.glob(<em>pattern</em>)</span>,<br/>
<span class="code"><em>p</em></span><span class="code">.rglob(<em>pattern</em>)</span><br/>
			Yield<a contenteditable="false" data-primary="glob (pathlib.Path class)" data-type="indexterm" id="idm44924516049776"/><a contenteditable="false" data-primary="rglob (pathlib.Path class)" data-type="indexterm" id="idm44924516048656"/> all matching files in directory <span class="code"><em>p</em></span> in arbitrary order. <span class="code"><em>pattern</em></span> may<a contenteditable="false" data-primary="** (double star) operator" data-secondary="glob recursive wildcard" data-type="indexterm" id="idm44924516045712"/><a contenteditable="false" data-primary="double star (**) operator" data-secondary="glob recursive wildcard" data-type="indexterm" id="idm44924516044272"/> include <span class="code">**</span> to allow recursive globbing in <span class="code"><em>p</em></span> or any subdirectory; <span class="code">rglob</span> always performs recursive globbing in <span class="code"><em>p</em></span> and all subdirectories, as if <span class="code"><em>pattern</em></span> started with <span class="code">'**/'</span>. For example:
			<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="nb">sorted</code><code class="p">(</code><code class="n">td</code><code class="o">.</code><code class="n">glob</code><code class="p">(</code><code class="s1">'*'</code><code class="p">))</code></pre>
<pre data-type="programlisting">
<strong>[WindowsPath('tempdir/bar'), 
WindowsPath('tempdir/foo')]</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="nb">sorted</code><code class="p">(</code><code class="n">td</code><code class="o">.</code><code class="n">glob</code><code class="p">(</code><code class="s1">'**/*'</code><code class="p">))</code></pre>
<pre data-type="programlisting">
<strong>[WindowsPath('tempdir/bar'),
WindowsPath('tempdir/bar/baz'), 
WindowsPath('tempdir/bar/boo'), 
WindowsPath('tempdir/foo')]</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><code class="nb">sorted</code><code class="p">(</code><code class="n">td</code><code class="o">.</code><code class="n">glob</code><code class="p">(</code><code class="s1">'</code><code class="s1">*/**/*</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code> </code><em><code class="c1"># expanding at 2nd+ level</code></em></pre>
<pre data-type="programlisting">
<strong>[WindowsPath('tempdir/bar/baz'), 
WindowsPath('tempdir/bar/boo')]</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><code class="nb">sorted</code><code class="p">(</code><code class="n">td</code><code class="o">.</code><code class="n">rglob</code><code class="p">(</code><code class="s1">'</code><code class="s1">*</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>  </code><em><code class="c1"># just like glob('**/*')</code></em></pre>
<pre data-type="programlisting">
<strong>[WindowsPath('tempdir/bar'), 
WindowsPath('tempdir/bar/baz'), 
WindowsPath('tempdir/bar/boo'), 
WindowsPath('tempdir/foo')]</strong></pre>
</td>
</tr>
<tr>
<td><span class="code">hardlink_to</span></td>
<td><span class="code"><em>p</em></span><span class="code">.hardlink_to(<em>target</em>)</span><br/>
<span class="version">3.10+</span> Makes<a contenteditable="false" data-primary="hardlink_to (pathlib.Path class)" data-type="indexterm" id="idm44924515919200"/> <span class="code"><em>p</em></span> a hard link to the same file as <span class="code"><em>target</em></span>. Replaces the deprecated <span class="code">link_to</span> <span class="version">3.8+</span>, <span class="code">-3.10</span> Note: the order of arguments for <span class="code">link_to</span> was like <span class="code">os.link</span>, described in <a data-type="xref" href="#os_module_functions">Table 11-16</a>; for <span class="code">hardlink_to</span>, like for <span class="code">symlink_to</span> later in this table, it’s the reverse.</td>
</tr>
<tr>
<td><span class="code">home</span></td>
<td><span class="code">pathlib.Path.home()</span><br/>
			Returns<a contenteditable="false" data-primary="home (pathlib.Path class)" data-type="indexterm" id="idm44924515885632"/> the user’s home directory as a path object.</td>
</tr>
<tr>
<td><span class="code">is_dir</span></td>
<td><span class="code"><em>p</em></span><span class="code">.is_dir()</span><br/>
			Returns<a contenteditable="false" data-primary="is_dir (pathlib.Path class)" data-type="indexterm" id="idm44924515881024"/> <span class="code"><strong>True</strong></span> when <span class="code"><em>p</em></span> names an existing directory (or a symbolic link to a directory); otherwise, returns <span class="code"><strong>False</strong></span>.</td>
</tr>
<tr>
<td><span class="code">is_file</span></td>
<td><span class="code"><em>p</em></span><span class="code">.is_file()</span><br/>
			Returns<a contenteditable="false" data-primary="is_file (pathlib.Path class)" data-type="indexterm" id="idm44924515874064"/> <span class="code"><strong>True</strong></span> when <span class="code"><em>p</em></span> names an existing file (or a symbolic link to a file); otherwise, returns <span class="code"><strong>False</strong></span>.</td>
</tr>
<tr>
<td><span class="code">is_mount</span></td>
<td><span class="code"><em>p.</em></span><span class="code">is_mount()</span><br/>
			Returns <span class="code"><strong>True</strong></span> when <span class="code"><em>p</em></span> is a <em>mount point</em> (a point in a filesystem where a different filesystem has been mounted); otherwise, returns <span class="code"><strong>False</strong></span>. See the <a href="https://oreil.ly/-g8r0">online docs</a> for details. Not implemented on Windows.</td>
</tr>
<tr>
<td><span class="code">is_symlink</span></td>
<td><span class="code"><em>p</em></span><span class="code">.is_symlink()</span><br/>
			Returns <span class="code"><strong>True</strong></span> when <span class="code"><em>p</em></span> names an existing symbolic link; otherwise, returns <span class="code"><strong>False</strong></span>.</td>
</tr>
<tr>
<td><span class="code">iterdir</span></td>
<td><span class="code"><em>p</em></span><span class="code">.iterdir()</span><br/>
			Yields path objects for the contents of directory <span class="code"><em>p</em></span> (<span class="code">'.'</span> and <span class="code">'..'</span> not included) in arbitrary order. Raises <span class="code">NotADirectoryError</span> when <span class="code"><em>p</em></span> is not a directory. May produce unexpected results if you remove a file from <span class="code"><em>p</em></span>, or add a file to <span class="code"><em>p</em></span>, after you create the iterator and before you’re done using it.</td>
</tr>
<tr>
<td><span class="code">mkdir</span></td>
<td><span class="code"><em>p</em></span><span class="code">.mkdir(mode=0o777, parents=<strong>False</strong>, exist_ok=<strong>False</strong>)</span><br/>
			Creates<a contenteditable="false" data-primary="mkdir (pathlib.Path class)" data-type="indexterm" id="idm44924515844624"/> a new directory at the path. Use <span class="code">mode</span> to set file mode and access flags. Pass <span class="code">parents=</span><span class="code"><strong>True</strong></span> to create any missing parents as needed. Pass <span class="code">exist_ok=</span><span class="code"><strong>True</strong></span> to ignore <span class="code">FileExistsError</span> exceptions. For example:
			<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">td</code><code class="o">=</code><code class="n">pathlib</code><code class="o">.</code><code class="n">Path</code><code class="p">(</code><code class="s1">'tempdir/'</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">td</code><code class="o">.</code><code class="n">mkdir</code><code class="p">(</code><code class="n">exist_ok</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">td</code><code class="o">.</code><code class="n">is_dir</code><code class="p">()</code></pre>
<pre data-type="programlisting">
<strong>True</strong></pre>
			See the <a href="https://oreil.ly/yrvuL">online docs</a> for thorough coverage.</td>
</tr>
<tr>
<td><span class="code">open</span></td>
<td><span class="code"><em>p</em></span><span class="code">.open(mode='r', buffering=-1, encoding=<strong>None</strong>, errors=<strong>None</strong>, newline=<strong>None</strong>)</span><br/>
			Opens<a contenteditable="false" data-primary="open (pathlib.Path class)" data-type="indexterm" id="idm44924515804864"/> the file pointed to by the path, like the built-in <span class="code">open(<em>p</em>)</span> (with other args the same).</td>
</tr>
<tr>
<td><span class="code">read_bytes</span></td>
<td><span class="code"><em>p</em></span><span class="code">.read_bytes()</span><br/>
			Returns<a contenteditable="false" data-primary="read_bytes (pathlib.Path class)" data-type="indexterm" id="idm44924515780688"/> the binary contents of <span class="code"><em>p</em></span> as a <span class="code">bytes</span> object.</td>
</tr>
<tr>
<td><span class="code">read_text</span></td>
<td><span class="code"><em>p</em></span><span class="code">.read_text(encoding=<strong>None</strong>, errors=<strong>None</strong>)</span><br/>
			Returns<a contenteditable="false" data-primary="read_text (pathlib.Path class)" data-type="indexterm" id="idm44924515773904"/> the decoded contents of <span class="code"><em>p</em></span> as a string.</td>
</tr>
<tr>
<td><span class="code">readlink</span></td>
<td><span class="code"><em>p</em></span><span class="code">.readlink()</span><br/>
<span class="version">3.9+</span> Returns<a contenteditable="false" data-primary="readlink (pathlib.Path class)" data-type="indexterm" id="idm44924515768048"/> the path to which a symbolic link points.</td>
</tr>
<tr>
<td><span class="code">rename</span></td>
<td><span class="code"><em>p</em></span><span class="code">.rename(<em>target</em>)</span><br/>
			Renames <span class="code"><em>p</em></span> to <span class="code"><em>target</em></span> and <span class="version">3.8+</span> returns a new <span class="code">Path</span> instance pointing to <span class="code"><em>target</em></span>. <span class="code"><em>target</em></span> may be a string, or an absolute or relative path; however, relative paths are interpreted relative to the <em>current</em> working directory, <em>not</em> the directory of <span class="code"><em>p</em></span>. On Unix, when <span class="code"><em>target</em></span> is an existing file or empty directory, <span class="code">rename</span> replaces it silently when the user has permission; on Windows, <span class="code">rename</span> raises <span class="code">FileExistsError</span>.</td>
</tr>
<tr>
<td><span class="code">replace</span></td>
<td><span class="code"><em>p</em></span><span class="code">.replace(<em>target</em>)</span><br/>
			Like <span class="code"><em>p</em></span><span class="code">.rename(<em>target</em>)</span>, but, on any platform, when <span class="code"><em>target</em></span> is an existing file (or, except on Windows, an empty directory), <span class="code">replace</span> replaces it silently when the user has permission. For example:
			<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">p</code><code class="o">.</code><code class="n">read_text</code><code class="p">()</code></pre>
<pre data-type="programlisting">
<strong>'spam'</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">t</code><code class="o">.</code><code class="n">read_text</code><code class="p">()</code></pre>
<pre data-type="programlisting">
<strong>'and eggs'</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">p</code><code class="o">.</code><code class="n">replace</code><code class="p">(</code><code class="n">t</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>WindowsPath('C:/Users/annar/testfile.txt')</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">t</code><code class="o">.</code><code class="n">read_text</code><code class="p">()</code></pre>
<pre data-type="programlisting">
<strong>'spam'</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">p</code><code class="o">.</code><code class="n">read_text</code><code class="p">()</code></pre>
<pre data-type="programlisting">
<strong>Traceback (most recent call last):</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">...</code></pre>
<pre data-type="programlisting">
<strong>FileNotFoundError: [Errno 2] No such file...</strong></pre>
</td>
</tr>
<tr>
<td><span class="code">resolve</span></td>
<td><span class="code"><em>p</em></span><span class="code">.resolve(strict=<strong>False</strong>)</span><br/>
			Returns<a contenteditable="false" data-primary="resolve (pathlib.Path class)" data-type="indexterm" id="idm44924515616128"/> a new absolute path object with symbolic links resolved; eliminates any <span class="code">'..'</span> components. Set <span class="code">strict=</span><span class="code"><strong>True</strong></span> to raise exceptions: <span class="code">FileNotFoundError</span> when the path does not exist, or <span class="code">RuntimeError</span> when it encounters an infinite loop. For example, on the temporary directory created in the <span class="code">mkdir</span> example earlier in this table:
			<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">td</code><code class="o">.</code><code class="n">resolve</code><code class="p">()</code></pre>
<pre data-type="programlisting">
<strong>PosixPath('/Users/annar/tempdir')</strong></pre>
</td>
</tr>
<tr>
<td><span class="code">rmdir</span></td>
<td><span class="code"><em>p</em></span><span class="code">.rmdir()</span><br/>
			Removes<a contenteditable="false" data-primary="rmdir (pathlib.Path class)" data-type="indexterm" id="idm44924515566112"/> directory <span class="code"><em>p</em></span>. Raises <span class="code">OSError</span> if <span class="code"><em>p</em></span> is not empty.</td>
</tr>
<tr>
<td><span class="code">samefile</span></td>
<td><span class="code"><em>p</em></span><span class="code">.samefile(<em>target</em>)</span><br/>
			Returns <span class="code"><strong>True</strong></span> when <span class="code"><em>p</em></span> and <span class="code"><em>target</em></span> indicate the same file; otherwise, returns <span class="code"><strong>False</strong></span>. <span class="code"><em>target</em></span> may be a string or a path object.</td>
</tr>
<tr>
<td><span class="code">stat</span></td>
<td><span class="code">p.stat(*, follow_symlinks=<strong>True</strong>)</span><br/>
			Returns<a contenteditable="false" data-primary="stat (pathlib.Path class)" data-type="indexterm" id="idm44924515539312"/> information about the path object, including permissions and size; see <span class="code">os.stat</span> in <a data-type="xref" href="#os_module_functions">Table 11-16</a> for return values. <span class="version">3.10+</span> To <span class="code">stat</span> a symbolic link itself, rather than its target, pass <span class="code">follow_symlinks=</span><span class="code"><strong>False</strong></span>.</td>
</tr>
<tr>
<td><span class="code">symlink_to</span></td>
<td><span class="code"><em>p</em></span><span class="code">.symlink_to(<em>target</em>, target_is_directory=<strong>False</strong>)</span><br/>
			Makes<a contenteditable="false" data-primary="symlink_to (pathlib.Path class)" data-type="indexterm" id="idm44924515529840"/> <span class="code"><em>p</em></span> a symbolic link to <span class="code"><em>target</em></span>. On Windows, you must set <span class="code">target_is_directory=</span><span class="code"><strong>True</strong></span> if <span class="code"><em>target</em></span> is a directory. (POSIX ignores this argument.) (On Windows 10+, like <span class="code">os.symlink</span>, requires Developer Mode permissions; see the <a href="https://oreil.ly/_aI9U">online docs</a> for details.) Note: the order of arguments is the reverse of the order for <span class="code">os.link</span> and <span class="code">os.symlink</span>, described in <a data-type="xref" href="#os_module_functions">Table 11-16</a>.</td>
</tr>
<tr>
<td><span class="code">touch</span></td>
<td><span class="code"><em>p</em></span><span class="code">.touch(mode=0o666, exist_ok=<strong>True</strong>)</span><br/>
			Like<a contenteditable="false" data-primary="touch (pathlib.Path class)" data-type="indexterm" id="idm44924515517328"/> <span class="code">touch</span> on Unix, creates an empty file at the given path. When the file already exists, updates the modification time to the current time if <span class="code">exist_ok=</span><span class="code"><strong>True</strong></span>; if <span class="code">exist_ok=</span><span class="code"><strong>False</strong></span>, raises <span class="code">FileExistsError</span>. For example:
			<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">d</code></pre>
<pre data-type="programlisting">
<strong>WindowsPath('C:/Users/annar/Documents')</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">f</code> <code class="o">=</code> <code class="n">d</code> <code class="o">/</code> <code class="s1">'testfile.txt'</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">f</code><code class="o">.</code><code class="n">is_file</code><code class="p">()</code></pre>
<pre data-type="programlisting">
<strong>False</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">f</code><code class="o">.</code><code class="n">touch</code><code class="p">()</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">f</code><code class="o">.</code><code class="n">is_file</code><code class="p">()</code></pre>
<pre data-type="programlisting">
<strong>True</strong></pre>
</td>
</tr>
<tr>
<td><span class="code">unlink</span></td>
<td><span class="code"><em>p</em></span><span class="code">.unlink(missing_ok=<strong>False</strong>)</span><br/>
			Removes<a contenteditable="false" data-primary="unlink (pathlib.Path class)" data-type="indexterm" id="idm44924515439344"/> file or symbolic link <span class="code"><em>p</em></span>. (Use <span class="code">rmdir</span> for directories, as described earlier in this table.) <span class="version">3.8+</span> Pass <span class="code">missing_ok=</span><span class="code"><strong>True</strong></span> to ignore <a href="https://oreil.ly/wuPTp"><span class="code">FileExistsError</span></a>.</td>
</tr>
<tr>
<td><span class="code">write_bytes</span></td>
<td><span class="code"><em>p</em></span><span class="code">.write_bytes(<em>data</em>)</span><br/>
			Opens<a contenteditable="false" data-primary="write_bytes (pathlib.Path class)" data-type="indexterm" id="idm44924515408512"/> (or, if need be, creates) the file pointed to in bytes mode, writes <span class="code"><em>data</em></span> to it, then closes the file. Overwrites the file if it already exists.</td>
</tr>
<tr>
<td><span class="code">write_text</span></td>
<td><span class="code"><em>p</em></span><span class="code">.write_text(data, encoding=<strong>None</strong>, errors=<strong>None</strong>, newline=<strong>None</strong>)</span><br/>
			Opens<a contenteditable="false" data-primary="write_text (pathlib.Path class)" data-type="indexterm" id="idm44924515401696"/> (or, if need be, creates) the file pointed to in text mode, writes <span class="code"><em>data</em></span> to it, then closes the file. Overwrites the file if it already exists. <span class="version">3.10+</span> When <span class="code">newline</span> is <span class="code"><strong>None</strong></span> (the default), translates any <span class="code">'\n'</span> to the system default line separator; when <span class="code">'\r'</span> or <span class="code">'\r\n'</span>, translates <span class="code">'\n'</span> to the given string; when <span class="code">''</span> or <span class="code">'\n'</span>, no translation takes place.</td>
</tr>
</tbody>
</table>
<p><span class="code">pathlib.Path</span> objects<a contenteditable="false" data-primary="pathlib.Path class" data-type="indexterm" id="idm44924515392528"/> also support the attributes listed in <a data-type="xref" href="#attributes_of_an_instance_p_of_pathlibd">Table 11-22</a> to access the various component parts of the path string. Note that some attributes are strings, while others are <span class="code">Path</span> objects. (For brevity, OS-specific types such as <span class="code">PosixPath</span> or <span class="code">WindowsPath</span> are shown simply using the abstract <span class="code">Path</span> class.)</p>
<table class="border" id="attributes_of_an_instance_p_of_pathlibd">
<caption><span class="label">Table 11-22. </span>Attributes of an instance <span class="code">p</span> of <span class="code">pathlib.Path</span></caption>
<thead>
<tr>
<th>Attribute</th>
<th>Description</th>
<th>Value for Unix path Path('/usr/bin/ python')</th>
<th>Value for Windows path Path(r’c:\Python3\ python.exe')</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="code">anchor</span></td>
<td>Combination of <span class="code">drive</span> and <span class="code">root</span></td>
<td><span class="code">'/'</span></td>
<td><span class="code">'c:\\'</span></td>
</tr>
<tr>
<td><span class="code">drive</span></td>
<td>Drive letter of <span class="code"><em>p</em></span></td>
<td><span class="code">''</span></td>
<td><span class="code">'c:'</span></td>
</tr>
<tr>
<td><span class="code">name</span></td>
<td>End component of <span class="code"><em>p</em></span></td>
<td><span class="code">'python'</span></td>
<td><span class="code">'python.exe'</span></td>
</tr>
<tr>
<td><span class="code">parent</span></td>
<td>Parent directory of <span class="code"><em>p</em></span></td>
<td><span class="code">Path('/usr/bin')</span></td>
<td><span class="code">Path('c:\\Python3')</span></td>
</tr>
<tr>
<td><span class="code">parents</span></td>
<td>Ancestor directories of <span class="code"><em>p</em></span></td>
<td><span class="code">(Path('/usr/ bin'), Path('/usr'), Path('/'))</span></td>
<td><span class="code">(Path('c:\\Python3'), Path('c:\\'))</span></td>
</tr>
<tr>
<td><span class="code">parts</span></td>
<td>Tuple of all components of <span class="code"><em>p</em></span></td>
<td><span class="code">('/', 'usr', 'bin', 'python')</span></td>
<td><span class="code">('c:\\', 'Python3', 'python.exe')</span></td>
</tr>
<tr>
<td><span class="code">root</span></td>
<td>Root directory of <span class="code"><em>p</em></span></td>
<td><span class="code">'/'</span></td>
<td><span class="code">'\\'</span></td>
</tr>
<tr>
<td><span class="code">stem</span></td>
<td>Name of <span class="code"><em>p</em></span>, minus suffix</td>
<td><span class="code">'python'</span></td>
<td><span class="code">'python'</span></td>
</tr>
<tr>
<td><span class="code">suffix</span></td>
<td>Ending suffix of <span class="code"><em>p</em></span></td>
<td><span class="code">''</span></td>
<td><span class="code">'.exe'</span></td>
</tr>
<tr>
<td><span class="code">suffixes</span></td>
<td>List of all suffixes of <span class="code"><em>p</em></span>, as delimited by <span class="code">'.'</span> characters</td>
<td><span class="code">[]</span></td>
<td><span class="code">['.exe']</span></td>
</tr>
</tbody>
</table>
<p>The <a href="https://oreil.ly/uBDrd">online documentation</a> includes more examples for paths with additional components, such as filesystem and UNC shares.</p>
<p><span class="code">pathlib.Path</span> objects also support<a contenteditable="false" data-primary="/ (slash)" data-secondary="pathlib.Path join operator" data-type="indexterm" id="idm44924515336624"/><a contenteditable="false" data-primary="slash (/)" data-secondary="pathlib.Path join operator" data-type="indexterm" id="idm44924515335248"/> the <span class="code">'/'</span> operator, an excellent alternative to <span class="code">os.path.join</span> or <span class="code">Path.joinpath</span> from the <span class="code">Path</span> module. See the example code in the description of <span class="code">Path.touch</span> in <a data-type="xref" href="#commonly_used_functions_of_pathlibdotpa">Table 11-21</a>.<a contenteditable="false" data-primary="" data-startref="FTOpathlib11" data-type="indexterm" id="idm44924515329088"/><a contenteditable="false" data-primary="" data-startref="pathlib11" data-type="indexterm" id="idm44924515327712"/><a contenteditable="false" data-primary="" data-startref="SLMpathlib11" data-type="indexterm" id="idm44924515326336"/></p>
</div></section>
<section data-pdf-bookmark="The stat Module" data-type="sect1"><div class="sect1" id="the_stat_module">
<h1>The stat Module</h1>
<p>The<a contenteditable="false" data-primary="file and text operations" data-secondary="stat module" data-type="indexterm" id="idm44924515322960"/><a contenteditable="false" data-primary="stat module" data-type="indexterm" id="idm44924515321616"/><a contenteditable="false" data-primary="standard library modules" data-secondary="stat" data-type="indexterm" id="idm44924515320480"/> function <span class="code">os.stat</span> (covered in <a data-type="xref" href="#os_module_functions">Table 11-16</a>) returns instances of <span class="code">stat_result</span>, whose item indices, attribute names, and meaning are also covered there. The <span class="code">stat</span> module supplies attributes with names like those of <span class="code">stat_result</span>’s attributes in uppercase, and corresponding values that are the corresponding item indices.</p>
<p>The more interesting contents of the <span class="code">stat</span> module are functions to examine the <span class="code">st_mode</span> attribute of a <span class="code">stat_result</span> instance and determine the kind of file. <span class="code">os.path</span> also supplies functions for such tasks, which operate directly on the file’s <span class="code"><em>path</em></span>. The functions supplied by <span class="code">stat</span>, shown in <a data-type="xref" href="#stat_module_functions_for_examining_st">Table 11-23</a>, are faster than <span class="code">os</span>’s when you perform several tests on the same file: they require only one <span class="code">os.stat</span> system call at the start of a series of tests to obtain the file’s <span class="code">st_mode</span>, while the functions in <span class="code">os.path</span> implicitly ask the operating system for the same information at each test. Each function returns <span class="code"><strong>True</strong></span> when <span class="code"><em>mode</em></span> denotes a file of the given kind; otherwise, it returns <span class="code"><strong>False</strong></span>.</p>
<table class="border" id="stat_module_functions_for_examining_st">
<caption><span class="label">Table 11-23. </span><span class="code">stat</span> module functions for examining <span class="code">st_mode</span></caption>
<tbody>
<tr>
<td><span class="code">S_ISBLK</span></td>
<td><span class="code">S_ISBLK(<em>mode</em>)</span><br/>
			Indicates whether <span class="code"><em>mode</em></span> denotes a special-device file of the block kind</td>
</tr>
<tr>
<td><span class="code">S_ISCHR</span></td>
<td><span class="code">S_ISCHR(<em>mode</em>)</span><br/>
			Indicates whether <span class="code"><em>mode</em></span> denotes a special-device file of the character kind</td>
</tr>
<tr>
<td><span class="code">S_ISDIR</span></td>
<td><span class="code">S_ISDIR(<em>mode</em>)</span><br/>
			Indicates whether <span class="code"><em>mode</em></span> denotes a directory</td>
</tr>
<tr>
<td><span class="code">S_ISFIFO</span></td>
<td><span class="code">S_ISFIFO(<em>mode</em>)</span><br/>
			Indicates whether <span class="code"><em>mode</em></span> denotes a FIFO (also known as a “named pipe”)</td>
</tr>
<tr>
<td><span class="code">S_ISLNK</span></td>
<td><span class="code">S_ISLNK(<em>mode</em>)</span><br/>
			Indicates whether <span class="code"><em>mode</em></span> denotes a symbolic link</td>
</tr>
<tr>
<td><span class="code">S_ISREG</span></td>
<td><span class="code">S_ISREG(<em>mode</em>)</span><br/>
			Indicates whether <span class="code"><em>mode</em></span> denotes a normal file (not a directory, special device-file, etc.)</td>
</tr>
<tr>
<td><span class="code">S_ISSOCK</span></td>
<td><span class="code">S_ISSOCK(<em>mode</em>)</span><br/>
			Indicates whether <span class="code"><em>mode</em></span> denotes a Unix-domain socket</td>
</tr>
</tbody>
</table>
<p>Several of these functions are meaningful only on Unix-like systems, since other platforms do not keep special files such as devices and sockets in the same namespace as regular files; Unix-like systems do.</p>
<p>The <span class="code">stat</span> module also supplies two functions that extract relevant parts of a file’s <span class="code"><em>mode</em></span> (<span class="code"><em>x</em></span><span class="code">.st_mode</span>, for some result <span class="code"><em>x</em></span> of function <span class="code">os.stat</span>), listed in <a data-type="xref" href="#stat_module_functions_for_extracting_bi">Table 11-24</a>.</p>
<table class="border" id="stat_module_functions_for_extracting_bi">
<caption><span class="label">Table 11-24. </span><span class="code">stat</span> module functions for extracting bits from mode</caption>
<tbody>
<tr>
<td><span class="code">S_IFMT</span></td>
<td><span class="code">S_IFMT(<em>mode</em>)</span><br/>
			Returns those bits of <span class="code"><em>mode</em></span> that describe the kind of file (i.e., the bits that are examined by the functions <span class="code">S_ISDIR</span>, <span class="code">S_ISREG</span>, etc.)</td>
</tr>
<tr>
<td><span class="code">S_IMODE</span></td>
<td><span class="code">S_IMODE(<em>mode</em>)</span><br/>
			Returns those bits of <span class="code"><em>mode</em></span> that can be set by the function <span class="code">os.chmod</span> (i.e., the permission bits and, on Unix-like platforms, a few other special bits such as the <span class="code">set-user-id</span> flag)</td>
</tr>
</tbody>
</table>
<p>The <span class="code">stat</span> module supplies a utility function, <span class="code">stat.filemode(<em>mode</em>)</span>, that converts a file’s mode to a human readable string of the form <span class="code">'-rwxrwxrwx'</span>.</p>
</div></section>
<section data-pdf-bookmark="The filecmp Module" data-type="sect1"><div class="sect1" id="the_filecmp_module">
<h1>The filecmp Module</h1>
<p>The<a contenteditable="false" data-primary="file and text operations" data-secondary="filecmp module" data-type="indexterm" id="FTOfilecmp11"/><a contenteditable="false" data-primary="filecmp module" data-type="indexterm" id="filecmpmod11"/><a contenteditable="false" data-primary="standard library modules" data-secondary="filecmp" data-type="indexterm" id="SLMfilecmp11"/> <span class="code">filecmp</span> module supplies a few functions that are useful for comparing files and directories, listed in <a data-type="xref" href="#useful_functions_of_the_filecmp_module">Table 11-25</a>.</p>
<table class="border" id="useful_functions_of_the_filecmp_module">
<caption><span class="label">Table 11-25. </span>Useful functions of the <span class="code">filecmp</span> module</caption>
<tbody>
<tr>
<td><span class="code">clear_cache</span></td>
<td><span class="code">clear_cache()</span><br/>
			Clears the <span class="code">filecmp</span> cache, which may be useful in quick file comparisons.</td>
</tr>
<tr>
<td><span class="code">cmp</span></td>
<td><span class="code">cmp(<em>f1</em>,</span> <span class="code"><em>f2</em></span><span class="code">, shallow=<strong>True</strong>)</span><br/>
			Compares the files (or <span class="code">pathlib.Path</span>s) identified by path strings <span class="code"><em>f1</em></span> and <span class="code"><em>f2</em></span>. If the files are deemed to be equal, <span class="code">cmp</span> returns <span class="code"><strong>True</strong></span>; otherwise, it returns <span class="code"><strong>False</strong></span>. If <span class="code">shallow</span> is <span class="code"><strong>True</strong></span>, files are deemed to be equal if their <span class="code">stat</span> tuples are equal. When <span class="code">shallow</span> is <span class="code"><strong>False</strong></span>, <span class="code">cmp</span> reads and compares the contents of files whose <span class="code">stat</span> tuples are equal.</td>
</tr>
<tr>
<td><span class="code">cmpfiles</span></td>
<td><span class="code">cmpfiles(<em>dir1</em>,</span> <span class="code"><em>dir2</em></span><span class="code">,</span> <span class="code"><em>common</em></span><span class="code">, shallow=<strong>True</strong>)</span><br/>
			Loops on the sequence <span class="code"><em>common</em></span>. Each item of <span class="code"><em>common</em></span> is a string that names a file present in both directories <span class="code"><em>dir1</em></span> and <span class="code"><em>dir2</em></span>. <span class="code">cmpfiles</span> returns a tuple whose items are three lists of strings: <span class="code">(<em>equal</em>,</span> <span class="code"><em>diff</em></span><span class="code">,</span> and <span class="code"><em>errs</em></span><span class="code">)</span>. <span class="code"><em>equal</em></span> is the list of names of files that are equal in both directories, <span class="code"><em>diff</em></span> is the list of names of files that differ between directories, and <span class="code"><em>errs</em></span> is the list of names of files that it could not compare (because they do not exist in both directories, or there is no permission to read one or both of them). The argument <span class="code">shallow</span> is the same as for <span class="code">cmp</span>.</td>
</tr>
</tbody>
</table>
<p>The <span class="code">filecmp</span> module also supplies the class <span class="code">dircmp</span>. The constructor for this class has the signature:</p>
<table class="border">
<tbody>
<tr>
<td><span class="code">dircmp</span></td>
<td><span class="code"><strong>class</strong></span> <span class="code">dircmp(<em>dir1</em>,</span> <span class="code"><em>dir2</em></span><span class="code">, ignore=<strong>None</strong>, hide=<strong>None</strong>)</span><br/>
			Creates a new directory-comparison instance object comparing directories <span class="code"><em>dir1</em></span> and <span class="code"><em>dir2</em></span>, ignoring names listed in <span class="code">ignore</span> and hiding names listed in <span class="code">hide</span> (defaulting to <span class="code">'.'</span> and <span class="code">'..'</span> when <span class="code">hide=</span><span class="code"><strong>None</strong></span>). The default value for <span class="code">ignore</span> is supplied by the <span class="code">DEFAULT_IGNORE</span> attribute of the <span class="code">filecmp</span> module; at the time of this writing it is <span class="code">['RCS', 'CVS',</span> <span class="code">'tags',</span> <span class="code">'.git',</span> <span class="code">'.hg',</span> <span class="code">'.bzr',</span> <span class="code">'_darcs',</span> <span class="code">'__pycache__']</span>. Files in the directories are compared like with <span class="code">filecmp.cmp</span> with <span class="code">shallow=</span><span class="code"><strong>True</strong></span>.</td>
</tr>
</tbody>
</table>
<p>A <span class="code">dircmp</span> instance <span class="code"><em>d</em></span> supplies three methods, detailed in <a data-type="xref" href="#methods_supplied_by_a_dircmp_instance_d">Table 11-26</a>.</p>
<table class="border" id="methods_supplied_by_a_dircmp_instance_d">
<caption><span class="label">Table 11-26. </span>Methods supplied by a <span class="code">dircmp</span> instance <span class="code">d</span></caption>
<tbody>
<tr>
<td><span class="code">report</span></td>
<td><span class="code">report_full_closure()</span><br/>
			Outputs to <span class="code">sys.stdout</span> a comparison between <span class="code"><em>dir1</em></span> and <span class="code"><em>dir2</em></span> and all their common subdirectories, recursively</td>
</tr>
<tr>
<td><span class="code">report_fu⁠l⁠l⁠_​c⁠l⁠o⁠sure</span></td>
<td><span class="code">report_full_closure()</span><br/>
			Outputs to <span class="code">sys.stdout</span> a comparison between <span class="code"><em>dir1</em></span> and <span class="code"><em>dir2</em></span> and all their common subdirectories, recursively</td>
</tr>
<tr>
<td><span class="code">report_parti⁠a⁠l⁠_​c⁠l⁠o⁠sure</span></td>
<td><span class="code">report_partial_closure()</span><br/>
			Outputs to <span class="code">sys.stdout</span> a comparison between <span class="code"><em>dir1</em></span> and <span class="code"><em>dir2</em></span> and their common immediate subdirectories</td>
</tr>
</tbody>
</table>
<p>In addition, <span class="code"><em>d</em></span> supplies several attributes, covered in <a data-type="xref" href="#attributes_supplied_by_a_dircmp_instanc">Table 11-27</a>. These attributes are computed “just in time” (i.e., only if and when needed, thanks to a <span class="code">__getattr__</span> special method) so that using a <span class="code">dircmp</span> instance incurs no unnecessary overhead.</p>
<table class="border" id="attributes_supplied_by_a_dircmp_instanc">
<caption><span class="label">Table 11-27. </span>Attributes supplied by a <span class="code">dircmp</span> instance <span class="code">d</span></caption>
<tbody>
<tr>
<td><span class="code">common</span></td>
<td>Files and subdirectories that are in both <span class="code"><em>dir1</em></span> and <span class="code"><em>dir2</em></span></td>
</tr>
<tr>
<td><span class="code">common_dirs</span></td>
<td>Subdirectories that are in both <span class="code"><em>dir1</em></span> and <span class="code"><em>dir2</em></span></td>
</tr>
<tr>
<td><span class="code">common_files</span></td>
<td>Files that are in both <span class="code"><em>dir1</em></span> and <span class="code"><em>dir2</em></span></td>
</tr>
<tr>
<td><span class="code">common_funny</span></td>
<td>Names that are in both <span class="code"><em>dir1</em></span> and <span class="code"><em>dir2</em></span> for which <span class="code">os.stat</span> reports an error or returns different kinds for the versions in the two directories</td>
</tr>
<tr>
<td><span class="code">diff_files</span></td>
<td>Files that are in both <span class="code"><em>dir1</em></span> and <span class="code"><em>dir2</em></span> but with different contents</td>
</tr>
<tr>
<td><span class="code">funny_files</span></td>
<td>Files that are in both <span class="code"><em>dir1</em></span> and <span class="code"><em>dir2</em></span> but could not be compared</td>
</tr>
<tr>
<td><span class="code">left_list</span></td>
<td>Files and subdirectories that are in <span class="code"><em>dir1</em></span></td>
</tr>
<tr>
<td><span class="code">left_only</span></td>
<td>Files and subdirectories that are in <span class="code"><em>dir1</em></span> and not in <span class="code"><em>dir2</em></span></td>
</tr>
<tr>
<td><span class="code">right_list</span></td>
<td>Files and subdirectories that are in <span class="code"><em>dir2</em></span></td>
</tr>
<tr>
<td><span class="code">right_only</span></td>
<td>Files and subdirectories that are in <span class="code"><em>dir2</em></span> and not in <span class="code"><em>dir1</em></span></td>
</tr>
<tr>
<td><span class="code">same_files</span></td>
<td>Files that are in both <span class="code"><em>dir1</em></span> and <span class="code"><em>dir2</em></span> with the same contents</td>
</tr>
<tr>
<td><span class="code">subdirs</span></td>
<td>A dictionary whose keys are the strings in <span class="code">common_dirs</span>; the corresponding values are instances of <span class="code">dircmp</span> (or <span class="version">3.10+</span> of the same <span class="code">dircmp</span> subclass as <span class="code"><em>d</em></span>) for each subdirectory<a contenteditable="false" data-primary="" data-startref="filecmpmod11" data-type="indexterm" id="idm44924515109152"/><a contenteditable="false" data-primary="" data-startref="FTOfilecmp11" data-type="indexterm" id="idm44924515107776"/><a contenteditable="false" data-primary="" data-startref="SLMfilecmp11" data-type="indexterm" id="idm44924515106400"/></td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="The fnmatch Module" data-type="sect1"><div class="sect1" id="the_fnmatch_module">
<h1>The fnmatch Module</h1>
<p>The<a contenteditable="false" data-primary="file and text operations" data-secondary="fnmatch module" data-type="indexterm" id="idm44924515103056"/><a contenteditable="false" data-primary="fnmatch module" data-type="indexterm" id="idm44924515101712"/><a contenteditable="false" data-primary="filename matching" data-type="indexterm" id="idm44924515100576"/><a contenteditable="false" data-primary="standard library modules" data-secondary="fnmatch" data-type="indexterm" id="idm44924515099472"/> <span class="code">fnmatch</span> module (an abbreviation for <em>filename match</em>) matches filename strings or paths with patterns that resemble the ones used by Unix shells, as<a contenteditable="false" data-primary="question mark (?)" data-type="indexterm" id="idm44924515096752"/><a contenteditable="false" data-primary="? (question mark)" data-type="indexterm" id="idm44924515095648"/><a contenteditable="false" data-primary="* (asterisk)" data-secondary="in fnmatch module" data-secondary-sortas="fnmatch module" data-type="indexterm" id="idm44924515094544"/><a contenteditable="false" data-primary="asterisk (*)" data-secondary="in fnmatch module" data-secondary-sortas="fnmatch module" data-type="indexterm" id="idm44924515092896"/> listed in <a data-type="xref" href="#fnmatch_pattern_matching_conventions">Table 11-28</a>.</p>
<table class="border" id="fnmatch_pattern_matching_conventions">
<caption class="width-full"><span class="label">Table 11-28. </span><span class="code">fnmatch</span> pattern matching conventions</caption>
<thead>
<tr>
<th>Pattern</th>
<th>Matches</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="code">*</span></td>
<td>Any sequence of characters</td>
</tr>
<tr>
<td><span class="code">?</span></td>
<td>Any single character</td>
</tr>
<tr>
<td><span class="code">[<em>chars</em>]</span></td>
<td>Any one of the characters in <span class="code"><em>chars</em></span></td>
</tr>
<tr>
<td><span class="code">[!<em>chars</em>]</span></td>
<td>Any one character not among those in <span class="code"><em>chars</em></span></td>
</tr>
</tbody>
</table>
<p><span class="code">fnmatch</span> does <em>not</em> follow other conventions of Unix shell pattern matching, such as treating a slash (<span class="code">/</span>) or a leading dot (<span class="code">.</span>) specially. It also does not allow escaping special characters: rather, to match a special character, enclose it in brackets. For example, to match a filename that’s a single close bracket, use <span class="code">'[]]'</span>.</p>
<p>The <span class="code">fnmatch</span> module supplies the functions listed in <a data-type="xref" href="#functions_of_the_fnmatch_module">Table 11-29</a>.</p>
<table class="border" id="functions_of_the_fnmatch_module">
<caption><span class="label">Table 11-29. </span>Functions of the <span class="code">fnmatch</span> module</caption>
<tbody>
<tr>
<td class="width-15"><span class="code">filter</span></td>
<td><span class="code">filter(<em>names</em>,</span> <span class="code"><em>pattern</em></span><span class="code">)</span><br/>
			Returns<a contenteditable="false" data-primary="filter (fnmatch module)" data-type="indexterm" id="idm44924515063600"/> the list of items of <span class="code"><em>names</em></span> (a sequence of strings) that match <span class="code"><em>pattern</em></span>.</td>
</tr>
<tr>
<td><span class="code">fnmatch</span></td>
<td><span class="code">fnmatch(<em>filename</em>,</span> <span class="code"><em>pattern</em></span><span class="code">)</span><br/>
			Returns <span class="code"><strong>True</strong></span> when string <span class="code"><em>filename</em></span> matches <span class="code"><em>pattern</em></span>; otherwise, returns <span class="code"><strong>False</strong></span>. The match is case sensitive when the platform is (for example, typical Unix-like systems), and otherwise (for example, on Windows) case insensitive; beware of that, if you’re dealing with a filesystem whose case-sensitivity doesn’t match your platform (for example, macOS is Unix-like; however, its typical filesystems are case insensitive).</td>
</tr>
<tr>
<td><span class="code">fnmatchcase</span></td>
<td><span class="code">fnmatchcase(<em>filename</em>,</span> <span class="code"><em>pattern</em></span><span class="code">)</span><br/>
			Returns <span class="code"><strong>True</strong></span> when string <span class="code"><em>filename</em></span> matches <span class="code"><em>pattern</em></span>; otherwise, returns <span class="code"><strong>False</strong></span>. The match is always case-sensitive on any platform.</td>
</tr>
<tr>
<td><span class="code">translate</span></td>
<td><span class="code">translate(<em>pattern</em>)</span><br/>
			Returns<a contenteditable="false" data-primary="translate (fnmatch module)" data-type="indexterm" id="idm44924515042144"/> the regular expression pattern (as covered in <a data-type="xref" href="ch10.xhtml#pattern_string_syntax">“Pattern String Syntax”</a>) equivalent to the <span class="code">fnmatch</span> pattern <span class="code"><em>pattern</em></span>.</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="The glob Module" data-type="sect1"><div class="sect1" id="the_glob_module">
<h1>The glob Module</h1>
<p>The<a contenteditable="false" data-primary="file and text operations" data-secondary="glob module" data-type="indexterm" id="idm44924515036336"/><a contenteditable="false" data-primary="glob (glob module)" data-type="indexterm" id="idm44924515034576"/><a contenteditable="false" data-primary=" path patterns" data-type="indexterm" id="idm44924515033472"/> <span class="code">glob</span> module<a contenteditable="false" data-primary="standard library modules" data-secondary="glob" data-type="indexterm" id="idm44924515031520"/><a contenteditable="false" data-primary="rglob (glob module)" data-type="indexterm" id="idm44924515030144"/> lists (in arbitrary order) the pathnames of files that match a <em>path pattern</em>, using the same rules as <span class="code">fnmatch</span>; in addition, it treats a<a contenteditable="false" data-primary="** (double star) operator" data-secondary="glob recursive wildcard" data-type="indexterm" id="idm44924515027728"/><a contenteditable="false" data-primary=". (period)" data-secondary="treatment by glob module" data-type="indexterm" id="idm44924515026384"/><a contenteditable="false" data-primary="period (.)" data-secondary="treatment by glob module" data-type="indexterm" id="idm44924515025040"/><a contenteditable="false" data-primary="/ (slash)" data-secondary="in glob module" data-secondary-sortas="glob module" data-type="indexterm" id="idm44924515023696"/><a contenteditable="false" data-primary="slash (/)" data-secondary="in glob module" data-secondary-sortas="glob module" data-type="indexterm" id="idm44924515022048"/><a contenteditable="false" data-primary="double star (**) operator" data-secondary="glob recursive wildcard" data-type="indexterm" id="idm44924515020400"/> leading dot (<span class="code">.</span>), separator (<span class="code">/</span>), and <span class="code">**</span> specially, like Unix shells do. <a data-type="xref" href="#functions_of_the_glob_module">Table 11-30</a> lists some useful functions provided by the <span class="code">glob</span> module.</p>
<table class="border" id="functions_of_the_glob_module">
<caption><span class="label">Table 11-30. </span>Functions of the <span class="code">glob</span> module</caption>
<tbody>
<tr>
<td><span class="code">escape</span></td>
<td><span class="code">escape(<em>pathname</em>)</span><br/>
			Escapes all special characters (<span class="code">'?'</span>, <span class="code">'*'</span>, and <span class="code">'['</span>), so you can match an arbitrary literal string that may contain special characters.</td>
</tr>
<tr>
<td><span class="code">glob</span></td>
<td><span class="code">glob(<em>pathname</em>, *, root_dir=<strong>None</strong>, dir_fd=<strong>None</strong>, recursive=<strong>False</strong>)</span><br/>
			Returns the list of pathnames of files that match the pattern <span class="code"><em>pathname</em></span>. <span class="code">root_dir</span> (if not <span class="code"><strong>None</strong></span>) is a string or path-like object specifying the root directory for searching (this works like changing the current directory before calling <span class="code">glob</span>). If <span class="code"><em>pathname</em></span> is relative, the paths returned are relative to <span class="code">root_dir</span>. To search paths relative to directory descriptors, pass <span class="code">dir_fd</span> instead. Optionally pass named argument <span class="code">recursive=</span><span class="code"><strong>True</strong></span> to have path component <span class="code">**</span> recursively match zero or more levels of subdirectories.</td>
</tr>
<tr>
<td><span class="code">iglob</span></td>
<td><span class="code">iglob(</span><span class="code"><em>pathname, *,</em></span> <span class="code">root_dir=<strong>None</strong>, dir_fd=<strong>None</strong>, recursive=<strong>False</strong>)</span><br/>
			Like <span class="code">glob</span>, but returns an iterator yielding one relevant pathname at a time.</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="The shutil Module" data-type="sect1"><div class="sect1" id="the_shutil_module">
<h1>The shutil Module</h1>
<p>The<a contenteditable="false" data-primary="file and text operations" data-secondary="shutil module" data-type="indexterm" id="FTOshutil11"/><a contenteditable="false" data-primary="shutil module" data-type="indexterm" id="shutilmod11"/><a contenteditable="false" data-primary="shell utilities" data-type="indexterm" id="shelutil11"/><a contenteditable="false" data-primary="standard library modules" data-secondary="shutil" data-type="indexterm" id="SLMshutil11"/> <span class="code">shutil</span> module (an abbreviation for <em>shell utilities</em>) supplies functions to copy and move files, and to remove an entire directory tree. On some Unix platforms, most of the functions support the optional keyword-only argument <span class="code">follow_symlinks</span>, defaulting to <span class="code"><strong>True</strong></span>. When <span class="code">follow_symlinks=</span><span class="code"><strong>True</strong></span>, if a path indicates a symbolic link, the function follows it to reach an actual file or directory; when <span class="code"><strong>False</strong></span>, the function operates on the symbolic link itself. <a data-type="xref" href="#functions_of_the_shutil_module">Table 11-31</a> lists the functions provided by the <span class="code">shutil</span> module.</p>
<table class="border" id="functions_of_the_shutil_module">
<caption><span class="label">Table 11-31. </span>Functions of the <span class="code">shutil</span> module</caption>
<tbody>
<tr>
<td class="width-20"><span class="code">copy</span></td>
<td><span class="code">copy(<em>src</em>,</span> <span class="code"><em>dst</em></span><span class="code">)</span><br/>
			Copies<a contenteditable="false" data-primary="copy function" data-secondary="shutil module" data-type="indexterm" id="idm44924514967024"/> the contents of the file named by <span class="code"><em>src</em></span>, which must exist, and creates or overwrites the file <span class="code"><em>dst</em></span> (<span class="code"><em>src</em></span> and <span class="code"><em>dst</em></span> are strings or instances of <span class="code">pathlib.Path</span>). If <span class="code"><em>dst</em></span> is a directory, the target is a file with the same base name as <span class="code"><em>src</em></span>, but located in <span class="code"><em>dst</em></span>. <span class="code">copy</span> also copies permission bits, but not last access and modification times. Returns the path to the destination file it has copied to.</td>
</tr>
<tr>
<td><span class="code">copy2</span></td>
<td><span class="code">copy2(<em>src</em>,</span> <span class="code"><em>dst</em></span><span class="code">)</span><br/>
			Like <span class="code">copy</span>, but also copies last access time and modification time.</td>
</tr>
<tr>
<td><span class="code">copyfile</span></td>
<td><span class="code">copyfile(<em>src</em>,</span> <span class="code"><em>dst</em></span><span class="code">)</span><br/>
			Copies<a contenteditable="false" data-primary="copyfile function (shutil module)" data-type="indexterm" id="idm44924514948752"/> just the contents (not permission bits, nor last access and modification times) of the file named by <span class="code"><em>src</em></span>, creating or overwriting the file named by <span class="code"><em>dst</em></span>.</td>
</tr>
<tr>
<td><span class="code">copyf⁠i⁠l⁠e​o⁠b⁠j</span></td>
<td><span class="code">copyfileobj(<em>fsrc</em>,</span> <span class="code"><em>fdst</em></span><span class="code">, bufsize=16384)</span><br/>
			Copies<a contenteditable="false" data-primary="copyfileobj function (shutil module)" data-type="indexterm" id="idm44924514941360"/> all bytes from file object <span class="code"><em>fsrc</em></span>, which must be open for reading, to file object <span class="code"><em>fdst</em></span>, which must be open for writing. Copies up to <span class="code">bufsize</span> bytes at a time if <span class="code"><em>bufsize</em></span> is greater than <span class="code">0</span>. File objects are covered in <a data-type="xref" href="#the_io_module">“The io Module”</a>.</td>
</tr>
<tr>
<td><span class="code">copymode</span></td>
<td><span class="code">copymode(<em>src</em>,</span> <span class="code"><em>dst</em></span><span class="code">)</span><br/>
			Copies<a contenteditable="false" data-primary="copymode function (shutil module)" data-type="indexterm" id="idm44924514930752"/> permission bits of the file or directory named by <span class="code"><em>src</em></span> to the file or directory named by <span class="code"><em>dst</em></span>. Both <span class="code"><em>src</em></span> and <span class="code"><em>dst</em></span> must exist. Does not change <span class="code"><em>dst</em></span>’s contents, nor its status as being a file or a directory.</td>
</tr>
<tr>
<td><span class="code">copystat</span></td>
<td><span class="code">copystat(<em>src</em>,</span> <span class="code"><em>dst</em></span><span class="code">)</span><br/>
			Copies<a contenteditable="false" data-primary="copystat function (shutil module)" data-type="indexterm" id="idm44924514920752"/> permission bits and times of last access and modification of the file or directory named by <span class="code"><em>src</em></span> to the file or directory named by <span class="code"><em>dst</em></span>. Both <span class="code"><em>src</em></span> and <span class="code"><em>dst</em></span> must exist. Does not change <span class="code"><em>dst</em></span>’s contents, nor its status as being a file or a directory.</td>
</tr>
<tr>
<td><span class="code">copytree</span></td>
<td><span class="code">copytree(<em>src</em>,</span> <span class="code"><em>dst</em></span><span class="code">, symlinks=<strong>False</strong>,</span> <span class="code">ignore=<strong>None</strong>, copy_function=copy2, ignore_dangling_symlinks=<strong>False</strong>, dirs_exist_ok=<strong>False</strong>)</span><br/>
			Copies<a contenteditable="false" data-primary="copytree function (shutil module)" data-type="indexterm" id="idm44924514907856"/> the directory tree rooted at the directory named by <span class="code"><em>src</em></span> into the destination directory named by <span class="code"><em>dst</em></span><em>.</em> <span class="code"><em>dst</em></span> must not already exist: <span class="code">copytree</span> creates it (as well as creating any missing parent directories). <span class="code">copytree</span> copies each file using the function <span class="code">copy2</span>, by default; you can optionally pass a different file-copy function as named argument <span class="code">copy_function</span>. If any exceptions occur during the copy process, <span class="code">copytree</span> will record them internally and continue, raising <span class="code">Error</span> at the end containing the list of all the recorded exceptions.<br/>
			When <span class="code">symlinks</span> is <span class="code"><strong>True</strong></span>, <span class="code">copytree</span> creates symbolic links in the new tree when it finds symbolic links in the source tree. When <span class="code">symlinks</span> is <span class="code"><strong>False</strong></span>, <span class="code">copytree</span> follows each symbolic link it finds and copies the linked-to file with the link’s name, recording an exception if the linked file does not exist (if <span class="code">ignore_dangling_symlinks=</span><span class="code"><strong>True</strong></span>, this exception is ignored). On platforms that do not have the concept of a symbolic link, <span class="code">copytree</span> ignores the argument <span class="code">symlinks</span>.</td>
</tr>
<tr>
<td><span class="code">copytree</span><br/>
<em>(cont.)</em></td>
<td>When <span class="code">ignore</span> is not <span class="code"><strong>None</strong></span>, it must be a callable accepting two arguments (a directory path and a list of the immediate children of the directory) and returning a list of the children to be ignored in the copy process. If present, <span class="code">ignore</span> is often the result of a call to <span class="code">shutil.ignore_patterns</span>. For example, this code:
			<pre data-code-language="python" data-type="programlisting">
<strong><code class="kn">import</code></strong><code> </code><code class="nn">shutil</code><code>
</code><code class="n">ignore</code><code> </code><code class="o">=</code><code> </code><code class="n">shutil</code><code class="o">.</code><code class="n">ignore_patterns</code><code class="p">(</code><code class="s1">'</code><code class="s1">.*</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">*.bak</code><code class="s1">'</code><code class="p">)</code><code>
</code><code class="n">shutil</code><code class="o">.</code><code class="n">copytree</code><code class="p">(</code><code class="s1">'</code><code class="s1">src</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">dst</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">ignore</code><code class="o">=</code><code class="n">ignore</code><code class="p">)</code></pre>
			copies the tree rooted at directory <span class="code">src</span> into a new tree rooted at directory <span class="code">dst</span>, ignoring any file or subdirectory whose name starts with a dot and any file or subdirectory whose name ends with <em>.bak</em>.<br/>
			By default, <span class="code">copytree</span> will record a <span class="code">FileExistsError</span> exception if a target directory already exists. <span class="version">3.8+</span> You can set <span class="code">dirs_exist_ok</span> to <span class="code"><strong>True</strong></span> to allow <span class="code">copytree</span> to write into existing directories found in the copying process (and potentially overwrite their contents).</td>
</tr>
<tr>
<td><span class="code">igno⁠r⁠e⁠_​p⁠a⁠t⁠terns</span></td>
<td><span class="code">ignore_patterns(<em>*patterns</em>)</span><br/>
			Returns a callable picking out files and subdirectories matching <span class="code"><em>patterns</em></span>, like those used in the <span class="code">fnmatch</span> module (see <a data-type="xref" href="#the_fnmatch_module">“The fnmatch Module”</a>). The result is suitable for passing as the <span class="code">ignore</span> argument to the <span class="code">copytree</span> function.</td>
</tr>
<tr>
<td><span class="code">move</span></td>
<td><span class="code">move(<em>src</em>,</span> <span class="code"><em>dst</em></span><span class="code">, copy_function=copy2)</span><br/>
			Moves<a contenteditable="false" data-primary="move function (shutil module)" data-type="indexterm" id="idm44924514807792"/> the file or directory named by <span class="code"><em>src</em></span> to that named by <span class="code"><em>dst</em></span>. <span class="code">move</span> first tries using <span class="code">os.rename</span>. Then, if that fails (because <span class="code"><em>src</em></span> and <span class="code"><em>dst</em></span> are on separate filesystems, or because <span class="code"><em>dst</em></span> already exists), <span class="code">move</span> copies <span class="code"><em>src</em></span> to <span class="code"><em>dst</em></span> (using <span class="code">copy2</span> for a file or <span class="code">copytree</span> for a directory by default; you can optionally pass a file-copy function other than <span class="code">copy2</span> as the named argument <span class="code">copy_function</span>), then removes <span class="code"><em>src</em></span> (using <span class="code">os.unlink</span> for a file, <span class="code">rmtree</span> for a directory).</td>
</tr>
<tr>
<td><span class="code">rmtree</span></td>
<td><span class="code">rmtree(<em>path</em>,</span> <span class="code">ignore_errors=<strong>False</strong>,</span> <span class="code">onerror=<strong>None</strong>)</span><br/>
			Removes<a contenteditable="false" data-primary="rmtree function (shutil module)" data-type="indexterm" id="idm44924514788128"/> the directory tree rooted at <span class="code"><em>path</em></span>. When <span class="code">ignore_errors</span> is <span class="code"><strong>True</strong></span>, <span class="code">rmtree</span> ignores errors. When <span class="code">ignore_errors</span> is <span class="code"><strong>False</strong></span> and <span class="code">onerror</span> is <span class="code"><strong>None</strong></span>, errors raise exceptions. When <span class="code">onerror</span> is not <span class="code"><strong>None</strong></span>, it must be callable with three parameters: <span class="code"><em>func</em></span>, <span class="code"><em>path</em></span>, and <span class="code"><em>ex</em></span>. <span class="code"><em>func</em></span> is the function raising the exception (<span class="code">os.remove</span> or <span class="code">os.rmdir</span>), <span class="code"><em>path</em></span> is the path passed to <span class="code"><em>func</em></span>, and <span class="code"><em>ex</em></span> is the tuple of information <span class="code">sys.exc_info</span> returns. When <span class="code">onerror</span> raises an exception, <span class="code">rmtree</span> terminates, and the exception propagates.</td>
</tr>
</tbody>
</table>
<p>Beyond offering functions that are directly useful, the source file <em>shutil.py</em> in the Python stdlib is an excellent example of how to use many of the <span class="code">os</span> functions.<a contenteditable="false" data-primary="" data-startref="SLMshutil11" data-type="indexterm" id="idm44924514768704"/><a contenteditable="false" data-primary="" data-startref="shutilmod11" data-type="indexterm" id="idm44924514767328"/><a contenteditable="false" data-primary="" data-startref="FTOshutil11" data-type="indexterm" id="idm44924514765920"/><a contenteditable="false" data-primary="" data-startref="shelutil11" data-type="indexterm" id="idm44924514764544"/><a contenteditable="false" data-primary="" data-startref="FTOosmod11" data-type="indexterm" id="idm44924514763168"/></p>
</div></section>
<section data-pdf-bookmark="Text Input and Output" data-type="sect1"><div class="sect1" id="text_input_and_output">
<h1>Text Input and Output</h1>
<p>Python<a contenteditable="false" data-primary="file and text operations" data-secondary="text input and output" data-type="indexterm" id="FTOtinout11"/><a contenteditable="false" data-primary="text input and output" data-type="indexterm" id="testinout11"/> presents non-GUI text input and output streams to Python programs as file objects, so you can use the methods of file objects (covered in <a data-type="xref" href="#attributes_and_methods_of_file_object">“Attributes and Methods of File Objects”</a>) to operate on these streams.</p>
<section data-pdf-bookmark="Standard Output and Standard Error" data-type="sect2"><div class="sect2" id="standard_output_and_standard_error">
<h2>Standard Output and Standard Error</h2>
<p>The<a contenteditable="false" data-primary="sys module" data-type="indexterm" id="idm44924514753856"/><a contenteditable="false" data-primary="standard library modules" data-secondary="sys" data-type="indexterm" id="idm44924514752752"/> <span class="code">sys</span> module (covered in <a data-type="xref" href="ch08.xhtml#the_sys_module">“The sys Module”</a>) has the attributes<a contenteditable="false" data-primary="stdout (sys module)" data-type="indexterm" id="idm44924514749488"/><a contenteditable="false" data-primary="stderr (sys module)" data-type="indexterm" id="idm44924514748352"/> <span class="code">stdout</span> and <span class="code">stderr</span>, which are writable file objects. Unless you are using shell redirection or pipes, these streams connect to the “terminal” running your script. Nowadays, actual terminals are very rare: a so-called terminal is generally a screen window that supports text I/O.</p>
<p>The<a contenteditable="false" data-primary="sys.stdout" data-type="indexterm" id="idm44924514745392"/><a contenteditable="false" data-primary="sys.stderr" data-type="indexterm" id="idm44924514743904"/> distinction between <span class="code">sys.stdout</span> and <span class="code">sys.stderr</span> is a matter of convention. <span class="code">sys.stdout</span>, known as<a contenteditable="false" data-primary="standard output" data-type="indexterm" id="idm44924514740512"/> <em>standard output</em>, is where your program emits results. <span class="code">sys.stderr</span>, known as<a contenteditable="false" data-primary="standard error" data-type="indexterm" id="idm44924514738112"/> <em>standard error</em>, is where output such as error, status, or progress messages should go. Separating program output from status and error messages helps you use shell redirection effectively. Python respects this convention, using <span class="code">sys.stderr</span> for its own errors and warnings.</p>
</div></section>
<section data-pdf-bookmark="The print Function" data-type="sect2"><div class="sect2" id="the_print_function">
<h2>The print Function</h2>
<p>Programs<a contenteditable="false" data-primary="print (built-in function)" data-type="indexterm" id="idm44924514734000"/> that output results to standard output often need to write to <span class="code">sys.stdout</span>. Python’s <span class="code">print</span> function (covered in <a data-type="xref" href="ch08.xhtml#pythonapostrophes_core_built_in_functio">Table 8-2</a>) can be a rich, convenient alternative to <span class="code">sys.stdout.write</span>. <span class="code">print</span> is fine for the informal output used during development to help you debug your code, but for production output, you may need more control of formatting than <span class="code">print</span> affords. For example, you may need to control spacing, field widths, the number of decimal places for floating-point values, and so on. If so, you can prepare the output as an f-string (covered in <a data-type="xref" href="ch09.xhtml#string_formatting">“String Formatting”</a>), then output the string, usually with the <span class="code">write</span> method of the appropriate file object. (You can pass formatted strings to <span class="code">print</span>, but <span class="code">print</span> may add spaces and newlines; the <span class="code">write</span> method adds nothing at all, so it’s easier for you to control what exactly gets output.)</p>
<p>If you need to direct output to a file <span class="code"><em>f</em></span> that is open for writing, just calling <span class="code"><em>f</em></span><span class="code">.write</span> is often best, while <span class="code">print(..., file=<em>f</em>)</span> is sometimes a handy alternative. To repeatedly direct the output from <span class="code">print</span> calls to a certain file, you can temporarily change the value of <span class="code">sys.stdout</span>. The following example is a general-purpose redirection function usable for such a temporary change; in the presence of multitasking, make sure to also add a lock in order to avoid any contention (see also the <span class="code">contextlib.redirect_stdout</span> decorator described in <a data-type="xref" href="ch06.xhtml#commonly_used_classes_and_functions_in">Table 6-1</a>):</p>
<pre data-code-language="python" data-type="programlisting">
<strong><code class="k">def</code></strong><code> </code><code class="nf">redirect</code><code class="p">(</code><code class="n">func</code><code class="p">:</code><code> </code><code class="n">Callable</code><code class="p">,</code><code> </code><code class="o">*</code><code class="n">a</code><code class="p">,</code><code> </code><code class="o">*</code><code class="o">*</code><code class="n">k</code><code class="p">)</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="p">(</code><code class="nb">str</code><code class="p">,</code><code> </code><code class="n">Any</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><em><code class="sd">"""redirect(func, *a, **k) -&gt; (func's results, return value)</code></em><code class="sd">
</code><em><code class="sd">    func is a callable emitting results to standard output.</code></em><code class="sd">
</code><em><code class="sd">    redirect captures the results as a str and returns a pair</code></em><code class="sd">
</code><em><code class="sd">    (output string, return value).</code></em><code class="sd">
</code><em><code class="sd">    """</code></em><code>
</code><code>    </code><strong><code class="kn">import</code></strong><code> </code><code class="nn">sys</code><code class="o">,</code><code> </code><code class="nn">io</code><code>
</code><code>    </code><code class="n">save_out</code><code> </code><code class="o">=</code><code> </code><code class="n">sys</code><code class="o">.</code><code class="n">stdout</code><code>
</code><code>    </code><code class="n">sys</code><code class="o">.</code><code class="n">stdout</code><code> </code><code class="o">=</code><code> </code><code class="n">io</code><code class="o">.</code><code class="n">StringIO</code><code class="p">(</code><code class="p">)</code><code>
</code><code>    </code><strong><code class="k">try</code></strong><code class="p">:</code><code>
</code><code>        </code><code class="n">retval</code><code> </code><code class="o">=</code><code> </code><code class="n">func</code><code class="p">(</code><code class="o">*</code><code class="n">args</code><code class="p">,</code><code> </code><code class="o">*</code><code class="o">*</code><code class="n">kwds</code><code class="p">)</code><code>
</code><code>        </code><strong><code class="k">return</code></strong><code> </code><code class="n">sys</code><code class="o">.</code><code class="n">stdout</code><code class="o">.</code><code class="n">getvalue</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">retval</code><code>
</code><code>    </code><strong><code class="k">finally</code></strong><code class="p">:</code><code>
</code><code>        </code><code class="n">sys</code><code class="o">.</code><code class="n">stdout</code><code class="o">.</code><code class="n">close</code><code class="p">(</code><code class="p">)</code><code>
</code><code>        </code><code class="n">sys</code><code class="o">.</code><code class="n">stdout</code><code> </code><code class="o">=</code><code> </code><code class="n">save_out</code></pre>
</div></section>
<section data-pdf-bookmark="Standard Input" data-type="sect2"><div class="sect2" id="standard_input">
<h2>Standard Input</h2>
<p>In<a contenteditable="false" data-primary="standard input" data-type="indexterm" id="idm44924514597200"/> addition to <span class="code">stdout</span> and <span class="code">stderr,</span> the <span class="code">sys</span> module provides the<a contenteditable="false" data-primary="stdin (sys module)" data-type="indexterm" id="idm44924514614400"/> <span class="code">stdin</span> attribute, which is a readable file object. When you need a line of text from the user, you can call the built-in function <span class="code">input</span> (covered in <a data-type="xref" href="ch08.xhtml#pythonapostrophes_core_built_in_functio">Table 8-2</a>), optionally with a string argument to use as a prompt.</p>
<p>When<a contenteditable="false" data-primary="ast.literal_eval function" data-type="indexterm" id="idm44924514610512"/> the input you need is not a string (for example, when you need a number), use <span class="code">input</span> to obtain a string from the user, then other built-ins, such as <span class="code">int</span>, <span class="code">float</span>, or <span class="code">ast.literal_eval</span>, to turn the string into the number you need. To evaluate an expression or string from an untrusted source, we recommend using the<a contenteditable="false" data-primary="literal_eval function (ast module)" data-type="indexterm" id="idm44924514563312"/> function <span class="code">literal_eval</span> from the<a contenteditable="false" data-primary="ast module" data-type="indexterm" id="idm44924514561584"/><a contenteditable="false" data-primary="standard library modules" data-secondary="ast" data-type="indexterm" id="idm44924514560608"/> standard library module <span class="code">ast</span> (as covered in the <a href="https://oreil.ly/6kb6T">online docs</a>). <span class="code">ast.literal_eval(<em>astring</em>)</span> returns a valid Python value (such as an <span class="code">int</span>, a <span class="code">float</span>, or a <span class="code">list</span>) for the given literal <span class="code"><em>astring</em></span> when it can (<span class="version">3.10+</span> stripping any leading spaces and tabs from string inputs), or else raises a <span class="code">SyntaxError</span> or <span class="code">ValueError</span> exception; it never has any side effects. To ensure complete safety, <span class="code"><em>astring</em></span> cannot contain any operator or any nonkeyword identifier; however, <span class="code">+</span> and <span class="code">-</span> may be accepted as positive or negative signs on numbers, rather than as operators. For example:</p>
<pre data-code-language="python" data-type="programlisting">
<strong><code class="kn">import</code></strong><code> </code><code class="nn">ast</code><code>
</code><code class="nb">print</code><code class="p">(</code><code class="n">ast</code><code class="o">.</code><code class="n">literal_eval</code><code class="p">(</code><code class="s1">'</code><code class="s1">23</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>     </code><em><code class="c1"># prints 23</code></em><code>
</code><code class="nb">print</code><code class="p">(</code><code class="n">ast</code><code class="o">.</code><code class="n">literal_eval</code><code class="p">(</code><code class="s1">'</code><code class="s1">  23</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>   </code><em><code class="c1"># prints 23 (3.10++)</code></em><code>
</code><code class="nb">print</code><code class="p">(</code><code class="n">ast</code><code class="o">.</code><code class="n">literal_eval</code><code class="p">(</code><code class="s1">'</code><code class="s1">[2,-3]</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code> </code><em><code class="c1"># prints [2, -3]</code></em><code>
</code><code class="nb">print</code><code class="p">(</code><code class="n">ast</code><code class="o">.</code><code class="n">literal_eval</code><code class="p">(</code><code class="s1">'</code><code class="s1">2+3</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>    </code><em><code class="c1"># raises ValueError</code></em><code>
</code><code class="nb">print</code><code class="p">(</code><code class="n">ast</code><code class="o">.</code><code class="n">literal_eval</code><code class="p">(</code><code class="s1">'</code><code class="s1">2+</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>     </code><em><code class="c1"># raises SyntaxError</code></em></pre>
<div data-type="warning" epub:type="warning">
<h1>eval Can Be Dangerous</h1>
<p>Don’t use <span class="code">eval</span> on arbitrary, unsanitized user inputs: a nasty (or well-meaning but careless) user can breach security or otherwise cause damage this way. There is no effective defense—just avoid using <span class="code">eval</span> (and <span class="code">exec</span>) on input from sources you do not fully trust.</p>
</div>
</div></section>
<section data-pdf-bookmark="The getpass Module" data-type="sect2"><div class="sect2" id="the_getpass_module">
<h2>The getpass Module</h2>
<p>Very<a contenteditable="false" data-primary="getpass module" data-type="indexterm" id="idm44924514488704"/><a contenteditable="false" data-primary="standard library modules" data-secondary="getpass" data-type="indexterm" id="idm44924514487568"/> occasionally, you may want the user to input a line of text in such a way that somebody looking at the screen cannot see what the user is typing. This may occur when you’re asking the user for a password, for example. The <span class="code">getpass</span> module provides a function for this, as well as one to get the current user’s username (see <a data-type="xref" href="#functions_of_the_getpass_module">Table 11-32</a>).</p>
<table class="border pagebreak-before less_space" id="functions_of_the_getpass_module">
<caption><span class="label">Table 11-32. </span>Functions of the <span class="code">getpass</span> module</caption>
<tbody>
<tr>
<td><span class="code">getpass</span></td>
<td><span class="code">getpass(prompt='Password: ')</span><br/>
			Like<a contenteditable="false" data-primary="getpass (getpass module)" data-type="indexterm" id="idm44924514442944"/> <span class="code">input</span> (covered in <a data-type="xref" href="ch08.xhtml#pythonapostrophes_core_built_in_functio">Table 8-2</a>), except that the text the user inputs is not echoed to the screen as the user is typing, and the default <span class="code">prompt</span> is different from <span class="code">input</span>’s.</td>
</tr>
<tr>
<td><span class="code">getuser</span></td>
<td><span class="code">getuser()</span><br/>
			Returns<a contenteditable="false" data-primary="getuser (getpass module)" data-type="indexterm" id="idm44924514435920"/> the current user’s username. <span class="code">getuser</span> tries to get the username as the value of one of the environment variables <span class="code">LOGNAME</span>, <span class="code">USER</span>, <span class="code">LNAME</span>, or <span class="code">USERNAME</span>, in that order. If none of these variables are in <span class="code">os.environ</span>, <span class="code">getuser</span> asks the operating system.<a contenteditable="false" data-primary="" data-startref="FTOtinout11" data-type="indexterm" id="idm44924514429776"/><a contenteditable="false" data-primary="" data-startref="testinout11" data-type="indexterm" id="idm44924514428400"/></td>
</tr>
</tbody>
</table>
</div></section>
</div></section>
<section data-pdf-bookmark="Richer-Text I/O" data-type="sect1"><div class="sect1" id="richer_text_isoliduso">
<h1>Richer-Text I/O</h1>
<p>The<a contenteditable="false" data-primary="file and text operations" data-secondary="richer-text I/O" data-type="indexterm" id="FTOricher11"/><a contenteditable="false" data-primary="richer-text I/O" data-type="indexterm" id="richertextio11"/> text I/O modules covered so far supply basic text I/O functionality on all platform terminals. Most platforms also offer enhanced text I/O features, such as responding to single keypresses (not just entire lines), printing text in any terminal row and column position, and enhancing the text with background and foreground colors and font effects like bold, italic, and underline. For this kind of functionality you’ll need to consider a third-party library. We focus here on the <span class="code">readline</span> module, then take a quick look at a few console I/O options, including <span class="code">mscvrt</span>, with a brief mention of <span class="code">curses</span>, <span class="code">rich</span>, and <span class="code">colorama</span>, which we do not cover further.</p>
<section data-pdf-bookmark="The readline Module" data-type="sect2"><div class="sect2" id="the_readline_module">
<h2>The readline Module</h2>
<p>The<a contenteditable="false" data-primary="readline module" data-type="indexterm" id="idm44924514416048"/><a contenteditable="false" data-primary="standard library modules" data-secondary="readline" data-type="indexterm" id="idm44924514414944"/> <span class="code">readline</span> module wraps the<a contenteditable="false" data-primary="GNU Readline Library" data-type="indexterm" id="idm44924514412720"/> <a href="https://oreil.ly/Z0A5t">GNU Readline Library</a>, which lets the user edit text lines during interactive input and recall previous lines for editing and re-entry. Readline comes preinstalled on many Unix-like platforms, and it’s available online. On Windows, you can install and use the third-party module <a href="https://oreil.ly/9XExm"><span class="code">pyreadline</span></a>.</p>
<p>When <span class="code">readline</span> is available, Python uses it for all line-oriented input, such as <span class="code">input</span>. The interactive Python interpreter always tries to load <span class="code">readline</span> to enable line editing and recall for interactive sessions. Some <span class="code">readline</span> functions control advanced functionality: particularly <em>history</em>, for recalling lines entered in previous sessions; and <em>completion</em>, for context-sensitive completion of the word being entered. (See the <a href="https://oreil.ly/6SMkN">Python <span class="code">readline</span> docs</a> for complete details on configuration commands.) You can access the module’s functionality using the functions in <a data-type="xref" href="#functions_of_the_readline_module">Table 11-33</a>.</p>
<table class="border" id="functions_of_the_readline_module">
<caption><span class="label">Table 11-33. </span>Functions of the <span class="code">readline</span> module</caption>
<tbody>
<tr>
<td><span class="code">add_history</span></td>
<td><span class="code">add_history(<em>s</em>,</span> <span class="code"><em>/</em></span><span class="code">)</span><br/>
			Adds<a contenteditable="false" data-primary="add_history (readline module)" data-type="indexterm" id="idm44924514395936"/> string <span class="code"><em>s</em></span> as a line at the end of the history buffer. To temporarily disable <span class="code">add_history</span>, call <span class="code">set_auto_history(<strong>False</strong>)</span>, which will disable <span class="code">add_history</span> for this session only (it won’t persist across sessions); <span class="code">set_auto_history</span> is <span class="code"><strong>True</strong></span> by default.</td>
</tr>
<tr>
<td><span class="code">app⁠e⁠n⁠d⁠_​h⁠i⁠s⁠tory_file</span></td>
<td><span class="code">append_history_file(<em>n</em>,</span> <span class="code"><em>filename</em></span><span class="code">='~/.history', /)</span><br/>
			Appends the last <span class="code"><em>n</em></span> items to existing file <span class="code"><em>filename</em></span>.</td>
</tr>
<tr>
<td><span class="code">clear_history</span></td>
<td><span class="code">clear_history()</span><br/>
			Clears the history buffer.</td>
</tr>
<tr>
<td><span class="code">get_completer</span></td>
<td><span class="code">get_completer()</span><br/>
			Returns the current completer function (as last set by <span class="code">set_completer</span>), or <span class="code"><strong>None</strong></span> if no completer function is set.</td>
</tr>
<tr>
<td><span class="code">g⁠e⁠t⁠_​h⁠i⁠s⁠tory_length</span></td>
<td><span class="code">get_history_length()</span><br/>
			Returns the number of lines of history to be saved to the history file. When the result is less than <span class="code">0</span>, all lines in the history are to be saved.</td>
</tr>
<tr>
<td><span class="code">parse_and_bind</span></td>
<td><span class="code">parse_and_bind(<em>readline_cmd</em>,</span> <span class="code"><em>/</em></span><span class="code">)</span><br/>
			Gives<a contenteditable="false" data-primary="parse_and_bind (readline module)" data-type="indexterm" id="idm44924514369472"/> <span class="code">readline</span> a configuration command. To let the user hit Tab to request completion, call <span class="code">parse_and_bind('tab: complete')</span>. See the <a href="https://oreil.ly/Wv2dm"><span class="code">readline</span> documentation</a> for other useful values of the string <span class="code"><em>readline_cmd</em></span>.<br/>
			A good completion function is in the standard library module <span class="code">rlcompleter</span>. In the interactive interpreter (or in the startup file executed at the start of interactive sessions, covered in <a data-type="xref" href="ch02.xhtml#environment_variables">“Environment Variables”</a>), enter:
			<pre data-code-language="python" data-type="programlisting">
<strong><code class="kn">import</code></strong><code> </code><code class="nn">readline</code><code class="o">,</code><code> </code><code class="nn">rlcompleter</code><code>
</code><code class="n">readline</code><code class="o">.</code><code class="n">parse_and_bind</code><code class="p">(</code><code class="s1">'</code><code class="s1">tab: complete</code><code class="s1">'</code><code class="p">)</code></pre>
			For the rest of this interactive session, you can hit the Tab key during line editing and get completion for global names and object attributes.</td>
</tr>
<tr>
<td><span class="code">re⁠a⁠d⁠_​h⁠i⁠s⁠tory_file</span></td>
<td><span class="code">read_history_file(<em>filename</em>='~/.history', /)</span><br/>
			Loads<a contenteditable="false" data-primary="read_history_file (readline module)" data-type="indexterm" id="idm44924514347824"/> history lines from the text file at path <span class="code"><em>filename</em></span>.</td>
</tr>
<tr>
<td><span class="code">read_init_file</span></td>
<td><span class="code">read_init_file(<em>filename</em>=<strong>None, /</strong>)</span><br/>
			Makes <span class="code">readline</span> load a text file: each line is a configuration command. When <span class="code"><em>filename</em></span> is <span class="code"><strong>None</strong></span>, loads the same file as the last time.</td>
</tr>
<tr>
<td><span class="code">set_completer</span></td>
<td><span class="code">set_completer(<em>func, /</em>)</span><br/>
			Sets<a contenteditable="false" data-primary="set_completer (readline module)" data-type="indexterm" id="idm44924514314192"/> the completion function. When <span class="code"><em>func</em></span> is <span class="code"><strong>None</strong></span> or omitted, <span class="code">readline</span> disables completion. Otherwise, when the user types a partial word <span class="code"><em>start</em></span>, then presses the Tab key, <span class="code">readline</span> calls <span class="code"><em>func</em></span><span class="code">(<em>start</em>,</span> <span class="code"><em>i</em></span><span class="code">)</span>, with <span class="code"><em>i</em></span> initially <span class="code">0</span>. <span class="code"><em>func</em></span> returns the <span class="code"><em>i</em></span>th possible word starting with <span class="code"><em>start</em></span>, or <span class="code"><strong>None</strong></span> when there are no more. <span class="code">readline</span> loops, calling <span class="code"><em>func</em></span> with <span class="code"><em>i</em></span> set to <span class="code">0</span>, <span class="code">1</span>, <span class="code">2</span>, etc., until <span class="code"><em>func</em></span> returns <span class="code"><strong>None</strong></span>.</td>
</tr>
<tr>
<td><span class="code">s⁠e⁠t⁠_​h⁠i⁠s⁠tory_length</span></td>
<td><span class="code">set_history_length(<em>x, /</em>)</span><br/>
			Sets the number of lines of history that are to be saved to the history file. When <span class="code"><em>x</em></span> is less than <span class="code">0</span>, all lines in the history are to be saved.</td>
</tr>
<tr>
<td><span class="code">wri⁠t⁠e⁠_​h⁠i⁠s⁠tory_file</span></td>
<td><span class="code">write_history_file(<em>filename</em>='~/.history')</span><br/>
			Saves<a contenteditable="false" data-primary="write_history_file (readline module)" data-type="indexterm" id="idm44924514288000"/> history lines to the text file whose name or path is <span class="code"><em>filename</em></span>, overwriting any existing file.</td>
</tr>
</tbody>
</table>
</div></section>
<section class="pagebreak-before" data-pdf-bookmark="Console I/O" data-type="sect2"><div class="sect2" id="console_isoliduso">
<h2 class="less_space">Console I/O</h2>
<p>As<a contenteditable="false" data-primary="console I/O" data-type="indexterm" id="idm44924514283408"/> mentioned previously, “terminals” today are usually text windows on a graphical screen. You may also, in theory, use a true terminal, or (perhaps a tad less theoretically, but these days not by much) the console (main screen) of a personal computer in text mode. All such “terminals” in use today offer advanced text I/O functionality, accessed in platform-dependent ways. The low-level <span class="code">curses</span> package works on Unix-like platforms. For a cross-platform (Windows, Unix, macOS) solution, you may use the third-party package <a href="https://oreil.ly/zuTRT"><span class="code">rich</span></a>; in addition to its excellent <a href="https://oreil.ly/BHr83">online docs</a>, there are online <a href="https://oreil.ly/GYAnd">tutorials</a> to help you get started. To output<a contenteditable="false" data-primary="colored text" data-type="indexterm" id="idm44924514278528"/> colored text on the terminal, see<a contenteditable="false" data-primary="colorama package" data-type="indexterm" id="idm44924514277248"/> <span class="code">colorama</span>, available on <a href="https://oreil.ly/JVE1a">PyPI</a>. <span class="code">msvcrt</span>, introduced next, provides some low-level (Windows only) functions.</p>
<section data-pdf-bookmark="curses" data-type="sect3"><div class="sect3" id="curses">
<h3>curses</h3>
<p>The<a contenteditable="false" data-primary="curses module" data-type="indexterm" id="idm44924514272224"/><a contenteditable="false" data-primary="standard library modules" data-secondary="curses" data-type="indexterm" id="idm44924514271120"/> classic Unix approach to enhanced terminal I/O is named <span class="code">curses</span>, for obscure historical reasons.<sup><a data-type="noteref" href="ch11.xhtml#ch01fn104" id="ch01fn104-marker">4</a></sup> The Python package <span class="code">curses</span> lets you exert detailed control if required. We don’t cover <span class="code">curses</span> in this book; for more information, see A.M. Kuchling’s and Eric Raymond’s online tutorial <a href="https://oreil.ly/Pbpbh">“Curses Programming with Python”</a>.</p>
</div></section>
<section data-pdf-bookmark="The msvcrt module" data-type="sect3"><div class="sect3" id="the_msvcrt_module">
<h3>The msvcrt module</h3>
<p>The<a contenteditable="false" data-primary="msvcrt module" data-type="indexterm" id="idm44924514263536"/> Windows-only <span class="code">msvcrt</span> module (which you may need to install with <span class="code">pip</span>) supplies a few low-level functions that let Python programs access proprietary extras supplied by the Microsoft Visual C++ runtime library <em>msvcrt.dll</em>. For example, the functions listed in <a data-type="xref" href="#some_useful_functions_of_the_msvcrt_mod">Table 11-34</a> let you read user input character by character rather than reading a full line at a time.</p>
<table class="border" id="some_useful_functions_of_the_msvcrt_mod">
<caption><span class="label">Table 11-34. </span>Some useful functions of the <span class="code">msvcrt</span> module</caption>
<tbody>
<tr>
<td><span class="code">getch</span>,<br/>
<span class="code">getche</span></td>
<td><span class="code">getch()</span>,<span class="code"> getche()</span><br/>
			Reads<a contenteditable="false" data-primary="getch (msvcrt module)" data-type="indexterm" id="idm44924514252800"/> and returns a single-character bytes from keyboard input, and if necessary blocks until one is available (i.e., a key is pressed). <span class="code">getche</span> echoes the character to screen (if printable), while <span class="code">getch</span> does not. When the user presses a special key (arrows, function keys, etc.), it’s seen as two characters: first a <span class="code">chr(0)</span> or <span class="code">chr(224)</span>, then a second character that, together with the first one, defines the special key the user pressed. This means that the program must call <span class="code">getch</span> or <span class="code">getche</span> twice to read these key presses. To find out what <span class="code">getch</span> returns for any key, run the following small script on a Windows machine:
			<pre data-code-language="python" data-type="programlisting">
<strong><code class="kn">import</code></strong><code> </code><code class="nn">msvcrt</code><code>
</code><code class="nb">print</code><code class="p">(</code><code class="s2">"</code><code class="s2">press z to exit, or any other key </code><code class="s2">"</code><code>
</code><code>      </code><code class="s2">"</code><code class="s2">to see the key</code><code class="s2">'</code><code class="s2">s code:</code><code class="s2">"</code><code class="p">)</code><code>
</code><strong><code class="k">while</code><code> </code><code class="kc">True</code></strong><code class="p">:</code><code>
</code><code>    </code><code class="n">c</code><code> </code><code class="o">=</code><code> </code><code class="n">msvcrt</code><code class="o">.</code><code class="n">getch</code><code class="p">(</code><code class="p">)</code><code>
</code><code>    </code><strong><code class="k">if</code></strong><code> </code><code class="n">c</code><code> </code><code class="o">==</code><code> </code><code class="sa">b</code><code class="s1">'</code><code class="s1">z</code><code class="s1">'</code><code class="p">:</code><code>
</code><code>        </code><strong><code class="k">break</code></strong><code>
</code><code>    </code><code class="nb">print</code><code class="p">(</code><code class="sa">f</code><code class="s1">'</code><code class="si">{</code><code class="nb">ord</code><code class="p">(</code><code class="n">c</code><code class="p">)</code><code class="si">}</code><code class="s1"> (</code><code class="si">{</code><code class="n">c</code><code class="si">!r}</code><code class="s1">)</code><code class="s1">'</code><code class="p">)</code></pre>
</td>
</tr>
<tr>
<td><span class="code">kbhit</span></td>
<td><span class="code">kbhit()</span><br/>
			Returns <span class="code"><strong>True</strong></span> when a character is available for reading (<span class="code">getch</span>, when called, returns immediately); otherwise, returns <span class="code"><strong>False</strong></span> (<span class="code">getch</span>, when called, waits).</td>
</tr>
<tr>
<td><span class="code">ungetch</span></td>
<td><span class="code">ungetch(<em>c</em>)</span><br/>
			“Ungets” character<a contenteditable="false" data-primary="ungetch (msvcrt module)" data-type="indexterm" id="idm44924514186928"/> <span class="code"><em>c</em></span>; the next call to <span class="code">getch</span> or <span class="code">getche</span> returns <span class="code"><em>c</em></span>. It’s an error to call <span class="code">ungetch</span> twice without intervening calls to <span class="code">getch</span> or <span class="code">getche</span>.<a contenteditable="false" data-primary="" data-startref="FTOricher11" data-type="indexterm" id="idm44924514147312"/><a contenteditable="false" data-primary="" data-startref="richertextio11" data-type="indexterm" id="idm44924514146096"/></td>
</tr>
</tbody>
</table>
</div></section>
</div></section>
</div></section>
<section data-pdf-bookmark="Internationalization" data-type="sect1"><div class="sect1" id="internationalization">
<h1>Internationalization</h1>
<p>Many<a contenteditable="false" data-primary="file and text operations" data-secondary="internationalization" data-type="indexterm" id="FTOinter11"/><a contenteditable="false" data-primary="internationalization (i18n)" data-type="indexterm" id="inter11"/><a contenteditable="false" data-primary="i18n (internationalization)" data-type="indexterm" id="i18n11"/> programs present some information to users as text. Such text should be understandable and acceptable to users in different locales. For example, in some countries and cultures, the date “March 7” can be concisely expressed as “3/7.” Elsewhere, “3/7” indicates “July 3,” and the string that means “March 7” is “7/3.” In Python, such<a contenteditable="false" data-primary="cultural conventions" data-type="indexterm" id="idm44924514138128"/> cultural conventions are handled with the help of the standard library module <span class="code">locale</span>.</p>
<p>Similarly, a greeting might be expressed in one natural language by the string “Benvenuti,” while in another language the string to use is “Welcome.” In Python, such translations are handled with the help of the stdlib module <span class="code">gettext</span>.</p>
<p>Both kinds of issues are commonly addressed under the umbrella term <em>internationalization</em> (often abbreviated <em>i18n</em>, as there are 18 letters between <em>i</em> and <em>n</em> in the full spelling in English)—a misnomer, since the same issues apply not just between nations, but also to different languages or cultures within a single nation.<sup><a data-type="noteref" href="ch11.xhtml#ch01fn105" id="ch01fn105-marker">5</a></sup></p>
<section data-pdf-bookmark="The locale Module" data-type="sect2"><div class="sect2" id="the_locale_module">
<h2>The locale Module</h2>
<p>Python’s support<a contenteditable="false" data-primary="locale module" data-type="indexterm" id="localmod11"/><a contenteditable="false" data-primary="standard library modules" data-secondary="locale" data-type="indexterm" id="SLMlocale11"/> for cultural conventions imitates that of C, slightly simplified. A program operates in an environment of cultural conventions known as a <em>locale</em>. The locale setting permeates the program and is typically set at program startup. The locale is not thread-specific, and the <span class="code">locale</span> module is not thread-safe. In a multithreaded program, set the program’s locale in the main thread; i.e., set it before starting secondary threads.</p>
<div data-type="warning" epub:type="warning">
<h1>Limitations of locale</h1>
<p><span class="code">locale</span> is only useful for process-wide settings. If your application needs to handle multiple locales at the same time in a single process—whether in threads or asynchronously—<span class="code">locale</span> is not the answer due to its process-wide nature. Consider, instead, alternatives such as <a href="https://pypi.org/project/PyICU">PyICU</a>, mentioned in <a data-type="xref" href="#more_internationalization_resources">“More Internationalization Resources”</a>.</p>
</div>
<p>If a program does not call <span class="code">locale.setlocale</span>, the <em>C locale</em> (so called due to Python’s C language roots) is used; it’s similar, but not identical, to the US English locale. Alternatively, a program can find out and accept the user’s default locale. In this case, the <span class="code">locale</span> module interacts with the operating system (via the environment or in other system-dependent ways) to try to find the user’s preferred locale. Finally, a program can set a specific locale, presumably determining which locale to set on the basis of user interaction or via persistent configuration settings.</p>
<p>Locale setting is normally performed across the board for all relevant categories of cultural conventions. This common wide-spectrum setting is denoted by the constant attribute <span class="code">LC_ALL</span> of the <span class="code">locale</span> module. However, the cultural conventions handled by <span class="code">locale</span> are grouped into categories, and, in some rare cases, a program can choose to mix and match categories to build up a synthetic composite locale. The categories are identified by the attributes listed in <a data-type="xref" href="#constant_attributes_of_the_locale_modul">Table 11-35</a>.</p>
<table class="border pagebreak-before less_space" id="constant_attributes_of_the_locale_modul">
<caption><span class="label">Table 11-35. </span>Constant attributes of the <span class="code">locale</span> module</caption>
<tbody>
<tr>
<td><span class="code">LC_COLLATE</span></td>
<td>String sorting; affects functions <span class="code">strcoll</span> and <span class="code">strxfrm</span> in <span class="code">locale</span></td>
</tr>
<tr>
<td><span class="code">LC_CTYPE</span></td>
<td>Character types; affects aspects of module <span class="code">string</span> (and string methods) that have to do with lowercase and uppercase letters</td>
</tr>
<tr>
<td><span class="code">LC_MESSAGES</span></td>
<td>Messages; may affect messages displayed by the operating system (for example, messages displayed by function <span class="code">os.strerror</span> and module <span class="code">gettext</span>)</td>
</tr>
<tr>
<td><span class="code">LC_MONETARY</span></td>
<td>Formatting of<a contenteditable="false" data-primary="currency values" data-type="indexterm" id="curval11"/> currency values; affects functions <span class="code">localeconv</span> and <span class="code">currency</span> in <span class="code">locale</span></td>
</tr>
<tr>
<td><span class="code">LC_NUMERIC</span></td>
<td>Formatting of numbers; affects functions <span class="code">atoi</span>, <span class="code">atof</span>, <span class="code">format_string</span>, <span class="code">localeconv</span>, and <span class="code">str</span> in <span class="code">locale</span>, as well as the number separators used in format strings (e.g., f-strings and str.format) when format character <span class="code">'n'</span> is used</td>
</tr>
<tr>
<td><span class="code">LC_TIME</span></td>
<td>Formatting of times and dates; affects the function <span class="code">time.strftime</span></td>
</tr>
</tbody>
</table>
<p>The settings of some categories (denoted by <span class="code">LC_CTYPE</span>, <span class="code">LC_MESSAGES</span>, and <span class="code">LC_TIME</span>) affect behavior in other modules (<span class="code">string</span>, <span class="code">os</span>, <span class="code">gettext</span>, and <span class="code">time</span>, as indicated). Other categories (denoted by <span class="code">LC_COLLATE</span>, <span class="code">LC_MONETARY</span>, and <span class="code">LC_NUMERIC</span>) affect only some functions of <span class="code">locale</span> itself (plus string formatting in the case of <span class="code">LC_NUMERIC</span>).</p>
<p>The <span class="code">locale</span> module supplies the functions listed in <a data-type="xref" href="#useful_functions_of_the_locale_module">Table 11-36</a> to query, change, and manipulate locales, as well as functions that implement the cultural conventions of locale categories <span class="code">LC_COLLATE</span>, <span class="code">LC_MONETARY</span>, and <span class="code">LC_NUMERIC</span>.</p>
<table class="border" id="useful_functions_of_the_locale_module">
<caption><span class="label">Table 11-36. </span>Useful functions of the <span class="code">locale</span> module</caption>
<tbody>
<tr>
<td class="width-12"><span class="code">atof</span></td>
<td><span class="code">atof(<em>s</em>)</span><br/>
			Parses the string <span class="code"><em>s</em></span> into a floating-point number using the current <span class="code">LC_NUMERIC</span> setting.</td>
</tr>
<tr>
<td><span class="code">atoi</span></td>
<td><span class="code">atoi(<em>s</em>)</span><br/>
			Parses the string <span class="code"><em>s</em></span> into an integer number using the current <span class="code">LC_NUMERIC</span> setting.</td>
</tr>
<tr>
<td><span class="code">currency</span></td>
<td><span class="code">currency(</span><span class="code"><em>data,</em></span> <span class="code">grouping=<strong>False</strong>, international=<strong>False</strong>)</span><br/>
			Returns<a contenteditable="false" data-primary="currency (locale module)" data-type="indexterm" id="idm44924514058208"/> the string or number <span class="code"><em>data</em></span> with a currency symbol, and, if <span class="code">grouping</span> is <span class="code"><strong>True</strong></span>, uses the monetary thousands separator and grouping. When <span class="code">international</span> is <span class="code"><strong>True</strong></span>, uses <span class="code">int_curr_symbol</span> and <span class="code">int_frac_digits</span>, described later in this table.</td>
</tr>
<tr>
<td><span class="code">f⁠o⁠r⁠m⁠a⁠t⁠_​s⁠t⁠r⁠i⁠n⁠g</span></td>
<td><span class="code">format_string(<em>fmt</em>,</span> <span class="code"><em>num</em></span><span class="code">, grouping=<strong>False</strong>, monetary=<strong>False</strong>)</span><br/>
			Returns the string obtained by formatting <span class="code"><em>num</em></span> according to the format string <span class="code"><em>fmt</em></span> and the <span class="code">LC_NUMERIC</span> or <span class="code">LC_MONETARY</span> settings. Except for cultural convention issues, the result is like old-style <span class="code"><em>fmt</em></span> <span class="code">%</span> <span class="code"><em>num</em></span> string formatting, covered in <a data-type="xref" href="ch09.xhtml#legacy_string_formatting_with_percent">“Legacy String Formatting with %”</a>. If <span class="code"><em>num</em></span> is an instance of a number type and <span class="code"><em>fmt</em></span> is <span class="code"><em>%d</em></span> or <span class="code"><em>%f</em></span>, set <span class="code">grouping</span> to <span class="code"><strong>True</strong></span> to group digits in the result string according to the <span class="code">LC_NUMERIC</span> setting. If <span class="code">monetary</span> is <span class="code"><strong>True</strong></span>, the string is formatted with <span class="code">mon_decimal_point</span>, and <span class="code"><em>grouping</em></span> uses <span class="code">mon_thousands_sep</span> and <span class="code">mon_grouping</span> instead of the ones supplied by <span class="code">LC_NUMERIC</span> (see <span class="code">localeconv</span> later in this table for more information on these). For example:
			<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">locale</code><code class="o">.</code><code class="n">setlocale</code><code class="p">(</code><code class="n">locale</code><code class="o">.</code><code class="n">LC_NUMERIC</code><code class="p">,</code> 
<code class="o">...</code>                  <code class="s1">'en_us'</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>'en_us'</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">n</code><code class="o">=</code><code class="mi">1000</code><code class="o">*</code><code class="mi">1000</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">locale</code><code class="o">.</code><code class="n">format_string</code><code class="p">(</code><code class="s1">'</code><code class="si">%d</code><code class="s1">'</code><code class="p">,</code> <code class="n">n</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>'1000000'</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">locale</code><code class="o">.</code><code class="n">setlocale</code><code class="p">(</code><code class="n">locale</code><code class="o">.</code><code class="n">LC_MONETARY</code><code class="p">,</code> 
<code class="o">...</code>                  <code class="s1">'it_it'</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>'it_it'</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">locale</code><code class="o">.</code><code class="n">format_string</code><code class="p">(</code><code class="s1">'</code><code class="si">%f</code><code class="s1">'</code><code class="p">,</code> <code class="n">n</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>'1000000.000000' </strong> <em># uses decimal_point</em></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">locale</code><code class="o">.</code><code class="n">format_string</code><code class="p">(</code><code class="s1">'</code><code class="si">%f</code><code class="s1">'</code><code class="p">,</code> <code class="n">n</code><code class="p">,</code> 
<code class="o">...</code>                      <code class="n">monetary</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>'1000000,000000' </strong> <em># uses mon_decimal_point</em></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">locale</code><code class="o">.</code><code class="n">format_string</code><code class="p">(</code><code class="s1">'</code><code class="si">%0.2f</code><code class="s1">'</code><code class="p">,</code> <code class="n">n</code><code class="p">,</code> 
<code class="o">...</code>                      <code class="n">grouping</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>'1,000,000.00'    </strong><em># separators &amp; decimal from</em>
<em>                  # LC_NUMERIC</em></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">locale</code><code class="o">.</code><code class="n">format_string</code><code class="p">(</code><code class="s1">'</code><code class="si">%0.2f</code><code class="s1">'</code><code class="p">,</code> <code class="n">n</code><code class="p">,</code> 
<code class="o">...</code>                      <code class="n">grouping</code><code class="o">=</code><code class="kc">True</code><code class="p">,</code>
<code class="o">...</code>                      <code class="n">monetary</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>'1.000.000,00'   </strong> <em># separators &amp; decimal from</em> 
<em>                  # LC_MONETARY</em></pre>
			In this example, since the numeric locale is set to US English, when the argument <span class="code">grouping</span> is <span class="code"><strong>True</strong></span>, <span class="code">format_string</span> groups digits by threes with commas and uses a dot (<span class="code">.</span>) for the decimal point. However, the monetary locale is set to Italian, so when the argument <span class="code">monetary</span> is <span class="code"><strong>True</strong></span>, <span class="code">format_string</span> uses a comma (<span class="code">,</span>) for the decimal point and <span class="code">grouping</span> uses a dot (<span class="code">.</span>) for the thousands separator. Usually, the syntaxes for monetary and nonmonetary numbers are equal within any given locale.</td>
</tr>
<tr>
<td><span class="code">g⁠e⁠t​d⁠e⁠f⁠a⁠u⁠l⁠t​l⁠o⁠c⁠a⁠l⁠e</span></td>
<td><span class="code">getdefaultlocale(envvars=('LANGUAGE', 'LC_ALL', 'LC_TYPE', 'LANG'))</span><br/>
			Checks<a contenteditable="false" data-primary="getdefaultlocale (locale module)" data-type="indexterm" id="idm44924513762208"/> the environment variables whose names are specified by <span class="code">envvars</span>, in order. The first one found in the environment determines the default locale. <span class="code">getdefaultlocale</span> returns a pair of strings <span class="code">(<em>lang</em>,</span> <span class="code"><em>encoding</em></span><span class="code">)</span> compliant with <a href="https://oreil.ly/BbYK1">RFC 1766</a> (except for the <span class="code">'C'</span> locale), such as <span class="code">('en_US'</span>, <span class="code">'UTF-8')</span>. Each item of the pair may be <span class="code"><strong>None</strong></span> if <span class="code">gedefaultlocale</span> is unable to discover what value the item should have.</td>
</tr>
<tr>
<td><span class="code">g⁠e⁠t​l⁠o⁠c⁠a⁠l⁠e</span></td>
<td><span class="code">getlocale(category=LC_CTYPE)</span><br/>
			Returns<a contenteditable="false" data-primary="getlocale (locale module)" data-type="indexterm" id="idm44924513730512"/> a pair of strings <span class="code">(<em>lang, encoding</em>)</span> with the current setting for the given <span class="code keep-together">category</span>. The category cannot be <span class="code">LC_ALL</span>.</td>
</tr>
<tr>
<td><span class="code">localeconv</span></td>
<td><span class="code">localeconv()</span><br/>
			Returns a <span class="code">dict</span> <span class="code"><em>d</em></span> with the cultural conventions specified by categories <span class="code">LC_NUMERIC</span> and <span class="code">LC_MONETARY</span> of the current locale. While <span class="code">LC_NUMERIC</span> is best used indirectly, via other functions of <span class="code">locale</span>, the details of <span class="code">LC_MONETARY</span> are accessible only through <span class="code"><em>d</em></span>. Currency formatting is different for local and international use. For example, the <span class="code">'$'</span> symbol is for <em>local</em> use only; it is ambiguous in <em>international</em> use, since the same symbol is used for many currencies called “dollars” (US, Canadian, Australian, Hong Kong, etc.). In international use, therefore, the symbol for US currency is the unambiguous string <span class="code">'USD'</span>. The function temporarily sets the <span class="code">LC_CTYPE</span> locale to the <span class="code">LC_NUMERIC</span> locale, or the <span class="code">LC_MONETARY</span> locale if the locales are different and the numeric or monetary strings are non-ASCII. This temporary change affects all threads. The keys into <span class="code"><em>d</em></span> to use for currency formatting are the following strings:
			<dl>
<dt class="plain"><span class="code">'currency_symbol'</span></dt>
<dd>Currency symbol to use locally</dd>
<dt class="plain"><span class="code">'frac_digits'</span></dt>
<dd>Number of fractional digits to use locally</dd>
<dt class="plain"><span class="code">'int_curr_symbol'</span></dt>
<dd>Currency symbol to use internationally</dd>
<dt class="plain"><span class="code">'int_frac_digits'</span></dt>
<dd>Number of fractional digits to use internationally</dd>
<dt class="plain"><span class="code">'mon_decimal_point'</span></dt>
<dd>String to use as the “decimal point” (aka <em>radix point</em>) for monetary values</dd>
<dt class="plain"><span class="code">'mon_grouping'</span></dt>
<dd>List of digit-grouping numbers for monetary values</dd>
<dt class="plain"><span class="code">'mon_thousands_sep'</span></dt>
<dd>String to use as digit-groups separator for monetary values</dd>
<dt class="plain"><span class="code">'negative_sign'</span>, <span class="code">'positive_sign'</span></dt>
<dd>Strings to use as the sign symbol for negative (positive) monetary values</dd>
<dt class="plain"><span class="code">'n_cs_precedes'</span>, <span class="code">'p_cs_precedes'</span></dt>
<dd><span class="code"><strong>True</strong></span> when the currency symbol comes before negative (positive) monetary values</dd>
<dt class="plain"><span class="code">'n_sep_by_space'</span>, <span class="code">'p_sep_by_space'</span></dt>
<dd><span class="code"><strong>True</strong></span> when a space goes between the sign and negative (positive) monetary values</dd>
<dt class="plain"><span class="code">'n_sign_posn'</span>, <span class="code">'p_sign_posn'</span></dt>
<dd>See <a data-type="xref" href="#numeric_codes">Table 11-37</a> for a list of numberic codes for formating negative (positive) monetary values.</dd>
<dt class="plain"><span class="code">CHAR_MAX</span></dt>
<dd>Indicates that the current locale does not specify any convention for this formatting</dd>
</dl>
</td>
</tr>
<tr>
<td><span class="code">localeconv</span><br/>
<em>(cont.)</em></td>
<td><span class="code"><em>d</em></span><span class="code">['mon_grouping']</span> is a list of numbers of digits to group when formatting a monetary value (but take care: in some locales, <span class="code"><em>d</em></span><span class="code">['mon_grouping']</span> may be an empty list). When <span class="code"><em>d</em></span><span class="code">['mon_grouping'][-1]</span> is <span class="code">0</span>, there is no further grouping beyond the indicated numbers of digits. When <span class="code"><em>d</em></span><span class="code">['mon_grouping'][-1]</span> is <span class="code">locale.CHAR_MAX</span>, grouping continues indefinitely, as if <span class="code"><em>d</em></span><span class="code">['mon_grouping'][-2]</span> were endlessly repeated. <span class="code">locale.CHAR_MAX</span> is a constant used as the value for all entries in <span class="code"><em>d</em></span> for which the current locale does not specify any convention.<a contenteditable="false" data-primary="" data-startref="curval11" data-type="indexterm" id="idm44924513675280"/></td>
</tr>
<tr>
<td><span class="code">localize</span></td>
<td><span class="code">localize(<em>normstr</em>, grouping=<strong>False</strong>, monetary=<strong>False</strong>)</span><br/>
			Returns<a contenteditable="false" data-primary="localize (locale module)" data-type="indexterm" id="idm44924513670224"/> a formatted string following <span class="code">LC_NUMERIC</span> (or <span class="code">LC_MONETARY</span>, when <span class="code">monetary</span> is <span class="code"><strong>True</strong></span>) settings from normalized numeric string <span class="code"><em>normstr</em></span>.</td>
</tr>
<tr>
<td><span class="code">normalize</span></td>
<td><span class="code">normalize(<em>localename</em>)</span><br/>
			Returns a string, suitable as an argument to <span class="code">setlocale</span>, that is the normalized form for <span class="code"><em>localename</em></span>. When <span class="code">normalize</span> cannot normalize the string <span class="code"><em>localename</em></span>, it returns <span class="code"><em>localename</em></span> unchanged.</td>
</tr>
<tr>
<td><span class="code">re⁠s⁠e⁠t​l⁠o⁠c⁠ale</span></td>
<td><span class="code">resetlocale(category=LC_ALL)</span><br/>
			Sets the locale for <span class="code">category</span> to the default given by <span class="code">getdefaultlocale</span>.</td>
</tr>
<tr>
<td><span class="code">s⁠e⁠t​l⁠o⁠c⁠a⁠l⁠e</span></td>
<td><span class="code">setlocale(<em>category</em>, locale=<strong>None</strong>)</span><br/>
			Sets the locale for <span class="code"><em>category</em></span> to <span class="code">locale</span>, if not <span class="code"><strong>None</strong></span>, and returns the setting (the existing one when <span class="code">locale</span> is <span class="code"><strong>None</strong></span>; otherwise, the new one). <span class="code">locale</span> can be a string, or a pair <span class="code">(<em>lang</em>,</span> <span class="code"><em>encoding</em></span><span class="code">)</span>. <span class="code"><em>lang</em></span> is normally a language code based on <a href="https://oreil.ly/aT8Js">ISO 639</a> two-letter codes (<span class="code">'en'</span> is English, <span class="code">'nl'</span> is Dutch, and so on). When <span class="code">locale</span> is the empty string <span class="code">''</span>, <span class="code">setlocale</span> sets the user’s default locale. To see valid locales, view the <span class="code">locale.locale_alias</span> dictionary.</td>
</tr>
<tr>
<td><span class="code">str</span></td>
<td><span class="code">str(<em>num</em>)</span><br/>
			Like <span class="code">locale.format_string('%f',</span> <span class="code"><em>num</em></span><span class="code">)</span>.</td>
</tr>
<tr>
<td><span class="code">strcoll</span></td>
<td><span class="code">strcoll(<em>str1</em>,</span> <span class="code"><em>str2</em></span><span class="code">)</span><br/>
			Respecting the <span class="code">LC_COLLATE</span> setting, returns <span class="code">-1</span> when <span class="code"><em>str1</em></span> comes before <span class="code"><em>str2</em></span> in collation, <span class="code">1</span> when <span class="code"><em>str2</em></span> comes before <span class="code"><em>str1</em></span>, and <span class="code">0</span> when the two strings are equivalent for collation purposes.</td>
</tr>
<tr>
<td><span class="code">strxfrm</span></td>
<td><span class="code">strxfrm(<em>s</em>)</span><br/>
			Returns a string <span class="code"><em>sx</em></span> such that Python’s built-in comparisons of two or more strings so transformed is like calling <span class="code">locale.strcoll</span> on the originals. <span class="code">strxfrm</span> lets you easily use the <span class="code">key</span> argument for sorts and comparisons needing locale-conformant string<a contenteditable="false" data-primary="" data-startref="localmod11" data-type="indexterm" id="idm44924513616096"/><a contenteditable="false" data-primary="" data-startref="SLMlocale11" data-type="indexterm" id="idm44924513614640"/> comparisons. For example,
			<pre data-code-language="python" data-type="programlisting">
<strong><code class="k">def</code></strong><code> </code><code class="nf">locale_sort_inplace</code><code class="p">(</code><code class="n">list_of_strings</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="n">list_of_strings</code><code class="o">.</code><code class="n">sort</code><code class="p">(</code><code class="n">key</code><code class="o">=</code><code class="n">locale</code><code class="o">.</code><code class="n">strxfrm</code><code class="p">)</code></pre>
</td>
</tr>
</tbody>
</table>
<table class="border" id="numeric_codes">
<caption class="width-full"><span class="label">Table 11-37. </span>Numeric codes to format monetary values</caption>
<tbody>
<tr>
<td><span class="code">0</span></td>
<td>The value and the currency symbol are placed inside parentheses</td>
</tr>
<tr>
<td><span class="code">1</span></td>
<td>The sign is placed before the value and the currency symbol</td>
</tr>
<tr>
<td><span class="code">2</span></td>
<td>The sign is placed after the value and the currency symbol</td>
</tr>
<tr>
<td><span class="code">3</span></td>
<td>The sign is placed immediately before the value</td>
</tr>
<tr>
<td><span class="code">4</span></td>
<td>The sign is placed immediately after the value</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="The gettext Module" data-type="sect2"><div class="sect2" id="the_gettext_module">
<h2>The gettext Module</h2>
<p>A<a contenteditable="false" data-primary="gettext module" data-type="indexterm" id="gettextmod11"/><a contenteditable="false" data-primary="localization (l10n)" data-type="indexterm" id="loal11"/><a contenteditable="false" data-primary="l10n (localization)" data-type="indexterm" id="l10n11"/><a contenteditable="false" data-primary="standard library modules" data-secondary="gettext" data-type="indexterm" id="SLMgettext11"/> key issue in internationalization is the ability to use text in different natural languages, a task known as <em>localization</em> (sometimes <em>l10n</em>). Python supports localization via the standard library module <span class="code">gettext</span>, inspired by GNU <span class="code">gettext</span>. The <span class="code">gettext</span> module is optionally able to use the latter’s infrastructure and APIs, but also offers a simpler, higher-level approach, so you don’t need to install or study GNU <span class="code">gettext</span> to use Python’s <span class="code">gettext</span> effectively.</p>
<p>For full coverage of <span class="code">gettext</span> from a different perspective, see the <a href="https://oreil.ly/43fgn">online docs</a>.</p>
<section data-pdf-bookmark="Using gettext for localization" data-type="sect3"><div class="sect3" id="using_gettext_for_localization">
<h3>Using gettext for localization</h3>
<p><span class="code">gettext</span> does not deal with automatic translation between natural languages. Rather, it helps you extract, organize, and access the text messages that your program uses. Pass<a contenteditable="false" data-primary="_ (underscore)" data-secondary="with gettext module" data-secondary-sortas="gettext module" data-type="indexterm" id="idm44924513545984"/><a contenteditable="false" data-primary="underscore (_)" data-secondary="with gettext module" data-secondary-sortas="gettext module" data-type="indexterm" id="idm44924513544368"/> each string literal subject to translation, also known as a <em>message</em>, to a function named <span class="code">_</span> (underscore) rather than using it directly. <span class="code">gettext</span> normally installs a function named <span class="code">_</span> in the <span class="code">builtins</span> module. To ensure that your program runs with or without <span class="code">gettext</span>, conditionally define a do-nothing function, named <span class="code">_</span>, that just returns its argument unchanged. Then you can safely use <span class="code">_('<em>message</em>')</span> wherever you would normally use a literal <span class="code">'<em>message</em>'</span> that should be translated, if feasible. The following example shows how to start a module for conditional use of <span class="code">gettext</span>:</p>
<pre data-code-language="python" data-type="programlisting">
<strong><code class="k">try</code></strong><code class="p">:</code><code>
</code><code>    </code><code class="n">_</code><code>
</code><strong><code class="k">except</code></strong><code> </code><code class="ne">NameError</code><code class="p">:</code><code>
</code><code>    </code><strong><code class="k">def</code></strong><code> </code><code class="nf">_</code><code class="p">(</code><code class="n">s</code><code class="p">)</code><code class="p">:</code><code> </code><strong><code class="k">return</code></strong><code> </code><code class="n">s</code><code>
</code><strong><code class="k">def</code></strong><code> </code><code class="nf">greet</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="nb">print</code><code class="p">(</code><code class="n">_</code><code class="p">(</code><code class="s1">'</code><code class="s1">Hello world</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code></pre>
<p>If some other module has installed <span class="code">gettext</span> before you run this example code, the function <span class="code">greet</span> outputs a properly localized greeting. Otherwise, <span class="code">greet</span> outputs the string <span class="code">'Hello world'</span> unchanged.</p>
<p>Edit your source, decorating message literals with the function <span class="code">_</span>. Then use any of various tools to extract messages into a text file (normally named <em>messages.pot</em>) and distribute the file to the people who translate messages into the various natural languages your application must support. Python supplies a script <em>pygettext.py</em> (in the directory <em>Tools/i18n</em> in the Python source distribution) to perform message extraction on your Python sources.</p>
<p>Each translator edits <em>messages.pot</em> to produce a text file of translated messages, with extension <em>.po.</em> Compile the <em>.po</em> files into binary files with extension <em>.mo</em>, suitable for fast searching, using any of various tools. Python supplies a script <em>msgfmt.py</em> (also in <em>Tools/i18n</em>) for this purpose. Finally, install each <em>.mo</em> file with a suitable name in a suitable directory.</p>
<p>Conventions about which directories and names are suitable differ among platforms and applications. <span class="code">gettext</span>’s default is subdirectory <em>share/locale/&lt;lang&gt;/LC_MESSAGES/</em> of directory <em>sys.prefix</em>, where <em>&lt;lang&gt;</em> is the language’s code (two letters). Each file is named <em>&lt;name&gt;.mo</em>, where <em>&lt;name&gt;</em> is the name of your application or package.</p>
<p>Once you have prepared and installed your <em>.mo</em> files, you normally execute, at the time your application starts up, some code such as the following:</p>
<pre data-code-language="python" data-type="programlisting">
<strong><code class="kn">import</code></strong><code> </code><code class="nn">os</code><code class="o">,</code><code> </code><code class="nn">gettext</code><code>
</code><code class="n">os</code><code class="o">.</code><code class="n">environ</code><code class="o">.</code><code class="n">setdefault</code><code class="p">(</code><code class="s1">'</code><code class="s1">LANG</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">en</code><code class="s1">'</code><code class="p">)</code><code>  </code><em><code class="c1"># application-default</code></em><code class="c1"> </code><em><code class="c1">language</code></em><code>
</code><code class="n">gettext</code><code class="o">.</code><code class="n">install</code><code class="p">(</code><code class="s1">'</code><code class="s1">your_application_name</code><code class="s1">'</code><code class="p">)</code></pre>
<p>This ensures that calls such as <span class="code">_('message')</span> return the appropriate translated strings. You can choose different ways to access <span class="code">gettext</span> functionality in your program; for example, if you also need to localize C-coded extensions, or to switch between languages during a run. Another important consideration is whether you’re localizing a whole application, or just a package that is distributed separately.</p>
</div></section>
<section data-pdf-bookmark="Essential gettext functions" data-type="sect3"><div class="sect3" id="essential_gettext_functions">
<h3>Essential gettext functions</h3>
<p><span class="code">gettext</span> supplies many functions. The most often used functions are listed in <a data-type="xref" href="#useful_functions_of_the_gettext_module">Table 11-38</a>; see the <a href="https://oreil.ly/Yk1yv">online docs</a> for a complete list.</p>
<table class="border" id="useful_functions_of_the_gettext_module">
<caption><span class="label">Table 11-38. </span>Useful functions of the <span class="code">gettext</span> module</caption>
<tbody>
<tr>
<td class="width-15"><span class="code">install</span></td>
<td><span class="code">install(<em>domain</em>, localedir=<strong>None</strong>, names=<strong>None</strong>)</span><br/>
			Installs in Python’s built-in namespace a function named <span class="code">_</span> to perform translations given in the file <em>&lt;lang&gt;/LC_MESSAGES/&lt;domain&gt;.mo</em> in the directory <span class="code">localedir</span>, with language code <em>&lt;lang&gt;</em> as per <span class="code">getdefaultlocale</span>. When <span class="code">localedir</span> is <span class="code"><strong>None</strong></span>, <span class="code">install</span> uses the directory <span class="code">os.path.join(sys.prefix, 'share', 'locale')</span>. When <span class="code">names</span> is provided, it must be a sequence containing the names of functions you want to install in the <span class="code">builtins</span> namespace in addition to <span class="code">_</span>. Supported names are <span class="code">'gettext'</span>, <span class="code">'lgettext'</span>, <span class="code">'lngettext'</span>, <span class="code">'ngettext'</span>, <span class="version">3.8+</span> <span class="code">'npgettext'</span>, and <span class="version">3.8+</span> <span class="code">'pgettext'</span>.</td>
</tr>
<tr>
<td><span class="code">translation</span></td>
<td><span class="code">translation(<em>domain</em>, localedir=<strong>None</strong>, languages=<strong>None</strong>, class_=<strong>None</strong>, fallback=<strong>False</strong>)</span><br/>
			Searches for a <em>.mo</em> file, like the <span class="code">install</span> function; if it finds multiple files, <span class="code">translation</span> uses later files as fallbacks for earlier ones. Set <span class="code">fallback</span> to <span class="code"><strong>True</strong></span> to return a <span class="code">NullTranslations</span> instance; otherwise, the function raises <span class="code">OSError</span> when it doesn’t find any <em>.mo</em> file.<br/>
			When <span class="code">languages</span> is <span class="code"><strong>None</strong></span>, <span class="code">translation</span> looks in the environment for the <em>&lt;lang&gt;</em> to use, like <span class="code">install</span>. It examines, in order, the environment variables <span class="code">LANGUAGE</span>, <span class="code">LC_ALL</span>, <span class="code">LC_MESSAGES</span>, and <span class="code">LANG</span>, and splits the first nonempty one on <span class="code">':'</span> to give a list of language names (for example, it splits <span class="code">'de:en'</span> into <span class="code">['de', 'en']</span>). When not <span class="code"><strong>None</strong></span>, <span class="code">languages</span> must be a list of one or more language names (for example, <span class="code">['de', 'en']</span>). <span class="code">translation</span> uses the first language name in the list for which it finds a <em>.mo</em> file.</td>
</tr>
<tr>
<td><span class="code">translation</span><br/>
<em>(cont.)</em></td>
<td><span class="code">translation</span> returns an instance object of a translation class (by default, <span class="code">GNUTranslations</span>; if present, the class’s constructor must take a single file object argument) that supplies the methods <span class="code">gettext</span> (to translate a <span class="code">str</span>) and <span class="code">install</span> (to install <span class="code">gettext</span> under the name <span class="code">_</span> in Python’s <span class="code">builtins</span> namespace).<br/>
<span class="code">translation</span> offers more detailed control than <span class="code">install</span>, which is like <span class="code">translation(<em>domain</em>,</span> <span class="code"><em>localedir</em></span><span class="code">).install(<em>unicode</em>)</span>. With <span class="code">translation</span>, you can localize a single package without affecting the built-in namespace, by binding the name <span class="code">_</span> on a per-module basis—for<a contenteditable="false" data-primary="" data-startref="l10n11" data-type="indexterm" id="idm44924513351744"/><a contenteditable="false" data-primary="" data-startref="loal11" data-type="indexterm" id="idm44924513350368"/><a contenteditable="false" data-primary="" data-startref="gettextmod11" data-type="indexterm" id="idm44924513348992"/><a contenteditable="false" data-primary="" data-startref="SLMgettext11" data-type="indexterm" id="idm44924513347616"/> example, with:
			<pre data-code-language="python" data-type="programlisting">
<code class="n">_</code><code> </code><code class="o">=</code><code> </code><code class="n">translation</code><code class="p">(</code><em><code class="n">domain</code></em><code class="p">)</code><code class="o">.</code><code class="n">ugettext</code></pre>
</td>
</tr>
</tbody>
</table>
</div></section>
</div></section>
<section data-pdf-bookmark="More Internationalization Resources" data-type="sect2"><div class="sect2" id="more_internationalization_resources">
<h2>More Internationalization Resources</h2>
<p>Internationalization is a very large topic. For a general introduction, see <a href="https://oreil.ly/raRbx">Wikipedia</a>. One of the best packages of code and information for internationalization, which the authors happily recommend, is <a href="https://icu.unicode.org">ICU</a>, embedding also the<a contenteditable="false" data-primary="Common Locale Data Repository (CLDR)" data-type="indexterm" id="idm44924513331632"/><a contenteditable="false" data-primary="CLDR (Common Locale Data Repository)" data-type="indexterm" id="idm44924513330528"/> Unicode Consortium’s Common Locale Data Repository (CLDR) database of locale conventions and code to access the CLDR. To use ICU in Python, install the<a contenteditable="false" data-primary="PyICU" data-type="indexterm" id="idm44924513329328"/> third-party package <a href="https://oreil.ly/EkwTk">PyICU</a>.<a contenteditable="false" data-primary="" data-startref="FTOinter11" data-type="indexterm" id="idm44924513327376"/><a contenteditable="false" data-primary="" data-startref="inter11" data-type="indexterm" id="idm44924513304752"/><a contenteditable="false" data-primary="" data-startref="i18n11" data-type="indexterm" id="idm44924513303440"/></p>
</div></section>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="ch01fn99"><sup><a href="ch11.xhtml#ch01fn99-marker">1</a></sup> <span class="code">tell</span>’s value is opaque for text files, since they contain variable-length characters. For binary files, it’s simply a straight byte count.</p><p data-type="footnote" id="ch01fn102"><sup><a href="ch11.xhtml#ch01fn102-marker">2</a></sup> Alas, yes—not <span class="code">sys.stderr</span>, as common practice and logic would dictate!</p><p data-type="footnote" id="ch01fn103"><sup><a href="ch11.xhtml#ch01fn103-marker">3</a></sup> Or, even better, the even-higher-level <span class="code">pathlib</span> module, covered later in this chapter.</p><p data-type="footnote" id="ch01fn104"><sup><a href="ch11.xhtml#ch01fn104-marker">4</a></sup> “Curses” does describe well the typical utterances of programmers faced with this complicated, low-level approach.</p><p data-type="footnote" id="ch01fn105"><sup><a href="ch11.xhtml#ch01fn105-marker">5</a></sup> I18n includes the process of “localization,” or adapting international software to local language and cultural conventions.</p></div></div></section></div></body></html>