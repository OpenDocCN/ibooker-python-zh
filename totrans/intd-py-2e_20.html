<html><head></head><body><section data-pdf-bookmark="Chapter 18. The Web, Untangled" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch_web">&#13;
<h1><span class="label">Chapter 18. </span>The Web, Untangled</h1>&#13;
&#13;
<blockquote>&#13;
<p><a data-primary="World Wide Web" data-seealso="web entries" data-type="indexterm" id="ix_ch18-web-asciidoc0"/>Oh, what a tangled web we weave…</p>&#13;
<p data-type="attribution">Walter Scott, <cite>Marmion</cite></p>&#13;
</blockquote>&#13;
&#13;
<p><a data-primary="World Wide Web" data-secondary="history of" data-type="indexterm" id="idm45794970296488"/>Straddling the French–Swiss border is CERN—a particle physics research institute that&#13;
smashes atoms multiple times, just to make sure.</p>&#13;
&#13;
<p>All that smashing generates a mountain of data.&#13;
In 1989,&#13;
the English scientist Tim Berners-Lee&#13;
first circulated a proposal within CERN&#13;
to help disseminate&#13;
information there and across the research community.&#13;
He called it the <em>World Wide Web</em> and&#13;
distilled its design into three simple ideas:</p>&#13;
<dl>&#13;
<dt>HTTP (Hypertext Transfer Protocol)</dt>&#13;
<dd>&#13;
<p>A protocol for web clients and servers to&#13;
interchange requests and responses.</p>&#13;
</dd>&#13;
<dt>HTML (Hypertext Markup Language)</dt>&#13;
<dd>&#13;
<p>A presentation format for results.</p>&#13;
</dd>&#13;
<dt>URL (Uniform Resource Locator)</dt>&#13;
<dd>&#13;
<p>A way to uniquely represent a server and a <em>resource</em> on that server.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>In its simplest usage, a web client&#13;
(I think Berners-Lee was the first to use the term&#13;
<em>browser</em>) connected to a web server&#13;
with HTTP,&#13;
requested a URL,&#13;
and received HTML.</p>&#13;
&#13;
<p>This was all built on the networking base from the <em>internet</em>,&#13;
which at the time was noncommercial,&#13;
and known only to a few universities&#13;
and research organizations.</p>&#13;
&#13;
<p>He wrote the first web browser and server on a&#13;
NeXT<sup><a data-type="noteref" href="ch18.html#idm45794970286888" id="idm45794970286888-marker">1</a></sup>&#13;
computer.&#13;
Web awareness really expanded in 1993,&#13;
when a group of students at the&#13;
University of Illinois released the Mosaic web browser&#13;
(for Windows, the Macintosh, and Unix)&#13;
and the NCSA <em>httpd</em> server.&#13;
When I downloaded Mosaic that summer and started building sites,&#13;
I had no idea that the web and the internet would soon&#13;
become part of everyday life.&#13;
The internet<sup><a data-type="noteref" href="ch18.html#idm45794970285336" id="idm45794970285336-marker">2</a></sup>&#13;
was still officially noncommercial then;&#13;
there were about 500 known web servers&#13;
<a href="http://home.web.cern.ch/about/birth-web">in the world</a>.&#13;
By the end of 1994,&#13;
the number of web servers had grown to 10,000.&#13;
The internet was opened to commercial&#13;
use, and&#13;
the authors of Mosaic founded Netscape to write commercial&#13;
web software.&#13;
Netscape went public as part of the early internet frenzy,&#13;
and the web’s explosive growth has never stopped.</p>&#13;
&#13;
<p>Almost every computer language has been used to write&#13;
web clients and web servers.&#13;
The dynamic languages Perl, PHP,&#13;
and Ruby have been especially popular.&#13;
In this chapter,&#13;
I show why Python is a particularly good language for&#13;
web work at every level:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Clients, to access remote sites</p>&#13;
</li>&#13;
<li>&#13;
<p>Servers, to provide data for websites and web APIs</p>&#13;
</li>&#13;
<li>&#13;
<p>Web APIs and services, to interchange data&#13;
in other ways than viewable web pages</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>And while we’re at it,&#13;
we’ll build an actual interactive website&#13;
in the exercises at the end of this chapter.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Web Clients" data-type="sect1"><div class="sect1" id="web_clients">&#13;
<h1>Web Clients</h1>&#13;
&#13;
<p><a data-primary="web clients" data-type="indexterm" id="ix_ch18-web-asciidoc1"/><a data-primary="World Wide Web" data-secondary="web clients" data-type="indexterm" id="ix_ch18-web-asciidoc2"/>The low-level network plumbing of the internet&#13;
is called <a data-primary="client-server system" data-type="indexterm" id="idm45794970274104"/><a data-primary="TCP/IP (Transmission Control Protocol/Internet Protocol)" data-type="indexterm" id="idm45794970273352"/>Transmission Control Protocol/Internet Protocol,&#13;
or more commonly,&#13;
simply TCP/IP&#13;
(<a data-type="xref" href="ch17.html#tcp_ip">“TCP/IP”</a> goes into more detail about this).&#13;
It moves bytes among computers,&#13;
but doesn’t care about what those bytes mean.&#13;
That’s the job of higher-level <em>protocols</em>—syntax definitions for specific purposes.&#13;
HTTP&#13;
is the standard protocol for web data interchange.</p>&#13;
&#13;
<p>The web is a client-server system.&#13;
The client makes a <em>request</em> to a server:&#13;
it opens a TCP/IP connection,&#13;
sends the URL and other information via HTTP,&#13;
and receives a <em>response</em>.</p>&#13;
&#13;
<p>The format of the response is also defined by HTTP.&#13;
It includes the status of the request,&#13;
and (if the request succeeded)&#13;
the response’s data and format.</p>&#13;
&#13;
<p><a data-primary="web browser" data-type="indexterm" id="idm45794970268600"/>The most well-known web client is a web <em>browser</em>.&#13;
It can make HTTP requests in a number of ways.&#13;
You might initiate a request manually by&#13;
typing a URL into the location bar&#13;
or clicking a link in a web page.&#13;
Very often, the data returned is&#13;
used to display a website —HTML documents,&#13;
JavaScript files, CSS files, and images—but it can be any type of data,&#13;
not just that intended for display.</p>&#13;
&#13;
<p>An important aspect of HTTP is that it’s <em>stateless</em>.&#13;
Each HTTP connection that you make is&#13;
independent of all the others.&#13;
This simplifies basic web operations but complicates others.&#13;
Here are just a few samples of the challenges:</p>&#13;
<dl>&#13;
<dt>Caching</dt>&#13;
<dd>&#13;
<p>Remote content that doesn’t change&#13;
should be saved by the web client and used&#13;
to avoid downloading from the server again.</p>&#13;
</dd>&#13;
<dt>Sessions</dt>&#13;
<dd>&#13;
<p>A shopping website should remember&#13;
the contents of your shopping cart.</p>&#13;
</dd>&#13;
<dt>Authentication</dt>&#13;
<dd>&#13;
<p>Sites that require your username&#13;
and password should remember them while you’re logged in.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Solutions to statelessness include <em>cookies</em>,&#13;
in which the server sends the client&#13;
enough specific information&#13;
to be able to identify it uniquely when&#13;
the client sends the cookie back.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Test with telnet" data-type="sect2"><div class="sect2" id="telnet">&#13;
<h2>Test with telnet</h2>&#13;
&#13;
<p><a data-primary="telnet" data-type="indexterm" id="idm45794970258120"/><a data-primary="web clients" data-secondary="testing with telnet" data-type="indexterm" id="idm45794970257416"/>HTTP is a text-based protocol,&#13;
so you can actually type it yourself&#13;
for web testing.&#13;
The ancient <code>telnet</code> program lets you connect to&#13;
any server and port,&#13;
and type commands to any service that’s running there.&#13;
For secure (encrypted) connections to other&#13;
machines, it’s been replaced by <code>ssh</code>.</p>&#13;
&#13;
<p>Let’s ask everyone’s favorite test site, Google,&#13;
some basic information about its home page.&#13;
Type this:</p>&#13;
<pre>$ <strong>telnet www.google.com 80</strong></pre>&#13;
&#13;
<p>If there is a web server on port 80&#13;
(this is where unencrypted <code>http</code> usually runs;&#13;
encrypted <code>https</code> uses port 443)&#13;
at <em>google.com</em>&#13;
(I think that’s a safe bet),&#13;
<code>telnet</code> will print some reassuring information,&#13;
and then display a final blank line that’s your cue&#13;
to type something else:</p>&#13;
&#13;
<pre data-type="programlisting">Trying 74.125.225.177...&#13;
Connected to www.google.com.&#13;
Escape character is '^]'.</pre>&#13;
&#13;
<p>Now, type an actual HTTP command for <code>telnet</code>&#13;
to send to the Google web server.&#13;
The most common HTTP command&#13;
(the one your browser uses when you type a URL in&#13;
its location bar) is <code>GET</code>.&#13;
This retrieves the contents of the specified resource,&#13;
such as an HTML file,&#13;
and returns it to the client.&#13;
For our first test, we’ll use the HTTP command <code>HEAD</code>,&#13;
which just retrieves some&#13;
basic information <em>about</em> the resource:</p>&#13;
<pre><strong>HEAD / HTTP/1.1</strong></pre>&#13;
&#13;
<p>Add an extra carriage return to send a blank&#13;
line so the remote server knows&#13;
you’re all done and want a response.&#13;
That <code>HEAD /</code> sends the&#13;
HTTP <code>HEAD</code> <em>verb</em> (command) to&#13;
get information about&#13;
the home page (<code>/</code>).&#13;
You’ll receive a response such as this&#13;
(I trimmed some of the long lines using … so they&#13;
wouldn’t stick out of the book):</p>&#13;
&#13;
<pre data-type="programlisting">HTTP/1.1 200 OK&#13;
Date: Mon, 10 Jun 2019 16:12:13 GMT&#13;
Expires: -1&#13;
Cache-Control: private, max-age=0&#13;
Content-Type: text/html; charset=ISO-8859-1&#13;
P3P: CP="This is not a P3P policy! See g.co/p3phelp for more info."&#13;
Server: gws&#13;
X-XSS-Protection: 0&#13;
X-Frame-Options: SAMEORIGIN&#13;
Set-Cookie: 1P_JAR=...; expires=... GMT; path=/; domain=.google.com&#13;
Set-Cookie: NID=...; expires=... GMT; path=/; domain=.google.com; HttpOnly&#13;
Transfer-Encoding: chunked&#13;
Accept-Ranges: none&#13;
Vary: Accept-Encoding</pre>&#13;
&#13;
<p>These are HTTP response headers and their values.&#13;
Some, like <code>Date</code> and <code>Content-Type</code>, are required.&#13;
Others, such as <code>Set-Cookie</code>,&#13;
are used to track your activity across multiple&#13;
visits (we talk about <em>state management</em>&#13;
a little later in this chapter).&#13;
When you make an HTTP <code>HEAD</code> request,&#13;
you get back only headers.&#13;
If you had used the HTTP <code>GET</code> or <code>POST</code> commands,&#13;
you would also receive data from the home page&#13;
(a mixture of HTML,&#13;
CSS, JavaScript,&#13;
and whatever else Google decided to throw into its home page).</p>&#13;
&#13;
<p>I don’t want to leave you stranded in <code>telnet</code>.&#13;
To close <code>telnet</code>, type the following:</p>&#13;
<pre><strong>q</strong></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Test with curl" data-type="sect2"><div class="sect2" id="curl">&#13;
<h2>Test with curl</h2>&#13;
&#13;
<p><a data-primary="curl" data-type="indexterm" id="idm45794970236248"/><a data-primary="web clients" data-secondary="testing with curl" data-type="indexterm" id="idm45794970235320"/>Using <code>telnet</code> is simple, but is a completely manual process.&#13;
The <a href="https://curl.haxx.se"><code>curl</code></a> program is probably&#13;
the most popular command-line web client.&#13;
Documentation includes the book&#13;
<a href="https://curl.haxx.se/book.html"><em>Everything Curl</em></a>,&#13;
in HTML, PDF, and ebook formats.&#13;
A <a href="https://oreil.ly/dLR8b">table</a>&#13;
compares <code>curl</code> with similar tools.&#13;
The <a href="https://curl.haxx.se/download.html">download</a> page&#13;
includes all the major platforms,&#13;
and many obscure ones.</p>&#13;
&#13;
<p>The simplest use of <code>curl</code> does an implicit <code>GET</code>&#13;
(output truncated here):</p>&#13;
<pre>$ <strong>curl http://www.example.com</strong>&#13;
&lt;!doctype html&gt;&#13;
&lt;html&gt;&#13;
&lt;head&gt;&#13;
    &lt;title&gt;Example Domain&lt;/title&gt;&#13;
    ...&#13;
</pre>&#13;
&#13;
<p>This uses <code>HEAD</code>:</p>&#13;
<pre>$ <strong>curl --head http://www.example.com</strong>&#13;
HTTP/1.1 200 OK&#13;
Content-Encoding: gzip&#13;
Accept-Ranges: bytes&#13;
Cache-Control: max-age=604800&#13;
Content-Type: text/html; charset=UTF-8&#13;
Date: Sun, 05 May 2019 16:14:30 GMT&#13;
Etag: "1541025663"&#13;
Expires: Sun, 12 May 2019 16:14:30 GMT&#13;
Last-Modified: Fri, 09 Aug 2013 23:54:35 GMT&#13;
Server: ECS (agb/52B1)&#13;
X-Cache: HIT&#13;
Content-Length: 606</pre>&#13;
&#13;
<p>If you’re passing arguments,&#13;
you can include them in the&#13;
command line or a data file.&#13;
In these examples, I use the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><em>url</em> for any website</p>&#13;
</li>&#13;
<li>&#13;
<p><code>data.txt</code> as a text data file with these contents:&#13;
<code>a=1&amp;b=2</code></p>&#13;
</li>&#13;
<li>&#13;
<p><code>data.json</code> as a JSON data file with these contents:&#13;
<code>{"a":1, "b": 2}</code></p>&#13;
</li>&#13;
<li>&#13;
<p><code>a=1&amp;b=2</code> as two data arguments</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Using default (<em>form-encoded</em>) arguments:</p>&#13;
<pre>$ <strong>curl -X POST -d "a=1&amp;b=2" <em>url</em></strong>&#13;
$ <strong>curl -X POST -d "@data.txt" <em>url</em></strong></pre>&#13;
&#13;
<p>For JSON-encoded arguments:</p>&#13;
<pre>$ <strong>curl -X POST -d "{'a':1,'b':2}" -H "Content-Type: application/json" <em>url</em></strong>&#13;
$ <strong>curl -X POST -d "@data.json" <em>url</em></strong></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Test with httpie" data-type="sect2"><div class="sect2" id="httpie">&#13;
<h2>Test with httpie</h2>&#13;
&#13;
<p><a data-primary="httpie" data-type="indexterm" id="idm45794970212648"/><a data-primary="web clients" data-secondary="testing with httpie" data-type="indexterm" id="idm45794970211944"/>A more Pythonic alternative to curl is&#13;
<a href="https://httpie.org"><code>httpie</code></a>.</p>&#13;
<pre>$ <strong>pip install httpie</strong></pre>&#13;
&#13;
<p>To make a form-encoded POST,&#13;
similar to the methods for <code>curl</code> above&#13;
(<code>-f</code> is a synonym for <code>--form</code>):</p>&#13;
<pre>$ <strong>http -f POST <em>url</em> a=1 b=2</strong>&#13;
$ <strong>http POST -f <em>url</em> &lt; data.txt</strong></pre>&#13;
&#13;
<p>The default encoding is JSON:</p>&#13;
<pre>$ <strong>http POST <em>url</em> a=1 b=2</strong>&#13;
$ <strong>http POST <em>url</em> &lt; data.json</strong></pre>&#13;
&#13;
<p><code>httpie</code> also handles HTTP headers, cookies, file uploads,&#13;
authentication, redirects, SSL, and so on.&#13;
As usual, see the&#13;
<a href="https://httpie.org/doc">docs</a></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Test with httpbin" data-type="sect2"><div class="sect2" id="idm45794970201336">&#13;
<h2>Test with httpbin</h2>&#13;
&#13;
<p><a data-primary="httpbin" data-type="indexterm" id="idm45794970200136"/><a data-primary="web clients" data-secondary="testing with httpbin" data-type="indexterm" id="idm45794970199432"/>You can test your web queries against the site&#13;
<a href="https://httpbin.org"><code>httpbin</code></a>,&#13;
or download and run the site in a local Docker image:</p>&#13;
<pre>$ <strong>docker run -p 80:80 kennethreitz/httpbin</strong></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Python’s Standard Web Libraries" data-type="sect2"><div class="sect2" id="web_libraries">&#13;
<h2>Python’s Standard Web Libraries</h2>&#13;
&#13;
<p><a data-primary="web clients" data-secondary="Pythons standard web libraries" data-type="indexterm" id="ix_ch18-web-asciidoc3"/>In Python 2, web client and server modules were a bit scattered.&#13;
One of the Python 3 goals was to bundle these modules into&#13;
two <em>packages</em> (remember from <a data-type="xref" href="ch11.html#ch_modules">Chapter 11</a> that a package&#13;
is just a directory containing module files):</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>http</code> manages all the client-server HTTP details:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>client</code> does the client-side stuff</p>&#13;
</li>&#13;
<li>&#13;
<p><code>server</code> helps you write Python web servers</p>&#13;
</li>&#13;
<li>&#13;
<p><code>cookies</code> and <code>cookiejar</code> manage cookies,&#13;
which save data between site visits</p>&#13;
</li>&#13;
</ul>&#13;
</li>&#13;
<li>&#13;
<p><code>urllib</code> runs on top of <code>http</code>:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>request</code> handles the client  request</p>&#13;
</li>&#13;
<li>&#13;
<p><code>response</code> handles the server response</p>&#13;
</li>&#13;
<li>&#13;
<p><code>parse</code> cracks the parts of a URL</p>&#13;
</li>&#13;
</ul>&#13;
</li>&#13;
</ul>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>If you’re trying to write code that’s compatible&#13;
with both Python 2 and Python 3, keep in mind that&#13;
<code>urllib</code> changed <a href="https://oreil.ly/ww5_R">a lot</a> between the two versions.&#13;
For a better alternative, refer to <a data-type="xref" href="#requests">“Beyond the Standard Library: requests”</a>.</p>&#13;
</div>&#13;
&#13;
<p class="pagebreak-before">Let’s use the standard library to get something from a website.&#13;
The URL in the following example returns&#13;
information from a test website:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">urllib.request</code> <code class="kn">as</code> <code class="nn">ur</code>&#13;
<code class="go">&gt;&gt;&gt;</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">url</code> <code class="o">=</code> <code class="s">'http://www.example.com/'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">conn</code> <code class="o">=</code> <code class="n">ur</code><code class="o">.</code><code class="n">urlopen</code><code class="p">(</code><code class="n">url</code><code class="p">)</code></pre>&#13;
&#13;
<p>This little chunk of Python opened a TCP/IP connection&#13;
to the remote web server <code>www.example.com</code>,&#13;
made an HTTP request, and received an HTTP response.&#13;
The response contained more than just the page data.&#13;
In <a href="http://bit.ly/httpresponse-docs">the official&#13;
documentation</a>,&#13;
we find that <code>conn</code> is an <code>HTTPResponse</code> object&#13;
with a number of methods and attributes.&#13;
One of the most important parts of the response&#13;
is the HTTP <em>status code</em>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="k">print</code><code class="p">(</code><code class="n">conn</code><code class="o">.</code><code class="n">status</code><code class="p">)</code>&#13;
<code class="go">200</code></pre>&#13;
&#13;
<p>A <code>200</code> means that everything was peachy.&#13;
There are dozens of HTTP status codes,&#13;
grouped into five ranges by&#13;
their first (hundreds) digit:</p>&#13;
<dl>&#13;
<dt>1xx (information)</dt>&#13;
<dd>&#13;
<p>The server received the request but has&#13;
some extra information for the client.</p>&#13;
</dd>&#13;
<dt>2xx (success)</dt>&#13;
<dd>&#13;
<p>It worked; every success code other than 200&#13;
conveys extra details.</p>&#13;
</dd>&#13;
<dt>3xx (redirection)</dt>&#13;
<dd>&#13;
<p>The resource moved, so the response returns&#13;
the new URL to the client.</p>&#13;
</dd>&#13;
<dt>4xx (client error)</dt>&#13;
<dd>&#13;
<p>Some problem from the client side,&#13;
such as the well-known 404 (not found).&#13;
418 (<em>I’m a teapot</em>) was an April Fool’s joke.</p>&#13;
</dd>&#13;
<dt>5xx (server error)</dt>&#13;
<dd>&#13;
<p>500 is the generic whoops;&#13;
you might see a 502 (bad gateway) if there’s&#13;
some disconnect between a web server and a&#13;
backend application server.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>To get the actual data contents from the web page,&#13;
use the <code>read()</code> method of the <code>conn</code> variable.&#13;
This returns a <code>bytes</code> value.&#13;
Let’s get the data and print the first 50 bytes:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">data</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="n">read</code><code class="p">()</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">print</code><code class="p">(</code><code class="n">data</code><code class="p">[:</code><code class="mi">50</code><code class="p">])</code></pre>&#13;
&#13;
<pre data-type="programlisting">b'&lt;!doctype html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Example D'</pre>&#13;
&#13;
<p>We can convert these bytes to a string and print its&#13;
first 50 characters:</p>&#13;
&#13;
<pre data-type="programlisting">&gt;&gt;&gt; str_data = data.decode('utf8')&#13;
&gt;&gt;&gt; print(str_data[:50])&#13;
&lt;!doctype html&gt;&#13;
&lt;html&gt;&#13;
&lt;head&gt;&#13;
    &lt;title&gt;Example D&#13;
&gt;&gt;&gt;</pre>&#13;
&#13;
<p>The rest is more HTML and CSS.</p>&#13;
&#13;
<p>Out of sheer curiosity, what HTTP headers were sent back to us?</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="k">for</code> <code class="n">key</code><code class="p">,</code> <code class="n">value</code> <code class="ow">in</code> <code class="n">conn</code><code class="o">.</code><code class="n">getheaders</code><code class="p">():</code>&#13;
<code class="gp">... </code>    <code class="k">print</code><code class="p">(</code><code class="n">key</code><code class="p">,</code> <code class="n">value</code><code class="p">)</code>&#13;
<code class="gp">...</code></pre>&#13;
&#13;
<pre data-type="programlisting">Cache-Control max-age=604800&#13;
Content-Type text/html; charset=UTF-8&#13;
Date Sun, 05 May 2019 03:09:26 GMT&#13;
Etag "1541025663+ident"&#13;
Expires Sun, 12 May 2019 03:09:26 GMT&#13;
Last-Modified Fri, 09 Aug 2013 23:54:35 GMT&#13;
Server ECS (agb/5296)&#13;
Vary Accept-Encoding&#13;
X-Cache HIT&#13;
Content-Length 1270&#13;
Connection close</pre>&#13;
&#13;
<p>Remember that <code>telnet</code> example a little earlier?&#13;
Now, our Python library is parsing all those HTTP response&#13;
headers and providing them in a dictionary.&#13;
<code>Date</code> and <code>Server</code> seem straightforward;&#13;
some of the others, less so.&#13;
It’s helpful to know that HTTP has a set of&#13;
standard headers such as <code>Content-Type</code>,&#13;
and many optional ones.<a data-startref="ix_ch18-web-asciidoc3" data-type="indexterm" id="idm45794970058424"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Beyond the Standard Library: requests" data-type="sect2"><div class="sect2" id="requests">&#13;
<h2>Beyond the Standard Library: requests</h2>&#13;
&#13;
<p><a data-primary="requests module" data-type="indexterm" id="idm45794970056248"/><a data-primary="web clients" data-secondary="requests module" data-type="indexterm" id="idm45794970028968"/>At the beginning of <a data-type="xref" href="ch01.html#ch_intro">Chapter 1</a>,&#13;
there was a program that accessed a&#13;
Wayback Machine API by using&#13;
the standard libraries <code>urllib.request</code> and <code>json</code>.&#13;
Following that example is a version that uses the&#13;
third-party module <code>requests</code>.&#13;
The <code>requests</code> version is shorter and easier to understand.</p>&#13;
&#13;
<p>For most purposes,&#13;
I think web client development with <code>requests</code> is easier.&#13;
You can browse the&#13;
<a href="https://oreil.ly/zF8cy">documentation</a>&#13;
(which is pretty good)&#13;
for full details.&#13;
I’ll show the basics of <code>requests</code> in this section&#13;
and use it throughout this book for&#13;
web client tasks.</p>&#13;
&#13;
<p>First, install the <code>requests</code> library:</p>&#13;
<pre>$ <strong>pip install requests</strong></pre>&#13;
&#13;
<p>Now, let’s redo our example.com query with <code>requests</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">requests</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">resp</code> <code class="o">=</code> <code class="n">requests</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s">'http://example.com'</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">resp</code>&#13;
<code class="go">&lt;Response [200]&gt;</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">resp</code><code class="o">.</code><code class="n">status_code</code>&#13;
<code class="go">200</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">resp</code><code class="o">.</code><code class="n">text</code><code class="p">[:</code><code class="mi">50</code><code class="p">]</code>&#13;
<code class="go">'&lt;!doctype html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Example D'</code></pre>&#13;
&#13;
<p>To show a JSON query, here’s a minimal version of&#13;
a program that appears at the end of this chapter.&#13;
You provide a string,&#13;
and it uses an Internet Archive search API&#13;
to look through the titles&#13;
of billions of multimedia items saved there.&#13;
Notice that in the <code>requests.get()</code> call shown in <a data-type="xref" href="#ex1801">Example 18-1</a>,&#13;
you only need to pass a <code>params</code> dictionary,&#13;
and <code>requests</code> handles all the query construction&#13;
and character escaping.</p>&#13;
<div data-type="example" id="ex1801">&#13;
<h5><span class="label">Example 18-1. </span>ia.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">import</code> <code class="nn">json</code>&#13;
<code class="kn">import</code> <code class="nn">sys</code>&#13;
&#13;
<code class="kn">import</code> <code class="nn">requests</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">search</code><code class="p">(</code><code class="n">title</code><code class="p">):</code>&#13;
     <code class="n">url</code> <code class="o">=</code> <code class="s2">"http://archive.org/advancedsearch.php"</code>&#13;
     <code class="n">params</code> <code class="o">=</code> <code class="p">{</code><code class="s2">"q"</code><code class="p">:</code> <code class="n">f</code><code class="s2">"title:({title})"</code><code class="p">,</code>&#13;
               <code class="s2">"output"</code><code class="p">:</code> <code class="s2">"json"</code><code class="p">,</code>&#13;
               <code class="s2">"fields"</code><code class="p">:</code> <code class="s2">"identifier,title"</code><code class="p">,</code>&#13;
               <code class="s2">"rows"</code><code class="p">:</code> <code class="mi">50</code><code class="p">,</code>&#13;
               <code class="s2">"page"</code><code class="p">:</code> <code class="mi">1</code><code class="p">,}</code>&#13;
     <code class="n">resp</code> <code class="o">=</code> <code class="n">requests</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="n">url</code><code class="p">,</code> <code class="n">params</code><code class="o">=</code><code class="n">params</code><code class="p">)</code>&#13;
     <code class="k">return</code> <code class="n">resp</code><code class="o">.</code><code class="n">json</code><code class="p">()</code>&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s2">"__main__"</code><code class="p">:</code>&#13;
     <code class="n">title</code> <code class="o">=</code> <code class="n">sys</code><code class="o">.</code><code class="n">argv</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>&#13;
     <code class="n">data</code> <code class="o">=</code> <code class="n">search</code><code class="p">(</code><code class="n">title</code><code class="p">)</code>&#13;
     <code class="n">docs</code> <code class="o">=</code> <code class="n">data</code><code class="p">[</code><code class="s2">"response"</code><code class="p">][</code><code class="s2">"docs"</code><code class="p">]</code>&#13;
     <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"Found {len(docs)} items, showing first 10"</code><code class="p">)</code>&#13;
     <code class="k">print</code><code class="p">(</code><code class="s2">"identifier</code><code class="se">\t</code><code class="s2">title"</code><code class="p">)</code>&#13;
     <code class="k">for</code> <code class="n">row</code> <code class="ow">in</code> <code class="n">docs</code><code class="p">[:</code><code class="mi">10</code><code class="p">]:</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="n">row</code><code class="p">[</code><code class="s2">"identifier"</code><code class="p">],</code> <code class="n">row</code><code class="p">[</code><code class="s2">"title"</code><code class="p">],</code> <code class="n">sep</code><code class="o">=</code><code class="s2">"</code><code class="se">\t</code><code class="s2">"</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>How’s their stock of wendigo items?</p>&#13;
<pre>$ <strong>python ia.py wendigo</strong>&#13;
Found 24 items, showing first 10&#13;
identifier  title&#13;
cd_wendigo_penny-sparrow  Wendigo&#13;
Wendigo1  Wendigo 1&#13;
wendigo_ag_librivox The Wendigo&#13;
thewendigo10897gut  The Wendigo&#13;
isbn_9780843944792  Wendigo mountain ; Death camp&#13;
jamendo-060508  Wendigo - Audio Leash&#13;
fav-lady_wendigo  lady_wendigo Favorites&#13;
011bFearTheWendigo  011b Fear The Wendigo&#13;
CharmedChats112 Episode 112 - The Wendigo&#13;
jamendo-076964  Wendigo - Tomame o Dejame&gt;</pre>&#13;
&#13;
<p>The first column (the <em>identifier</em>) can be used to&#13;
actually view the item at the <em>archive.org</em> site.&#13;
You’ll see how to do this at the end of this chapter.<a data-startref="ix_ch18-web-asciidoc2" data-type="indexterm" id="idm45794969810216"/><a data-startref="ix_ch18-web-asciidoc1" data-type="indexterm" id="idm45794969809624"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Web Servers" data-type="sect1"><div class="sect1" id="web_servers">&#13;
<h1>Web Servers</h1>&#13;
&#13;
<p><a data-primary="web servers" data-type="indexterm" id="ix_ch18-web-asciidoc4"/><a data-primary="World Wide Web" data-secondary="web servers" data-type="indexterm" id="ix_ch18-web-asciidoc5"/>Web developers have found&#13;
Python to be an excellent language for writing web servers&#13;
and server-side programs.&#13;
This has led to such&#13;
a variety of Python-based web <em>frameworks</em>&#13;
that it can be hard to&#13;
navigate among them and make choices—not to mention deciding what&#13;
deserves to go into a book.</p>&#13;
&#13;
<p>A web framework provides features with which&#13;
you can build websites,&#13;
so it does more than a simple web (HTTP) server.&#13;
You’ll see features such as&#13;
routing (URL to server function),&#13;
templates (HTML with dynamic inclusions),&#13;
debugging, and more.</p>&#13;
&#13;
<p>I’m not going to cover all of the frameworks here—just those that I’ve found to be&#13;
relatively simple to use and suitable for real websites.&#13;
I’ll also show how to run the dynamic parts&#13;
of a website with Python&#13;
and other parts with a traditional web server.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The Simplest Python Web Server" data-type="sect2"><div class="sect2" id="http_server">&#13;
<h2>The Simplest Python Web Server</h2>&#13;
&#13;
<p><a data-primary="Web Server Gateway Interface (WSGI)" data-type="indexterm" id="idm45794969800840"/><a data-primary="web servers" data-secondary="bare-bones Python HTTP server" data-type="indexterm" id="idm45794969800168"/><a data-primary="web servers" data-secondary="WSGI" data-type="indexterm" id="idm45794969799208"/>You can run a simple web server by typing&#13;
just one line of Python:</p>&#13;
<pre>$ <strong>python -m http.server</strong></pre>&#13;
&#13;
<p>This implements a bare-bones Python HTTP server.&#13;
If there are no problems,&#13;
this will print an initial status message:</p>&#13;
&#13;
<pre data-type="programlisting">Serving HTTP on 0.0.0.0 port 8000 ...</pre>&#13;
&#13;
<p>That <code>0.0.0.0</code> means <em>any TCP address</em>,&#13;
so web clients can access it&#13;
no matter what address the server has.&#13;
There’s more low-level details on TCP&#13;
and other network plumbing for you to&#13;
read about in <a data-type="xref" href="ch17.html#ch_networks">Chapter 17</a>.</p>&#13;
&#13;
<p>You can now request files, with paths relative&#13;
to your current directory, and they will be returned.&#13;
If you type <code>http://localhost:8000</code> in your web browser,&#13;
you should see a directory listing there,&#13;
and the server will print access log lines such as this:</p>&#13;
&#13;
<pre data-type="programlisting">127.0.0.1 - - [20/Feb/2013 22:02:37] "GET / HTTP/1.1" 200 -</pre>&#13;
&#13;
<p><code>localhost</code> and <code>127.0.0.1</code> are TCP synonyms for&#13;
<em>your local computer</em>,&#13;
so this works regardless of whether you’re&#13;
connected to the internet.&#13;
You can interpret this line as follows:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>127.0.0.1</code> is the client’s IP address</p>&#13;
</li>&#13;
<li>&#13;
<p>The first <code>-</code> is the remote username, if found</p>&#13;
</li>&#13;
<li>&#13;
<p>The second <code>-</code> is the login username, if required</p>&#13;
</li>&#13;
<li>&#13;
<p><code>[20/Feb/2013 22:02:37]</code> is the access date and time</p>&#13;
</li>&#13;
<li>&#13;
<p><code>"GET / HTTP/1.1"</code> is the command sent to the web server:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>The HTTP method (<code>GET</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p>The resource requested (<code>/</code>, the top)</p>&#13;
</li>&#13;
<li>&#13;
<p>The HTTP version (<code>HTTP/1.1</code>)</p>&#13;
</li>&#13;
</ul>&#13;
</li>&#13;
<li>&#13;
<p>The final <code>200</code> is the HTTP status code returned by the web server</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Click any file.&#13;
If your browser can recognize the format&#13;
(HTML, PNG, GIF, JPEG, and so on) it should display it,&#13;
and the server will log the request.&#13;
For instance, if you have the file <em>oreilly.png</em>&#13;
in your current directory,&#13;
a request for <em><a href="http://localhost:8000/oreilly.png"><em class="hyperlink">http://localhost:8000/oreilly.png</em></a></em>&#13;
should return the image of the&#13;
unsettling fellow in <a data-type="xref" href="ch20.html#tarsier_1">Figure 20-2</a>,&#13;
and the log should show something such as this:</p>&#13;
&#13;
<pre data-type="programlisting">127.0.0.1 - - [20/Feb/2013 22:03:48] "GET /oreilly.png HTTP/1.1" 200 -</pre>&#13;
&#13;
<p>If you have other files in the same directory&#13;
on your computer,&#13;
they should show up in a listing on your display,&#13;
and you can click&#13;
any one to download it.&#13;
If your browser is configured to display&#13;
that file’s format,&#13;
you’ll see the results on your screen;&#13;
otherwise, your browser will ask you&#13;
if you want to download and save the file.</p>&#13;
&#13;
<p>The default port number used is 8000,&#13;
but you can specify another:</p>&#13;
<pre>$ <strong>python -m http.server 9999</strong></pre>&#13;
&#13;
<p>You should see this:</p>&#13;
&#13;
<pre data-type="programlisting">Serving HTTP on 0.0.0.0 port 9999 ...</pre>&#13;
&#13;
<p>This Python-only server is best suited for quick tests.&#13;
You can stop it by killing its process;&#13;
in most terminals, press Ctrl+C.</p>&#13;
&#13;
<p>You should not use this basic server for a busy production website.&#13;
Traditional web servers such as Apache and NGINX&#13;
are much faster for serving static files.&#13;
In addition, this simple&#13;
server has no way to handle dynamic content,&#13;
which more extensive&#13;
servers can do by accepting parameters.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Web Server Gateway Interface (WSGI)" data-type="sect2"><div class="sect2" id="wsgi">&#13;
<h2>Web Server Gateway Interface (WSGI)</h2>&#13;
&#13;
<p>All too soon,&#13;
the allure of serving simple files wears off,&#13;
and we want a web server that can also run programs&#13;
dynamically.&#13;
<a data-primary="Common Gateway Interface (CGI)" data-type="indexterm" id="idm45794969767928"/>In the early days of the web,&#13;
the <em>Common Gateway Interface</em> (CGI)&#13;
was designed for clients to make web servers&#13;
run external programs and return the results.&#13;
CGI also handled getting input arguments from the client&#13;
through the server to the external programs.&#13;
However, the programs were started anew&#13;
for <em>each</em> client access.&#13;
This could not scale well, because&#13;
even small programs have appreciable startup time.</p>&#13;
&#13;
<p>To avoid this startup delay,&#13;
people began merging the language interpreter&#13;
into the web server.&#13;
Apache ran PHP within its <code>mod_php</code> module,&#13;
Perl in <code>mod_perl</code>,&#13;
and Python in <code>mod_python</code>.&#13;
Then, code in these dynamic languages could be executed&#13;
within the long-running Apache process itself&#13;
rather than in external programs.</p>&#13;
&#13;
<p>An alternative method was to run the dynamic language&#13;
within a separate long-running program&#13;
and have it communicate with the web server.&#13;
FastCGI and SCGI are examples.</p>&#13;
&#13;
<p>Python web development made a leap with the&#13;
definition of the <em>Web Server Gateway Interface</em> (WSGI),&#13;
a universal API between Python&#13;
web applications&#13;
and web servers.&#13;
All of the Python web frameworks and web servers&#13;
in the rest of this chapter use WSGI.&#13;
You don’t normally need to know how WSGI works&#13;
(there really isn’t much to it),&#13;
but it helps to know what some of the parts&#13;
under the hood are called.&#13;
This is a <em>synchronous</em> connection—one step follows another.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="ASGI" data-type="sect2"><div class="sect2" id="idm45794969801704">&#13;
<h2>ASGI</h2>&#13;
&#13;
<p><a data-primary="web servers" data-secondary="ASGI" data-type="indexterm" id="idm45794969760312"/>In a few places so far,&#13;
I’ve mentioned that Python has been introducing&#13;
<em>asynchronous</em>&#13;
language features like&#13;
<code>async</code>, <code>await</code>, and <code>asyncio</code>.&#13;
ASGI (Asynchronous Server&#13;
Gateway Interface) is&#13;
a counterpart of WSGI&#13;
that uses these new features.&#13;
In <a data-type="xref" href="app03.html#app_async">Appendix C</a>,&#13;
you’ll see more discussion,&#13;
and examples of new web frameworks that use ASGI.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Apache" data-type="sect2"><div class="sect2" id="apache">&#13;
<h2>Apache</h2>&#13;
&#13;
<p><a data-primary="Apache web server" data-type="indexterm" id="idm45794969754104"/><a data-primary="web servers" data-secondary="Apache" data-type="indexterm" id="idm45794969753400"/>The <a href="http://httpd.apache.org"><code>apache</code></a>&#13;
web server’s best WSGI module is&#13;
<a href="https://code.google.com/p/modwsgi"><code>mod_wsgi</code></a>.&#13;
This can run Python code within the Apache&#13;
process or in separate processes that&#13;
communicate with Apache.</p>&#13;
&#13;
<p>You should already have <code>apache</code> if your system&#13;
is Linux or macOS.&#13;
For Windows, you’ll need to install&#13;
<a href="http://bit.ly/apache-http">apache</a>.</p>&#13;
&#13;
<p>Finally, install your preferred&#13;
WSGI-based Python web framework.&#13;
Let’s try <code>bottle</code> here.&#13;
Almost all of the work involves configuring Apache,&#13;
which can be a dark art.</p>&#13;
&#13;
<p>Create the test file shown in <a data-type="xref" href="#ch18_ex01">Example 18-2</a> and save it as <em>/var/www/test/home.wsgi</em>.</p>&#13;
<div data-type="example" id="ch18_ex01">&#13;
<h5><span class="label">Example 18-2. </span>home.wsgi</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">import</code> <code class="nn">bottle</code>&#13;
&#13;
<code class="n">application</code> <code class="o">=</code> <code class="n">bottle</code><code class="o">.</code><code class="n">default_app</code><code class="p">()</code>&#13;
&#13;
<code class="nd">@bottle.route</code><code class="p">(</code><code class="s1">'/'</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">home</code><code class="p">():</code>&#13;
    <code class="k">return</code> <code class="s2">"apache and wsgi, sitting in a tree"</code></pre></div>&#13;
&#13;
<p>Do not call <code>run()</code> this time,&#13;
because that starts the built-in Python web server.&#13;
We need to assign to the variable <code>application</code>&#13;
because that’s what <code>mod_wsgi</code> looks for&#13;
to marry the web server and the Python code.</p>&#13;
&#13;
<p>If <code>apache</code> and its <code>mod_wsgi</code> module&#13;
are working correctly,&#13;
we just need to connect them to our Python script.&#13;
We want to add one line to the file&#13;
that defines the default website&#13;
for this <code>apache</code> server,&#13;
but finding that file is a task itself.&#13;
It could be&#13;
<em>/etc/apache2/httpd.conf</em>,&#13;
or&#13;
<em>/etc/apache2/sites-available/default</em>,&#13;
or the Latin name of someone’s pet salamander.</p>&#13;
&#13;
<p>Let’s assume for now that you understand <code>apache</code>&#13;
and found that file.&#13;
Add this line inside the <code>&lt;VirtualHost&gt;</code>&#13;
section that governs the default website:</p>&#13;
&#13;
<pre data-type="programlisting">    WSGIScriptAlias / /var/www/test/home.wsgi</pre>&#13;
&#13;
<p>That section might then look like this:</p>&#13;
&#13;
<pre data-type="programlisting">&lt;VirtualHost *:80&gt;&#13;
    DocumentRoot /var/www&#13;
&#13;
    WSGIScriptAlias / /var/www/test/home.wsgi&#13;
&#13;
    &lt;Directory /var/www/test&gt;&#13;
    Order allow,deny&#13;
    Allow from all&#13;
    &lt;/Directory&gt;&#13;
&lt;/VirtualHost&gt;</pre>&#13;
&#13;
<p>Start <code>apache</code>, or restart it if it was running&#13;
to make it use this new configuration.&#13;
If you then browse to <a href="http://localhost/"><em class="hyperlink">http://localhost/</em></a>, you should see:</p>&#13;
&#13;
<pre data-type="programlisting">apache and wsgi, sitting in a tree</pre>&#13;
&#13;
<p>This runs <code>mod_wsgi</code> in <em>embedded mode</em>,&#13;
as part of <code>apache</code> itself.</p>&#13;
&#13;
<p>You can also run it in <em>daemon mode</em>,&#13;
as one or more processes,&#13;
separate from <code>apache</code>.&#13;
To do this, add two new directive lines&#13;
to your <code>apache</code> config file:</p>&#13;
<pre>WSGIDaemonProcess <em>domain-name</em> user=<em>user-name</em> group=<em>group-name</em> threads=25&#13;
WSGIProcessGroup <em>domain-name</em></pre>&#13;
&#13;
<p>In the preceding example,&#13;
<em><code>user-name</code></em>&#13;
and&#13;
<em><code>group-name</code></em>&#13;
are the operating system user and group names,&#13;
and the&#13;
<em><code>domain-name</code></em>&#13;
is the name of your internet domain.&#13;
A minimal <code>apache</code> config might look like this:</p>&#13;
&#13;
<pre data-type="programlisting">&lt;VirtualHost *:80&gt;&#13;
    DocumentRoot /var/www&#13;
&#13;
    WSGIScriptAlias / /var/www/test/home.wsgi&#13;
&#13;
    WSGIDaemonProcess mydomain.com user=myuser group=mygroup threads=25&#13;
    WSGIProcessGroup mydomain.com&#13;
&#13;
    &lt;Directory /var/www/test&gt;&#13;
    Order allow,deny&#13;
    Allow from all&#13;
    &lt;/Directory&gt;&#13;
&lt;/VirtualHost&gt;</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="NGINX" data-type="sect2"><div class="sect2" id="nginx">&#13;
<h2>NGINX</h2>&#13;
&#13;
<p><a data-primary="NGINX web server" data-type="indexterm" id="idm45794969655576"/><a data-primary="web servers" data-secondary="NGINX" data-type="indexterm" id="idm45794969654872"/>The <a href="http://nginx.org"><code>NGINX</code> </a>&#13;
web server does not have an embedded Python module.&#13;
Instead, it’s a frontend to a separate WSGI server&#13;
such as uWSGI or gUnicorn.&#13;
Together they make&#13;
a very fast and configurable platform&#13;
for Python web <span class="keep-together">development.</span></p>&#13;
&#13;
<p>You can install <code>nginx</code> from its&#13;
<a href="http://wiki.nginx.org/Install">website</a>.&#13;
For examples of setting up Flask with NGINX&#13;
and a WSGI server, see&#13;
<a href="https://oreil.ly/7FTPa">this</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Other Python Web Servers" data-type="sect2"><div class="sect2" id="other_web_servers">&#13;
<h2>Other Python Web Servers</h2>&#13;
&#13;
<p>Following are some of the independent&#13;
Python-based WSGI servers&#13;
that work like <code>apache</code> or <code>nginx</code>,&#13;
using multiple processes and/or threads&#13;
(see <a data-type="xref" href="ch15.html#concurrency">“Concurrency”</a>)&#13;
to handle simultaneous requests:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="http://projects.unbit.it/uwsgi"><code>uwsgi</code></a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://www.cherrypy.org"><code>cherrypy</code></a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://www.pylonsproject.org"><code>pylons</code></a></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p><a data-primary="event-based servers" data-type="indexterm" id="idm45794969620472"/><a data-primary="web servers" data-secondary="event-based" data-type="indexterm" id="idm45794969619768"/>Here are some <em>event-based</em> servers,&#13;
which use a single process&#13;
but avoid blocking on any single request:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="http://www.tornadoweb.org"><code>tornado</code></a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://gevent.org"><code>gevent</code></a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://gunicorn.org"><code>gunicorn</code></a></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>I have more to say about events in the discussion&#13;
about <em>concurrency</em> in <a data-type="xref" href="ch15.html#ch_systems">Chapter 15</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Web Server Frameworks" data-type="sect1"><div class="sect1" id="frameworks">&#13;
<h1>Web Server Frameworks</h1>&#13;
&#13;
<p><a data-primary="web servers" data-secondary="frameworks" data-type="indexterm" id="ix_ch18-web-asciidoc6"/>Web servers handle the HTTP and WSGI details,&#13;
but you use web <em>frameworks</em> to actually write the Python&#13;
code that powers the site.&#13;
So, let’s talk about frameworks for a while&#13;
and then get back to alternative ways of actually serving&#13;
sites that use them.</p>&#13;
&#13;
<p>If you want to write a website in Python, there are&#13;
many (some say too many) Python web frameworks.&#13;
A web framework handles, at a minimum,&#13;
client requests and server responses.&#13;
Most major web frameworks include these tasks:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>HTTP protocol handling</p>&#13;
</li>&#13;
<li>&#13;
<p>Authentication (<em>authn</em>, or who are you?)</p>&#13;
</li>&#13;
<li>&#13;
<p>Authorization (<em>authz</em>, or what can you do?)</p>&#13;
</li>&#13;
<li>&#13;
<p>Establish a session</p>&#13;
</li>&#13;
<li>&#13;
<p>Get parameters</p>&#13;
</li>&#13;
<li>&#13;
<p>Validate parameters (required/optional, type, range)</p>&#13;
</li>&#13;
<li>&#13;
<p>Handle HTTP verbs</p>&#13;
</li>&#13;
<li>&#13;
<p>Route (functions/classes)</p>&#13;
</li>&#13;
<li>&#13;
<p>Serve static files (HTML, JS, CSS, images)</p>&#13;
</li>&#13;
<li>&#13;
<p>Serve dynamic data (databases, services)</p>&#13;
</li>&#13;
<li>&#13;
<p>Return values and HTTP status</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Optional features include:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Backend templates</p>&#13;
</li>&#13;
<li>&#13;
<p>Database connectivity, ORMs</p>&#13;
</li>&#13;
<li>&#13;
<p>Rate limiting</p>&#13;
</li>&#13;
<li>&#13;
<p>Asynchronous tasks</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>In the coming sections,&#13;
we write example code for two frameworks&#13;
(<code>bottle</code> and <code>flask</code>).&#13;
These are <em>synchronous</em>.&#13;
Later, I talk about alternatives,&#13;
especially for database-backed websites.&#13;
You can find a Python framework to&#13;
power any site that you can think of.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Bottle" data-type="sect2"><div class="sect2" id="bottle">&#13;
<h2>Bottle</h2>&#13;
&#13;
<p><a data-primary="Bottle" data-type="indexterm" id="ix_ch18-web-asciidoc7"/><a data-primary="web servers" data-secondary="Bottle framework" data-type="indexterm" id="ix_ch18-web-asciidoc8"/>Bottle consists of a single&#13;
Python file, so it’s very easy to try out,&#13;
and it’s easy to deploy later.&#13;
Bottle isn’t part of standard Python,&#13;
so to install it, type the following command:</p>&#13;
<pre>$ <strong>pip install bottle</strong></pre>&#13;
&#13;
<p>Here’s code that will run a test web server&#13;
and return a line of text when your browser accesses&#13;
the URL <em><a href="http://localhost:9999/"><em class="hyperlink">http://localhost:9999/</em></a></em>.&#13;
Save it as <em>bottle1.py</em> (<a data-type="xref" href="#ch18_ex02">Example 18-3</a>).</p>&#13;
<div data-type="example" id="ch18_ex02">&#13;
<h5><span class="label">Example 18-3. </span>bottle1.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">bottle</code> <code class="kn">import</code> <code class="n">route</code><code class="p">,</code> <code class="n">run</code>&#13;
&#13;
<code class="nd">@route</code><code class="p">(</code><code class="s1">'/'</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">home</code><code class="p">():</code>&#13;
  <code class="k">return</code> <code class="s2">"It isn't fancy, but it's my home page"</code>&#13;
&#13;
<code class="n">run</code><code class="p">(</code><code class="n">host</code><code class="o">=</code><code class="s1">'localhost'</code><code class="p">,</code> <code class="n">port</code><code class="o">=</code><code class="mi">9999</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>Bottle uses the <code>route</code> decorator to&#13;
associate a URL with the following function;&#13;
in this case, <code>/</code> (the home page) is handled by&#13;
the <code>home()</code> function.&#13;
Make Python run this server script by typing this:</p>&#13;
<pre>$ <strong>python bottle1.py</strong></pre>&#13;
&#13;
<p>You should see this on your browser when you access <em><a href="http://localhost:9999/"><em class="hyperlink">http://localhost:9999/</em></a></em>:</p>&#13;
&#13;
<pre data-type="programlisting">It isn't fancy, but it's my home page</pre>&#13;
&#13;
<p>The <code>run()</code> function executes <code>bottle</code>’s built-in&#13;
Python test web server.&#13;
You don’t need to use this for <code>bottle</code> programs,&#13;
but it’s useful for initial development and testing.</p>&#13;
&#13;
<p>Now, instead of creating text for the home page in code,&#13;
let’s make a separate HTML file called <em>index.html</em>&#13;
that contains this line of text:</p>&#13;
&#13;
<pre data-type="programlisting">My &lt;b&gt;new&lt;/b&gt; and &lt;i&gt;improved&lt;/i&gt; home page!!!</pre>&#13;
&#13;
<p>Make <code>bottle</code> return the contents of this file&#13;
when the home page is requested.&#13;
Save this script as <em>bottle2.py</em> (<a data-type="xref" href="#ch18_ex03">Example 18-4</a>).</p>&#13;
<div data-type="example" id="ch18_ex03">&#13;
<h5><span class="label">Example 18-4. </span>bottle2.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">bottle</code> <code class="kn">import</code> <code class="n">route</code><code class="p">,</code> <code class="n">run</code><code class="p">,</code> <code class="n">static_file</code>&#13;
&#13;
<code class="nd">@route</code><code class="p">(</code><code class="s1">'/'</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">main</code><code class="p">():</code>&#13;
    <code class="k">return</code> <code class="n">static_file</code><code class="p">(</code><code class="s1">'index.html'</code><code class="p">,</code> <code class="n">root</code><code class="o">=</code><code class="s1">'.'</code><code class="p">)</code>&#13;
&#13;
<code class="n">run</code><code class="p">(</code><code class="n">host</code><code class="o">=</code><code class="s1">'localhost'</code><code class="p">,</code> <code class="n">port</code><code class="o">=</code><code class="mi">9999</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>In the call to <code>static_file()</code>,&#13;
we want the file <code>index.html</code> in the directory&#13;
indicated by <code>root</code>&#13;
(in this case, <code>'.'</code>, the current directory).&#13;
If your previous server example code was still running,&#13;
stop it.&#13;
Now, run the new server:</p>&#13;
<pre>$ <strong>python bottle2.py</strong></pre>&#13;
&#13;
<p>When you ask your browser to get&#13;
<em>http:/localhost:9999/</em>, you should see this:</p>&#13;
<pre><code>My</code> <strong><code>new</code></strong> <code>and</code> <em><code>improved</code></em> <code>home page!!!</code></pre>&#13;
&#13;
<p>Let’s add one last example that shows how to&#13;
pass arguments to&#13;
a URL and use them.&#13;
Of course, this will be <em>bottle3.py</em>, which you can see in <a data-type="xref" href="#ch18_ex04">Example 18-5</a>.</p>&#13;
<div data-type="example" id="ch18_ex04">&#13;
<h5><span class="label">Example 18-5. </span>bottle3.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">bottle</code> <code class="kn">import</code> <code class="n">route</code><code class="p">,</code> <code class="n">run</code><code class="p">,</code> <code class="n">static_file</code>&#13;
&#13;
<code class="nd">@route</code><code class="p">(</code><code class="s1">'/'</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">home</code><code class="p">():</code>&#13;
    <code class="k">return</code> <code class="n">static_file</code><code class="p">(</code><code class="s1">'index.html'</code><code class="p">,</code> <code class="n">root</code><code class="o">=</code><code class="s1">'.'</code><code class="p">)</code>&#13;
&#13;
<code class="nd">@route</code><code class="p">(</code><code class="s1">'/echo/&lt;thing&gt;'</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">echo</code><code class="p">(</code><code class="n">thing</code><code class="p">):</code>&#13;
    <code class="k">return</code> <code class="s2">"Say hello to my little friend: </code><code class="si">%s</code><code class="s2">!"</code> <code class="o">%</code> <code class="n">thing</code>&#13;
&#13;
<code class="n">run</code><code class="p">(</code><code class="n">host</code><code class="o">=</code><code class="s1">'localhost'</code><code class="p">,</code> <code class="n">port</code><code class="o">=</code><code class="mi">9999</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>We have a new function called <code>echo()</code> and want to&#13;
pass it a string argument in a URL.&#13;
That’s what the line&#13;
<code>@route('/echo/&lt;thing&gt;')</code> in the preceding example does.&#13;
That <code>&lt;thing&gt;</code> in the route means that&#13;
whatever was in the URL after <code>/echo/</code> is&#13;
assigned to the string argument <code>thing</code>,&#13;
which is then passed to the <code>echo</code> function.&#13;
To see what happens, stop the old server&#13;
if it’s still running and then start it with the new code:</p>&#13;
<pre>$ <strong>python bottle3.py</strong></pre>&#13;
&#13;
<p>Then, access <em><a href="http://localhost:9999/echo/Mothra"><em class="hyperlink">http://localhost:9999/echo/Mothra</em></a></em>&#13;
in your web browser.&#13;
You should see the following:</p>&#13;
&#13;
<pre data-type="programlisting">Say hello to my little friend: Mothra!</pre>&#13;
&#13;
<p>Now, leave <em>bottle3.py</em> running for a minute&#13;
so that we can try something else.&#13;
You’ve been verifying that these examples work by&#13;
typing URLs into&#13;
your browser and looking at the displayed pages.&#13;
You can also use client libraries such as <code>requests</code>&#13;
to do your work for you.&#13;
Save this as <em>bottle_test.py</em> (<a data-type="xref" href="#ch18_ex05">Example 18-6</a>).</p>&#13;
<div data-type="example" id="ch18_ex05">&#13;
<h5><span class="label">Example 18-6. </span>bottle_test.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">import</code> <code class="nn">requests</code>&#13;
&#13;
<code class="n">resp</code> <code class="o">=</code> <code class="n">requests</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s1">'http://localhost:9999/echo/Mothra'</code><code class="p">)</code>&#13;
<code class="k">if</code> <code class="n">resp</code><code class="o">.</code><code class="n">status_code</code> <code class="o">==</code> <code class="mi">200</code> <code class="ow">and</code> \&#13;
  <code class="n">resp</code><code class="o">.</code><code class="n">text</code> <code class="o">==</code> <code class="s1">'Say hello to my little friend: Mothra!'</code><code class="p">:</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="s1">'It worked! That almost never happens!'</code><code class="p">)</code>&#13;
<code class="k">else</code><code class="p">:</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="s1">'Argh, got this:'</code><code class="p">,</code> <code class="n">resp</code><code class="o">.</code><code class="n">text</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>Great! Now, run it:</p>&#13;
<pre>$ <strong>python bottle_test.py</strong></pre>&#13;
&#13;
<p>You should see this in your terminal:</p>&#13;
&#13;
<pre data-type="programlisting">It worked! That almost never happens!</pre>&#13;
&#13;
<p>This is a little example of a <em>unit test</em>.&#13;
<a data-type="xref" href="ch19.html#ch_pythonista">Chapter 19</a> provides more details on why&#13;
tests are good and how to write them in Python.</p>&#13;
&#13;
<p>There’s more to Bottle than I’ve shown here.&#13;
In particular, you can try adding these arguments when&#13;
you call <code>run()</code>:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>debug=True</code> creates a debugging page&#13;
if you get an HTTP error;</p>&#13;
</li>&#13;
<li>&#13;
<p><code>reloader=True</code> reloads the page in the browser&#13;
if you change any of the Python code.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>It’s well documented at the&#13;
<a href="http://bottlepy.org/docs/dev">developer site</a>.<a data-startref="ix_ch18-web-asciidoc8" data-type="indexterm" id="idm45794969302696"/><a data-startref="ix_ch18-web-asciidoc7" data-type="indexterm" id="idm45794969301960"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Flask" data-type="sect2"><div class="sect2" id="flask">&#13;
<h2>Flask</h2>&#13;
&#13;
<p><a data-primary="Flask" data-type="indexterm" id="ix_ch18-web-asciidoc9"/><a data-primary="web servers" data-secondary="Flask framework" data-type="indexterm" id="ix_ch18-web-asciidoc10"/>Bottle is a good initial web framework.&#13;
If you need a few more cowbells and whistles,&#13;
try Flask.&#13;
It started in 2010 as an April Fools’ joke,&#13;
but enthusiastic response&#13;
encouraged the author, Armin Ronacher,&#13;
to make it a real framework.&#13;
He named the result Flask as a wordplay on Bottle.</p>&#13;
&#13;
<p>Flask is about as simple to use as Bottle,&#13;
but it supports many extensions that are useful in&#13;
professional web development,&#13;
such as Facebook authentication&#13;
and database integration.&#13;
It’s my personal favorite among Python web frameworks&#13;
because it balances ease of use with a rich feature set.</p>&#13;
&#13;
<p>The <code>flask</code> package includes the&#13;
<code>werkzeug</code> WSGI library and the&#13;
<code>jinja2</code> template library.&#13;
You can install it from a terminal:</p>&#13;
<pre>$ <strong>pip install flask</strong></pre>&#13;
&#13;
<p>Let’s replicate the final Bottle example code in Flask.&#13;
First, though, we need to make a few changes:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Flask’s default directory home for static files is&#13;
<code>static</code>, and URLs for files there also&#13;
begin with <code>/static</code>.&#13;
We change the folder to <code>'.'</code> (current directory)&#13;
and the URL prefix to <code>''</code> (empty) to allow&#13;
the URL <code>/</code> to map to the file <em>index.html</em>.</p>&#13;
</li>&#13;
<li>&#13;
<p>In the <code>run()</code> function, setting <code>debug=True</code> also&#13;
activates the automatic reloader; <code>bottle</code> used&#13;
separate arguments for debugging and reloading.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Save this file to <em>flask1.py</em> (<a data-type="xref" href="#ch18_ex06">Example 18-7</a>).</p>&#13;
<div data-type="example" id="ch18_ex06">&#13;
<h5><span class="label">Example 18-7. </span>flask1.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">flask</code> <code class="kn">import</code> <code class="n">Flask</code>&#13;
&#13;
<code class="n">app</code> <code class="o">=</code> <code class="n">Flask</code><code class="p">(</code><code class="nv-Magic">__name__</code><code class="p">,</code> <code class="n">static_folder</code><code class="o">=</code><code class="s1">'.'</code><code class="p">,</code> <code class="n">static_url_path</code><code class="o">=</code><code class="s1">''</code><code class="p">)</code>&#13;
&#13;
<code class="nd">@app.route</code><code class="p">(</code><code class="s1">'/'</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">home</code><code class="p">():</code>&#13;
    <code class="k">return</code> <code class="n">app</code><code class="o">.</code><code class="n">send_static_file</code><code class="p">(</code><code class="s1">'index.html'</code><code class="p">)</code>&#13;
&#13;
<code class="nd">@app.route</code><code class="p">(</code><code class="s1">'/echo/&lt;thing&gt;'</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">echo</code><code class="p">(</code><code class="n">thing</code><code class="p">):</code>&#13;
    <code class="k">return</code> <code class="s2">"Say hello to my little friend: </code><code class="si">%s</code><code class="s2">"</code> <code class="o">%</code> <code class="n">thing</code>&#13;
&#13;
<code class="n">app</code><code class="o">.</code><code class="n">run</code><code class="p">(</code><code class="n">port</code><code class="o">=</code><code class="mi">9999</code><code class="p">,</code> <code class="n">debug</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>Then, run the server from a terminal or window:</p>&#13;
<pre>$ <strong>python flask1.py</strong></pre>&#13;
&#13;
<p>Test the home page by typing this URL into your browser:</p>&#13;
&#13;
<pre data-type="programlisting">http://localhost:9999/</pre>&#13;
&#13;
<p>You should see the following (as you did for <code>bottle</code>):</p>&#13;
<pre><code>My</code> <strong><code>new</code></strong> <code>and</code> <em><code>improved</code></em> <code>home page!!!</code></pre>&#13;
&#13;
<p>Try the <code>/echo</code> endpoint:</p>&#13;
&#13;
<pre data-type="programlisting">http://localhost:9999/echo/Godzilla</pre>&#13;
&#13;
<p>You should see this:</p>&#13;
&#13;
<pre data-type="programlisting">Say hello to my little friend: Godzilla</pre>&#13;
&#13;
<p>There’s another benefit to setting <code>debug</code> to <code>True</code>&#13;
when calling <code>run</code>.&#13;
If an exception occurs in the server code,&#13;
Flask returns a specially formatted page with&#13;
useful details about what went wrong, and where.&#13;
Even better, you can type some commands&#13;
to see the values of variables in the server program.</p>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p><a data-primary="security issues" data-secondary="debug in production web servers" data-type="indexterm" id="idm45794969185720"/>Do not set <code>debug = True</code> in production web servers.&#13;
It exposes too much information about your server&#13;
to potential intruders.</p>&#13;
</div>&#13;
&#13;
<p>So far, the Flask example just replicates&#13;
what we did with Bottle.&#13;
What can Flask do that Bottle can’t?&#13;
Flask includes <code>jinja2</code>, a more extensive templating system.&#13;
Here’s a tiny example of how to use&#13;
<code>jinja2</code> and Flask together.</p>&#13;
&#13;
<p>Create a directory called <code>templates</code>&#13;
and a file within it called <em>flask2.html</em> (<a data-type="xref" href="#ch18_ex07">Example 18-8</a>).</p>&#13;
<div data-type="example" id="ch18_ex07">&#13;
<h5><span class="label">Example 18-8. </span>flask2.html</h5>&#13;
&#13;
<pre data-type="programlisting">&lt;html&gt;&#13;
&lt;head&gt;&#13;
&lt;title&gt;Flask2 Example&lt;/title&gt;&#13;
&lt;/head&gt;&#13;
&lt;body&gt;&#13;
Say hello to my little friend: {{ thing }}&#13;
&lt;/body&gt;&#13;
&lt;/html&gt;</pre></div>&#13;
&#13;
<p>Next, we write the server code to grab this template,&#13;
fill in the value of <em>thing</em> that we passed it,&#13;
and render it as HTML&#13;
(I’m dropping the <code>home()</code> function here to save space).&#13;
Save this as <em>flask2.py</em> (<a data-type="xref" href="#ch18_ex08">Example 18-9</a>).</p>&#13;
<div data-type="example" id="ch18_ex08">&#13;
<h5><span class="label">Example 18-9. </span>flask2.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">flask</code> <code class="kn">import</code> <code class="n">Flask</code><code class="p">,</code> <code class="n">render_template</code>&#13;
&#13;
<code class="n">app</code> <code class="o">=</code> <code class="n">Flask</code><code class="p">(</code><code class="nv-Magic">__name__</code><code class="p">)</code>&#13;
&#13;
<code class="nd">@app.route</code><code class="p">(</code><code class="s1">'/echo/&lt;thing&gt;'</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">echo</code><code class="p">(</code><code class="n">thing</code><code class="p">):</code>&#13;
    <code class="k">return</code> <code class="n">render_template</code><code class="p">(</code><code class="s1">'flask2.html'</code><code class="p">,</code> <code class="n">thing</code><code class="o">=</code><code class="n">thing</code><code class="p">)</code>&#13;
&#13;
<code class="n">app</code><code class="o">.</code><code class="n">run</code><code class="p">(</code><code class="n">port</code><code class="o">=</code><code class="mi">9999</code><code class="p">,</code> <code class="n">debug</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>That <code>thing = thing</code> argument means to pass a variable&#13;
named <code>thing</code>&#13;
to the template,&#13;
with the value of the string <code>thing</code>.</p>&#13;
&#13;
<p>Ensure that <em>flask1.py</em> isn’t still running and then start <em>flask2.py</em>:</p>&#13;
<pre>$ <strong>python flask2.py</strong></pre>&#13;
&#13;
<p>Now, type this URL:</p>&#13;
&#13;
<pre data-type="programlisting">http://localhost:9999/echo/Gamera</pre>&#13;
&#13;
<p>You should see the following:</p>&#13;
&#13;
<pre data-type="programlisting">Say hello to my little friend: Gamera</pre>&#13;
&#13;
<p>Let’s modify our template and save it in the&#13;
<em>templates</em> directory as <em>flask3.html</em>:</p>&#13;
&#13;
<pre data-type="programlisting" id="ch18_ex09">&lt;html&gt;&#13;
&lt;head&gt;&#13;
&lt;title&gt;Flask3 Example&lt;/title&gt;&#13;
&lt;/head&gt;&#13;
&lt;body&gt;&#13;
Say hello to my little friend: {{ thing }}.&#13;
Alas, it just destroyed {{ place }}!&#13;
&lt;/body&gt;&#13;
&lt;/html&gt;</pre>&#13;
&#13;
<p>You can pass this second argument to the&#13;
<code>echo</code> URL in many ways.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Pass an argument as part of the URL path" data-type="sect3"><div class="sect3" id="idm45794969085768">&#13;
<h3>Pass an argument as part of the URL path</h3>&#13;
&#13;
<p>Using this method, you simply extend the URL itself.&#13;
Save the code shown in <a data-type="xref" href="#ch18_ex10">Example 18-10</a> as <em>flask3a.py</em>.</p>&#13;
<div data-type="example" id="ch18_ex10">&#13;
<h5><span class="label">Example 18-10. </span>flask3a.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">flask</code> <code class="kn">import</code> <code class="n">Flask</code><code class="p">,</code> <code class="n">render_template</code>&#13;
&#13;
<code class="n">app</code> <code class="o">=</code> <code class="n">Flask</code><code class="p">(</code><code class="nv-Magic">__name__</code><code class="p">)</code>&#13;
&#13;
<code class="nd">@app.route</code><code class="p">(</code><code class="s1">'/echo/&lt;thing&gt;/&lt;place&gt;'</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">echo</code><code class="p">(</code><code class="n">thing</code><code class="p">,</code> <code class="n">place</code><code class="p">):</code>&#13;
    <code class="k">return</code> <code class="n">render_template</code><code class="p">(</code><code class="s1">'flask3.html'</code><code class="p">,</code> <code class="n">thing</code><code class="o">=</code><code class="n">thing</code><code class="p">,</code> <code class="n">place</code><code class="o">=</code><code class="n">place</code><code class="p">)</code>&#13;
&#13;
<code class="n">app</code><code class="o">.</code><code class="n">run</code><code class="p">(</code><code class="n">port</code><code class="o">=</code><code class="mi">9999</code><code class="p">,</code> <code class="n">debug</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>As usual, stop the previous test server script if it’s&#13;
still running and then try this new one:</p>&#13;
<pre>$ <strong>python flask3a.py</strong></pre>&#13;
&#13;
<p>The URL would look like this:</p>&#13;
&#13;
<pre data-type="programlisting">http://localhost:9999/echo/Rodan/McKeesport</pre>&#13;
&#13;
<p>And you should see the following:</p>&#13;
&#13;
<pre data-type="programlisting">Say hello to my little friend: Rodan. Alas, it just destroyed McKeesport!</pre>&#13;
&#13;
<p>Or, you can provide the arguments as <code>GET</code> parameters, as shown in <a data-type="xref" href="#ch18_ex11">Example 18-11</a>;&#13;
save this as <em>flask3b.py</em>.</p>&#13;
<div data-type="example" id="ch18_ex11">&#13;
<h5><span class="label">Example 18-11. </span>flask3b.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">flask</code> <code class="kn">import</code> <code class="n">Flask</code><code class="p">,</code> <code class="n">render_template</code><code class="p">,</code> <code class="n">request</code>&#13;
&#13;
<code class="n">app</code> <code class="o">=</code> <code class="n">Flask</code><code class="p">(</code><code class="nv-Magic">__name__</code><code class="p">)</code>&#13;
&#13;
<code class="nd">@app.route</code><code class="p">(</code><code class="s1">'/echo/'</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">echo</code><code class="p">():</code>&#13;
    <code class="n">thing</code> <code class="o">=</code> <code class="n">request</code><code class="o">.</code><code class="n">args</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s1">'thing'</code><code class="p">)</code>&#13;
    <code class="n">place</code> <code class="o">=</code> <code class="n">request</code><code class="o">.</code><code class="n">args</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s1">'place'</code><code class="p">)</code>&#13;
    <code class="k">return</code> <code class="n">render_template</code><code class="p">(</code><code class="s1">'flask3.html'</code><code class="p">,</code> <code class="n">thing</code><code class="o">=</code><code class="n">thing</code><code class="p">,</code> <code class="n">place</code><code class="o">=</code><code class="n">place</code><code class="p">)</code>&#13;
&#13;
<code class="n">app</code><code class="o">.</code><code class="n">run</code><code class="p">(</code><code class="n">port</code><code class="o">=</code><code class="mi">9999</code><code class="p">,</code> <code class="n">debug</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>Run the new server script:</p>&#13;
<pre>$ <strong>python flask3b.py</strong></pre>&#13;
&#13;
<p>This time, use this URL:</p>&#13;
&#13;
<pre data-type="programlisting">http://localhost:9999/echo?thing=Gorgo&amp;place=Wilmerding</pre>&#13;
&#13;
<p>You should get back what you see here:</p>&#13;
&#13;
<pre data-type="programlisting">Say hello to my little friend: Gorgo. Alas, it just destroyed Wilmerding!</pre>&#13;
&#13;
<p>When a <code>GET</code> command is used for a URL,&#13;
any arguments are passed&#13;
in the form&#13;
<code>&amp;<em><code>key1</code></em>=<em><code>val1</code></em>&amp;<em><code>key2</code></em>=<em><code>val2</code></em>&amp;...</code></p>&#13;
&#13;
<p><a data-primary="** (asterisks)" data-secondary="dictionary operator" data-type="indexterm" id="idm45794968889784"/><a data-primary="asterisks (**)" data-secondary="dictionary operator" data-type="indexterm" id="idm45794968888808"/>You can also use the dictionary <code>**</code> operator&#13;
to pass multiple arguments to a template&#13;
from a single dictionary&#13;
(call this <em>flask3c.py</em>), as shown in <a data-type="xref" href="#ch18_ex12">Example 18-12</a>.</p>&#13;
<div data-type="example" id="ch18_ex12">&#13;
<h5><span class="label">Example 18-12. </span>flask3c.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">flask</code> <code class="kn">import</code> <code class="n">Flask</code><code class="p">,</code> <code class="n">render_template</code><code class="p">,</code> <code class="n">request</code>&#13;
&#13;
<code class="n">app</code> <code class="o">=</code> <code class="n">Flask</code><code class="p">(</code><code class="nv-Magic">__name__</code><code class="p">)</code>&#13;
&#13;
<code class="nd">@app.route</code><code class="p">(</code><code class="s1">'/echo/'</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">echo</code><code class="p">():</code>&#13;
    <code class="n">kwargs</code> <code class="o">=</code> <code class="p">{}</code>&#13;
    <code class="n">kwargs</code><code class="p">[</code><code class="s1">'thing'</code><code class="p">]</code> <code class="o">=</code> <code class="n">request</code><code class="o">.</code><code class="n">args</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s1">'thing'</code><code class="p">)</code>&#13;
    <code class="n">kwargs</code><code class="p">[</code><code class="s1">'place'</code><code class="p">]</code> <code class="o">=</code> <code class="n">request</code><code class="o">.</code><code class="n">args</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s1">'place'</code><code class="p">)</code>&#13;
    <code class="k">return</code> <code class="n">render_template</code><code class="p">(</code><code class="s1">'flask3.html'</code><code class="p">,</code> <code class="o">**</code><code class="n">kwargs</code><code class="p">)</code>&#13;
&#13;
<code class="n">app</code><code class="o">.</code><code class="n">run</code><code class="p">(</code><code class="n">port</code><code class="o">=</code><code class="mi">9999</code><code class="p">,</code> <code class="n">debug</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>That <code>**kwargs</code> acts like <code>thing=thing, place=place</code>.&#13;
It saves some typing if there are a lot of input arguments.</p>&#13;
&#13;
<p>The <code>jinja2</code> templating language does a lot more than this.&#13;
If you’ve programmed in PHP,&#13;
you’ll see many similarities.<a data-startref="ix_ch18-web-asciidoc10" data-type="indexterm" id="idm45794968777544"/><a data-startref="ix_ch18-web-asciidoc9" data-type="indexterm" id="idm45794968776840"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before less_space" data-pdf-bookmark="Django" data-type="sect2"><div class="sect2" id="idm45794969084664">&#13;
<h2>Django</h2>&#13;
&#13;
<p><a data-primary="Django" data-type="indexterm" id="idm45794968775592"/><a data-primary="web servers" data-secondary="Django framework" data-type="indexterm" id="idm45794968774696"/><a href="https://www.djangoproject.com"><code>Django</code></a>&#13;
is a very popular Python web framework,&#13;
especially for large sites.&#13;
It’s worth learning for many reasons,&#13;
including frequent requests&#13;
for <code>django</code> experience in Python job ads.&#13;
It includes ORM code&#13;
(we talked about ORMs in <a data-type="xref" href="ch16.html#orms">“The Object-Relational Mapper (ORM)”</a>)&#13;
to create automatic web pages for&#13;
the typical database <em>CRUD</em> functions&#13;
(create, replace, update, delete) that we looked at in&#13;
<a data-type="xref" href="ch16.html#ch_databases">Chapter 16</a>.&#13;
It also includes some automatic admin pages for these,&#13;
but they’re designed for internal use by&#13;
programmers rather&#13;
than public web page use.&#13;
You don’t have to use <code>Django</code>’s ORM if you&#13;
prefer another, such as SQLAlchemy,&#13;
or direct SQL queries.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Other Frameworks" data-type="sect2"><div class="sect2" id="idm45794968769672">&#13;
<h2>Other Frameworks</h2>&#13;
&#13;
<p>You can compare the frameworks by viewing this <a href="http://bit.ly/web-frames">online table</a>:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://fastapi.tiangelo.com"><code>fastapi</code></a> handles both synchronous (WSGI) and asynchronous (ASGI) calls, uses type hints, generates test pages, and is well documented. Recommended.</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://www.web2py.com"><code>web2py</code></a>&#13;
covers much the same ground as <code>django</code>,&#13;
with a different style.</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://trypyramid.com"><code>pyramid</code></a>&#13;
grew from the earlier <code>pylons</code> project,&#13;
and is similar to <code>django</code> in scope.</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://turbogears.org"><code>turbogears</code></a>&#13;
supports an ORM, many databases, and multiple template languages.</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://pythonhosted.org/wheezy.web"><code>wheezy.web</code></a>&#13;
is a newer framework&#13;
optimized for performance.&#13;
It was <a href="http://bit.ly/wheezyweb">faster</a>&#13;
than the others in a recent test.</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://moltenframework.com"><code>molten</code></a> also uses type hints, but only supports WSGI.</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://docs.apistar.com"><code>apistar</code></a> is similar to fastapi, but is more of an API validation tool than a web framework.</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://docs.masoniteproject.com"><code>masonite</code></a>&#13;
is a Python version of Ruby on Rails,&#13;
or PHP’s Laravel<a data-startref="ix_ch18-web-asciidoc6" data-type="indexterm" id="idm45794968752376"/>.<a data-startref="ix_ch18-web-asciidoc5" data-type="indexterm" id="idm45794968751576"/><a data-startref="ix_ch18-web-asciidoc4" data-type="indexterm" id="idm45794968750872"/></p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Database Frameworks" data-type="sect1"><div class="sect1" id="web_databases">&#13;
<h1>Database Frameworks</h1>&#13;
&#13;
<p><a data-primary="databases" data-secondary="web framework support for" data-type="indexterm" id="ix_ch18-web-asciidoc11"/><a data-primary="web servers" data-secondary="database frameworks" data-type="indexterm" id="ix_ch18-web-asciidoc12"/>The web and databases are the peanut butter and jelly&#13;
of computing:&#13;
where you find one, you’ll eventually find the other.&#13;
In real-life Python applications,&#13;
at some point you’ll probably&#13;
need to provide a web interface (site and/or API)&#13;
to a relational <span class="keep-together">database.</span></p>&#13;
&#13;
<p>You could build your own with:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>A web framework like Bottle or Flask</p>&#13;
</li>&#13;
<li>&#13;
<p>A database package, like db-api or SQLAlchemy</p>&#13;
</li>&#13;
<li>&#13;
<p>A database driver, like pymysql</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Instead, you could use a web/database package&#13;
like one of these:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://connexion.readthedocs.io">connexion</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://datasette.readthedocs.io">datasette</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://github.com/jeffknupp/sandman2">sandman2</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://flask-restless.readthedocs.io">flask-restless</a></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Or, you could use a framework with built-in&#13;
database support, like Django.</p>&#13;
&#13;
<p>Your database may not be a relational one.&#13;
If your data schema varies significantly—columns that differ&#13;
markedly across rows—it might be worthwhile to consider&#13;
a <em>schemaless</em> database, such as one of the&#13;
<em>NoSQL</em> databases discussed in <a data-type="xref" href="ch16.html#ch_databases">Chapter 16</a>.&#13;
I once worked on a site that initially&#13;
stored its data in a NoSQL database,&#13;
switched to a relational one,&#13;
on to another relational one, to&#13;
a different NoSQL one,&#13;
and then finally back to one of the relational ones.<a data-startref="ix_ch18-web-asciidoc12" data-type="indexterm" id="idm45794968732232"/><a data-startref="ix_ch18-web-asciidoc11" data-type="indexterm" id="idm45794968731560"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Web Services and Automation" data-type="sect1"><div class="sect1" id="web_services">&#13;
<h1>Web Services and Automation</h1>&#13;
&#13;
<p><a data-primary="web servers" data-secondary="automation and" data-type="indexterm" id="ix_ch18-web-asciidoc13"/><a data-primary="World Wide Web" data-secondary="web services and automation" data-type="indexterm" id="ix_ch18-web-asciidoc14"/>We’ve just looked at traditional web&#13;
client and server applications,&#13;
consuming and generating HTML pages.&#13;
Yet the web has turned out to be a powerful way to&#13;
glue applications and data&#13;
in many more formats than HTML.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="webbrowser" data-type="sect2"><div class="sect2" id="idm45794968726152">&#13;
<h2>webbrowser</h2>&#13;
&#13;
<p><a data-primary="webbrowser module" data-type="indexterm" id="idm45794968724584"/>Let’s start begin a little surprise.&#13;
Start a Python session in a terminal window&#13;
and type the following:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">antigravity</code></pre>&#13;
&#13;
<p>This secretly calls the standard library’s&#13;
<code>webbrowser</code> module&#13;
and directs your browser to an enlightening&#13;
Python link.<sup><a data-type="noteref" href="ch18.html#idm45794968721928" id="idm45794968721928-marker">3</a></sup></p>&#13;
&#13;
<p>You can use this module directly.&#13;
This program loads the main Python site’s page&#13;
in your browser:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">webbrowser</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">url</code> <code class="o">=</code> <code class="s">'http://www.python.org/'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">webbrowser</code><code class="o">.</code><code class="n">open</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>&#13;
<code class="go">True</code></pre>&#13;
&#13;
<p>This opens it in a new window:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">webbrowser</code><code class="o">.</code><code class="n">open_new</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>&#13;
<code class="go">True</code></pre>&#13;
&#13;
<p>And this opens it in a new tab,&#13;
if your browser supports tabs:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="n">webbrowser</code><code class="o">.</code><code class="n">open_new_tab</code><code class="p">(</code><code class="s">'http://www.python.org/'</code><code class="p">)</code>&#13;
<code class="go">True</code></pre>&#13;
&#13;
<p>The <code>webbrowser</code> makes your browser do all the work.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="webview" data-type="sect2"><div class="sect2" id="webview">&#13;
<h2>webview</h2>&#13;
&#13;
<p><a data-primary="webview module" data-type="indexterm" id="idm45794968620952"/>Rather than calling your browser as <code>webbrowser</code> does,&#13;
<code>webview</code> displays the page in its own window,&#13;
using your machine’s native GUI.&#13;
To install on Linux or macOS:</p>&#13;
<pre>$ <strong>pip install pywebview[qt]</strong></pre>&#13;
&#13;
<p>For Windows:</p>&#13;
<pre>$ <strong>pip install pywebview[cef]</strong></pre>&#13;
&#13;
<p>See the installation&#13;
<a href="https://oreil.ly/NiYD7">notes</a>&#13;
if you have problems.</p>&#13;
&#13;
<p>Here’s an example in which I gave it the official US government&#13;
current time site:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">webview</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">url</code> <code class="o">=</code> <code class="nb">input</code><code class="p">(</code><code class="s">"URL? "</code><code class="p">)</code>&#13;
<code class="go">URL? http://time.gov</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">webview</code><code class="o">.</code><code class="n">create_window</code><code class="p">(</code><code class="n">f</code><code class="s">"webview display of {url}"</code><code class="p">,</code> <code class="n">url</code><code class="p">)</code></pre>&#13;
&#13;
<p><a data-type="xref" href="#fig1801">Figure 18-1</a> shows the result I got back.</p>&#13;
&#13;
<figure><div class="figure" id="fig1801">&#13;
<img alt="inp2 1801" src="assets/inp2_1801.png"/>&#13;
<h6><span class="label">Figure 18-1. </span><code>webview</code> display window</h6>&#13;
</div></figure>&#13;
&#13;
<p>To stop the program, kill the display window.<a data-startref="ix_ch18-web-asciidoc14" data-type="indexterm" id="idm45794968540040"/><a data-startref="ix_ch18-web-asciidoc13" data-type="indexterm" id="idm45794968539336"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Web APIs and REST" data-type="sect1"><div class="sect1" id="rest">&#13;
<h1>Web APIs and REST</h1>&#13;
&#13;
<p><a data-primary="API (application programming interface)" data-type="indexterm" id="idm45794968533384"/><a data-primary="Representational State Transfer (REST)" data-type="indexterm" id="idm45794968532712"/><a data-primary="World Wide Web" data-secondary="APIs and REST" data-type="indexterm" id="idm45794968532072"/>Often, data is available only within web pages.&#13;
If you want to access it,&#13;
you need to access the pages through a web browser&#13;
and read it.&#13;
If the authors of the website made any changes&#13;
since the last time&#13;
you visited, the location and style&#13;
of the data might have changed.</p>&#13;
&#13;
<p>Instead of publishing web pages,&#13;
you can provide data through a web&#13;
<em>application programming interface</em>&#13;
(API).&#13;
Clients access your service by making requests to URLs&#13;
and getting back responses containing status and data.&#13;
Instead of HTML pages, the data is in formats&#13;
that are easier for programs to consume,&#13;
such as JSON or XML (refer to <a data-type="xref" href="ch16.html#ch_databases">Chapter 16</a>&#13;
for more about these formats).</p>&#13;
&#13;
<p><em>Representational State Transfer</em> (REST)&#13;
was defined by Roy Fielding in his doctoral thesis.&#13;
Many products claim to have a&#13;
<em>REST interface</em> or a <em>RESTful interface</em>.&#13;
In <span class="keep-together">practice,</span> this often only means that&#13;
they have a <em>web</em> interface—definitions of URLs to access a web service.</p>&#13;
&#13;
<p>A <em>RESTful</em> service uses the HTTP <em>verbs</em>&#13;
in specific ways:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>HEAD</code> gets information about the resource, but not its data.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>GET</code> retrieves the resource’s data from the server.&#13;
This is the standard method used by your browser.&#13;
<code>GET</code> should not be used to create, change, or delete data.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>POST</code> creates a new resource.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>PUT</code> replaces an existing resource, creating it if it doesn’t exist.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>PATCH</code> partially updates a resource.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>DELETE</code> deletes. Truth in advertising!</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>A RESTful client can also request one or more&#13;
content types from the server&#13;
by using HTTP request headers.&#13;
For example, a complex service with a&#13;
REST interface might prefer&#13;
its input and output to be JSON strings.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Crawl and Scrape" data-type="sect1"><div class="sect1" id="scraping">&#13;
<h1>Crawl and Scrape</h1>&#13;
&#13;
<p><a data-primary="crawling" data-type="indexterm" id="ix_ch18-web-asciidoc15"/><a data-primary="scraping" data-type="indexterm" id="ix_ch18-web-asciidoc16"/><a data-primary="web crawling" data-type="indexterm" id="ix_ch18-web-asciidoc17"/><a data-primary="web scraping" data-type="indexterm" id="ix_ch18-web-asciidoc18"/><a data-primary="World Wide Web" data-secondary="crawling and scraping" data-type="indexterm" id="ix_ch18-web-asciidoc19"/>Sometimes, you might want a little bit of information—a movie rating, stock price, or product availability—but what you need is available only in HTML pages,&#13;
surrounded by ads and extraneous content.</p>&#13;
&#13;
<p>You could extract what you’re looking for&#13;
manually by doing the following:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Type the URL into your browser.</p>&#13;
</li>&#13;
<li>&#13;
<p>Wait for the remote page to load.</p>&#13;
</li>&#13;
<li>&#13;
<p>Look through the displayed page for the&#13;
information you want.</p>&#13;
</li>&#13;
<li>&#13;
<p>Write it down somewhere.</p>&#13;
</li>&#13;
<li>&#13;
<p>Possibly repeat the process for related URLs.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>However, it’s much more satisfying to automate&#13;
some or all of these steps.&#13;
An automated web fetcher is called a&#13;
<em>crawler</em> or&#13;
<em>spider</em>.<sup><a data-type="noteref" href="ch18.html#idm45794968478664" id="idm45794968478664-marker">4</a></sup>&#13;
After the contents have been retrieved&#13;
from the remote web servers,&#13;
a <em>scraper</em> parses it to find the needle in the haystack.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Scrapy" data-type="sect2"><div class="sect2" id="scrapy">&#13;
<h2>Scrapy</h2>&#13;
&#13;
<p><a data-primary="scrapy" data-type="indexterm" id="idm45794968475720"/>If you need an industrial-strength combined&#13;
crawler <em>and</em> scraper,&#13;
<a href="http://scrapy.org">Scrapy</a> is worth downloading:</p>&#13;
<pre>$ <strong>pip install scrapy</strong></pre>&#13;
&#13;
<p>This installs the module and a standalone&#13;
command-line <code>scrapy</code> program.</p>&#13;
&#13;
<p>Scrapy is a framework, not just a module such as <code>BeautifulSoup</code>.&#13;
It does more, but it’s more complex to set up.&#13;
To learn more about Scrapy, read&#13;
<a href="https://oreil.ly/8IYoe">“Scrapy at a Glance”</a>&#13;
and the&#13;
<a href="https://oreil.ly/4H_AW">tutorial</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="BeautifulSoup" data-type="sect2"><div class="sect2" id="beautifulsoup">&#13;
<h2>BeautifulSoup</h2>&#13;
&#13;
<p><a data-primary="BeautifulSoup" data-type="indexterm" id="idm45794968467768"/>If you already have the HTML data from a website and&#13;
just want to extract&#13;
data from it,&#13;
<a href="https://oreil.ly/c43mV"><code>BeautifulSoup</code></a>&#13;
is a good choice.&#13;
HTML parsing is harder than it sounds.&#13;
This is because much of the HTML&#13;
on public web pages is technically invalid:&#13;
unclosed tags,&#13;
incorrect nesting,&#13;
and other complications.&#13;
If you try to write your own&#13;
HTML parser by using regular expressions&#13;
(discussed in <a data-type="xref" href="ch12.html#regex">“Text Strings: Regular Expressions”</a>)&#13;
you’ll soon encounter these messes.</p>&#13;
&#13;
<p>To install <code>BeautifulSoup</code>, type the following command&#13;
(don’t forget the final <code>4</code>, or <code>pip</code> will&#13;
try to install an older version and probably fail):</p>&#13;
<pre>$ <strong>pip install beautifulsoup4</strong></pre>&#13;
&#13;
<p>Now, let’s use it to get all the links from a web page.&#13;
The HTML <code>a</code> element represents a link,&#13;
and <code>href</code> is its attribute representing&#13;
the link destination.&#13;
In <a data-type="xref" href="#ch18_ex13">Example 18-13</a>,&#13;
we’ll define the function <code>get_links()</code>&#13;
to do the grunt work,&#13;
and a main program to get one or more URLs&#13;
as command-line arguments.</p>&#13;
<div data-type="example" id="ch18_ex13">&#13;
<h5><span class="label">Example 18-13. </span>links.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">get_links</code><code class="p">(</code><code class="n">url</code><code class="p">):</code>&#13;
    <code class="kn">import</code> <code class="nn">requests</code>&#13;
    <code class="kn">from</code> <code class="nn">bs4</code> <code class="kn">import</code> <code class="n">BeautifulSoup</code> <code class="k">as</code> <code class="n">soup</code>&#13;
    <code class="n">result</code> <code class="o">=</code> <code class="n">requests</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>&#13;
    <code class="n">page</code> <code class="o">=</code> <code class="n">result</code><code class="o">.</code><code class="n">text</code>&#13;
    <code class="n">doc</code> <code class="o">=</code> <code class="n">soup</code><code class="p">(</code><code class="n">page</code><code class="p">)</code>&#13;
    <code class="n">links</code> <code class="o">=</code> <code class="p">[</code><code class="n">element</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s1">'href'</code><code class="p">)</code> <code class="k">for</code> <code class="n">element</code> <code class="ow">in</code> <code class="n">doc</code><code class="o">.</code><code class="n">find_all</code><code class="p">(</code><code class="s1">'a'</code><code class="p">)]</code>&#13;
    <code class="k">return</code> <code class="n">links</code>&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="kn">import</code> <code class="nn">sys</code>&#13;
    <code class="k">for</code> <code class="n">url</code> <code class="ow">in</code> <code class="n">sys</code><code class="o">.</code><code class="n">argv</code><code class="p">[</code><code class="mi">1</code><code class="p">:]:</code>&#13;
        <code class="k">print</code><code class="p">(</code><code class="s1">'Links in'</code><code class="p">,</code> <code class="n">url</code><code class="p">)</code>&#13;
        <code class="k">for</code> <code class="n">num</code><code class="p">,</code> <code class="n">link</code> <code class="ow">in</code> <code class="nb">enumerate</code><code class="p">(</code><code class="n">get_links</code><code class="p">(</code><code class="n">url</code><code class="p">),</code> <code class="n">start</code><code class="o">=</code><code class="mi">1</code><code class="p">):</code>&#13;
            <code class="k">print</code><code class="p">(</code><code class="n">num</code><code class="p">,</code> <code class="n">link</code><code class="p">)</code>&#13;
        <code class="k">print</code><code class="p">()</code></pre></div>&#13;
&#13;
<p>I saved this program as <em>links.py</em>&#13;
and then ran this command:</p>&#13;
<pre>$ <strong>python links.py http://boingboing.net</strong></pre>&#13;
&#13;
<p>Here are the first few lines that it printed:</p>&#13;
&#13;
<pre data-type="programlisting">Links in http://boingboing.net/&#13;
1 http://boingboing.net/suggest.html&#13;
2 http://boingboing.net/category/feature/&#13;
3 http://boingboing.net/category/review/&#13;
4 http://boingboing.net/category/podcasts&#13;
5 http://boingboing.net/category/video/&#13;
6 http://bbs.boingboing.net/&#13;
7 javascript:void(0)&#13;
8 http://shop.boingboing.net/&#13;
9 http://boingboing.net/about&#13;
10 http://boingboing.net/contact</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Requests-HTML" data-type="sect2"><div class="sect2" id="requests_html">&#13;
<h2>Requests-HTML</h2>&#13;
&#13;
<p><a data-primary="requests-html library" data-type="indexterm" id="idm45794968352280"/>Kenneth Reitz,&#13;
the author of the popular web client package <code>requests</code>,&#13;
has written a new scraping library called&#13;
<a href="http://html.python-requests.org">requests-html</a>&#13;
(for Python 3.6 and newer versions).</p>&#13;
&#13;
<p>It gets a page and processes its elements,&#13;
so you can find, for example, all of its links,&#13;
or all the contents or attributes of any HTML element.</p>&#13;
&#13;
<p>It has a clean design, similar to <code>requests</code> and other&#13;
packages by the same author.&#13;
Overall, it may be easier to use than <code>beautifulsoup</code> or&#13;
Scrapy.<a data-startref="ix_ch18-web-asciidoc19" data-type="indexterm" id="idm45794968348520"/><a data-startref="ix_ch18-web-asciidoc18" data-type="indexterm" id="idm45794968347784"/><a data-startref="ix_ch18-web-asciidoc17" data-type="indexterm" id="idm45794968347112"/><a data-startref="ix_ch18-web-asciidoc16" data-type="indexterm" id="idm45794968346440"/><a data-startref="ix_ch18-web-asciidoc15" data-type="indexterm" id="idm45794968345768"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Let’s Watch a Movie" data-type="sect1"><div class="sect1" id="idm45794968344968">&#13;
<h1>Let’s Watch a Movie</h1>&#13;
&#13;
<p><a data-primary="World Wide Web" data-secondary="video search program example" data-type="indexterm" id="ix_ch18-web-asciidoc20"/>Let’s build a full program.</p>&#13;
&#13;
<p>It searches for videos&#13;
using an API at the&#13;
Internet Archive.<sup><a data-type="noteref" href="ch18.html#idm45794968341672" id="idm45794968341672-marker">5</a></sup>&#13;
This is one of the few APIs that allows anonymous access&#13;
<em>and</em> should still be around after this book is printed.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Most web APIs require&#13;
you to first get an <em>API key</em>,&#13;
and provide it every time you access that API.&#13;
Why?&#13;
It’s the tragedy of the commons:&#13;
free resources with anonymous access&#13;
are often overused or abused.&#13;
That’s why we can’t have nice things.</p>&#13;
</div>&#13;
&#13;
<p>The following program shown in <a data-type="xref" href="#ch18_ex14">Example 18-14</a> does the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Prompts you for part of a movie or video title</p>&#13;
</li>&#13;
<li>&#13;
<p>Searches for it at the Internet Archive</p>&#13;
</li>&#13;
<li>&#13;
<p>Returns a list of identifiers, names, and descriptions</p>&#13;
</li>&#13;
<li>&#13;
<p>Lists them and asks you to select one</p>&#13;
</li>&#13;
<li>&#13;
<p>Displays that video in your web browser</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Save this as <em>iamovies.py</em>.</p>&#13;
&#13;
<p>The <code>search()</code> function uses <code>requests</code> to&#13;
access the URL, get the results, and convert them to JSON.&#13;
The other functions handle everything else.&#13;
You’ll see usage of list comprehensions,&#13;
string slices, and other things that you’ve seen&#13;
in previous chapters.&#13;
(The line numbers are not part of the source;&#13;
they’ll be used in the exercises to locate code pieces.)</p>&#13;
<div data-type="example" id="ch18_ex14">&#13;
<h5><span class="label">Example 18-14. </span>iamovies.py</h5>&#13;
&#13;
<pre data-code-language="python" data-line-numbering="numbered" data-type="programlisting"><span class="line-number">1 </span><code class="sd">"""Find a video at the Internet Archive</code>&#13;
<span class="line-number">2 </span><code class="sd">by a partial title match and display it."""</code>&#13;
<span class="line-number">3 </span>&#13;
<span class="line-number">4 </span><code class="kn">import</code> <code class="nn">sys</code>&#13;
<span class="line-number">5 </span><code class="kn">import</code> <code class="nn">webbrowser</code>&#13;
<span class="line-number">6 </span><code class="kn">import</code> <code class="nn">requests</code>&#13;
<span class="line-number">7 </span>&#13;
<span class="line-number">8 </span><code class="k">def</code> <code class="nf">search</code><code class="p">(</code><code class="n">title</code><code class="p">):</code>&#13;
<span class="line-number">9 </span>    <code class="sd">"""Return a list of 3-item tuples (identifier,</code>&#13;
<span class="line-number">10 </span><code class="sd">       title, description) about videos</code>&#13;
<span class="line-number">11 </span><code class="sd">       whose titles partially match :title."""</code>&#13;
<span class="line-number">12 </span>    <code class="n">search_url</code> <code class="o">=</code> <code class="s2">"https://archive.org/advancedsearch.php"</code>&#13;
<span class="line-number">13 </span>    <code class="n">params</code> <code class="o">=</code> <code class="p">{</code>&#13;
<span class="line-number">14 </span>        <code class="s2">"q"</code><code class="p">:</code> <code class="s2">"title:({}) AND mediatype:(movies)"</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">title</code><code class="p">),</code>&#13;
<span class="line-number">15 </span>        <code class="s2">"fl"</code><code class="p">:</code> <code class="s2">"identifier,title,description"</code><code class="p">,</code>&#13;
<span class="line-number">16 </span>        <code class="s2">"output"</code><code class="p">:</code> <code class="s2">"json"</code><code class="p">,</code>&#13;
<span class="line-number">17 </span>        <code class="s2">"rows"</code><code class="p">:</code> <code class="mi">10</code><code class="p">,</code>&#13;
<span class="line-number">18 </span>        <code class="s2">"page"</code><code class="p">:</code> <code class="mi">1</code><code class="p">,</code>&#13;
<span class="line-number">19 </span>        <code class="p">}</code>&#13;
<span class="line-number">20 </span>    <code class="n">resp</code> <code class="o">=</code> <code class="n">requests</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="n">search_url</code><code class="p">,</code> <code class="n">params</code><code class="o">=</code><code class="n">params</code><code class="p">)</code>&#13;
<span class="line-number">21 </span>    <code class="n">data</code> <code class="o">=</code> <code class="n">resp</code><code class="o">.</code><code class="n">json</code><code class="p">()</code>&#13;
<span class="line-number">22 </span>    <code class="n">docs</code> <code class="o">=</code> <code class="p">[(</code><code class="n">doc</code><code class="p">[</code><code class="s2">"identifier"</code><code class="p">],</code> <code class="n">doc</code><code class="p">[</code><code class="s2">"title"</code><code class="p">],</code> <code class="n">doc</code><code class="p">[</code><code class="s2">"description"</code><code class="p">])</code>&#13;
<span class="line-number">23 </span>            <code class="k">for</code> <code class="n">doc</code> <code class="ow">in</code> <code class="n">data</code><code class="p">[</code><code class="s2">"response"</code><code class="p">][</code><code class="s2">"docs"</code><code class="p">]]</code>&#13;
<span class="line-number">24 </span>    <code class="k">return</code> <code class="n">docs</code>&#13;
<span class="line-number">25 </span>&#13;
<span class="line-number">26 </span><code class="k">def</code> <code class="nf">choose</code><code class="p">(</code><code class="n">docs</code><code class="p">):</code>&#13;
<span class="line-number">27 </span>    <code class="sd">"""Print line number, title and truncated description for</code>&#13;
<span class="line-number">28 </span><code class="sd">       each tuple in :docs. Get the user to pick a line</code>&#13;
<span class="line-number">29 </span><code class="sd">       number. If it's valid, return the first item in the</code>&#13;
<span class="line-number">30 </span><code class="sd">       chosen tuple (the "identifier"). Otherwise, return None."""</code>&#13;
<span class="line-number">31 </span>    <code class="n">last</code> <code class="o">=</code> <code class="nb">len</code><code class="p">(</code><code class="n">docs</code><code class="p">)</code> <code class="o">-</code> <code class="mi">1</code>&#13;
<span class="line-number">32 </span>    <code class="k">for</code> <code class="n">num</code><code class="p">,</code> <code class="n">doc</code> <code class="ow">in</code> <code class="nb">enumerate</code><code class="p">(</code><code class="n">docs</code><code class="p">):</code>&#13;
<span class="line-number">33 </span>        <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"{num}: ({doc[1]}) {doc[2][:30]}..."</code><code class="p">)</code>&#13;
<span class="line-number">34 </span>    <code class="n">index</code> <code class="o">=</code> <code class="nb">input</code><code class="p">(</code><code class="n">f</code><code class="s2">"Which would you like to see (0 to {last})? "</code><code class="p">)</code>&#13;
<span class="line-number">35 </span>    <code class="k">try</code><code class="p">:</code>&#13;
<span class="line-number">36 </span>        <code class="k">return</code> <code class="n">docs</code><code class="p">[</code><code class="nb">int</code><code class="p">(</code><code class="n">index</code><code class="p">)][</code><code class="mi">0</code><code class="p">]</code>&#13;
<span class="line-number">37 </span>    <code class="k">except</code><code class="p">:</code>&#13;
<span class="line-number">38 </span>        <code class="k">return</code> <code class="bp">None</code>&#13;
<span class="line-number">39 </span>&#13;
<span class="line-number">40 </span><code class="k">def</code> <code class="nf">display</code><code class="p">(</code><code class="n">identifier</code><code class="p">):</code>&#13;
<span class="line-number">41 </span>    <code class="sd">"""Display the Archive video with :identifier in the browser"""</code>&#13;
<span class="line-number">42 </span>    <code class="n">details_url</code> <code class="o">=</code> <code class="s2">"https://archive.org/details/{}"</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">identifier</code><code class="p">)</code>&#13;
<span class="line-number">43 </span>    <code class="k">print</code><code class="p">(</code><code class="s2">"Loading"</code><code class="p">,</code> <code class="n">details_url</code><code class="p">)</code>&#13;
<span class="line-number">44 </span>    <code class="n">webbrowser</code><code class="o">.</code><code class="n">open</code><code class="p">(</code><code class="n">details_url</code><code class="p">)</code>&#13;
<span class="line-number">45 </span>&#13;
<span class="line-number">46 </span><code class="k">def</code> <code class="nf">main</code><code class="p">(</code><code class="n">title</code><code class="p">):</code>&#13;
<span class="line-number">47 </span>    <code class="sd">"""Find any movies that match :title.</code>&#13;
<span class="line-number">48 </span><code class="sd">       Get the user's choice and display it in the browser."""</code>&#13;
<span class="line-number">49 </span>    <code class="n">identifiers</code> <code class="o">=</code> <code class="n">search</code><code class="p">(</code><code class="n">title</code><code class="p">)</code>&#13;
<span class="line-number">50 </span>    <code class="k">if</code> <code class="n">identifiers</code><code class="p">:</code>&#13;
<span class="line-number">51 </span>        <code class="n">identifier</code> <code class="o">=</code> <code class="n">choose</code><code class="p">(</code><code class="n">identifiers</code><code class="p">)</code>&#13;
<span class="line-number">52 </span>        <code class="k">if</code> <code class="n">identifier</code><code class="p">:</code>&#13;
<span class="line-number">53 </span>            <code class="n">display</code><code class="p">(</code><code class="n">identifier</code><code class="p">)</code>&#13;
<span class="line-number">54 </span>        <code class="k">else</code><code class="p">:</code>&#13;
<span class="line-number">55 </span>            <code class="k">print</code><code class="p">(</code><code class="s2">"Nothing selected"</code><code class="p">)</code>&#13;
<span class="line-number">56 </span>    <code class="k">else</code><code class="p">:</code>&#13;
<span class="line-number">57 </span>        <code class="k">print</code><code class="p">(</code><code class="s2">"Nothing found for"</code><code class="p">,</code> <code class="n">title</code><code class="p">)</code>&#13;
<span class="line-number">58 </span>&#13;
<span class="line-number">59 </span><code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s2">"__main__"</code><code class="p">:</code>&#13;
<span class="line-number">60 </span>    <code class="n">main</code><code class="p">(</code><code class="n">sys</code><code class="o">.</code><code class="n">argv</code><code class="p">[</code><code class="mi">1</code><code class="p">])</code></pre></div>&#13;
&#13;
<p>Here’s what I got when I ran this program&#13;
and searched for&#13;
<strong><code>eegah</code></strong>:<sup><a data-type="noteref" href="ch18.html#idm45794968318712" id="idm45794968318712-marker">6</a></sup></p>&#13;
<pre>$ <strong>python iamovies.py eegah</strong>&#13;
0: (Eegah) From IMDb : While driving thro...&#13;
1: (Eegah) This film has fallen into the ...&#13;
2: (Eegah) A caveman is discovered out in...&#13;
3: (Eegah (1962)) While driving through the dese...&#13;
4: (It's "Eegah" - Part 2) Wait till you see how this end...&#13;
5: (EEGAH trailer) The infamous modern-day cavema...&#13;
6: (It's "Eegah" - Part 1) Count Gore De Vol shares some ...&#13;
7: (Midnight Movie show: eegah) Arch Hall Jr...&#13;
Which would you like to see (0 to 7)? 2&#13;
Loading https://archive.org/details/Eegah</pre>&#13;
&#13;
<p class="pagebreak-before">It displayed the page in my browser, ready to run (<a data-type="xref" href="#fig1802">Figure 18-2</a>).<a data-startref="ix_ch18-web-asciidoc20" data-type="indexterm" id="idm45794968315336"/></p>&#13;
&#13;
<figure><div class="figure" id="fig1802">&#13;
<img alt="inp2 1802" src="assets/inp2_1802.png"/>&#13;
<h6><span class="label">Figure 18-2. </span>Movie search result</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Coming Up" data-type="sect1"><div class="sect1" id="idm45794968344376">&#13;
<h1>Coming Up</h1>&#13;
&#13;
<p>The next chapter is an extremely practical one,&#13;
covering the nuts and bolts of modern Python development.&#13;
Learn how to become a steely-eyed,&#13;
card-carrying Pythonista.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before less_space" data-pdf-bookmark="Things to Do" data-type="sect1"><div class="sect1" id="idm45794967988776">&#13;
<h1>Things to Do</h1>&#13;
&#13;
<p>18.1&#13;
<a data-primary="World Wide Web" data-secondary="practice exercises" data-type="indexterm" id="idm45794967986920"/>If you haven’t installed <code>flask</code> yet, do so now.&#13;
This will also install&#13;
<code>werkzeug</code>, <code>jinja2</code>, and possibly other packages.</p>&#13;
&#13;
<p>18.2&#13;
Build a skeleton website,&#13;
using Flask’s debug/reload development web server.&#13;
Ensure that the server starts up for hostname&#13;
<code>localhost</code> on default port <code>5000</code>.&#13;
If your computer is already using port 5000 for&#13;
something else, use another port number.</p>&#13;
&#13;
<p>18.3&#13;
Add a <code>home()</code> function to handle requests for the home page.&#13;
Set it up to return the string&#13;
<code>It's alive!</code>.</p>&#13;
&#13;
<p>18.4&#13;
Create a Jinja2 template file called <em>home.html</em> with the following contents:</p>&#13;
&#13;
<pre data-type="programlisting">&lt;html&gt;&#13;
&lt;head&gt;&#13;
&lt;title&gt;It's alive!&lt;/title&gt;&#13;
&lt;body&gt;&#13;
I'm of course referring to {{thing}}, which is {{height}} feet tall and {{color}}.&#13;
&lt;/body&gt;&#13;
&lt;/html&gt;</pre>&#13;
&#13;
<p>18.5&#13;
Modify your server’s <code>home()</code> function to use the <em>home.html</em> template.&#13;
Provide it with three <code>GET</code> parameters:&#13;
<code>thing</code>, <code>height</code>, and <code>color</code>.<a data-startref="ix_ch18-web-asciidoc0" data-type="indexterm" id="idm45794967976536"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<div data-type="footnotes"><p data-type="footnote" id="idm45794970286888"><sup><a href="ch18.html#idm45794970286888-marker">1</a></sup> A company founded by Steve Jobs during his exile from Apple.</p><p data-type="footnote" id="idm45794970285336"><sup><a href="ch18.html#idm45794970285336-marker">2</a></sup> Let’s kill a <em>zombie lie</em> here. Senator (and later, Vice President) Al Gore championed bipartisan legislation and cooperation that greatly advanced the early internet, including funding for the group that wrote Mosaic. He never claimed that he “invented the internet”; that phrase was falsely attributed to him by political rivals as he began running for president in 2000.</p><p data-type="footnote" id="idm45794968721928"><sup><a href="ch18.html#idm45794968721928-marker">3</a></sup> If you don’t see it for some reason, visit <a href="http://xkcd.com/353">xkcd</a>.</p><p data-type="footnote" id="idm45794968478664"><sup><a href="ch18.html#idm45794968478664-marker">4</a></sup> Unappealing terms to arachnophobes.</p><p data-type="footnote" id="idm45794968341672"><sup><a href="ch18.html#idm45794968341672-marker">5</a></sup> If you remember, I used another Archive API in the main example program we looked at in <a data-type="xref" href="ch01.html#ch_intro">Chapter 1</a>.</p><p data-type="footnote" id="idm45794968318712"><sup><a href="ch18.html#idm45794968318712-marker">6</a></sup> With Richard Kiel as the caveman, years before he was Jaws in a Bond movie.</p></div></div></section></body></html>