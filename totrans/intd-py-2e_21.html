<html><head></head><body><section data-pdf-bookmark="Chapter 19. Be a Pythonista" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch_pythonista">&#13;
<h1><span class="label">Chapter 19. </span>Be a Pythonista</h1>&#13;
&#13;
<blockquote>&#13;
<p>Always wanted to travel back in time to try&#13;
fighting a younger version of yourself?&#13;
Software development is the career for you!</p>&#13;
<p data-type="attribution"><a href="http://bit.ly/loh-tweet">Elliot Loh</a></p>&#13;
</blockquote>&#13;
&#13;
<p>This chapter is devoted to the art and science of Python development,&#13;
with “best practice” recommendations.&#13;
Absorb them,&#13;
and you too can be a card-carrying <span class="keep-together">Pythonista.</span></p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="About Programming" data-type="sect1"><div class="sect1" id="idm45794967971384">&#13;
<h1>About Programming</h1>&#13;
&#13;
<p>First, a few notes about programming,&#13;
based on personal experience.</p>&#13;
&#13;
<p>My original career path was science, and&#13;
I taught myself programming to analyze and&#13;
display experimental data.&#13;
I expected computer programming to be like&#13;
my impression of accounting—precise but dull.&#13;
I was surprised to find that I enjoyed it.&#13;
Part of the fun was its logical aspects—like solving puzzles—but part was creative.&#13;
You had to write your program correctly to get the right results,&#13;
but you had the freedom to write it any way you wanted.&#13;
It was an unusual balance of right-brain and left-brain <span class="keep-together">thinking.</span></p>&#13;
&#13;
<p>After I wandered off into a career in programming,&#13;
I also learned that the field had many niches,&#13;
with very different tasks and types of people.&#13;
You could delve into computer graphics,&#13;
operating systems,&#13;
business applications—even science.</p>&#13;
&#13;
<p>If you’re a programmer, you might have had&#13;
a similar experience yourself.&#13;
If you’re not,&#13;
you might try programming a bit to see if it fits your personality,&#13;
or at least helps you to get something done.&#13;
As I may have mentioned much earlier in this book,&#13;
math skills are not so important.&#13;
It seems that the ability to think logically is most <span class="keep-together">important</span>&#13;
and that an aptitude for languages seems to help.&#13;
Finally, patience also helps,&#13;
especially when you’re tracking down an elusive bug in your code.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Find Python Code" data-type="sect1"><div class="sect1" id="idm45794967965880">&#13;
<h1>Find Python Code</h1>&#13;
&#13;
<p><a data-primary="best practices" data-secondary="finding code" data-type="indexterm" id="idm45794967964600"/><a data-primary="code" data-secondary="finding" data-type="indexterm" id="idm45794967963624"/><a data-primary="Python standard library" data-secondary="finding code" data-type="indexterm" id="idm45794967962680"/>When you need to develop some code,&#13;
the fastest solution is to steal it…from a source that allows it.</p>&#13;
&#13;
<p>The Python&#13;
<a href="http://docs.python.org/3/library">standard library</a>&#13;
is wide, deep,&#13;
and mostly clear.&#13;
Dive in and look for those pearls.</p>&#13;
&#13;
<p>Like the halls of fame for various sports,&#13;
it takes time for a module to get into the standard library.&#13;
New packages are appearing outside constantly,&#13;
and throughout this book, I’ve highlighted some&#13;
that either do something new or do something old better.&#13;
Python is advertised as <em>batteries included</em>,&#13;
but you might need a new kind of battery.</p>&#13;
&#13;
<p>So where, outside the standard library,&#13;
should you look for good Python code?</p>&#13;
&#13;
<p><a data-primary="Cheese Shop (Python Package Index )" data-type="indexterm" id="idm45794967958520"/><a data-primary="Python Package Index (PyPI)" data-type="indexterm" id="idm45794967957656"/>The first place to look is the&#13;
<a href="https://pypi.org">Python Package Index (PyPI)</a>.&#13;
Formerly named the <em>Cheese Shop</em> after a Monty Python skit,&#13;
this site is constantly updated with Python packages—more than 113,000 as I write this.&#13;
When you use <code>pip</code> (see the next section), it searches PyPI.&#13;
The main PyPI page shows the most recently added packages.&#13;
You can also conduct a direct search by typing something&#13;
into the search box in the middle of the PyPI home page.&#13;
For example, <code>genealogy</code> yields 21 matches,&#13;
and <code>movies</code> yields 528.</p>&#13;
&#13;
<p>Another popular repository is GitHub.&#13;
See what Python packages are currently&#13;
<a href="https://github.com/trending?l=python">trending</a>.</p>&#13;
&#13;
<p><a href="http://bit.ly/popular-recipes">Popular Python recipes</a>&#13;
has more than four thousand short Python programs, on every subject.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Install Packages" data-type="sect1"><div class="sect1" id="idm45794967951880">&#13;
<h1>Install Packages</h1>&#13;
&#13;
<p><a data-primary="installation" data-secondary="packages" data-type="indexterm" id="ix_ch19-pythonista-asciidoc0"/><a data-primary="packages" data-secondary="installing" data-type="indexterm" id="ix_ch19-pythonista-asciidoc1"/>There are many ways to install Python packages:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Use <code>pip</code> if you can.&#13;
It’s the most common method by far.&#13;
You can install most of the Python packages&#13;
you’re likely to encounter with <code>pip</code>.</p>&#13;
</li>&#13;
<li>&#13;
<p>Use <code>pipenv</code>, which combines <code>pip</code> and <code>virtualenv</code></p>&#13;
</li>&#13;
<li>&#13;
<p>Sometimes, you can use a package manager&#13;
for your operating system.</p>&#13;
</li>&#13;
<li>&#13;
<p>Use <code>conda</code> if you do a lot of scientific work&#13;
and want to use the Anaconda distribution of Python.&#13;
See <a data-type="xref" href="app02.html#install_anaconda">“Install Anaconda”</a> for details.</p>&#13;
</li>&#13;
<li>&#13;
<p>Install from source.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>If you’re interested in several packages in the same area,&#13;
you might find a Python distribution that already includes them.&#13;
For instance,&#13;
in <a data-type="xref" href="ch22.html#ch_science">Chapter 22</a>,&#13;
you can try out a number of numeric and scientific programs&#13;
that would be tedious to install individually but are included&#13;
with distributions such as Anaconda.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Use pip" data-type="sect2"><div class="sect2" id="pip">&#13;
<h2>Use pip</h2>&#13;
&#13;
<p><a data-primary="installation" data-secondary="pip" data-type="indexterm" id="idm45794967935544"/><a data-primary="pip" data-type="indexterm" id="idm45794967934344"/>Python packaging has had some limitations.&#13;
An earlier installation tool called <code>easy_install</code>&#13;
has been replaced by one called <code>pip</code>,&#13;
but neither had been in the standard Python installation.&#13;
If you’re supposed to install things by using <code>pip</code>,&#13;
from where did you get <code>pip</code>?&#13;
Starting with Python 3.4,&#13;
<code>pip</code> will finally be included with the rest of Python&#13;
to avoid such existential crises.&#13;
If you’re using an earlier version of Python 3&#13;
and don’t have <code>pip</code>,&#13;
you can get it from&#13;
<a class="orm:hideurl" href="http://www.pip-installer.org"><em>http://www.pip-installer.org</em></a>.</p>&#13;
&#13;
<p>The simplest use of <code>pip</code> is to&#13;
install the latest version of a single package by using&#13;
the following command:</p>&#13;
<pre>$ <strong>pip install flask</strong></pre>&#13;
&#13;
<p>You will see details on what it’s doing,&#13;
just so you don’t think it’s goofing off:&#13;
downloading, running <em>setup.py</em>,&#13;
installing files on your disk, and other details.</p>&#13;
&#13;
<p>You can also ask <code>pip</code> to install a specific version:</p>&#13;
<pre>$ <strong>pip install flask==0.9.0</strong></pre>&#13;
&#13;
<p>Or, a minimum version (this is useful when some feature&#13;
that you can’t live without&#13;
turns up in a particular version):</p>&#13;
<pre>$ <strong>pip install 'flask≥0.9.0'</strong></pre>&#13;
&#13;
<p>In the preceding example,&#13;
those single quotes prevent the <code>&gt;</code>&#13;
from being interpreted by the shell&#13;
to redirect output to a file called <code>=0.9.0</code>.</p>&#13;
&#13;
<p>If you want to install more than one Python package,&#13;
you can use a&#13;
<a href="http://bit.ly/pip-require">requirements file</a>.&#13;
Although it has many options,&#13;
the simplest use is a list of packages, one per line,&#13;
optionally with a specific or relative version:</p>&#13;
<pre>$ <strong>pip -r requirements.txt</strong></pre>&#13;
&#13;
<p>Your sample <em>requirements.txt</em> file might contain this:</p>&#13;
&#13;
<pre data-type="programlisting">flask==0.9.0&#13;
django&#13;
psycopg2</pre>&#13;
&#13;
<p class="pagebreak-before">A few more examples:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Install the latest version: <code>pip install --upgrade <em>package</em></code></p>&#13;
</li>&#13;
<li>&#13;
<p>Delete a package: <code>pip uninstall <em>package</em></code></p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Use virtualenv" data-type="sect2"><div class="sect2" id="virtualenv">&#13;
<h2>Use virtualenv</h2>&#13;
&#13;
<p><a data-primary="installation" data-secondary="virtualenv" data-type="indexterm" id="idm45794967912888"/><a data-primary="virtualenv" data-type="indexterm" id="idm45794967911752"/>The standard way of installing third-party Python packages&#13;
is to use <code>pip</code> and <span class="keep-together"><code>virtual</code></span><code>env</code>.&#13;
I show how to install <code>virtualenv</code> in <a data-type="xref" href="app02.html#install_virtualenv">“Install virtualenv”</a>.</p>&#13;
&#13;
<p>A <em>virtual environment</em> is just a directory that contains&#13;
the Python interpreter, some other programs like <code>pip</code>,&#13;
and some packages.&#13;
You <em>activate</em> it by running the shell script <code>activate</code>&#13;
that’s in the <code>bin</code> directory of that virtual environment.&#13;
This sets the environment variable <code>$PATH</code> that your shell&#13;
uses to find programs.&#13;
By activating a virtual enviroment, you put its <code>bin</code>&#13;
directory ahead of the usual directories in your <code>$PATH</code>.&#13;
The result is that when you type a command like <code>pip</code>&#13;
or <code>python</code>, your shell first finds the one in your virtual environment,&#13;
instead of system directories like&#13;
<span class="keep-together"><code>/bin</code></span>, <code>/usr/bin</code>, or <code>/usr/local/bin</code>.</p>&#13;
&#13;
<p>You don’t want to install software into those system directories&#13;
anyhow, because:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>You don’t have permission to write to them.</p>&#13;
</li>&#13;
<li>&#13;
<p>Even if you could, overwriting your system’s standard&#13;
programs (like <code>python</code>)&#13;
could cause problems.</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Use pipenv" data-type="sect2"><div class="sect2" id="pipenv">&#13;
<h2>Use pipenv</h2>&#13;
&#13;
<p><a data-primary="installation" data-secondary="pipenv" data-type="indexterm" id="idm45794967896264"/><a data-primary="pipenv" data-type="indexterm" id="idm45794967895064"/>A recent package called&#13;
<a href="http://docs.pipenv.org">pipenv</a>&#13;
combines our friends <code>pip</code> and <code>virtualenv</code>.&#13;
It also addresses dependency issues that&#13;
can arise when using <code>pip</code> in different environments&#13;
(such as your local development machine, versus&#13;
staging, versus production):</p>&#13;
<pre>$ <strong>pip install pipenv</strong></pre>&#13;
&#13;
<p>Its use is recommended by the&#13;
<a href="https://www.pypa.io">Python Packaging Authority</a>—a working group trying to improve Python’s&#13;
packaging workflow.&#13;
This is not the same as the group that defines core Python&#13;
itself,&#13;
so <code>pipenv</code> is not a part of the standard library.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Use a Package Manager" data-type="sect2"><div class="sect2" id="idm45794967889720">&#13;
<h2>Use a Package Manager</h2>&#13;
&#13;
<p><a data-primary="installation" data-secondary="package manager" data-type="indexterm" id="idm45794967888520"/><a data-primary="macOS" data-secondary="package managers" data-type="indexterm" id="idm45794967887320"/><a data-primary="package managers" data-type="indexterm" id="idm45794967886376"/>Apple’s macOS includes the third-party packagers&#13;
<a href="http://brew.sh">homebrew</a> (<code>brew</code>) and&#13;
<a href="http://www.macports.org"><code>ports</code></a>.&#13;
They work a little like <code>pip</code>,&#13;
but aren’t restricted to Python packages.</p>&#13;
&#13;
<p><a data-primary="Linux" data-secondary="package manager" data-type="indexterm" id="idm45794967882920"/>Linux has a different manager for each distribution.&#13;
The most popular are&#13;
<code>apt-get</code>,&#13;
<code>yum</code>,&#13;
<code>dpkg</code>, and&#13;
<code>zypper</code>.</p>&#13;
&#13;
<p><a data-primary="Windows" data-secondary="package managers" data-type="indexterm" id="idm45794967879768"/>Windows has the Windows Installer&#13;
and package files with a <em>.msi</em> suffix.&#13;
If you installed Python for Windows,&#13;
it was probably in the MSI format.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Install from Source" data-type="sect2"><div class="sect2" id="idm45794967877944">&#13;
<h2>Install from Source</h2>&#13;
&#13;
<p><a data-primary="packages" data-secondary="installing from source" data-type="indexterm" id="idm45794967876744"/>Occasionally, a Python package is new,&#13;
or the author hasn’t managed to make it available&#13;
with <code>pip</code>.&#13;
To build the package, you generally do the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Download the code.</p>&#13;
</li>&#13;
<li>&#13;
<p>Extract the files by using <code>zip</code>, <code>tar</code>,&#13;
or another appropriate tool if they’re archived or compressed.</p>&#13;
</li>&#13;
<li>&#13;
<p>Run <code>python setup.py install</code>&#13;
in the directory containing a <em>setup.py</em> file.</p>&#13;
</li>&#13;
</ul>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>As always, be careful what you download and install.&#13;
It’s a little harder to hide malware&#13;
in Python programs, which are readable text, but it has happened.<a data-startref="ix_ch19-pythonista-asciidoc1" data-type="indexterm" id="idm45794967868696"/><a data-startref="ix_ch19-pythonista-asciidoc0" data-type="indexterm" id="idm45794967867928"/></p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Integrated Development Environments" data-type="sect1"><div class="sect1" id="ide">&#13;
<h1>Integrated Development Environments</h1>&#13;
&#13;
<p><a data-primary="best practices" data-secondary="integrated development environments (IDEs)" data-type="indexterm" id="ix_ch19-pythonista-asciidoc2"/><a data-primary="integrated development environments (IDEs)" data-type="indexterm" id="ix_ch19-pythonista-asciidoc3"/>I’ve used a plain-text interface for programs in this book,&#13;
but that doesn’t mean that you need to run everything&#13;
in a console or text window.&#13;
There are many free and commercial integrated development&#13;
environments (IDEs), which are&#13;
GUIs with support for such tools as text editors,&#13;
debuggers, library searching, and so on.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="IDLE" data-type="sect2"><div class="sect2" id="idle">&#13;
<h2>IDLE</h2>&#13;
&#13;
<p><a data-primary="IDLE" data-type="indexterm" id="idm45794967860888"/><a data-primary="integrated development environments (IDEs)" data-secondary="IDLE" data-type="indexterm" id="idm45794967860184"/><a href="http://bit.ly/py-idle">IDLE</a>&#13;
is the only Python IDE that’s included&#13;
with the standard distribution.&#13;
It’s based on tkinter, and its GUI is plain.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="PyCharm" data-type="sect2"><div class="sect2" id="pycharm">&#13;
<h2>PyCharm</h2>&#13;
&#13;
<p><a data-primary="integrated development environments (IDEs)" data-secondary="PyCharm" data-type="indexterm" id="idm45794967856680"/><a data-primary="PyCharm" data-type="indexterm" id="idm45794967855672"/><a href="http://www.jetbrains.com/pycharm">PyCharm</a>&#13;
is a recent graphic IDE with many features.&#13;
The community edition is free,&#13;
and you can get a free license for the <span class="keep-together">professional</span> edition&#13;
to use in a classroom or an open source project.&#13;
<a data-type="xref" href="#img_pycharm">Figure 19-1</a> shows its initial display.</p>&#13;
&#13;
<figure><div class="figure" id="img_pycharm">&#13;
<img alt="inp2 1901" src="assets/inp2_1901.png"/>&#13;
<h6><span class="label">Figure 19-1. </span>Startup screen for PyCharm</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="IPython" data-type="sect2"><div class="sect2" id="ipython">&#13;
<h2>IPython</h2>&#13;
&#13;
<p><a data-primary="integrated development environments (IDEs)" data-secondary="IPython" data-type="indexterm" id="idm45794967848488"/><a data-primary="IPython" data-type="indexterm" id="idm45794967847544"/><a href="http://ipython.org">iPython</a> started as an enhanced&#13;
terminal (text) Python IDE,&#13;
but evolved a graphical interface&#13;
with the metaphor of a <em>notebook</em>.&#13;
It integrated many packages that are discussed in this book,&#13;
including&#13;
Matplotlib and NumPy,&#13;
and became a popular tool in scientific computing.</p>&#13;
&#13;
<p>You install the basic text version with&#13;
(you guessed it)&#13;
<code>pip install ipython</code>.&#13;
When you start it, you’ll see something like this:</p>&#13;
<pre>$ <strong>ipython</strong>&#13;
Python 3.7.3 (v3.7.3:ef4ec6ed12, Mar 25 2019, 16:39:00)&#13;
Type 'copyright', 'credits' or 'license' for more information&#13;
IPython 7.3.0 -- An enhanced Interactive Python. Type '?' for help.&#13;
&#13;
In [1]:&#13;
</pre>&#13;
&#13;
<p>As you know,&#13;
the standard Python interpreter uses the input prompts&#13;
<code>&gt;&gt;&gt;</code>&#13;
and&#13;
<code>...</code>  to indicate where and when you should type code.&#13;
IPython tracks everything you type in a list called <code>In</code>, and all your&#13;
output in <code>Out</code>.&#13;
Each input can be more than one line, so you submit it by holding&#13;
the Shift key while pressing Enter.</p>&#13;
&#13;
<p class="pagebreak-before">Here’s a one-line example:</p>&#13;
<pre>In [1]: <strong>print("Hello? World?")</strong>&#13;
Hello? World?&#13;
&#13;
In [2]:</pre>&#13;
&#13;
<p><code>In</code> and <code>Out</code> are automatically numbered lists, letting you access any&#13;
of the inputs you typed or outputs you received.</p>&#13;
&#13;
<p>If you type <code>?</code> after a variable, IPython tells you its type, value,&#13;
ways of making a variable of that type, and some explanation:</p>&#13;
<pre>In [4]: <strong>answer = 42</strong>&#13;
&#13;
In [5]: <strong>answer?</strong></pre>&#13;
&#13;
<pre data-type="programlisting">Type:       int&#13;
String Form:42&#13;
Docstring:&#13;
int(x=0) -&gt; integer&#13;
int(x, base=10) -&gt; integer&#13;
&#13;
Convert a number or string to an integer, or return 0 if no arguments&#13;
are given.  If x is a number, return x.__int__().  For floating point&#13;
numbers, this truncates towards zero.&#13;
&#13;
If x is not a number or if base is given, then x must be a string,&#13;
bytes, or bytearray instance representing an integer literal in the&#13;
given base.  The literal can be preceded by '+' or '-' and be surrounded&#13;
by whitespace.  The base defaults to 10.  Valid bases are 0 and 2-36.&#13;
Base 0 means to interpret the base from the string as an integer literal.&#13;
&gt;&gt;&gt; int('0b100', base=0)&#13;
4</pre>&#13;
&#13;
<p>Name lookup is a popular feature of IDEs such as IPython.&#13;
If you press the Tab key right after some characters,&#13;
IPython shows all variables, keywords, and functions that begin with those characters.&#13;
Let’s define some variables and then find everything that begins with the letter <code>f</code>:</p>&#13;
<pre>In [6]: <strong>fee = 1</strong>&#13;
&#13;
In [7]: <strong>fie = 2</strong>&#13;
&#13;
In [8]: <strong>fo = 3</strong>&#13;
&#13;
In [9]: <strong>fum = 4</strong>&#13;
&#13;
In [10]: <strong>f</strong><em>tab</em>&#13;
%%file    fie       finally   fo        format    frozenset&#13;
fee       filter    float     for       from      fum</pre>&#13;
&#13;
<p>If you type <code>fe</code> followed by the Tab key, it expands to the variable <code>fee</code>,&#13;
which, in this program, is the only thing that starts with <code>fe</code>:</p>&#13;
<pre>In [11]: <strong>fee</strong>&#13;
Out[11]: 1</pre>&#13;
&#13;
<p>There’s much more to IPython.&#13;
Take a look at its&#13;
<a href="https://oreil.ly/PIvVK">tutorial</a>&#13;
to get a feel for its features.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Jupyter Notebook" data-type="sect2"><div class="sect2" id="jupyter">&#13;
<h2>Jupyter Notebook</h2>&#13;
&#13;
<p><a data-primary="integrated development environments (IDEs)" data-secondary="Jupyter Notebook" data-type="indexterm" id="idm45794967824696"/><a data-primary="Jupyter Notebook" data-type="indexterm" id="idm45794967823624"/><a href="https://jupyter.org">Jupyter</a>&#13;
is an evolution of IPython.&#13;
The name combines the languages Julia, Python, and R—all of which are popular in data science and scientific computing.&#13;
Jupyter Notebooks are a modern way to develop&#13;
and publish your code with documentation for any of these languages.</p>&#13;
&#13;
<p>If you’d like to play with it first before installing anything&#13;
on your computer,&#13;
you can first&#13;
<a href="https://jupyter.org/try">try it out</a>&#13;
in your web browser.</p>&#13;
&#13;
<p>To install Jupyter Notebook locally, type&#13;
<code>pip install jupyter</code>.&#13;
Run it with <code>jupyter notebook</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="JupyterLab" data-type="sect2"><div class="sect2" id="jupyterlab">&#13;
<h2>JupyterLab</h2>&#13;
&#13;
<p><a data-primary="integrated development environments (IDEs)" data-secondary="JupyterLab" data-type="indexterm" id="idm45794967817848"/><a data-primary="JupyterLab" data-type="indexterm" id="idm45794967816552"/>JupyterLab&#13;
is the next generation of Jupyter Notebook&#13;
and will eventually replace it.&#13;
As with the Notebook, you can first&#13;
<a href="https://jupyter.org/try">try out</a>&#13;
JupyterLab in your browser.&#13;
You install it locally with&#13;
<code>pip install jupyterlab</code> and then run it with&#13;
<code>jupyter lab</code>.<a data-startref="ix_ch19-pythonista-asciidoc3" data-type="indexterm" id="idm45794967814008"/><a data-startref="ix_ch19-pythonista-asciidoc2" data-type="indexterm" id="idm45794967813304"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Name and Document" data-type="sect1"><div class="sect1" id="documentation">&#13;
<h1>Name and Document</h1>&#13;
&#13;
<p><a data-primary="documentation" data-type="indexterm" id="idm45794967810696"/>You won’t remember what you wrote.&#13;
Sometimes, I look at code that I wrote even recently&#13;
and wonder where on earth it came from.&#13;
That’s why it helps to document your code.&#13;
Documentation can include comments and docstrings,&#13;
but it can also incorporate informative naming of&#13;
variables, functions, modules, and classes.&#13;
Don’t be obsessive, as in this example:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="c"># I'm going to assign 10 to the variable "num" here:</code>&#13;
<code class="gp">... </code><code class="n">num</code> <code class="o">=</code> <code class="mi">10</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="c"># I hope that worked</code>&#13;
<code class="gp">... </code><code class="k">print</code><code class="p">(</code><code class="n">num</code><code class="p">)</code>&#13;
<code class="go">10</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="c"># Whew.</code></pre>&#13;
&#13;
<p>Instead, say <em>why</em> you assigned the value <code>10</code>.&#13;
Point out why you called the variable <code>num</code>.&#13;
If you were writing the venerable Fahrenheit-to-Celsius converter,&#13;
you might name variables to explain what they do&#13;
rather than a lump of magic code.&#13;
And a little test code wouldn’t hurt (<a data-type="xref" href="#ex1901">Example 19-1</a>).</p>&#13;
<div data-type="example" id="ex1901">&#13;
<h5><span class="label">Example 19-1. </span>ftoc1.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">ftoc</code><code class="p">(</code><code class="n">f_temp</code><code class="p">):</code>&#13;
    <code class="s2">"Convert Fahrenheit temperature &lt;f_temp&gt; to Celsius and return it."</code>&#13;
    <code class="n">f_boil_temp</code> <code class="o">=</code> <code class="mf">212.0</code>&#13;
    <code class="n">f_freeze_temp</code> <code class="o">=</code> <code class="mf">32.0</code>&#13;
    <code class="n">c_boil_temp</code> <code class="o">=</code> <code class="mf">100.0</code>&#13;
    <code class="n">c_freeze_temp</code> <code class="o">=</code> <code class="mf">0.0</code>&#13;
    <code class="n">f_range</code> <code class="o">=</code> <code class="n">f_boil_temp</code> <code class="o">-</code> <code class="n">f_freeze_temp</code>&#13;
    <code class="n">c_range</code> <code class="o">=</code> <code class="n">c_boil_temp</code> <code class="o">-</code> <code class="n">c_freeze_temp</code>&#13;
    <code class="n">f_c_ratio</code> <code class="o">=</code> <code class="n">c_range</code> <code class="o">/</code> <code class="n">f_range</code>&#13;
    <code class="n">c_temp</code> <code class="o">=</code> <code class="p">(</code><code class="n">f_temp</code> <code class="o">-</code> <code class="n">f_freeze_temp</code><code class="p">)</code> <code class="o">*</code> <code class="n">f_c_ratio</code> <code class="o">+</code> <code class="n">c_freeze_temp</code>&#13;
    <code class="k">return</code> <code class="n">c_temp</code>&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="k">for</code> <code class="n">f_temp</code> <code class="ow">in</code> <code class="p">[</code><code class="o">-</code><code class="mf">40.0</code><code class="p">,</code> <code class="mf">0.0</code><code class="p">,</code> <code class="mf">32.0</code><code class="p">,</code> <code class="mf">100.0</code><code class="p">,</code> <code class="mf">212.0</code><code class="p">]:</code>&#13;
        <code class="n">c_temp</code> <code class="o">=</code> <code class="n">ftoc</code><code class="p">(</code><code class="n">f_temp</code><code class="p">)</code>&#13;
        <code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="si">%f</code><code class="s1"> F =&gt; </code><code class="si">%f</code><code class="s1"> C'</code> <code class="o">%</code> <code class="p">(</code><code class="n">f_temp</code><code class="p">,</code> <code class="n">c_temp</code><code class="p">))</code></pre></div>&#13;
&#13;
<p>Let’s run the tests:</p>&#13;
<pre>$ <strong>python ftoc1.py</strong></pre>&#13;
&#13;
<pre data-type="programlisting">-40.000000 F =&gt; -40.000000 C&#13;
0.000000 F =&gt; -17.777778 C&#13;
32.000000 F =&gt; 0.000000 C&#13;
100.000000 F =&gt; 37.777778 C&#13;
212.000000 F =&gt; 100.000000 C</pre>&#13;
&#13;
<p>We can make (at least) two improvements:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Python doesn’t have constants,&#13;
but the PEP8 stylesheet&#13;
<a href="http://bit.ly/pep-constant">recommends</a>&#13;
using capital letters and underscores&#13;
(e.g., <code>ALL_CAPS</code>) when naming variables that&#13;
should be considered constants.&#13;
Let’s rename those constant-y variables in our example.</p>&#13;
</li>&#13;
<li>&#13;
<p>Because we precompute values based on constant values,&#13;
let’s move them to the top level of the module.&#13;
Then, they’ll be calculated only once rather than&#13;
in every call to the <code>ftoc()</code> function.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p><a data-type="xref" href="#ex1902">Example 19-2</a> shows the result of our rework.</p>&#13;
<div data-type="example" id="ex1902">&#13;
<h5><span class="label">Example 19-2. </span>ftoc2.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">F_BOIL_TEMP</code> <code class="o">=</code> <code class="mf">212.0</code>&#13;
<code class="n">F_FREEZE_TEMP</code> <code class="o">=</code> <code class="mf">32.0</code>&#13;
<code class="n">C_BOIL_TEMP</code> <code class="o">=</code> <code class="mf">100.0</code>&#13;
<code class="n">C_FREEZE_TEMP</code> <code class="o">=</code> <code class="mf">0.0</code>&#13;
<code class="n">F_RANGE</code> <code class="o">=</code> <code class="n">F_BOIL_TEMP</code> <code class="o">-</code> <code class="n">F_FREEZE_TEMP</code>&#13;
<code class="n">C_RANGE</code> <code class="o">=</code> <code class="n">C_BOIL_TEMP</code> <code class="o">-</code> <code class="n">C_FREEZE_TEMP</code>&#13;
<code class="n">F_C_RATIO</code> <code class="o">=</code> <code class="n">C_RANGE</code> <code class="o">/</code> <code class="n">F_RANGE</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">ftoc</code><code class="p">(</code><code class="n">f_temp</code><code class="p">):</code>&#13;
    <code class="s2">"Convert Fahrenheit temperature &lt;f_temp&gt; to Celsius and return it."</code>&#13;
    <code class="n">c_temp</code> <code class="o">=</code> <code class="p">(</code><code class="n">f_temp</code> <code class="o">-</code> <code class="n">F_FREEZE_TEMP</code><code class="p">)</code> <code class="o">*</code> <code class="n">F_C_RATIO</code> <code class="o">+</code> <code class="n">C_FREEZE_TEMP</code>&#13;
    <code class="k">return</code> <code class="n">c_temp</code>&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="k">for</code> <code class="n">f_temp</code> <code class="ow">in</code> <code class="p">[</code><code class="o">-</code><code class="mf">40.0</code><code class="p">,</code> <code class="mf">0.0</code><code class="p">,</code> <code class="mf">32.0</code><code class="p">,</code> <code class="mf">100.0</code><code class="p">,</code> <code class="mf">212.0</code><code class="p">]:</code>&#13;
        <code class="n">c_temp</code> <code class="o">=</code> <code class="n">ftoc</code><code class="p">(</code><code class="n">f_temp</code><code class="p">)</code>&#13;
        <code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="si">%f</code><code class="s1"> F =&gt; </code><code class="si">%f</code><code class="s1"> C'</code> <code class="o">%</code> <code class="p">(</code><code class="n">f_temp</code><code class="p">,</code> <code class="n">c_temp</code><code class="p">))</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Add Type Hints" data-type="sect1"><div class="sect1" id="type_hints">&#13;
<h1>Add Type Hints</h1>&#13;
&#13;
<p><a data-primary="type hints (type annotations)" data-type="indexterm" id="idm45794967495816"/><a data-primary="variables" data-secondary="type hints (type annotations)" data-type="indexterm" id="idm45794967495144"/>Static languages require you to define the&#13;
types of your variables,&#13;
and they can catch some errors at compile time.&#13;
As you know, Python doesn’t do this,&#13;
and you can encounter bugs only when the code is run.&#13;
Python variables are names&#13;
and only refer to actual objects.&#13;
Objects have strict types,&#13;
but names can point to any object at any time.</p>&#13;
&#13;
<p>Yet in real code (in Python and other languages),&#13;
a name tends to refer to a particular object.&#13;
It would help, at least in documentation,&#13;
if we could annotate things (variables, function returns,&#13;
and so on) with the object types we expect them to&#13;
be referencing.&#13;
Then, developers would not need to look through&#13;
as much code to see how a particular variable is supposed to act.</p>&#13;
&#13;
<p>Python 3.x added&#13;
<em>type hints</em>&#13;
(or <em>type annotations</em>)&#13;
to address this.&#13;
It’s completely optional,&#13;
and does not force types on variables.&#13;
It helps developers who are used to static languages,&#13;
where variable types <em>must</em> be declared.</p>&#13;
&#13;
<p>Hints for a function that converts a number to a string&#13;
would look like this:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">num_to_str</code><code class="p">(</code><code class="n">num</code><code class="p">:</code> <code class="nb">int</code><code class="p">)</code> <code class="o">-&gt;</code> <code class="nb">str</code><code class="p">:</code>&#13;
    <code class="k">return</code> <code class="nb">str</code><code class="p">(</code><code class="n">num</code><code class="p">)</code></pre>&#13;
&#13;
<p>These are only hints, and they don’t change how Python works.&#13;
Their main use is for documentation,&#13;
but people are finding more uses.&#13;
For example, the&#13;
<a href="https://fastapi.tiangolo.com">FastAPI</a>&#13;
web framework uses hints&#13;
to generate web documentation with live forms for testing.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Test" data-type="sect1"><div class="sect1" id="test">&#13;
<h1>Test</h1>&#13;
&#13;
<p><a data-primary="best practices" data-secondary="code, testing" data-type="indexterm" id="ix_ch19-pythonista-asciidoc4"/><a data-primary="code" data-secondary="testing" data-type="indexterm" id="ix_ch19-pythonista-asciidoc5"/><a data-primary="testing" data-type="indexterm" id="ix_ch19-pythonista-asciidoc6"/>You probably already know this,&#13;
but if not:&#13;
even trivial code changes can break your program.&#13;
Python lacks the type-checking of static languages,&#13;
which makes some things easier but&#13;
also lets undesirable results through the door.&#13;
Testing is essential.</p>&#13;
&#13;
<p>The very simplest way to test Python programs&#13;
is to add <code>print()</code> statements.&#13;
The Python interactive interpreter’s&#13;
Read-Evaluate-Print Loop (REPL)&#13;
lets you edit and test changes quickly.&#13;
However, you don’t want <code>print()</code>&#13;
statements in production code, so you need to&#13;
remember to remove them all.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Check with pylint, pyflakes, flake8, or pep8" data-type="sect2"><div class="sect2" id="pylint">&#13;
<h2>Check with pylint, pyflakes, flake8, or pep8</h2>&#13;
&#13;
<p><a data-primary="pyflakes" data-type="indexterm" id="ix_ch19-pythonista-asciidoc7"/><a data-primary="pylint" data-type="indexterm" id="ix_ch19-pythonista-asciidoc8"/><a data-primary="testing" data-secondary="Python code checkers" data-type="indexterm" id="ix_ch19-pythonista-asciidoc9"/>The next step, before creating actual test programs,&#13;
is to run a Python code checker.&#13;
The most popular are&#13;
<a href="http://www.pylint.org"><code>pylint</code></a>&#13;
and&#13;
<a href="http://bit.ly/pyflakes"><code>pyflakes</code></a>.&#13;
You can install either or both by using <code>pip</code>:</p>&#13;
<pre>$ <strong>pip install pylint</strong>&#13;
$ <strong>pip install pyflakes</strong></pre>&#13;
&#13;
<p>These check for actual code errors&#13;
(such as referring to a variable before assigning it a value)&#13;
and style faux pas&#13;
(the code equivalent of wearing plaids and stripes).&#13;
<a data-type="xref" href="#ex1903">Example 19-3</a> is a fairly meaningless program with a bug and style issue.</p>&#13;
<div data-type="example" id="ex1903">&#13;
<h5><span class="label">Example 19-3. </span>style1.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">a</code> <code class="o">=</code> <code class="mi">1</code>&#13;
<code class="n">b</code> <code class="o">=</code> <code class="mi">2</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="n">a</code><code class="p">)</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="n">b</code><code class="p">)</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="n">c</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>Here’s the initial output of <code>pylint</code>:</p>&#13;
<pre>$ <strong>pylint style1.py</strong>&#13;
No config file found, using default configuration&#13;
************* Module style1&#13;
C:  1,0: Missing docstring&#13;
C:  1,0: Invalid name "a" for type constant&#13;
  (should match (([A-Z_][A-Z0-9_]*)|(__.*__))$)&#13;
C:  2,0: Invalid name "b" for type constant&#13;
  (should match (([A-Z_][A-Z0-9_]*)|(__.*__))$)&#13;
E:  5,6: Undefined variable 'c'</pre>&#13;
&#13;
<p>Much further down, under <code>Global evaluation</code>,&#13;
is our score (10.0 is perfect):</p>&#13;
&#13;
<pre data-type="programlisting">Your code has been rated at -3.33/10</pre>&#13;
&#13;
<p>Ouch. Let’s fix the bug first.&#13;
That <code>pylint</code> output line starting with an&#13;
<code>E</code> indicates an <code>Error</code>,&#13;
which occurred because we didn’t assign&#13;
a value to <code>c</code> before we printed it.&#13;
Take a look at <a data-type="xref" href="#ex1904">Example 19-4</a> to see how we can fix that.</p>&#13;
<div data-type="example" id="ex1904">&#13;
<h5><span class="label">Example 19-4. </span>style2.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">a</code> <code class="o">=</code> <code class="mi">1</code>&#13;
<code class="n">b</code> <code class="o">=</code> <code class="mi">2</code>&#13;
<code class="n">c</code> <code class="o">=</code> <code class="mi">3</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="n">a</code><code class="p">)</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="n">b</code><code class="p">)</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="n">c</code><code class="p">)</code></pre></div>&#13;
<pre>$ <strong>pylint style2.py</strong></pre>&#13;
&#13;
<pre data-type="programlisting">No config file found, using default configuration&#13;
************* Module style2&#13;
C:  1,0: Missing docstring&#13;
C:  1,0: Invalid name "a" for type constant&#13;
  (should match (([A-Z_][A-Z0-9_]*)|(__.*__))$)&#13;
C:  2,0: Invalid name "b" for type constant&#13;
  (should match (([A-Z_][A-Z0-9_]*)|(__.*__))$)&#13;
C:  3,0: Invalid name "c" for type constant&#13;
  (should match (([A-Z_][A-Z0-9_]*)|(__.*__))$)</pre>&#13;
&#13;
<p>Good, no more <code>E</code> lines.&#13;
And our score jumped from -3.33 to 4.29:</p>&#13;
&#13;
<pre data-type="programlisting">Your code has been rated at 4.29/10</pre>&#13;
&#13;
<p><code>pylint</code> wants a docstring&#13;
(a short text at the top of a module or&#13;
function, describing the code),&#13;
and it thinks short variable names&#13;
such as <code>a</code>, <code>b</code>, and <code>c</code> are tacky.&#13;
Let’s make <code>pylint</code> happier and&#13;
improve <em>style2.py</em> to <em>style3.py</em> (<a data-type="xref" href="#ex1905">Example 19-5</a>).</p>&#13;
<div data-type="example" id="ex1905">&#13;
<h5><span class="label">Example 19-5. </span>style3.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="s2">"Module docstring goes here"</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">func</code><code class="p">():</code>&#13;
    <code class="s2">"Function docstring goes here. Hi, Mom!"</code>&#13;
    <code class="n">first</code> <code class="o">=</code> <code class="mi">1</code>&#13;
    <code class="n">second</code> <code class="o">=</code> <code class="mi">2</code>&#13;
    <code class="n">third</code> <code class="o">=</code> <code class="mi">3</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">first</code><code class="p">)</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">second</code><code class="p">)</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">third</code><code class="p">)</code>&#13;
&#13;
<code class="n">func</code><code class="p">()</code></pre></div>&#13;
<pre>$ <strong>pylint style3.py</strong>&#13;
No config file found, using default configuration</pre>&#13;
&#13;
<p>Hey, no complaints. And our score?</p>&#13;
&#13;
<pre data-type="programlisting">Your code has been rated at 10.00/10</pre>&#13;
&#13;
<p>And there was much rejoicing.</p>&#13;
&#13;
<p><a data-primary="pep8" data-type="indexterm" id="idm45794967245368"/>Another style checker is&#13;
<a href="https://pypi.python.org/pypi/pep8"><code>pep8</code></a>,&#13;
which you can install in your sleep by now:</p>&#13;
<pre>$ <strong>pip install pep8</strong></pre>&#13;
&#13;
<p>What does it say about our style makeover?</p>&#13;
<pre>$ <strong>pep8 style3.py</strong>&#13;
style3.py:3:1: E302 expected 2 blank lines, found 1</pre>&#13;
&#13;
<p>To be really stylish,&#13;
it’s recommending that I add a blank line after&#13;
the initial module docstring.<a data-startref="ix_ch19-pythonista-asciidoc9" data-type="indexterm" id="idm45794967241064"/><a data-startref="ix_ch19-pythonista-asciidoc8" data-type="indexterm" id="idm45794967240344"/><a data-startref="ix_ch19-pythonista-asciidoc7" data-type="indexterm" id="idm45794967239656"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Test with unittest" data-type="sect2"><div class="sect2" id="unittest">&#13;
<h2>Test with unittest</h2>&#13;
&#13;
<p><a data-primary="testing" data-secondary="unittest" data-type="indexterm" id="ix_ch19-pythonista-asciidoc10"/><a data-primary="unittest" data-type="indexterm" id="ix_ch19-pythonista-asciidoc11"/>We’ve verified that we’re no longer insulting&#13;
the style senses of the code gods,&#13;
so let’s move on to actual tests of the logic in your program.</p>&#13;
&#13;
<p>It’s a good practice to write independent test programs first,&#13;
to ensure that they all pass before you commit&#13;
your code to any source control system.&#13;
<a data-primary="regressions" data-type="indexterm" id="idm45794967234008"/>Writing tests can seem tedious at first,&#13;
but they really do help you find problems faster—especially <em>regressions</em>&#13;
(breaking something that used to work).&#13;
Painful experience teaches all developers&#13;
that even the teeniest change,&#13;
which they swear could not possibly affect anything else,&#13;
actually does.&#13;
If you look at well-written Python packages, they always&#13;
include a test suite.</p>&#13;
&#13;
<p>The standard library contains not one, but two test packages.&#13;
Let’s start with&#13;
<a href="https://oreil.ly/ImFmE"><code>unittest</code></a>.&#13;
We’ll write a module that capitalizes words.&#13;
Our first version just uses the standard string function&#13;
<code>capitalize()</code>,&#13;
with some unexpected results as we’ll see.&#13;
Save this as <em>cap.py</em> (<a data-type="xref" href="#ex1906">Example 19-6</a>).</p>&#13;
<div data-type="example" id="ex1906">&#13;
<h5><span class="label">Example 19-6. </span>cap.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">just_do_it</code><code class="p">(</code><code class="n">text</code><code class="p">):</code>&#13;
    <code class="k">return</code> <code class="n">text</code><code class="o">.</code><code class="n">capitalize</code><code class="p">()</code></pre></div>&#13;
&#13;
<p>The basis of testing is to decide what outcome&#13;
you want from a certain&#13;
input&#13;
(here, you want the capitalized version of&#13;
whatever text you&#13;
input),&#13;
submit the input to the function you’re testing,&#13;
and then&#13;
check whether it returned the expected results.&#13;
<a data-primary="assertion" data-type="indexterm" id="idm45794967197080"/>The expected result is&#13;
called an <em>assertion</em>,&#13;
so in <code>unittest</code> you check your results by using&#13;
methods with names that begin with <code>assert</code>,&#13;
like the <code>assertEqual</code> method&#13;
shown in <a data-type="xref" href="#ex1907">Example 19-7</a>.</p>&#13;
&#13;
<p>Save this test script as <em>test_cap.py</em>.</p>&#13;
<div data-type="example" id="ex1907">&#13;
<h5><span class="label">Example 19-7. </span>test_cap.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">import</code> <code class="nn">unittest</code>&#13;
<code class="kn">import</code> <code class="nn">cap</code>&#13;
&#13;
<code class="k">class</code> <code class="nc">TestCap</code><code class="p">(</code><code class="n">unittest</code><code class="o">.</code><code class="n">TestCase</code><code class="p">):</code>&#13;
&#13;
    <code class="k">def</code> <code class="nf">setUp</code><code class="p">(</code><code class="bp">self</code><code class="p">):</code>&#13;
        <code class="k">pass</code>&#13;
&#13;
    <code class="k">def</code> <code class="nf">tearDown</code><code class="p">(</code><code class="bp">self</code><code class="p">):</code>&#13;
        <code class="k">pass</code>&#13;
&#13;
    <code class="k">def</code> <code class="nf">test_one_word</code><code class="p">(</code><code class="bp">self</code><code class="p">):</code>&#13;
        <code class="n">text</code> <code class="o">=</code> <code class="s1">'duck'</code>&#13;
        <code class="n">result</code> <code class="o">=</code> <code class="n">cap</code><code class="o">.</code><code class="n">just_do_it</code><code class="p">(</code><code class="n">text</code><code class="p">)</code>&#13;
        <code class="bp">self</code><code class="o">.</code><code class="n">assertEqual</code><code class="p">(</code><code class="n">result</code><code class="p">,</code> <code class="s1">'Duck'</code><code class="p">)</code>&#13;
&#13;
    <code class="k">def</code> <code class="nf">test_multiple_words</code><code class="p">(</code><code class="bp">self</code><code class="p">):</code>&#13;
        <code class="n">text</code> <code class="o">=</code> <code class="s1">'a veritable flock of ducks'</code>&#13;
        <code class="n">result</code> <code class="o">=</code> <code class="n">cap</code><code class="o">.</code><code class="n">just_do_it</code><code class="p">(</code><code class="n">text</code><code class="p">)</code>&#13;
        <code class="bp">self</code><code class="o">.</code><code class="n">assertEqual</code><code class="p">(</code><code class="n">result</code><code class="p">,</code> <code class="s1">'A Veritable Flock Of Ducks'</code><code class="p">)</code>&#13;
&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="n">unittest</code><code class="o">.</code><code class="n">main</code><code class="p">()</code></pre></div>&#13;
&#13;
<p><a data-primary="setUp() function" data-type="indexterm" id="idm45794967188520"/><a data-primary="tearDown() function" data-type="indexterm" id="idm45794967187688"/>The <code>setUp()</code> method is called before each test method,&#13;
and the <code>tearDown()</code> method is called after each.&#13;
Their purpose is to allocate and free external resources&#13;
needed by the tests,&#13;
such as a database connection or some test data.&#13;
In this case, our tests are self-contained, and we wouldn’t&#13;
even need to define <code>setUp()</code> and <code>tearDown()</code>,&#13;
but it doesn’t hurt to have empty versions there.&#13;
At the heart of our test are the two functions named&#13;
<code>test_one_word()</code> and&#13;
<code>test_multiple_words()</code>.&#13;
Each runs the <code>just_do_it()</code> function we defined&#13;
with different input and checks&#13;
whether we got back what we expect.&#13;
Okay, let’s run it.&#13;
This will call our two test methods:</p>&#13;
<pre>$ <strong>python test_cap.py</strong></pre>&#13;
&#13;
<pre data-type="programlisting"> F.&#13;
 ======================================================================&#13;
 FAIL: test_multiple_words (__main__.TestCap)&#13;
 ----------------------------------------------------------------------&#13;
 Traceback (most recent call last):&#13;
   File "test_cap.py", line 20, in test_multiple_words&#13;
  self.assertEqual(result, 'A Veritable Flock Of Ducks')&#13;
 AssertionError: 'A veritable flock of ducks' != 'A Veritable Flock Of Ducks'&#13;
 - A veritable flock of ducks&#13;
 ?   ^         ^     ^  ^&#13;
 + A Veritable Flock Of Ducks&#13;
 ?   ^         ^     ^  ^&#13;
&#13;
&#13;
 ----------------------------------------------------------------------&#13;
 Ran 2 tests in 0.001s&#13;
&#13;
 FAILED (failures=1)</pre>&#13;
&#13;
<p>It liked the first test (<code>test_one_word</code>),&#13;
but not the second (<code>test_multiple_words</code>).&#13;
The up arrows (<code>^</code>) show where the strings actually differed.</p>&#13;
&#13;
<p>What’s special about multiple words?&#13;
Reading the documentation for the <code>string</code>&#13;
<a href="https://oreil.ly/x1IV8"><code>capitalize</code></a>&#13;
function yields an important clue:&#13;
it capitalizes only the first letter of the first word.&#13;
Maybe we should have read that first.</p>&#13;
&#13;
<p>Consequently, we need another function.&#13;
Gazing down that page a bit, we find&#13;
<a href="https://oreil.ly/CNKNl"><code>title()</code></a>.&#13;
So, let’s change <em>cap.py</em> to use <code>title()</code> instead of <code>capitalize()</code> (<a data-type="xref" href="#ex1908">Example 19-8</a>).</p>&#13;
<div data-type="example" id="ex1908">&#13;
<h5><span class="label">Example 19-8. </span>cap.py, revised</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">just_do_it</code><code class="p">(</code><code class="n">text</code><code class="p">):</code>&#13;
    <code class="k">return</code> <code class="n">text</code><code class="o">.</code><code class="n">title</code><code class="p">()</code></pre></div>&#13;
&#13;
<p>Rerun the tests, and let’s see what happens:</p>&#13;
<pre>$ <strong>python test_cap.py</strong></pre>&#13;
&#13;
<pre data-type="programlisting"> ..&#13;
 ----------------------------------------------------------------------&#13;
 Ran 2 tests in 0.000s&#13;
&#13;
 OK</pre>&#13;
&#13;
<p>Everything is great.&#13;
Well, actually, they’re not.&#13;
We need to add at least one more method&#13;
to <em>test_cap.py</em> (<a data-type="xref" href="#ex1909">Example 19-9</a>).</p>&#13;
<div data-type="example" id="ex1909">&#13;
<h5><span class="label">Example 19-9. </span>test_cap.py, revised</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting">    <code class="k">def</code> <code class="nf">test_words_with_apostrophes</code><code class="p">(</code><code class="bp">self</code><code class="p">):</code>&#13;
        <code class="n">text</code> <code class="o">=</code> <code class="s2">"I'm fresh out of ideas"</code>&#13;
        <code class="n">result</code> <code class="o">=</code> <code class="n">cap</code><code class="o">.</code><code class="n">just_do_it</code><code class="p">(</code><code class="n">text</code><code class="p">)</code>&#13;
        <code class="bp">self</code><code class="o">.</code><code class="n">assertEqual</code><code class="p">(</code><code class="n">result</code><code class="p">,</code> <code class="s2">"I'm Fresh Out Of Ideas"</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>Go ahead and try it again:</p>&#13;
<pre>$ <strong>python test_cap.py</strong></pre>&#13;
&#13;
<pre data-type="programlisting"> ..F&#13;
 ======================================================================&#13;
 FAIL: test_words_with_apostrophes (__main__.TestCap)&#13;
 ----------------------------------------------------------------------&#13;
 Traceback (most recent call last):&#13;
   File "test_cap.py", line 25, in test_words_with_apostrophes&#13;
     self.assertEqual(result, "I'm Fresh Out Of Ideas")&#13;
 AssertionError: "I'M Fresh Out Of Ideas" != "I'm Fresh Out Of Ideas"&#13;
 - I'M Fresh Out Of Ideas&#13;
 ?   ^&#13;
 + I'm Fresh Out Of Ideas&#13;
 ?   ^&#13;
&#13;
&#13;
 ----------------------------------------------------------------------&#13;
 Ran 3 tests in 0.001s&#13;
&#13;
 FAILED (failures=1)</pre>&#13;
&#13;
<p>Our function capitalized the <code>m</code> in <code>I'm</code>.&#13;
A quick run back to the documentation for <code>title()</code> shows&#13;
that it doesn’t handle apostrophes well.&#13;
We <em>really</em> should have read the entire text first.</p>&#13;
&#13;
<p>At the bottom of the standard library’s&#13;
<code>string</code> documentation is another candidate:&#13;
a helper function called <code>capwords()</code>.&#13;
Let’s use it in <em>cap.py</em> (<a data-type="xref" href="#ex1910">Example 19-10</a>).</p>&#13;
<div data-type="example" id="ex1910">&#13;
<h5><span class="label">Example 19-10. </span>cap.py, re-revised</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">just_do_it</code><code class="p">(</code><code class="n">text</code><code class="p">):</code>&#13;
    <code class="kn">from</code> <code class="nn">string</code> <code class="kn">import</code> <code class="n">capwords</code>&#13;
    <code class="k">return</code> <code class="n">capwords</code><code class="p">(</code><code class="n">text</code><code class="p">)</code></pre></div>&#13;
<pre>$ <strong>python test_cap.py</strong></pre>&#13;
<pre>...&#13;
----------------------------------------------------------------------&#13;
Ran 3 tests in 0.004s&#13;
&#13;
OK</pre>&#13;
&#13;
<p>At last, we’re finally done!&#13;
Uh, no.&#13;
We have one more test to add to <em>test_cap.py</em> (<a data-type="xref" href="#ex1911">Example 19-11</a>).</p>&#13;
<div data-type="example" id="ex1911">&#13;
<h5><span class="label">Example 19-11. </span>test_cap.py, re-revised</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting">    <code class="k">def</code> <code class="nf">test_words_with_quotes</code><code class="p">(</code><code class="bp">self</code><code class="p">):</code>&#13;
        <code class="n">text</code> <code class="o">=</code> <code class="s2">"</code><code class="se">\"</code><code class="s2">You're despicable,</code><code class="se">\"</code><code class="s2"> said Daffy Duck"</code>&#13;
        <code class="n">result</code> <code class="o">=</code> <code class="n">cap</code><code class="o">.</code><code class="n">just_do_it</code><code class="p">(</code><code class="n">text</code><code class="p">)</code>&#13;
        <code class="bp">self</code><code class="o">.</code><code class="n">assertEqual</code><code class="p">(</code><code class="n">result</code><code class="p">,</code> <code class="s2">"</code><code class="se">\"</code><code class="s2">You're Despicable,</code><code class="se">\"</code><code class="s2"> Said Daffy Duck"</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>Did it work?</p>&#13;
<pre>$ <strong>python test_cap.py</strong></pre>&#13;
<pre>...F&#13;
======================================================================&#13;
FAIL: test_words_with_quotes (__main__.TestCap)&#13;
----------------------------------------------------------------------&#13;
Traceback (most recent call last):&#13;
  File "test_cap.py", line 30, in test_words_with_quotes&#13;
    self.assertEqual(result, "\"You're&#13;
    Despicable,\" Said Daffy Duck") AssertionError: '"you\'re Despicable,"&#13;
        Said Daffy Duck'&#13;
 != '"You\'re Despicable," Said Daffy Duck' - "you're Despicable,"&#13;
        Said Daffy Duck&#13;
?  ^ + "You're Despicable," Said Daffy Duck&#13;
?  ^&#13;
----------------------------------------------------------------------&#13;
Ran 4 tests in 0.004s&#13;
&#13;
FAILED (failures=1)</pre>&#13;
&#13;
<p>It looks like that first double quote confused even <code>capwords</code>,&#13;
our favorite capitalizer thus far.&#13;
It tried to capitalize the <code>"</code>,&#13;
and lowercased the rest (<code>You're</code>).&#13;
We should have also tested that our capitalizer&#13;
left the rest of the string untouched.</p>&#13;
&#13;
<p>People who do testing for a living&#13;
have a knack for spotting these edge cases,&#13;
but developers often have blind spots&#13;
when it comes to their own code.</p>&#13;
&#13;
<p><code>unittest</code> provides a small but powerful set of assertions,&#13;
letting you check values,&#13;
confirm whether you have the class you want,&#13;
determine whether an error was raised,&#13;
and so on.<a data-startref="ix_ch19-pythonista-asciidoc11" data-type="indexterm" id="idm45794966855976"/><a data-startref="ix_ch19-pythonista-asciidoc10" data-type="indexterm" id="idm45794966855304"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Test with doctest" data-type="sect2"><div class="sect2" id="doctest">&#13;
<h2>Test with doctest</h2>&#13;
&#13;
<p><a data-primary="doctest" data-type="indexterm" id="idm45794966853336"/><a data-primary="testing" data-secondary="doctest" data-type="indexterm" id="idm45794966852408"/>The second test package in the standard library is&#13;
<a href="http://bit.ly/py-doctest"><code>doctest</code></a>.&#13;
With this package, you can write tests&#13;
within the docstring itself,&#13;
also serving as documentation.&#13;
It looks like the interactive interpreter:&#13;
the characters <code>&gt;&gt;&gt;</code>, followed by the call,&#13;
and then the results on the following line.&#13;
You can run some tests in the interactive interpreter&#13;
and just paste&#13;
the results into your test file.&#13;
Let’s modify our old <em>cap.py</em> as <em>cap2.py</em>&#13;
(without that troublesome last test with quotes), as shown in <a data-type="xref" href="#ex1912">Example 19-12</a>.</p>&#13;
<div data-type="example" id="ex1912">&#13;
<h5><span class="label">Example 19-12. </span>cap2.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">just_do_it</code><code class="p">(</code><code class="n">text</code><code class="p">):</code>&#13;
    <code class="sd">"""</code>&#13;
<code class="sd">    &gt;&gt;&gt; just_do_it('duck')</code>&#13;
<code class="sd">    'Duck'</code>&#13;
<code class="sd">    &gt;&gt;&gt; just_do_it('a veritable flock of ducks')</code>&#13;
<code class="sd">    'A Veritable Flock Of Ducks'</code>&#13;
<code class="sd">    &gt;&gt;&gt; just_do_it("I'm fresh out of ideas")</code>&#13;
<code class="sd">    "I'm Fresh Out Of Ideas"</code>&#13;
<code class="sd">    """</code>&#13;
    <code class="kn">from</code> <code class="nn">string</code> <code class="kn">import</code> <code class="n">capwords</code>&#13;
    <code class="k">return</code> <code class="n">capwords</code><code class="p">(</code><code class="n">text</code><code class="p">)</code>&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="kn">import</code> <code class="nn">doctest</code>&#13;
    <code class="n">doctest</code><code class="o">.</code><code class="n">testmod</code><code class="p">()</code></pre></div>&#13;
&#13;
<p>When you run it, it doesn’t print anything if all tests passed:</p>&#13;
<pre>$ <strong>python cap2.py</strong></pre>&#13;
&#13;
<p>Give it the verbose (<code>-v</code>) option to see what actually happened:</p>&#13;
<pre>$ <strong>python cap2.py -v</strong></pre>&#13;
<pre>Trying:&#13;
    just_do_it('duck')&#13;
    Expecting:&#13;
    'Duck'&#13;
ok&#13;
Trying:&#13;
     just_do_it('a veritable flock of ducks')&#13;
Expecting:&#13;
     'A Veritable Flock Of Ducks'&#13;
ok&#13;
Trying:&#13;
     just_do_it("I'm fresh out of ideas")&#13;
Expecting:&#13;
     "I'm Fresh Out Of Ideas"&#13;
ok&#13;
1 items had no tests:&#13;
     __main__&#13;
1 items passed all tests:&#13;
    3 tests in __main__.just_do_it&#13;
3 tests in 2 items.&#13;
3 passed and 0 failed.&#13;
Test passed.</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Test with nose" data-type="sect2"><div class="sect2" id="nose">&#13;
<h2>Test with nose</h2>&#13;
&#13;
<p><a data-primary="nose" data-type="indexterm" id="idm45794966784104"/><a data-primary="testing" data-secondary="nose" data-type="indexterm" id="idm45794966783400"/>The third-party package called&#13;
<a href="https://oreil.ly/gWK6r"><code>nose</code></a>&#13;
is another alternative to <code>unittest</code>.&#13;
Here’s the command to install it:</p>&#13;
<pre>$ <strong>pip install nose</strong></pre>&#13;
&#13;
<p>You don’t need to create a class that includes test methods,&#13;
as we did with <code>unittest</code>.&#13;
Any function with a name matching <code>test</code>&#13;
somewhere in its name will be run.&#13;
Let’s modify our last version of our&#13;
<code>unittest</code> tester and save it as <em>test_cap_nose.py</em> (<a data-type="xref" href="#ex1913">Example 19-13</a>).</p>&#13;
<div data-type="example" id="ex1913">&#13;
<h5><span class="label">Example 19-13. </span>test_cap_nose.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">import</code> <code class="nn">cap2</code>&#13;
<code class="kn">from</code> <code class="nn">nose.tools</code> <code class="kn">import</code> <code class="n">eq_</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">test_one_word</code><code class="p">():</code>&#13;
    <code class="n">text</code> <code class="o">=</code> <code class="s1">'duck'</code>&#13;
    <code class="n">result</code> <code class="o">=</code> <code class="n">cap</code><code class="o">.</code><code class="n">just_do_it</code><code class="p">(</code><code class="n">text</code><code class="p">)</code>&#13;
    <code class="n">eq_</code><code class="p">(</code><code class="n">result</code><code class="p">,</code> <code class="s1">'Duck'</code><code class="p">)</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">test_multiple_words</code><code class="p">():</code>&#13;
    <code class="n">text</code> <code class="o">=</code> <code class="s1">'a veritable flock of ducks'</code>&#13;
    <code class="n">result</code> <code class="o">=</code> <code class="n">cap</code><code class="o">.</code><code class="n">just_do_it</code><code class="p">(</code><code class="n">text</code><code class="p">)</code>&#13;
    <code class="n">eq_</code><code class="p">(</code><code class="n">result</code><code class="p">,</code> <code class="s1">'A Veritable Flock Of Ducks'</code><code class="p">)</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">test_words_with_apostrophes</code><code class="p">():</code>&#13;
    <code class="n">text</code> <code class="o">=</code> <code class="s2">"I'm fresh out of ideas"</code>&#13;
    <code class="n">result</code> <code class="o">=</code> <code class="n">cap</code><code class="o">.</code><code class="n">just_do_it</code><code class="p">(</code><code class="n">text</code><code class="p">)</code>&#13;
    <code class="n">eq_</code><code class="p">(</code><code class="n">result</code><code class="p">,</code> <code class="s2">"I'm Fresh Out Of Ideas"</code><code class="p">)</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">test_words_with_quotes</code><code class="p">():</code>&#13;
    <code class="n">text</code> <code class="o">=</code> <code class="s2">"</code><code class="se">\"</code><code class="s2">You're despicable,</code><code class="se">\"</code><code class="s2"> said Daffy Duck"</code>&#13;
    <code class="n">result</code> <code class="o">=</code> <code class="n">cap</code><code class="o">.</code><code class="n">just_do_it</code><code class="p">(</code><code class="n">text</code><code class="p">)</code>&#13;
    <code class="n">eq_</code><code class="p">(</code><code class="n">result</code><code class="p">,</code> <code class="s2">"</code><code class="se">\"</code><code class="s2">You're Despicable,</code><code class="se">\"</code><code class="s2"> Said Daffy Duck"</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>Run the tests:</p>&#13;
<pre>$ <strong>nosetests test_cap_nose.py</strong></pre>&#13;
<pre>...F&#13;
======================================================================&#13;
FAIL: test_cap_nose.test_words_with_quotes&#13;
----------------------------------------------------------------------&#13;
Traceback (most recent call last):&#13;
  File "/Users/.../site-packages/nose/case.py", line 198, in runTest&#13;
    self.test(*self.arg)&#13;
  File "/Users/.../book/test_cap_nose.py", line 23, in test_words_with_quotes&#13;
    eq_(result, "\"You're Despicable,\" Said Daffy Duck")&#13;
AssertionError: '"you\'re Despicable," Said Daffy Duck'      !=&#13;
'"You\'re Despicable," Said Daffy Duck'&#13;
----------------------------------------------------------------------&#13;
Ran 4 tests in 0.005s&#13;
&#13;
FAILED (failures=1)</pre>&#13;
&#13;
<p>This is the same bug we found when we used <code>unittest</code>&#13;
for testing;&#13;
fortunately, there’s an exercise to fix it&#13;
at the end of this chapter.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before less_space" data-pdf-bookmark="Other Test Frameworks" data-type="sect2"><div class="sect2" id="other_test">&#13;
<h2>Other Test Frameworks</h2>&#13;
&#13;
<p>For some reason, people like to write Python test frameworks.&#13;
If you’re curious, you can check out some other popular ones:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="http://tox.readthedocs.org"><code>tox</code></a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://pytest.org"><code>py.test</code></a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://github.com/CleanCut/green"><code>green</code></a></p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Continuous Integration" data-type="sect2"><div class="sect2" id="ci">&#13;
<h2>Continuous Integration</h2>&#13;
&#13;
<p><a data-primary="continuous integration" data-type="indexterm" id="idm45794966612392"/><a data-primary="testing" data-secondary="continuous integration" data-type="indexterm" id="idm45794966611688"/>When your group is cranking out a lot of code daily,&#13;
it helps to automate tests as soon as changes arrive.&#13;
You can automate source control systems to run tests on all&#13;
code as it’s checked in.&#13;
This way, everyone knows whether someone <em>broke the build</em>&#13;
and just disappeared for an early lunch—or a new job.</p>&#13;
&#13;
<p>These are big systems, and I’m not going into&#13;
installation and usage details here.&#13;
In case you need them someday, you’ll know where to find them:</p>&#13;
<dl>&#13;
<dt><a href="http://buildbot.net"><code>buildbot</code></a></dt>&#13;
<dd>&#13;
<p>Written in Python, this source control system automates building,&#13;
testing, and releasing.</p>&#13;
</dd>&#13;
<dt><a href="http://jenkins-ci.org"><code>jenkins</code></a></dt>&#13;
<dd>&#13;
<p>This is written in Java,&#13;
and seems to be the preferred CI tool of the moment.</p>&#13;
</dd>&#13;
<dt><a href="http://travis-ci.com"><code>travis-ci</code></a></dt>&#13;
<dd>&#13;
<p>This automates projects hosted at GitHub,&#13;
and is free for open source projects.</p>&#13;
</dd>&#13;
<dt><a href="https://circleci.com"><code>circleci</code></a></dt>&#13;
<dd>&#13;
<p>This one is commercial&#13;
but free for open source and private projects.<a data-startref="ix_ch19-pythonista-asciidoc6" data-type="indexterm" id="idm45794966601512"/><a data-startref="ix_ch19-pythonista-asciidoc5" data-type="indexterm" id="idm45794966600840"/><a data-startref="ix_ch19-pythonista-asciidoc4" data-type="indexterm" id="idm45794966600152"/></p>&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Debug Python Code" data-type="sect1"><div class="sect1" id="debug">&#13;
<h1>Debug Python Code</h1>&#13;
<blockquote>&#13;
<p>Debugging is like being the detective in a crime movie&#13;
where you are also the <span class="keep-together">murderer.</span></p>&#13;
<p data-type="attribution">Filipe Fortes</p>&#13;
</blockquote>&#13;
<blockquote>&#13;
<p>Everyone knows that debugging is twice as hard as&#13;
writing a program in the first place.&#13;
So if you’re as clever as you can be when you write it,&#13;
how will you ever debug it?</p>&#13;
<p data-type="attribution">Brian Kernighan</p>&#13;
</blockquote>&#13;
&#13;
<p>Test first.&#13;
<a data-primary="best practices" data-secondary="debugging" data-type="indexterm" id="ix_ch19-pythonista-asciidoc12"/><a data-primary="code" data-secondary="debugging" data-type="indexterm" id="ix_ch19-pythonista-asciidoc13"/><a data-primary="debugging" data-type="indexterm" id="ix_ch19-pythonista-asciidoc14"/><a data-primary="debugging" data-secondary="best practices" data-type="indexterm" id="ix_ch19-pythonista-asciidoc15"/>The better your tests are, the less you’ll have to fix later.&#13;
Yet, bugs happen and need to be fixed when they’re found later.</p>&#13;
&#13;
<p>When code breaks,&#13;
it’s usually because of something you just did.&#13;
So you typically debug “from the bottom up,”&#13;
starting with your most recent changes.<sup><a data-type="noteref" href="ch19.html#idm45794966587992" id="idm45794966587992-marker">1</a></sup></p>&#13;
&#13;
<p>But sometimes the cause is elsewhere,&#13;
in something that you trusted and thought worked.&#13;
You would think that if there were problems&#13;
in something that many people use,&#13;
someone would have noticed by now.&#13;
That is not always what happens.&#13;
The trickiest bugs that I’ve encountered,&#13;
that each took more than a week to fix,&#13;
had external causes.&#13;
So after blaming the person in the mirror,&#13;
question your assumptions.&#13;
This is a “top-down” approach,&#13;
and it takes longer.</p>&#13;
&#13;
<p>The following are some debugging techniques,&#13;
from quick and dirty&#13;
to slower, but often just as dirty.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Use print()" data-type="sect2"><div class="sect2" id="idm45794966585768">&#13;
<h2>Use print()</h2>&#13;
&#13;
<p><a data-primary="debugging" data-secondary="printing out strings" data-type="indexterm" id="idm45794966584328"/><a data-primary="print() function" data-secondary="debugging and" data-type="indexterm" id="idm45794966583352"/>The simplest way to debug in Python is&#13;
to print out strings.&#13;
Some useful things to print include <code>vars()</code>,&#13;
which extracts the values&#13;
of your local variables, including function arguments:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="k">def</code> <code class="nf">func</code><code class="p">(</code><code class="o">*</code><code class="n">args</code><code class="p">,</code> <code class="o">**</code><code class="n">kwargs</code><code class="p">):</code>&#13;
<code class="gp">... </code>    <code class="k">print</code><code class="p">(</code><code class="nb">vars</code><code class="p">())</code>&#13;
<code class="gp">...</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">func</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">)</code>&#13;
<code class="go">{'args': (1, 2, 3), 'kwargs': {}}</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">func</code><code class="p">([</code><code class="s">'a'</code><code class="p">,</code> <code class="s">'b'</code><code class="p">,</code> <code class="s">'argh'</code><code class="p">])</code>&#13;
<code class="go">{'args': (['a', 'b', 'argh'],), 'kwargs': {}}</code></pre>&#13;
&#13;
<p>Other things that are often&#13;
worth printing are <code>locals()</code> and <code>globals()</code>.</p>&#13;
&#13;
<p>If your code also includes normal prints to standard output,&#13;
you can write your debugging messages to standard error output&#13;
with <code>print(<em>stuff</em>, file=sys.stderr)</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Use Decorators" data-type="sect2"><div class="sect2" id="idm45794966514872">&#13;
<h2>Use Decorators</h2>&#13;
&#13;
<p><a data-primary="debugging" data-secondary="decorators for" data-type="indexterm" id="idm45794966513400"/><a data-primary="decorators" data-type="indexterm" id="idm45794966512424"/>As you read in <a data-type="xref" href="ch09.html#decorators">“Decorators”</a>,&#13;
a decorator can call code before or after a function&#13;
without modifying the code within the function itself.&#13;
This means that you can use a decorator&#13;
to do something before or after&#13;
any Python function,&#13;
not just ones that you wrote.&#13;
Let’s define the decorator <code>dump</code> to print the input arguments&#13;
and output values of any function as it’s called&#13;
(designers know that a dump often needs decorating), as shown in <a data-type="xref" href="#ex1914">Example 19-14</a>.</p>&#13;
<div data-type="example" id="ex1914">&#13;
<h5><span class="label">Example 19-14. </span>dump.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">dump</code><code class="p">(</code><code class="n">func</code><code class="p">):</code>&#13;
    <code class="s2">"Print input arguments and output value(s)"</code>&#13;
    <code class="k">def</code> <code class="nf">wrapped</code><code class="p">(</code><code class="o">*</code><code class="n">args</code><code class="p">,</code> <code class="o">**</code><code class="n">kwargs</code><code class="p">):</code>&#13;
        <code class="k">print</code><code class="p">(</code><code class="s2">"Function name:"</code><code class="p">,</code> <code class="n">func</code><code class="o">.</code><code class="nv-Magic">__name__</code><code class="p">)</code>&#13;
        <code class="k">print</code><code class="p">(</code><code class="s2">"Input arguments:"</code><code class="p">,</code> <code class="s1">' '</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="nb">map</code><code class="p">(</code><code class="nb">str</code><code class="p">,</code> <code class="n">args</code><code class="p">)))</code>&#13;
        <code class="k">print</code><code class="p">(</code><code class="s2">"Input keyword arguments:"</code><code class="p">,</code> <code class="n">kwargs</code><code class="o">.</code><code class="n">items</code><code class="p">())</code>&#13;
        <code class="n">output</code> <code class="o">=</code> <code class="n">func</code><code class="p">(</code><code class="o">*</code><code class="n">args</code><code class="p">,</code> <code class="o">**</code><code class="n">kwargs</code><code class="p">)</code>&#13;
        <code class="k">print</code><code class="p">(</code><code class="s2">"Output:"</code><code class="p">,</code> <code class="n">output</code><code class="p">)</code>&#13;
        <code class="k">return</code> <code class="n">output</code>&#13;
    <code class="k">return</code> <code class="n">wrapped</code></pre></div>&#13;
&#13;
<p>Now the decoratee.&#13;
<a data-primary="double() function" data-type="indexterm" id="idm45794966505336"/>This is a function called <code>double()</code>&#13;
that expects numeric arguments,&#13;
either named or unnamed,&#13;
and returns them in a list with their values doubled (<a data-type="xref" href="#ex1915">Example 19-15</a>).</p>&#13;
<div data-type="example" id="ex1915">&#13;
<h5><span class="label">Example 19-15. </span>test_dump.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">dump</code> <code class="kn">import</code> <code class="n">dump</code>&#13;
&#13;
<code class="nd">@dump</code>&#13;
<code class="k">def</code> <code class="nf">double</code><code class="p">(</code><code class="o">*</code><code class="n">args</code><code class="p">,</code> <code class="o">**</code><code class="n">kwargs</code><code class="p">):</code>&#13;
    <code class="s2">"Double every argument"</code>&#13;
    <code class="n">output_list</code> <code class="o">=</code> <code class="p">[</code> <code class="mi">2</code> <code class="o">*</code> <code class="n">arg</code> <code class="k">for</code> <code class="n">arg</code> <code class="ow">in</code> <code class="n">args</code> <code class="p">]</code>&#13;
    <code class="n">output_dict</code> <code class="o">=</code>  <code class="p">{</code> <code class="n">k</code><code class="p">:</code><code class="mi">2</code><code class="o">*</code><code class="n">v</code> <code class="k">for</code> <code class="n">k</code><code class="p">,</code><code class="n">v</code> <code class="ow">in</code> <code class="n">kwargs</code><code class="o">.</code><code class="n">items</code><code class="p">()</code> <code class="p">}</code>&#13;
    <code class="k">return</code> <code class="n">output_list</code><code class="p">,</code> <code class="n">output_dict</code>&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="n">output</code> <code class="o">=</code> <code class="n">double</code><code class="p">(</code><code class="mi">3</code><code class="p">,</code> <code class="mi">5</code><code class="p">,</code> <code class="n">first</code><code class="o">=</code><code class="mi">100</code><code class="p">,</code> <code class="nb">next</code><code class="o">=</code><code class="mf">98.6</code><code class="p">,</code> <code class="n">last</code><code class="o">=-</code><code class="mi">40</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>Take a moment to run it:</p>&#13;
<pre>$ <strong>python test_dump.py</strong></pre>&#13;
&#13;
<pre data-type="programlisting">Function name: double&#13;
Input arguments: 3 5&#13;
Input keyword arguments: dict_items([('first', 100), ('next', 98.6),&#13;
    ('last', -40)])&#13;
Output: ([6, 10], {'first': 200, 'next': 197.2, 'last': -80})</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Use pdb" data-type="sect2"><div class="sect2" id="pdb">&#13;
<h2>Use pdb</h2>&#13;
&#13;
<p><a data-primary="debugging" data-secondary="with pdb" data-type="indexterm" id="ix_ch19-pythonista-asciidoc16"/><a data-primary="pdb (Python debugger)" data-type="indexterm" id="ix_ch19-pythonista-asciidoc17"/><a data-primary="Python debugger (pdb)" data-type="indexterm" id="ix_ch19-pythonista-asciidoc18"/>These techniques help, but sometimes there’s&#13;
no substitute for a real debugger.&#13;
Most IDEs include a debugger,&#13;
with varying features and user interfaces.&#13;
Here, I describe use of the standard Python debugger,&#13;
<a href="https://oreil.ly/IIN4y"><code>pdb</code></a>.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>If you run your program with the <code>-i</code> flag,&#13;
Python will drop you into its interactive interpreter&#13;
if the program fails.</p>&#13;
</div>&#13;
&#13;
<p>Here’s a program with a bug that depends on data—the kind of bug that can be particularly hard to find.&#13;
This is a real bug from the early days of computing,&#13;
and it baffled programmers for quite a while.</p>&#13;
&#13;
<p>We’re going to read a file of countries and their capital cities,&#13;
separated by a comma,&#13;
and write them out as <em>capital</em>, <em>country</em>.&#13;
They might be capitalized incorrectly,&#13;
so we should fix that also when we print.&#13;
Oh, and there might be extra spaces here and there,&#13;
and you’ll want to get rid of those, too.&#13;
Finally, although it would make sense&#13;
for the program to just read to the end of the file,&#13;
for some reason our manager told us&#13;
to stop when we encounter the word&#13;
<code>quit</code> (in any mixture of uppercase and lowercase characters).&#13;
<a data-type="xref" href="#ex1916">Example 19-16</a> shows a sample data file.</p>&#13;
<div data-type="example" id="ex1916">&#13;
<h5><span class="label">Example 19-16. </span>cities.csv</h5>&#13;
&#13;
<pre data-type="programlisting">France, Paris&#13;
venuzuela,caracas&#13;
  LithuaniA,vilnius&#13;
     quit</pre></div>&#13;
&#13;
<p>Let’s design our <em>algorithm</em> (method for solving the problem).&#13;
This is <em>pseudocode</em>—it looks like a program, but is just a way to explain&#13;
the logic in normal language before converting it to&#13;
an actual program.&#13;
One reason programmers like Python is because it&#13;
<em>looks a lot like pseudocode</em>,&#13;
so there’s less work involved when it’s time to convert it to a working program:</p>&#13;
&#13;
<pre data-type="programlisting">for each line in the text file:&#13;
    read the line&#13;
    strip leading and trailing spaces&#13;
    if `quit` occurs in the lower-case copy of the line:&#13;
        stop&#13;
    else:&#13;
        split the country and capital by the comma character&#13;
        trim any leading and trailing spaces&#13;
        convert the country and capital to titlecase&#13;
        print the capital, a comma, and the country</pre>&#13;
&#13;
<p>We need to strip initial and trailing spaces&#13;
from the names because that was a requirement.&#13;
Likewise for the lowercase comparison with <code>quit</code>&#13;
and converting the city and country names to title case.&#13;
That being the case, let’s whip out <em>capitals.py</em>,&#13;
which is sure to work perfectly (<a data-type="xref" href="#ex1917">Example 19-17</a>).</p>&#13;
<div data-type="example" id="ex1917">&#13;
<h5><span class="label">Example 19-17. </span>capitals.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">process_cities</code><code class="p">(</code><code class="n">filename</code><code class="p">):</code>&#13;
    <code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="n">filename</code><code class="p">,</code> <code class="s1">'rt'</code><code class="p">)</code> <code class="k">as</code> <code class="nb">file</code><code class="p">:</code>&#13;
        <code class="k">for</code> <code class="n">line</code> <code class="ow">in</code> <code class="nb">file</code><code class="p">:</code>&#13;
            <code class="n">line</code> <code class="o">=</code> <code class="n">line</code><code class="o">.</code><code class="n">strip</code><code class="p">()</code>&#13;
            <code class="k">if</code> <code class="s1">'quit'</code> <code class="ow">in</code> <code class="n">line</code><code class="o">.</code><code class="n">lower</code><code class="p">():</code>&#13;
                <code class="k">return</code>&#13;
            <code class="n">country</code><code class="p">,</code> <code class="n">city</code> <code class="o">=</code> <code class="n">line</code><code class="o">.</code><code class="n">split</code><code class="p">(</code><code class="s1">','</code><code class="p">)</code>&#13;
            <code class="n">city</code> <code class="o">=</code> <code class="n">city</code><code class="o">.</code><code class="n">strip</code><code class="p">()</code>&#13;
            <code class="n">country</code> <code class="o">=</code> <code class="n">country</code><code class="o">.</code><code class="n">strip</code><code class="p">()</code>&#13;
            <code class="k">print</code><code class="p">(</code><code class="n">city</code><code class="o">.</code><code class="n">title</code><code class="p">(),</code> <code class="n">country</code><code class="o">.</code><code class="n">title</code><code class="p">(),</code> <code class="n">sep</code><code class="o">=</code><code class="s1">','</code><code class="p">)</code>&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="kn">import</code> <code class="nn">sys</code>&#13;
    <code class="n">process_cities</code><code class="p">(</code><code class="n">sys</code><code class="o">.</code><code class="n">argv</code><code class="p">[</code><code class="mi">1</code><code class="p">])</code></pre></div>&#13;
&#13;
<p>Let’s try it with that sample data file we made earlier.&#13;
Ready, fire, aim:</p>&#13;
<pre>$ <strong>python capitals.py cities.csv</strong>&#13;
Paris,France&#13;
Caracas,Venuzuela&#13;
Vilnius,Lithuania</pre>&#13;
&#13;
<p>Looks great!&#13;
It passed one test, so let’s put it in production,&#13;
processing capitals and countries from around the world—until it fails, but only for this data file (<a data-type="xref" href="#ex1918">Example 19-18</a>).</p>&#13;
<div data-type="example" id="ex1918">&#13;
<h5><span class="label">Example 19-18. </span>cities2.csv</h5>&#13;
&#13;
<pre data-type="programlisting">argentina,buenos aires&#13;
bolivia,la paz&#13;
brazil,brasilia&#13;
chile,santiago&#13;
colombia,Bogotá&#13;
ecuador,quito&#13;
falkland islands,stanley&#13;
french guiana,cayenne&#13;
guyana,georgetown&#13;
paraguay,Asunción&#13;
peru,lima&#13;
suriname,paramaribo&#13;
uruguay,montevideo&#13;
venezuela,caracas&#13;
quit</pre></div>&#13;
&#13;
<p>The program ends after printing only 5 lines of the 15&#13;
in the data file, as demonstrated here:</p>&#13;
<pre>$ <strong>python capitals.py cities2.csv</strong>&#13;
Buenos Aires,Argentina&#13;
La Paz,Bolivia&#13;
Brazilia,Brazil&#13;
Santiago,Chile&#13;
Bogotá,Colombia</pre>&#13;
&#13;
<p>What happened?&#13;
We can keep editing <em>capitals.py</em>,&#13;
putting <code>print()</code> statements in likely places,&#13;
but let’s see if the debugger can help us.</p>&#13;
&#13;
<p>To use the debugger, import the <code>pdb</code> module from the command line&#13;
by typing <strong><code>-m pdb</code></strong>, like so:</p>&#13;
<pre>$ <strong>python -m pdb capitals.py cities2.csv</strong></pre>&#13;
&#13;
<pre data-type="programlisting">&gt; /Users/williamlubanovic/book/capitals.py(1)&lt;module&gt;()&#13;
-&gt; def process_cities(filename):&#13;
(Pdb)</pre>&#13;
&#13;
<p>This starts the program and places you at the first line.&#13;
If you type <strong><code>c</code></strong> (<em>continue</em>), the program will run until it ends,&#13;
either normally or with an error:</p>&#13;
<pre>(Pdb) <strong>c</strong></pre>&#13;
&#13;
<pre data-type="programlisting">Buenos Aires,Argentina&#13;
La Paz,Bolivia&#13;
Brazilia,Brazil&#13;
Santiago,Chile&#13;
Bogotá,Colombia&#13;
The program finished and will be restarted&#13;
&gt; /Users/williamlubanovic/book/capitals.py(1)&lt;module&gt;()&#13;
-&gt; def process_cities(filename):</pre>&#13;
&#13;
<p>It completed normally,&#13;
just as it did when we ran it earlier outside of the debugger.&#13;
Let’s try again,&#13;
using some commands to narrow down where the problem lies.&#13;
It seems to be a <em>logic error</em> rather than&#13;
a syntax problem or exception&#13;
(which would have printed error messages).</p>&#13;
&#13;
<p><a data-primary="s (step)" data-type="indexterm" id="idm45794966138648"/>Type <strong><code>s</code></strong> (<em>step</em>) to single-step through Python lines.&#13;
This steps through <em>all</em> Python code lines:&#13;
yours, the standard library’s,&#13;
and any other modules you might be using.&#13;
When you use <code>s</code>, you also go into functions&#13;
and single-step within them.&#13;
Type <strong><code>n</code></strong> (<em>next</em>) to single-step but&#13;
<em>not</em> to go inside functions;&#13;
when you get to a function,&#13;
a single <code>n</code> causes the entire function to&#13;
execute and take you to the next line of your program.&#13;
Thus, use <code>s</code> when you’re not sure where the problem is;&#13;
use <code>n</code> when you’re sure that a particular function&#13;
isn’t the cause,&#13;
especially if it’s a long function.&#13;
Often you’ll single-step through your own code&#13;
and step over library code,&#13;
which is presumably well tested.&#13;
Let’s use <code>s</code> to step from the beginning of the program&#13;
into the function <code>process_cities()</code>:</p>&#13;
<pre>(Pdb) <strong>s</strong></pre>&#13;
&#13;
<pre data-type="programlisting">&gt; /Users/williamlubanovic/book/capitals.py(12)&lt;module&gt;()&#13;
 -&gt; if __name__ == '__main__':&lt;/pre&gt;</pre>&#13;
<pre>(Pdb) <strong>s</strong></pre>&#13;
&#13;
<pre data-type="programlisting"> &gt; /Users/williamlubanovic/book/capitals.py(13)&lt;module&gt;()&#13;
 -&gt; import sys</pre>&#13;
<pre>(Pdb) <strong>s</strong></pre>&#13;
&#13;
<pre data-type="programlisting"> &gt; /Users/williamlubanovic/book/capitals.py(14)&lt;module&gt;()&#13;
 -&gt; process_cities(sys.argv[1])</pre>&#13;
<pre>(Pdb) <strong>s</strong></pre>&#13;
&#13;
<pre data-type="programlisting"> --Call--&#13;
 &gt; /Users/williamlubanovic/book/capitals.py(1)process_cities()&#13;
 -&gt; def process_cities(filename):</pre>&#13;
<pre>(Pdb) <strong>s</strong></pre>&#13;
&#13;
<pre data-type="programlisting"> &gt; /Users/williamlubanovic/book/capitals.py(2)process_cities()&#13;
 -&gt; with open(filename, 'rt') as file:</pre>&#13;
&#13;
<p>Type <strong><code>l</code></strong> (<em>list</em>) to see the next few lines of your program:</p>&#13;
<pre>(Pdb) <strong>l</strong></pre>&#13;
&#13;
<pre data-type="programlisting">  1      def process_cities(filename):&#13;
  2  -&gt;     with open(filename, 'rt') as file:&#13;
  3             for line in file:&#13;
  4                 line = line.strip()&#13;
  5                 if 'quit' in line.lower():&#13;
  6                     return&#13;
  7                 country, city = line.split(',')&#13;
  8                 city = city.strip()&#13;
  9                 country = country.strip()&#13;
 10                 print(city.title(), country.title(), sep=',')&#13;
 11&#13;
 (Pdb)</pre>&#13;
&#13;
<p>The arrow (<code>-&gt;</code>) denotes the current line.</p>&#13;
&#13;
<p><a data-primary="breakpoints" data-type="indexterm" id="idm45794966119624"/>We could continue using <code>s</code> or <code>n</code>, hoping to spot something,&#13;
but let’s use one of the main features of a debugger: <em>breakpoints</em>.&#13;
A breakpoint stops execution at the line you indicate.&#13;
In our case, we want to know why <code>process_cities()</code> bails out&#13;
before it’s read all of the input lines.&#13;
Line 3 (<code>for line in file:</code>) will read every line in the input file,&#13;
so that seems innocent.&#13;
The only other place where we could return from the function before&#13;
reading all of the data is at line 6 (<code>return</code>).&#13;
Let’s set a breakpoint on line 6:</p>&#13;
<pre>(Pdb) <strong>b 6</strong></pre>&#13;
&#13;
<pre data-type="programlisting">Breakpoint 1 at /Users/williamlubanovic/book/capitals.py:6</pre>&#13;
&#13;
<p class="pagebreak-before">Next, let’s continue the program until it either hits the breakpoint or&#13;
reads all of the input lines and finishes normally:</p>&#13;
<pre>(Pdb) <strong>c</strong></pre>&#13;
&#13;
<pre data-type="programlisting"> Buenos Aires,Argentina&#13;
 La Paz,Bolivia&#13;
 Brasilia,Brazil&#13;
 Santiago,Chile&#13;
 Bogotá,Colombia&#13;
 &gt; /Users/williamlubanovic/book/capitals.py(6)process_cities()&#13;
 -&gt; return</pre>&#13;
&#13;
<p>Aha! It stopped at our line 6 breakpoint.&#13;
This indicates that the program wants to&#13;
return early after reading the country after Colombia.&#13;
Let’s print the value of <code>line</code> to see what we just read:</p>&#13;
<pre>(Pdb) <strong>p line</strong></pre>&#13;
&#13;
<pre data-type="programlisting">'ecuador,quito'</pre>&#13;
&#13;
<p>What’s so special about—oh, never mind.</p>&#13;
&#13;
<p>Really?&#13;
<strong><code>quit</code></strong>o?&#13;
Our manager never expected the string <code>quit</code>&#13;
to turn up inside normal data,&#13;
so using it as a <em>sentinel</em>&#13;
(end indicator) value like this was a boneheaded idea.&#13;
You march right in there and tell him that—while I wait here.</p>&#13;
&#13;
<p>If at this point you still have a job,&#13;
you can see all your breakpoints by using a plain <code>b</code> command:</p>&#13;
<pre>(Pdb) <strong>b</strong></pre>&#13;
&#13;
<pre data-type="programlisting">Num Type         Disp Enb   Where&#13;
1   breakpoint   keep yes   at /Users/williamlubanovic/book/capitals.py:6&#13;
    breakpoint already hit 1 time</pre>&#13;
&#13;
<p>An <code>l</code> will show your code lines,&#13;
the current line (<code>-&gt;</code>), and any breakpoints (<code>B</code>).&#13;
A plain <code>l</code> will start listing&#13;
from the end of your previous call to <code>l</code>,&#13;
so include&#13;
the optional starting line&#13;
(here, let’s start from line <code>1</code>):</p>&#13;
<pre>(Pdb) <strong>l 1</strong></pre>&#13;
&#13;
<pre data-type="programlisting">  1      def process_cities(filename):&#13;
  2         with open(filename, 'rt') as file:&#13;
  3             for line in file:&#13;
  4                 line = line.strip()&#13;
  5                 if 'quit' in line.lower():&#13;
  6 B-&gt;                 return&#13;
  7                 country, city = line.split(',')&#13;
  8                 city = city.strip()&#13;
  9                 country = country.strip()&#13;
 10                 print(city.title(), country.title(), sep=',')&#13;
 11</pre>&#13;
&#13;
<p>OK, as shown in <a data-type="xref" href="#ex1919">Example 19-19</a>, let’s fix that <code>quit</code> test to match only the full line,&#13;
not within other characters.</p>&#13;
<div data-type="example" id="ex1919">&#13;
<h5><span class="label">Example 19-19. </span>capitals2.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">process_cities</code><code class="p">(</code><code class="n">filename</code><code class="p">):</code>&#13;
    <code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="n">filename</code><code class="p">,</code> <code class="s1">'rt'</code><code class="p">)</code> <code class="k">as</code> <code class="nb">file</code><code class="p">:</code>&#13;
        <code class="k">for</code> <code class="n">line</code> <code class="ow">in</code> <code class="nb">file</code><code class="p">:</code>&#13;
            <code class="n">line</code> <code class="o">=</code> <code class="n">line</code><code class="o">.</code><code class="n">strip</code><code class="p">()</code>&#13;
            <code class="k">if</code> <code class="s1">'quit'</code> <code class="o">==</code> <code class="n">line</code><code class="o">.</code><code class="n">lower</code><code class="p">():</code>&#13;
                <code class="k">return</code>&#13;
            <code class="n">country</code><code class="p">,</code> <code class="n">city</code> <code class="o">=</code> <code class="n">line</code><code class="o">.</code><code class="n">split</code><code class="p">(</code><code class="s1">','</code><code class="p">)</code>&#13;
            <code class="n">city</code> <code class="o">=</code> <code class="n">city</code><code class="o">.</code><code class="n">strip</code><code class="p">()</code>&#13;
            <code class="n">country</code> <code class="o">=</code> <code class="n">country</code><code class="o">.</code><code class="n">strip</code><code class="p">()</code>&#13;
            <code class="k">print</code><code class="p">(</code><code class="n">city</code><code class="o">.</code><code class="n">title</code><code class="p">(),</code> <code class="n">country</code><code class="o">.</code><code class="n">title</code><code class="p">(),</code> <code class="n">sep</code><code class="o">=</code><code class="s1">','</code><code class="p">)</code>&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="kn">import</code> <code class="nn">sys</code>&#13;
    <code class="n">process_cities</code><code class="p">(</code><code class="n">sys</code><code class="o">.</code><code class="n">argv</code><code class="p">[</code><code class="mi">1</code><code class="p">])</code></pre></div>&#13;
&#13;
<p>Once more, with feeling:</p>&#13;
<pre>$ <strong>python capitals2.py cities2.csv</strong></pre>&#13;
&#13;
<pre data-type="programlisting">Buenos Aires,Argentina&#13;
La Paz,Bolivia&#13;
Brasilia,Brazil&#13;
Santiago,Chile&#13;
Bogotá,Colombia&#13;
Quito,Ecuador&#13;
Stanley,Falkland Islands&#13;
Cayenne,French Guiana&#13;
Georgetown,Guyana&#13;
Asunción,Paraguay&#13;
Lima,Peru&#13;
Paramaribo,Suriname&#13;
Montevideo,Uruguay&#13;
Caracas,Venezuela</pre>&#13;
&#13;
<p>That was a skimpy overview of the debugger—just enough to show you what it can do and what commands&#13;
you’d use most of the time.</p>&#13;
&#13;
<p>Remember: more tests, less debugging.<a data-startref="ix_ch19-pythonista-asciidoc18" data-type="indexterm" id="idm45794965947432"/><a data-startref="ix_ch19-pythonista-asciidoc17" data-type="indexterm" id="idm45794965946744"/><a data-startref="ix_ch19-pythonista-asciidoc16" data-type="indexterm" id="idm45794965946056"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Use breakpoint()" data-type="sect2"><div class="sect2" id="breakpoint">&#13;
<h2>Use breakpoint()</h2>&#13;
&#13;
<p><a data-primary="breakpoint() function" data-type="indexterm" id="idm45794965944792"/><a data-primary="debugging" data-secondary="breakpoint() for" data-type="indexterm" id="idm45794965944088"/>In Python 3.7, there’s a new built-in function&#13;
called <code>breakpoint()</code>.&#13;
If you add it to your code,&#13;
a debugger will automatically start up and&#13;
pause at each location.&#13;
Without this, you would need to fire up a debugger&#13;
like <code>pdb</code> and set breakpoints manually, as you saw earlier.</p>&#13;
&#13;
<p>The default debugger is the one you’ve just seen&#13;
(<code>pdb</code>), but this can be changed by setting&#13;
the environment variable&#13;
<code>PYTHONBREAKPOINT</code>.&#13;
For example, you could specify use&#13;
of the web-based remote debugger&#13;
<a href="https://pypi.org/project/web-pdb">web-pdb</a>:</p>&#13;
<pre>$ <strong>export PYTHONBREAKPOINT='web_pdb.set_trace'</strong></pre>&#13;
&#13;
<p>The official documentation is a bit dry,&#13;
but there are good overviews&#13;
<a href="https://oreil.ly/9Q9MZ">here</a>&#13;
and&#13;
<a href="https://oreil.ly/2LJKy">there</a>.<a data-startref="ix_ch19-pythonista-asciidoc15" data-type="indexterm" id="idm45794965937400"/><a data-startref="ix_ch19-pythonista-asciidoc14" data-type="indexterm" id="idm45794965936648"/><a data-startref="ix_ch19-pythonista-asciidoc13" data-type="indexterm" id="idm45794965935960"/><a data-startref="ix_ch19-pythonista-asciidoc12" data-type="indexterm" id="idm45794965935272"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Log Error Messages" data-type="sect1"><div class="sect1" id="log">&#13;
<h1>Log Error Messages</h1>&#13;
&#13;
<p><a data-primary="best practices" data-secondary="logging" data-type="indexterm" id="ix_ch19-pythonista-asciidoc19"/><a data-primary="exceptions" data-secondary="logging error messages" data-type="indexterm" id="ix_ch19-pythonista-asciidoc20"/><a data-primary="logging" data-type="indexterm" id="ix_ch19-pythonista-asciidoc21"/>At some point you might need to graduate from&#13;
using <code>print()</code> statements to logging messages.&#13;
A log is usually a system file that accumulates messages,&#13;
often inserting useful&#13;
information such as a timestamp&#13;
or the name of the user who’s running the program.&#13;
Often logs are <em>rotated</em> (renamed) daily and compressed;&#13;
by doing so, they don’t fill up your disk&#13;
and cause problems themselves.&#13;
When something goes wrong with your program,&#13;
you can look at the appropriate log file to see what happened.&#13;
The contents of exceptions are especially useful in logs because&#13;
they show you the actual line at which your program croaked,&#13;
and why.</p>&#13;
&#13;
<p>The standard Python library module is&#13;
<a href="http://bit.ly/py-logging"><code>logging</code></a>.&#13;
I’ve found most descriptions of it somewhat confusing.&#13;
After a while it makes more sense,&#13;
but it does seem overly complicated at first.&#13;
The <code>logging</code> module includes these concepts:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>The <em>message</em> that you want to save to the log</p>&#13;
</li>&#13;
<li>&#13;
<p>Ranked priority <em>levels</em> and matching functions:&#13;
<code>debug()</code>, <code>info()</code>, <code>warn()</code>, <code>error()</code>, and <code>critical()</code></p>&#13;
</li>&#13;
<li>&#13;
<p>One or more <em>logger</em> objects as&#13;
the main connection with the module</p>&#13;
</li>&#13;
<li>&#13;
<p><em>Handlers</em> that direct the message to your terminal,&#13;
a file, a database, or somewhere else</p>&#13;
</li>&#13;
<li>&#13;
<p><em>Formatters</em> that create the output</p>&#13;
</li>&#13;
<li>&#13;
<p><em>Filters</em> that make decisions based on the input</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>For the simplest logging example,&#13;
just import the module and use some of its <span class="keep-together">functions:</span></p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">logging</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logging</code><code class="o">.</code><code class="n">debug</code><code class="p">(</code><code class="s">"Looks like rain"</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logging</code><code class="o">.</code><code class="n">info</code><code class="p">(</code><code class="s">"And hail"</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logging</code><code class="o">.</code><code class="n">warn</code><code class="p">(</code><code class="s">"Did I hear thunder?"</code><code class="p">)</code>&#13;
<code class="go">WARNING:root:Did I hear thunder?</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logging</code><code class="o">.</code><code class="n">error</code><code class="p">(</code><code class="s">"Was that lightning?"</code><code class="p">)</code>&#13;
<code class="go">ERROR:root:Was that lightning?</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logging</code><code class="o">.</code><code class="n">critical</code><code class="p">(</code><code class="s">"Stop fencing and get inside!"</code><code class="p">)</code>&#13;
<code class="go">CRITICAL:root:Stop fencing and get inside!</code></pre>&#13;
&#13;
<p>Did you notice that <code>debug()</code> and <code>info()</code> didn’t do anything,&#13;
and the other two printed <em>LEVEL</em>:<code>root</code>: before each message?&#13;
So far, it’s like a <code>print()</code> statement with multiple personalities,&#13;
some of them hostile.</p>&#13;
&#13;
<p>But it is useful.&#13;
You can scan for a particular value of <em>LEVEL</em> in a log file&#13;
to find particular messages,&#13;
compare timestamps to see what happened before your server crashed,&#13;
and so on.</p>&#13;
&#13;
<p>A lot of digging through the documentation&#13;
answers the first mystery&#13;
(we get to the second one in a page or two):&#13;
the default priority <em>level</em> is <code>WARNING</code>,&#13;
and that got locked in&#13;
as soon as we called the first function (<code>logging.debug()</code>).&#13;
<a data-primary="basicConfig() function" data-type="indexterm" id="idm45794965841400"/>We can set the default level by using <code>basicConfig()</code>.&#13;
<code>DEBUG</code> is the lowest level, so this enables it and all&#13;
the higher levels to flow through:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">logging</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logging</code><code class="o">.</code><code class="n">basicConfig</code><code class="p">(</code><code class="n">level</code><code class="o">=</code><code class="n">logging</code><code class="o">.</code><code class="n">DEBUG</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logging</code><code class="o">.</code><code class="n">debug</code><code class="p">(</code><code class="s">"It's raining again"</code><code class="p">)</code>&#13;
<code class="go">DEBUG:root:It's raining again</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logging</code><code class="o">.</code><code class="n">info</code><code class="p">(</code><code class="s">"With hail the size of hailstones"</code><code class="p">)</code>&#13;
<code class="go">INFO:root:With hail the size of hailstones</code></pre>&#13;
&#13;
<p>We did all that with the default <code>logging</code> functions&#13;
without actually creating a <em>logger</em> object.&#13;
Each logger has a name.&#13;
Let’s make one called <code>bunyan</code>:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">logging</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logging</code><code class="o">.</code><code class="n">basicConfig</code><code class="p">(</code><code class="n">level</code><code class="o">=</code><code class="s">'DEBUG'</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logger</code> <code class="o">=</code> <code class="n">logging</code><code class="o">.</code><code class="n">getLogger</code><code class="p">(</code><code class="s">'bunyan'</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logger</code><code class="o">.</code><code class="n">debug</code><code class="p">(</code><code class="s">'Timber!'</code><code class="p">)</code>&#13;
<code class="go">DEBUG:bunyan:Timber!</code></pre>&#13;
&#13;
<p>If the logger name contains any dot characters,&#13;
they separate levels of a hierarchy of loggers,&#13;
each with potentially different properties.&#13;
This means that a logger named <code>quark</code> is&#13;
higher than one named <code>quark.charmed</code>.&#13;
The special <em>root logger</em> is at the top&#13;
and is called <code>''</code>.</p>&#13;
&#13;
<p>So far, we’ve just printed messages,&#13;
which is not a great improvement over <code>print()</code>.&#13;
We use <em>handlers</em> to direct the messages to different places.&#13;
The most common is a <em>log file</em>,&#13;
and here’s how you do it:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">logging</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logging</code><code class="o">.</code><code class="n">basicConfig</code><code class="p">(</code><code class="n">level</code><code class="o">=</code><code class="s">'DEBUG'</code><code class="p">,</code> <code class="n">filename</code><code class="o">=</code><code class="s">'blue_ox.log'</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logger</code> <code class="o">=</code> <code class="n">logging</code><code class="o">.</code><code class="n">getLogger</code><code class="p">(</code><code class="s">'bunyan'</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logger</code><code class="o">.</code><code class="n">debug</code><code class="p">(</code><code class="s">"Where's my axe?"</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logger</code><code class="o">.</code><code class="n">warn</code><code class="p">(</code><code class="s">"I need my axe"</code><code class="p">)</code>&#13;
<code class="go">&gt;&gt;&gt;</code></pre>&#13;
&#13;
<p>Aha! The lines aren’t on the screen anymore;&#13;
instead, they’re in the file named <em>blue_ox.log</em>:</p>&#13;
&#13;
<pre data-type="programlisting">DEBUG:bunyan:Where's my axe?&#13;
WARNING:bunyan:I need my axe</pre>&#13;
&#13;
<p>Calling <code>basicConfig()</code> with a <code>filename</code> argument created&#13;
a <code>FileHandler</code> for you and made it available to your logger.&#13;
The <code>logging</code> module includes at least 15 handlers&#13;
to send messages to places such as email and web servers&#13;
as well as the screen and files.</p>&#13;
&#13;
<p>Finally, you can control the <em>format</em> of your logged messages.&#13;
In our first example, our default gave us something similar to this:</p>&#13;
&#13;
<pre data-type="programlisting">WARNING:root:Message...</pre>&#13;
&#13;
<p>If you provide a <code>format</code> string to <code>basicConfig()</code>,&#13;
you can change to the format of your preference:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">logging</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">fmt</code> <code class="o">=</code> <code class="s">'</code><code class="si">%(asctime)s</code><code class="s"> </code><code class="si">%(levelname)s</code><code class="s"> </code><code class="si">%(lineno)s</code><code class="s"> </code><code class="si">%(message)s</code><code class="s">'</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logging</code><code class="o">.</code><code class="n">basicConfig</code><code class="p">(</code><code class="n">level</code><code class="o">=</code><code class="s">'DEBUG'</code><code class="p">,</code> <code class="n">format</code><code class="o">=</code><code class="n">fmt</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logger</code> <code class="o">=</code> <code class="n">logging</code><code class="o">.</code><code class="n">getLogger</code><code class="p">(</code><code class="s">'bunyan'</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">logger</code><code class="o">.</code><code class="n">error</code><code class="p">(</code><code class="s">"Where's my other plaid shirt?"</code><code class="p">)</code>&#13;
<code class="go">2014-04-08 23:13:59,899 ERROR 1 Where's my other plaid shirt?</code></pre>&#13;
&#13;
<p>We let the logger send output to the screen again,&#13;
but changed the format.</p>&#13;
&#13;
<p>The <code>logging</code> module recognizes a number of variable names&#13;
in the <code>fmt</code> format string.&#13;
We used <code>asctime</code> (date and time as an ISO 8601 string),&#13;
<code>levelname</code>,&#13;
<code>lineno</code> (line number),&#13;
and the&#13;
<code>message</code> itself.&#13;
There are other built-ins,&#13;
and you can provide your own variables,&#13;
as well.</p>&#13;
&#13;
<p>There’s much more to <code>logging</code> than this&#13;
little overview can provide.&#13;
You can log to more than one place at the same time,&#13;
with different priorities and formats.&#13;
The package has a lot of flexibility&#13;
but sometimes at the cost of simplicity.<a data-startref="ix_ch19-pythonista-asciidoc21" data-type="indexterm" id="idm45794965576232"/><a data-startref="ix_ch19-pythonista-asciidoc20" data-type="indexterm" id="idm45794965575512"/><a data-startref="ix_ch19-pythonista-asciidoc19" data-type="indexterm" id="idm45794965574824"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Optimize" data-type="sect1"><div class="sect1" id="optimize">&#13;
<h1>Optimize</h1>&#13;
&#13;
<p><a data-primary="best practices" data-secondary="optimizing code" data-type="indexterm" id="ix_ch19-pythonista-asciidoc22"/><a data-primary="code" data-secondary="optimizing" data-type="indexterm" id="ix_ch19-pythonista-asciidoc23"/><a data-primary="optimization" data-secondary="of code" data-type="indexterm" id="ix_ch19-pythonista-asciidoc24"/>Python is usually fast enough—until it isn’t.&#13;
In many cases, you can gain speed by&#13;
using a better algorithm or data structure.&#13;
The trick is knowing where to do this.&#13;
Even experienced programmers guess wrong surprisingly often.&#13;
You need to be like the careful quiltmaker&#13;
and measure before you cut.&#13;
And this leads us to <em>timers</em>.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Measure Timing" data-type="sect2"><div class="sect2" id="timing">&#13;
<h2>Measure Timing</h2>&#13;
&#13;
<p><a data-primary="optimization" data-secondary="timing" data-type="indexterm" id="ix_ch19-pythonista-asciidoc25"/><a data-primary="timing, measurement of" data-type="indexterm" id="ix_ch19-pythonista-asciidoc26"/>You’ve seen that the <code>time()</code> function in the <code>time</code> module returns&#13;
the current epoch time as a floating-point number of seconds.&#13;
A quick way of timing something is to get the current time,&#13;
do something,&#13;
get the new time,&#13;
and then subtract the original time from the new time.&#13;
Let’s write this up, as presented in <a data-type="xref" href="#ex1920">Example 19-20</a>, and call it (what else?) <em>time1.py</em>.</p>&#13;
<div data-type="example" id="ex1920">&#13;
<h5><span class="label">Example 19-20. </span>time1.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">time</code> <code class="kn">import</code> <code class="n">time</code>&#13;
&#13;
<code class="n">t1</code> <code class="o">=</code> <code class="n">time</code><code class="p">()</code>&#13;
<code class="n">num</code> <code class="o">=</code> <code class="mi">5</code>&#13;
<code class="n">num</code> <code class="o">*=</code> <code class="mi">2</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="n">time</code><code class="p">()</code> <code class="o">-</code> <code class="n">t1</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>In this example, we’re measuring the time it takes to assign&#13;
the value <code>5</code> to the name <code>num</code> and multiply it by <code>2</code>.&#13;
This is <em>not</em> a realistic benchmark,&#13;
just an example of how to measure some arbitrary Python code.&#13;
Try running it a few times, just to see how much it can vary:</p>&#13;
<pre>$ <strong>python time1.py</strong>&#13;
2.1457672119140625e-06&#13;
$ <strong>python time1.py</strong>&#13;
2.1457672119140625e-06&#13;
$ <strong>python time1.py</strong>&#13;
2.1457672119140625e-06&#13;
$ <strong>python time1.py</strong>&#13;
1.9073486328125e-06&#13;
$ <strong>python time1.py</strong>&#13;
3.0994415283203125e-06</pre>&#13;
&#13;
<p>That was about two or three millionths of a second.&#13;
Let’s try something slower,&#13;
such as <code>sleep()</code>.<sup><a data-type="noteref" href="ch19.html#idm45794965496488" id="idm45794965496488-marker">2</a></sup>&#13;
If we sleep for a second,&#13;
our timer should take a tiny bit more than a second.&#13;
<a data-type="xref" href="#ex1921">Example 19-21</a> shows the code; save this as <em>time2.py</em>.</p>&#13;
<div data-type="example" id="ex1921">&#13;
<h5><span class="label">Example 19-21. </span>time2.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">time</code> <code class="kn">import</code> <code class="n">time</code><code class="p">,</code> <code class="n">sleep</code>&#13;
&#13;
<code class="n">t1</code> <code class="o">=</code> <code class="n">time</code><code class="p">()</code>&#13;
<code class="n">sleep</code><code class="p">(</code><code class="mf">1.0</code><code class="p">)</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="n">time</code><code class="p">()</code> <code class="o">-</code> <code class="n">t1</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>Let’s be certain of our results, so run it a few times:</p>&#13;
<pre>$ <strong>python time2.py</strong>&#13;
1.000797986984253&#13;
$ <strong>python time2.py</strong>&#13;
1.0010130405426025&#13;
$ <strong>python time2.py</strong>&#13;
1.0010390281677246</pre>&#13;
&#13;
<p>As expected, it takes about a second to run.&#13;
If it didn’t,&#13;
either our timer or <code>sleep()</code> should be embarrassed.</p>&#13;
&#13;
<p id="timeit">There’s a handier way to measure code snippets like this:&#13;
using the standard module&#13;
<a href="http://bit.ly/py-timeit"><code>timeit</code></a>.&#13;
<a data-primary="timeit() function" data-type="indexterm" id="idm45794965438440"/>It has a function called (you guessed it) <code>timeit()</code>,&#13;
which will do <em>count</em> runs of&#13;
your test <em>code</em>&#13;
and print some&#13;
results. The syntax is:&#13;
<code>timeit.timeit(<em><code>code</code></em></code>, <code>number=<em><code>count</code></em>)</code>.</p>&#13;
&#13;
<p>In the examples in this section,&#13;
the <code>code</code> needs to be within quotes&#13;
so that it is not executed after you press&#13;
the Return key but is executed inside <code>timeit()</code>.&#13;
(In the next section,&#13;
you’ll see how to time a function&#13;
by passing its name to <code>timeit()</code>.)&#13;
Let’s run our previous example just once and time it.&#13;
Call this file <em>timeit1.py</em> (<a data-type="xref" href="#ex1922">Example 19-22</a>).</p>&#13;
<div data-type="example" id="ex1922">&#13;
<h5><span class="label">Example 19-22. </span>timeit1.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">timeit</code> <code class="kn">import</code> <code class="n">timeit</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="n">timeit</code><code class="p">(</code><code class="s1">'num = 5; num *= 2'</code><code class="p">,</code> <code class="n">number</code><code class="o">=</code><code class="mi">1</code><code class="p">))</code></pre></div>&#13;
&#13;
<p>Run it a few times:</p>&#13;
<pre>$ <strong>python timeit1.py</strong>&#13;
2.5600020308047533e-06&#13;
$ <strong>python timeit1.py</strong>&#13;
1.9020008039660752e-06&#13;
$ <strong>python timeit1.py</strong>&#13;
1.7380007193423808e-06</pre>&#13;
&#13;
<p>Again, these two code lines ran in about two millionths of a second.&#13;
We can use the <code>repeat</code> argument of the <code>timeit</code> module’s&#13;
<code>repeat()</code> function to run more sets.&#13;
Save this as <em>timeit2.py</em> (<a data-type="xref" href="#ex1923">Example 19-23</a>).</p>&#13;
<div data-type="example" id="ex1923">&#13;
<h5><span class="label">Example 19-23. </span>timeit2.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">timeit</code> <code class="kn">import</code> <code class="n">repeat</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="n">repeat</code><code class="p">(</code><code class="s1">'num = 5; num *= 2'</code><code class="p">,</code> <code class="n">number</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code> <code class="n">repeat</code><code class="o">=</code><code class="mi">3</code><code class="p">))</code></pre></div>&#13;
&#13;
<p>Try running it to see what transpires:</p>&#13;
<pre>$ <strong>python timeit2.py</strong>&#13;
[1.691998477326706e-06, 4.070025170221925e-07, 2.4700057110749185e-07]</pre>&#13;
&#13;
<p>The first run took two millionths of a second,&#13;
and the second and third runs were faster.&#13;
Why?&#13;
There could be many reasons.&#13;
For one thing,&#13;
we’re testing a very small piece of code,&#13;
and its speed could depend on&#13;
what else the computer was doing in those instants,&#13;
how the Python system optimizes calculations,&#13;
and many other things.</p>&#13;
&#13;
<p>Using <code>timeit()</code> meant wrapping the code you’re trying&#13;
to measure as a string.&#13;
What if you have multiple lines of code?&#13;
You could pass it a triple-quoted multiline string,&#13;
but that might be hard to read.</p>&#13;
&#13;
<p>Let’s define a lazy <code>snooze()</code> function that nods off for&#13;
a second, as we all do <span class="keep-together">occasionally.</span></p>&#13;
&#13;
<p>First, we can wrap the <code>snooze()</code> function itself.&#13;
We need to include the arguments&#13;
<code>globals=globals()</code>&#13;
(this helps Python to find <code>snooze</code>)&#13;
and <code>number=1</code>&#13;
(run it only once; the default is&#13;
1000000, and we don’t have that much time):</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">time</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="kn">from</code> <code class="nn">timeit</code> <code class="kn">import</code> <code class="n">timeit</code>&#13;
<code class="go">&gt;&gt;&gt;</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">def</code> <code class="nf">snooze</code><code class="p">():</code>&#13;
<code class="gp">... </code>    <code class="n">time</code><code class="o">.</code><code class="n">sleep</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>&#13;
<code class="gp">...</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">seconds</code> <code class="o">=</code> <code class="n">timeit</code><code class="p">(</code><code class="s">'snooze()'</code><code class="p">,</code> <code class="nb">globals</code><code class="o">=</code><code class="nb">globals</code><code class="p">(),</code> <code class="n">number</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">print</code><code class="p">(</code><code class="s">"</code><code class="si">%.4f</code><code class="s">"</code> <code class="o">%</code> <code class="n">seconds</code><code class="p">)</code>&#13;
<code class="go">1.0035</code></pre>&#13;
&#13;
<p>Or, we can use a decorator:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">time</code>&#13;
<code class="go">&gt;&gt;&gt;</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">def</code> <code class="nf">snooze</code><code class="p">():</code>&#13;
<code class="gp">... </code>    <code class="n">time</code><code class="o">.</code><code class="n">sleep</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>&#13;
<code class="gp">...</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">def</code> <code class="nf">time_decorator</code><code class="p">(</code><code class="n">func</code><code class="p">):</code>&#13;
<code class="gp">... </code>    <code class="k">def</code> <code class="nf">inner</code><code class="p">(</code><code class="o">*</code><code class="n">args</code><code class="p">,</code> <code class="o">**</code><code class="n">kwargs</code><code class="p">):</code>&#13;
<code class="gp">... </code>        <code class="n">t1</code> <code class="o">=</code> <code class="n">time</code><code class="o">.</code><code class="n">time</code><code class="p">()</code>&#13;
<code class="gp">... </code>        <code class="n">result</code> <code class="o">=</code> <code class="n">func</code><code class="p">(</code><code class="o">*</code><code class="n">args</code><code class="p">,</code> <code class="o">**</code><code class="n">kwargs</code><code class="p">)</code>&#13;
<code class="gp">... </code>        <code class="n">t2</code> <code class="o">=</code> <code class="n">time</code><code class="o">.</code><code class="n">time</code><code class="p">()</code>&#13;
<code class="gp">... </code>        <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s">"{(t2-t1):.4f}"</code><code class="p">)</code>&#13;
<code class="gp">... </code>        <code class="k">return</code> <code class="n">result</code>&#13;
<code class="gp">... </code>    <code class="k">return</code> <code class="n">inner</code>&#13;
<code class="gp">...</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="nd">@time_decorator</code>&#13;
<code class="gp">... </code><code class="k">def</code> <code class="nf">naptime</code><code class="p">():</code>&#13;
<code class="gp">... </code>    <code class="n">snooze</code><code class="p">()</code>&#13;
<code class="gp">...</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">naptime</code><code class="p">()</code>&#13;
<code class="go">1.0015</code></pre>&#13;
&#13;
<p>Another way is to use a context manager:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">time</code>&#13;
<code class="go">&gt;&gt;&gt;</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">def</code> <code class="nf">snooze</code><code class="p">():</code>&#13;
<code class="gp">... </code>    <code class="n">time</code><code class="o">.</code><code class="n">sleep</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>&#13;
<code class="gp">...</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">class</code> <code class="nc">TimeContextManager</code><code class="p">:</code>&#13;
<code class="gp">... </code>    <code class="k">def</code> <code class="nf">__enter__</code><code class="p">(</code><code class="bp">self</code><code class="p">):</code>&#13;
<code class="gp">... </code>        <code class="bp">self</code><code class="o">.</code><code class="n">t1</code> <code class="o">=</code> <code class="n">time</code><code class="o">.</code><code class="n">time</code><code class="p">()</code>&#13;
<code class="gp">... </code>        <code class="k">return</code> <code class="bp">self</code>&#13;
<code class="gp">... </code>    <code class="k">def</code> <code class="nf">__exit__</code><code class="p">(</code><code class="bp">self</code><code class="p">,</code> <code class="nb">type</code><code class="p">,</code> <code class="n">value</code><code class="p">,</code> <code class="n">traceback</code><code class="p">):</code>&#13;
<code class="gp">... </code>        <code class="n">t2</code> <code class="o">=</code> <code class="n">time</code><code class="o">.</code><code class="n">time</code><code class="p">()</code>&#13;
<code class="gp">... </code>        <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s">"{(t2-self.t1):.4f}"</code><code class="p">)</code>&#13;
<code class="gp">...</code>&#13;
<code class="go">&gt;&gt;&gt;</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">with</code> <code class="n">TimeContextManager</code><code class="p">():</code>&#13;
<code class="gp">... </code>    <code class="n">snooze</code><code class="p">()</code>&#13;
<code class="gp">...</code>&#13;
<code class="go">1.0019</code></pre>&#13;
&#13;
<p>The <code>__exit()__</code> method takes three extra arguments&#13;
that we don’t use here; we could have used  <code>*args</code>&#13;
in their place.<a data-startref="ix_ch19-pythonista-asciidoc26" data-type="indexterm" id="idm45794965150392"/><a data-startref="ix_ch19-pythonista-asciidoc25" data-type="indexterm" id="idm45794965017144"/></p>&#13;
&#13;
<p>Okay, we’ve seen many ways to do timing.&#13;
Now, let’s time some code to compare the efficiency of&#13;
different&#13;
algorithms (program logic)&#13;
and data structures (storage <span class="keep-together">mechanisms).</span></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Algorithms and Data Structures" data-type="sect2"><div class="sect2" id="algorithms">&#13;
<h2>Algorithms and Data Structures</h2>&#13;
&#13;
<p><a data-primary="algorithms, data structures and" data-type="indexterm" id="idm45794965013912"/><a data-primary="data structures" data-secondary="algorithms and" data-type="indexterm" id="idm45794965013080"/>The&#13;
<a href="http://bit.ly/zen-py">Zen of Python</a>&#13;
declares that&#13;
<em>There should be one—and preferably only one—obvious way to do it</em>.&#13;
Unfortunately, sometimes it isn’t obvious,&#13;
and you need to compare alternatives.&#13;
For example, is it better to use a <code>for</code> loop or&#13;
a list comprehension to build a list?&#13;
And what do we mean by <em>better</em>?&#13;
Is it faster, easier to understand, using less memory,&#13;
or more “Pythonic”?</p>&#13;
&#13;
<p>In this next exercise, we build a list in different ways,&#13;
comparing speed, readability, and Python style.&#13;
Here’s <em>time_lists.py</em> (<a data-type="xref" href="#ex1924">Example 19-24</a>).</p>&#13;
<div data-type="example" id="ex1924">&#13;
<h5><span class="label">Example 19-24. </span>time_lists.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">timeit</code> <code class="kn">import</code> <code class="n">timeit</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">make_list_1</code><code class="p">():</code>&#13;
    <code class="n">result</code> <code class="o">=</code> <code class="p">[]</code>&#13;
    <code class="k">for</code> <code class="n">value</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1000</code><code class="p">):</code>&#13;
        <code class="n">result</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">value</code><code class="p">)</code>&#13;
    <code class="k">return</code> <code class="n">result</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">make_list_2</code><code class="p">():</code>&#13;
    <code class="n">result</code> <code class="o">=</code> <code class="p">[</code><code class="n">value</code> <code class="k">for</code> <code class="n">value</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1000</code><code class="p">)]</code>&#13;
    <code class="k">return</code> <code class="n">result</code>&#13;
&#13;
<code class="k">print</code><code class="p">(</code><code class="s1">'make_list_1 takes'</code><code class="p">,</code> <code class="n">timeit</code><code class="p">(</code><code class="n">make_list_1</code><code class="p">,</code> <code class="n">number</code><code class="o">=</code><code class="mi">1000</code><code class="p">),</code> <code class="s1">'seconds'</code><code class="p">)</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="s1">'make_list_2 takes'</code><code class="p">,</code> <code class="n">timeit</code><code class="p">(</code><code class="n">make_list_2</code><code class="p">,</code> <code class="n">number</code><code class="o">=</code><code class="mi">1000</code><code class="p">),</code> <code class="s1">'seconds'</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>In each function, we add 1,000 items to a list,&#13;
and we call each function 1,000 times.&#13;
Notice that in this test we called <code>timeit()</code>&#13;
with the function name as the first argument&#13;
rather than code as a string.&#13;
Let’s run it:</p>&#13;
<pre>$ <strong>python time_lists.py</strong></pre>&#13;
&#13;
<pre data-type="programlisting">make_list_1 takes 0.14117428699682932 seconds&#13;
make_list_2 takes 0.06174145900149597 seconds</pre>&#13;
&#13;
<p>The list comprehension is at least twice as fast as adding items to&#13;
the list by using <code>append()</code>.&#13;
In general, comprehensions are faster than manual construction.</p>&#13;
&#13;
<p>Use these ideas to make your own code faster.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Cython, NumPy, and C Extensions" data-type="sect2"><div class="sect2" id="cython">&#13;
<h2>Cython, NumPy, and C Extensions</h2>&#13;
&#13;
<p><a data-primary="Cython" data-type="indexterm" id="idm45794964903048"/><a data-primary="optimization" data-secondary="Cython/NumPy/C extensions for" data-type="indexterm" id="idm45794964902344"/>If you’re pushing Python as hard as you can&#13;
and still can’t get the performance&#13;
you want, you have yet more options.</p>&#13;
&#13;
<p><a href="http://cython.org">Cython</a> is a hybrid of Python and C,&#13;
designed to translate Python with some&#13;
performance annotations to compiled C code.&#13;
These annotations are fairly small, like declaring the types&#13;
of some variables, function arguments, or function returns.&#13;
For scientific-style loops of numeric calculations,&#13;
adding these hints will make them much faster—as much as a thousand times faster.&#13;
See <a href="https://oreil.ly/MmW_v">the Cython wiki</a>&#13;
for documentation and examples.</p>&#13;
&#13;
<p>You can read much more about NumPy in <a data-type="xref" href="ch22.html#ch_science">Chapter 22</a>.&#13;
It’s a Python math library, written in C for speed.</p>&#13;
&#13;
<p>Many parts of Python and its standard library&#13;
are written in C for speed&#13;
and wrapped in Python for convenience.&#13;
These hooks are available to you for your applications.&#13;
If you know C and Python and really want to make your code fly,&#13;
writing a C extension is harder,&#13;
but the improvements can be worth the trouble.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="PyPy" data-type="sect2"><div class="sect2" id="pypy">&#13;
<h2>PyPy</h2>&#13;
&#13;
<p><a data-primary="optimization" data-secondary="PyPI for" data-type="indexterm" id="idm45794964895352"/><a data-primary="PyPI" data-type="indexterm" id="idm45794964894376"/>When Java first appeared about 20 years ago,&#13;
it was as slow as an arthritic Schnauzer.&#13;
When it started to mean real money to&#13;
Sun and other companies, though,&#13;
they put millions into optimizing the Java interpreter&#13;
and the underlying Java virtual machine (JVM),&#13;
borrowing techniques from earlier languages like Smalltalk and LISP.&#13;
Microsoft likewise put great effort into optimizing its rival&#13;
C# language and .NET VM.</p>&#13;
&#13;
<p>No one owns Python, so no one has pushed&#13;
that hard to make it faster.&#13;
You’re probably using the standard Python implementation.&#13;
It’s written in C, and often called CPython&#13;
(not the same as Cython).</p>&#13;
&#13;
<p>Like PHP, Perl, and even Java, Python is not compiled to machine&#13;
language, but translated to an intermediate language&#13;
(with names such as <em>bytecode</em> or p-code)&#13;
which is then interpreted in a <em>virtual machine</em>.</p>&#13;
&#13;
<p><a href="http://pypy.org">PyPy</a> is a new Python interpreter&#13;
that applies some of the tricks that sped up Java.&#13;
Its <a href="http://speed.pypy.org">benchmarks</a> show that&#13;
PyPy is faster than CPython&#13;
in every test—more than six times faster on average, and up to 20 times faster&#13;
in some cases.&#13;
It works with Python 2 and 3.&#13;
You can download it and use it instead of CPython.&#13;
PyPy is constantly being improved,&#13;
and it might even replace CPython some day.&#13;
Read the latest release notes on the site&#13;
to see whether it could work for your purposes.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Numba" data-type="sect2"><div class="sect2" id="numba">&#13;
<h2>Numba</h2>&#13;
&#13;
<p><a data-primary="Numba" data-type="indexterm" id="idm45794964887032"/><a data-primary="optimization" data-secondary="Numba for" data-type="indexterm" id="idm45794964886328"/>You can use&#13;
<a href="http://numba.pydata.org">Numba</a>&#13;
to compile your Python code on the fly&#13;
to machine code and speed it up.</p>&#13;
&#13;
<p>Install with the usual:</p>&#13;
<pre>$ <strong>pip install numba</strong></pre>&#13;
&#13;
<p>Let’s first time a normal Python function&#13;
that calculates a hypotenuse:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="kn">import</code> <code class="nn">math</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="kn">from</code> <code class="nn">timeit</code> <code class="kn">import</code> <code class="n">timeit</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="kn">from</code> <code class="nn">numba</code> <code class="kn">import</code> <code class="n">jit</code>&#13;
<code class="go">&gt;&gt;&gt;</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="k">def</code> <code class="nf">hypot</code><code class="p">(</code><code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">):</code>&#13;
<code class="gp">... </code>    <code class="k">return</code> <code class="n">math</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">a</code><code class="o">**</code><code class="mi">2</code> <code class="o">+</code> <code class="n">b</code><code class="o">**</code><code class="mi">2</code><code class="p">)</code>&#13;
<code class="gp">...</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">timeit</code><code class="p">(</code><code class="s">'hypot(5, 6)'</code><code class="p">,</code> <code class="nb">globals</code><code class="o">=</code><code class="nb">globals</code><code class="p">())</code>&#13;
<code class="go">0.6349189280000189</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">timeit</code><code class="p">(</code><code class="s">'hypot(5, 6)'</code><code class="p">,</code> <code class="nb">globals</code><code class="o">=</code><code class="nb">globals</code><code class="p">())</code>&#13;
<code class="go">0.6348589239999853</code></pre>&#13;
&#13;
<p>Use the <code>@jit</code> decorator to speed up calls after the first:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="nd">@jit</code>&#13;
<code class="gp">... </code><code class="k">def</code> <code class="nf">hypot_jit</code><code class="p">(</code><code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">):</code>&#13;
<code class="gp">... </code>    <code class="k">return</code> <code class="n">math</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">a</code><code class="o">**</code><code class="mi">2</code> <code class="o">+</code> <code class="n">b</code><code class="o">**</code><code class="mi">2</code><code class="p">)</code>&#13;
<code class="gp">...</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">timeit</code><code class="p">(</code><code class="s">'hypot_jit(5, 6)'</code><code class="p">,</code> <code class="nb">globals</code><code class="o">=</code><code class="nb">globals</code><code class="p">())</code>&#13;
<code class="go">0.5396156099999985</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">timeit</code><code class="p">(</code><code class="s">'hypot_jit(5, 6)'</code><code class="p">,</code> <code class="nb">globals</code><code class="o">=</code><code class="nb">globals</code><code class="p">())</code>&#13;
<code class="go">0.1534771130000081</code></pre>&#13;
&#13;
<p>Use <code>@jit(nopython=True)</code> to avoid the overhead&#13;
of the normal Python interpreter:</p>&#13;
&#13;
<pre data-code-language="pycon" data-type="programlisting"><code class="gp">&gt;&gt;&gt; </code><code class="nd">@jit</code><code class="p">(</code><code class="n">nopython</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>&#13;
<code class="gp">... </code><code class="k">def</code> <code class="nf">hypot_jit_nopy</code><code class="p">(</code><code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">):</code>&#13;
<code class="gp">... </code>    <code class="k">return</code> <code class="n">math</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">a</code><code class="o">**</code><code class="mi">2</code> <code class="o">+</code> <code class="n">b</code><code class="o">**</code><code class="mi">2</code><code class="p">)</code>&#13;
<code class="gp">...</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">timeit</code><code class="p">(</code><code class="s">'hypot_jit_nopy(5, 6)'</code><code class="p">,</code> <code class="nb">globals</code><code class="o">=</code><code class="nb">globals</code><code class="p">())</code>&#13;
<code class="go">0.18343535700000757</code>&#13;
<code class="gp">&gt;&gt;&gt; </code><code class="n">timeit</code><code class="p">(</code><code class="s">'hypot_jit_nopy(5, 6)'</code><code class="p">,</code> <code class="nb">globals</code><code class="o">=</code><code class="nb">globals</code><code class="p">())</code>&#13;
<code class="go">0.15387067300002855</code></pre>&#13;
&#13;
<p>Numba is especially useful with NumPy and other&#13;
mathematically demanding <span class="keep-together">packages.</span><a data-startref="ix_ch19-pythonista-asciidoc24" data-type="indexterm" id="idm45794964630232"/><a data-startref="ix_ch19-pythonista-asciidoc23" data-type="indexterm" id="idm45794964629624"/><a data-startref="ix_ch19-pythonista-asciidoc22" data-type="indexterm" id="idm45794964629016"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Source Control" data-type="sect1"><div class="sect1" id="source_control">&#13;
<h1>Source Control</h1>&#13;
&#13;
<p><a data-primary="best practices" data-secondary="source control" data-type="indexterm" id="ix_ch19-pythonista-asciidoc27"/><a data-primary="code" data-secondary="source control for" data-type="indexterm" id="ix_ch19-pythonista-asciidoc28"/><a data-primary="source control systems" data-type="indexterm" id="ix_ch19-pythonista-asciidoc29"/>When you’re working on a small group of programs,&#13;
you can usually keep track&#13;
of your changes—until you make a boneheaded mistake and clobber a few days of work.&#13;
Source control systems help protect your code&#13;
from dangerous forces, like you.&#13;
If you work with a group of developers,&#13;
source control becomes a necessity.&#13;
There are many commercial and open source packages in this area.&#13;
The most popular in the open source world where Python lives are&#13;
Mercurial and Git.&#13;
Both are examples of <em>distributed</em> version control systems,&#13;
which produce multiple copies of code repositories.&#13;
Earlier systems such as Subversion run on a single server.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Mercurial" data-type="sect2"><div class="sect2" id="mercurial">&#13;
<h2>Mercurial</h2>&#13;
&#13;
<p><a data-primary="Mercurial" data-type="indexterm" id="idm45794964620696"/><a data-primary="source control systems" data-secondary="Mercurial" data-type="indexterm" id="idm45794964619992"/><a href="http://mercurial-scm.org">Mercurial</a>&#13;
is written in Python.&#13;
It’s fairly easy to learn, with a handful of subcommands&#13;
to download code from a Mercurial repository,&#13;
add files,&#13;
check in changes,&#13;
and merge changes from different sources.&#13;
<a href="https://bitbucket.org">bitbucket</a> and&#13;
<a href="http://bit.ly/merc-host">other sites</a>&#13;
offer free or commercial <span class="keep-together">hosting.</span></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Git" data-type="sect2"><div class="sect2" id="git">&#13;
<h2>Git</h2>&#13;
&#13;
<p><a data-primary="Git" data-type="indexterm" id="ix_ch19-pythonista-asciidoc30"/><a data-primary="source control systems" data-secondary="Git" data-type="indexterm" id="ix_ch19-pythonista-asciidoc31"/><a href="http://git-scm.com">Git</a>&#13;
was originally written for Linux kernel development,&#13;
but now dominates&#13;
open source in general.&#13;
It’s similar to Mercurial,&#13;
although some find it slightly trickier to master.&#13;
<a href="http://github.com">GitHub</a> is the largest git host,&#13;
with more than a million repositories,&#13;
but there are <a href="http://bit.ly/githost-scm">many other hosts</a>.</p>&#13;
&#13;
<p>The standalone program examples in this book are available in&#13;
a public Git repository at&#13;
<a href="https://oreil.ly/U2Rmy">GitHub</a>.&#13;
If you have the <code>git</code> program on your computer,&#13;
you can download these programs by using this command:</p>&#13;
<pre>$ <strong>git clone https://github.com/madscheme/introducing-python</strong></pre>&#13;
&#13;
<p>You can also download the code from the GitHub page:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Click “Clone in Desktop” to open&#13;
your computer’s version of <code>git</code>, if installed.</p>&#13;
</li>&#13;
<li>&#13;
<p>Click “Download ZIP” to get a zipped archive of the programs.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>If you don’t have <code>git</code> but would like to try it,&#13;
read the&#13;
<a href="http://bit.ly/git-install">installation guide</a>.&#13;
I talk about the command-line version here,&#13;
but you might be interested in sites such as GitHub that&#13;
have extra services and might be easier to use in some cases;&#13;
<code>git</code> has many features, but is not always intuitive.</p>&#13;
&#13;
<p>Let’s take <code>git</code> for a test drive.&#13;
We won’t go far, but the ride will show&#13;
a few commands and their output.</p>&#13;
&#13;
<p>Make a new directory and change to it:</p>&#13;
<pre>$ <strong>mkdir newdir</strong>&#13;
$ <strong>cd newdir</strong></pre>&#13;
&#13;
<p>Create a local Git repository in your current directory <em>newdir</em>:</p>&#13;
<pre>$ <strong>git init</strong></pre>&#13;
&#13;
<pre data-type="programlisting">Initialized empty Git repository in /Users/williamlubanovic/newdir/.git/</pre>&#13;
&#13;
<p>Create a Python file called <em>test.py</em>, shown in <a data-type="xref" href="#ex1925">Example 19-25</a>,&#13;
with these contents in <em>newdir</em>.</p>&#13;
<div data-type="example" id="ex1925">&#13;
<h5><span class="label">Example 19-25. </span>test.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">print</code><code class="p">(</code><code class="s1">'Oops'</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>Add the file to the Git repository:</p>&#13;
<pre>$ <strong>git add test.py</strong></pre>&#13;
&#13;
<p>What do you think of that, Mr. Git?</p>&#13;
<pre>$ <strong>git status</strong></pre>&#13;
&#13;
<pre data-type="programlisting">On branch master&#13;
&#13;
Initial commit&#13;
&#13;
Changes to be committed:&#13;
  (use "git rm --cached &lt;file&gt;..." to unstage)&#13;
&#13;
    new file:   test.py</pre>&#13;
&#13;
<p>This means that <em>test.py</em> is part of the local repository&#13;
but its changes have not yet been committed.&#13;
Let’s <em>commit</em> it:</p>&#13;
<pre>$ <strong>git commit -m "simple print program"</strong></pre>&#13;
&#13;
<pre data-type="programlisting"> [master (root-commit) 52d60d7] my first commit&#13;
  1 file changed, 1 insertion(+)&#13;
  create mode 100644 test.py</pre>&#13;
&#13;
<p>That <code>-m "my first commit"</code> was your <em>commit message</em>.&#13;
If you omitted that, <code>git</code> would pop you into an editor and coax&#13;
you to enter the message that way.&#13;
This becomes a part of the <code>git</code> change history for that file.</p>&#13;
&#13;
<p>Let’s see what our current status is:</p>&#13;
<pre>$ <strong>git status</strong></pre>&#13;
&#13;
<pre data-type="programlisting"> On branch master&#13;
 nothing to commit, working directory clean</pre>&#13;
&#13;
<p>Okay, all current changes have been committed.&#13;
This means that we can change things&#13;
and not worry about losing the original version.&#13;
Make an adjustment now to <em>test.py</em>—change <code>Oops</code> to <code>Ops!</code> and save the file (<a data-type="xref" href="#ex1926">Example 19-26</a>).</p>&#13;
<div data-type="example" id="ex1926">&#13;
<h5><span class="label">Example 19-26. </span>test.py, revised</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">print</code><code class="p">(</code><code class="s1">'Ops!'</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>Let’s check to see what <code>git</code> thinks now:</p>&#13;
<pre>$ <strong>git status</strong></pre>&#13;
&#13;
<pre data-type="programlisting">On branch master&#13;
Changes not staged for commit:&#13;
  (use "git add &lt;file&gt;..." to update what will be committed)&#13;
  (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)&#13;
&#13;
    modified:   test.py&#13;
&#13;
no changes added to commit (use "git add" and/or "git commit -a")</pre>&#13;
&#13;
<p>Use <code>git diff</code> to see what lines have changed since the last commit:</p>&#13;
<pre>$ <strong>git diff</strong></pre>&#13;
&#13;
<pre data-type="programlisting">diff --git a/test.py b/test.py&#13;
index 76b8c39..62782b2 100644&#13;
--- a/test.py&#13;
+++ b/test.py&#13;
@@ -1 +1 @@&#13;
-print('Oops')&#13;
+print('Ops!')</pre>&#13;
&#13;
<p>If you try to commit this change now,&#13;
<code>git</code> complains:</p>&#13;
<pre>$ <strong>git commit -m "change the print string"</strong></pre>&#13;
&#13;
<pre data-type="programlisting">On branch master&#13;
Changes not staged for commit:&#13;
    modified:   test.py&#13;
&#13;
no changes added to commit</pre>&#13;
&#13;
<p>That <code>staged for commit</code> phrase means you need to <code>add</code> the file,&#13;
which roughly translated means <em>hey git, look over here</em>:</p>&#13;
<pre>$ <strong>git add test.py</strong></pre>&#13;
&#13;
<p>You could have also typed <code>git add .</code> to add&#13;
<em>all</em> changed files in the current directory;&#13;
that’s handy when you actually have edited multiple files&#13;
and want to ensure that you&#13;
check in all their changes.&#13;
Now we can commit the change:</p>&#13;
<pre>$ <strong>git commit -m "my first change"</strong></pre>&#13;
&#13;
<pre data-type="programlisting"> [master e1e11ec] my first change&#13;
  1 file changed, 1 insertion(&amp;plus;), 1 deletion(-)</pre>&#13;
&#13;
<p>If you’d like to see all the terrible things that you’ve done to&#13;
<em>test.py</em>, most recent first, use <code>git log</code><a data-startref="ix_ch19-pythonista-asciidoc31" data-type="indexterm" id="idm45794964503240"/><a data-startref="ix_ch19-pythonista-asciidoc30" data-type="indexterm" id="idm45794964502472"/>:<a data-startref="ix_ch19-pythonista-asciidoc29" data-type="indexterm" id="idm45794964501656"/><a data-startref="ix_ch19-pythonista-asciidoc28" data-type="indexterm" id="idm45794964500936"/><a data-startref="ix_ch19-pythonista-asciidoc27" data-type="indexterm" id="idm45794964500248"/></p>&#13;
<pre>$ <strong>git log test.py</strong></pre>&#13;
&#13;
<pre data-type="programlisting"> commit e1e11ecf802ae1a78debe6193c552dcd15ca160a&#13;
 Author: William Lubanovic &lt;bill@madscheme.com&gt;&#13;
 Date:   Tue May 13 23:34:59 2014 -0500&#13;
&#13;
     change the print string&#13;
&#13;
 commit 52d60d76594a62299f6fd561b2446c8b1227cfe1&#13;
 Author: William Lubanovic &lt;bill@madscheme.com&gt;&#13;
 Date:   Tue May 13 23:26:14 2014 -0500&#13;
&#13;
     simple print program</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Distribute Your Programs" data-type="sect1"><div class="sect1" id="distribute">&#13;
<h1>Distribute Your Programs</h1>&#13;
&#13;
<p><a data-primary="code" data-secondary="distributing" data-type="indexterm" id="idm45794964497400"/>You know that your Python files can be installed in files and&#13;
directories,&#13;
and you know that you can run a Python program file with the <code>python</code>&#13;
interpreter.</p>&#13;
&#13;
<p><a data-primary="zip files" data-type="indexterm" id="idm45794964495432"/>It’s less well known that the Python interpreter can also&#13;
execute Python&#13;
code packaged in ZIP files.&#13;
<a data-primary="pex files" data-type="indexterm" id="idm45794964494488"/>It’s even less well known that special ZIP files&#13;
known as <a href="https://pex.readthedocs.io">pex files</a> can also be used.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Clone This Book" data-type="sect1"><div class="sect1" id="idm45794964475224">&#13;
<h1>Clone This Book</h1>&#13;
&#13;
<p>You can get a copy of all the programs in this book.&#13;
Visit the&#13;
<a href="https://oreil.ly/FbFAE">Git repository</a>&#13;
and follow the directions to copy it to your local machine.&#13;
If you have <code>git</code>,&#13;
run the command&#13;
<code>git clone https://github.com/madscheme/introducing-python</code>&#13;
to make a Git repository on your computer.&#13;
You can also download the files in ZIP format.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="How You Can Learn More" data-type="sect1"><div class="sect1" id="idm45794964472168">&#13;
<h1>How You Can Learn More</h1>&#13;
&#13;
<p><a data-primary="best practices" data-secondary="resources" data-type="indexterm" id="ix_ch19-pythonista-asciidoc32"/><a data-primary="Python 3" data-secondary="resources for learning" data-type="indexterm" id="ix_ch19-pythonista-asciidoc33"/>This is an introduction.&#13;
It almost certainly says too much&#13;
about some things that you don’t care about&#13;
and not enough about some things that you do.&#13;
Let me recommend some Python resources that I’ve found helpful.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Books" data-type="sect2"><div class="sect2" id="python_books">&#13;
<h2>Books</h2>&#13;
&#13;
<p>I’ve found the books in the following list to be especially useful.&#13;
These range from introductory to advanced,&#13;
with mixtures of Python 2 and 3:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Barry, Paul.&#13;
<em>Head First Python (2nd Edition)</em>&#13;
O’Reilly, 2016.</p>&#13;
</li>&#13;
<li>&#13;
<p>Beazley, David M.&#13;
<em>Python Essential Reference (5th Edition)</em>.&#13;
Addison-Wesley, 2019.</p>&#13;
</li>&#13;
<li>&#13;
<p>Beazley, David M. and Brian K. Jones.&#13;
<em>Python Cookbook (3rd Edition)</em>.&#13;
O’Reilly, 2013.</p>&#13;
</li>&#13;
<li>&#13;
<p>Gorelick, Micha and Ian Ozsvald.&#13;
<em>High Performance Python</em>.&#13;
O’Reilly, 2014.</p>&#13;
</li>&#13;
<li>&#13;
<p>Maxwell, Aaron.&#13;
<em>Powerful Python</em>.&#13;
Powerful Python Press, 2017.</p>&#13;
</li>&#13;
<li>&#13;
<p>McKinney, Wes.&#13;
<em>Python for Data Analysis: Data Wrangling with Pandas, NumPy, and IPython</em>.&#13;
O’Reilly, 2012.</p>&#13;
</li>&#13;
<li>&#13;
<p>Ramalho, Luciano.&#13;
<em>Fluent Python</em>.&#13;
O’Reilly, 2015.</p>&#13;
</li>&#13;
<li>&#13;
<p>Reitz, Kenneth and Tanya Schlusser.&#13;
<em>The Hitchhiker’s Guide to Python</em>.&#13;
O’Reilly, 2016.</p>&#13;
</li>&#13;
<li>&#13;
<p>Slatkin, Brett.&#13;
<em>Effective Python</em>.&#13;
Addison-Wesley, 2015.</p>&#13;
</li>&#13;
<li>&#13;
<p>Summerfield, Mark.&#13;
<em>Python in Practice: Create Better Programs Using Concurrency, Libraries, and Patterns</em>.&#13;
Addison-Wesley, 2013.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Of course, there are&#13;
<a href="https://wiki.python.org/moin/PythonBooks">many more</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Websites" data-type="sect2"><div class="sect2" id="python_sites">&#13;
<h2>Websites</h2>&#13;
&#13;
<p>Here are some websites where you can find helpful tutorials:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://pymbook.readthedocs.io">Python for You and Me</a>&#13;
is an introduction, with good Windows coverage</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://realpython.com">Real Python</a>&#13;
by various authors</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://learnpythonthehardway.org/book">Learn Python the Hard Way</a>&#13;
by Zed Shaw</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/UJcGM">Dive into Python 3</a>&#13;
by Mark Pilgrim</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://www.blog.pythonlibrary.org">Mouse Vs. Python</a>&#13;
by Michael Driscoll</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>If you’re interested in keeping up with what’s going on&#13;
in the Pythonic world, check out these news websites:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="http://bit.ly/comp-lang-python">comp.lang.python</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://bit.ly/comp-lang-py-announce">comp.lang.python.announce</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://www.reddit.com/r/python">r/python subreddit</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://planet.python.org/">Planet Python</a></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Finally, here are some good websites for finding and&#13;
downloading packages:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://pypi.python.org/pypi">The Python Package Index</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://awesome-python.com">Awesome Python</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/S1vEL">Stack Overflow Python questions</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://code.activestate.com/recipes/langs/python">ActiveState Python recipes</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://github.com/trending?l=python">Python packages trending on GitHub</a></p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Groups" data-type="sect2"><div class="sect2" id="python_groups">&#13;
<h2>Groups</h2>&#13;
&#13;
<p><a data-primary="Python community" data-type="indexterm" id="idm45794964425672"/>Computing communities have varied personalities:&#13;
enthusiastic, argumentative, dull, hipster, button-down,&#13;
and many others across a broad range.&#13;
The Python community is friendly and civil.&#13;
You can find Python groups based on location—<a href="http://python.meetup.com">meetups</a> and&#13;
local user groups&#13;
<a href="https://wiki.python.org/moin/LocalUserGroups">around the world</a>.&#13;
Other groups are distributed and based on common interests.&#13;
For instance,&#13;
<a href="http://www.pyladies.com">PyLadies</a> is a&#13;
support network for women who are interested in Python&#13;
and open source.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Conferences" data-type="sect2"><div class="sect2" id="python_conferences">&#13;
<h2>Conferences</h2>&#13;
&#13;
<p>Of the many&#13;
<a href="http://www.pycon.org">conferences</a> and workshops&#13;
<a href="https://www.python.org/community/workshops">around the world</a>,&#13;
the largest are&#13;
held annually in&#13;
<a href="https://us.pycon.org">North America</a>&#13;
and&#13;
<a href="https://europython.eu/en">Europe</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Getting a Python Job" data-type="sect2"><div class="sect2" id="python_jobs">&#13;
<h2>Getting a Python Job</h2>&#13;
&#13;
<p>Useful search sites include:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://www.indeed.com">Indeed</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://stackoverflow.com/jobs">Stack Overflow</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://www.ziprecruiter.com/candidate/suggested-jobs">ZipRecruiter</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://www.simplyhired.com">Simply Hired</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://www.careerbuilder.com">CareerBuilder</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://www.google.com/search?q=jobs">Google</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://www.linkedin.com/jobs/search">LinkedIn</a></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>For most of these sites, type <code>python</code> in the first box&#13;
and your location in the other. Good local sites include the Craigslist ones,&#13;
like this link for&#13;
<a href="https://seattle.craigslist.org/search/jjj">Seattle</a>.&#13;
Simply change the <code>seattle</code> part to <code>sfbay</code>, <code>boston</code>, <code>nyc</code>,&#13;
or other craigslist site prefixes to search those&#13;
areas. For remote (telecommuting, or “work from home”)&#13;
Python jobs, special sites include:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://oreil.ly/pFQwb">Indeed</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/LI529">Google</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/nhV6s">LinkedIn</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/R23Tx">Stack Overflow</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/bPW1I">Remote Python</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/9c3sC">We Work Remotely</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/ohwAY">ZipRecruiter</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/tK5f5">Glassdoor</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/MkMeg">Remotely Awesome Jobs</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/uHVE3">Working Nomads</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/smmrZ">GitHub</a><a data-startref="ix_ch19-pythonista-asciidoc33" data-type="indexterm" id="idm45794964387224"/><a data-startref="ix_ch19-pythonista-asciidoc32" data-type="indexterm" id="idm45794964386552"/></p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Coming Up" data-type="sect1"><div class="sect1" id="idm45794964401336">&#13;
<h1>Coming Up</h1>&#13;
&#13;
<p>But wait, there’s more!&#13;
The next three chapters&#13;
offer tours of Python in the arts, business, and science.&#13;
You’ll find at least one package that you’ll want to&#13;
explore. Bright and shiny objects abound on the net.&#13;
Only you can tell which are costume jewelry and which are&#13;
silver bullets.&#13;
And even if you’re not currently pestered by werewolves,&#13;
you might want some of those silver bullets in your pocket.&#13;
Just in case.</p>&#13;
&#13;
<p>Finally, we have answers to those annoying&#13;
end-of-chapter exercises,&#13;
details on installation of Python and friends,&#13;
and a few cheat sheets for things that&#13;
I always need to look up.&#13;
Your brain is almost certainly better tuned,&#13;
but they’re there if needed.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Things to Do" data-type="sect1"><div class="sect1" id="idm45794964383192">&#13;
<h1>Things to Do</h1>&#13;
&#13;
<p>(Pythonistas don’t have homework today.)</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<div data-type="footnotes"><p data-type="footnote" id="idm45794966587992"><sup><a href="ch19.html#idm45794966587992-marker">1</a></sup> You, as the detective: “I know I’m in there! And if I don’t come out with my hands up, I’m coming in after me!”</p><p data-type="footnote" id="idm45794965496488"><sup><a href="ch19.html#idm45794965496488-marker">2</a></sup> Many computer books use Fibonacci number calculations in timing examples, but I’d rather sleep than calculate Fibonacci numbers.</p></div></div></section></body></html>