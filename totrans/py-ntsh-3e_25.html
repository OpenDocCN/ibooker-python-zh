<html><head></head><body>
<div id="sbo-rt-content"><section data-nutshell-tab="Extend and Embed Python" data-pdf-bookmark="Chapter 25. Extending and Embedding Classic Python" data-type="chapter" epub:type="chapter"><div class="chapter" id="extending_and_embedding_classic_python">
<h1><span class="label">Chapter 25. </span>Extending and Embedding Classic Python</h1>
<p><em>The content of this chapter has been abbreviated for the print edition of this book. The full content is <a href="https://oreil.ly/python-nutshell-25">available online</a>, as described in <a data-type="xref" href="#online_material">“Online Material”</a>.</em></p>
<p>CPython<a contenteditable="false" data-primary="Python" data-secondary="extending and embedding" data-type="indexterm" id="Pextend25"/><a contenteditable="false" data-primary="embedding" data-type="indexterm" id="idm44924475687328"/><a contenteditable="false" data-primary="CPython (Classic Python)" data-type="indexterm" id="idm44924475686352"/> runs on a portable, C-coded virtual machine. Python’s built-in objects—such as numbers, sequences, dictionaries, sets, and files—are coded in C, as are several modules in Python’s standard library. Modern platforms support dynamically loaded libraries, with file extensions such as .<em>dll</em> on Windows, .<em>so</em> on Linux, and .<em>dylib</em> on Mac: building Python produces such binary files. You can code your own extension modules for Python in C (or any language that can produce C-callable libraries), using the<a contenteditable="false" data-primary="C API" data-type="indexterm" id="idm44924475684096"/> Python C API covered in this chapter. With this API, you can produce and deploy dynamic libraries that Python scripts and interactive sessions can later use with the <span class="code"><strong>import</strong></span> statement, covered in <a data-type="xref" href="ch07.xhtml#the_import_statement">“The import Statement”</a>.</p>
<p><em>Extending</em> Python means building modules that Python code can <span class="code"><strong>import</strong></span> to access the features the modules supply. <em>Embedding</em> Python means executing Python code from an application coded in another language. For such execution to be useful, Python code must in turn be able to access some of your application’s functionality. In practice, therefore, embedding implies some extending, as well as a few embedding-specific operations. The three main reasons for wishing to extend Python can be summarized as follows:</p>
<ul>
<li>
<p>Reimplementing some functionality (originally coded in Python) in a lower-level language, hoping to get better performance</p>
</li>
<li>
<p>Letting Python code access some existing functionality supplied by libraries coded in (or, at any rate, callable from) lower-level languages</p>
</li>
<li>
<p>Letting Python code access some existing functionality of an application that is in the process of embedding Python as the application’s scripting language</p>
</li>
</ul>
<p>Embedding and extending are covered in Python’s online documentation; there, you can find an in-depth <a href="https://oreil.ly/BMl4L">tutorial</a> and an extensive <a href="https://oreil.ly/OQXBK">reference manual</a>. Many details are best studied in Python’s extensively documented C sources. Download Python’s source distribution and study the sources of Python’s core, C-coded extension modules, and the example extensions supplied for this purpose.</p>
<section data-pdf-bookmark="Online Material" data-type="sect1"><div class="sect1" id="online_material">
<h1>Online Material</h1>
<div data-type="note" epub:type="note">
<h1>This Chapter Assumes Some Knowledge of C</h1>
<p>Although we include some non-C extension options, to extend or embed Python using the C API you must know the C and/or C++ programming languages. We do not cover C and C++ in this book, but there are many print and online resources that you can consult to learn them. Most of the online content of this chapter assumes that you have at least some knowledge of C.</p>
</div>
<p>In the<a contenteditable="false" data-primary="online material" data-secondary="extending and embedding Python" data-type="indexterm" id="idm44924475672080"/> <a href="https://oreil.ly/python-nutshell-25">online version of this chapter</a>, you will find the following sections:</p>
<dl>
<dt>“Extending Python with Python’s C API”</dt>
<dd>
<p>Includes reference tables and examples for creating C-coded Python extension modules that you can import into your Python programs, showing how to code and build such modules. This section includes two complete examples:</p>
<ul>
<li>
<p>An extension implementing custom methods for manipulating <span class="code">dict</span>s</p>
</li>
<li>
<p>An extension defining a custom type</p>
</li>
</ul>
</dd>
<dt>“Extending Python Without Python’s C API”</dt>
<dd><a contenteditable="false" data-primary="CFFI" data-type="indexterm" id="idm44924475665168"/>Discusses (or, at least, mentions and links to) several utilities and libraries that support creating Python extensions that do not directly require C or C++ programming,<sup><a data-type="noteref" href="ch25.xhtml#ch01fn163" id="ch01fn163-marker">1</a></sup> including the third-party tools <a class="orm:hideurl" href="https://oreil.ly/JrP_4">F2PY</a>, <a class="orm:hideurl" href="https://oreil.ly/1l5ub">SIP</a>, <a class="orm:hideurl" href="https://google.github.io/clif">CLIF</a>, <a class="orm:hideurl" href="https://cppyy.readthedocs.io"><span class="code">cppyy</span></a>, <a class="orm:hideurl" href="https://pybind11.readthedocs.io"><span class="code">pybind11</span></a>, <a contenteditable="false" data-primary="Cython" data-type="indexterm" id="idm44924475657408"/><a class="orm:hideurl" href="https://cython.org">Cython</a>, <a class="orm:hideurl" href="https://cffi.readthedocs.io">CFFI</a>, and <a class="orm:hideurl" href="https://hpyproject.org">HPy</a>, and<a contenteditable="false" data-primary="ctypes module" data-type="indexterm" id="idm44924475653520"/><a contenteditable="false" data-primary="standard library modules" data-secondary="ctypes" data-type="indexterm" id="idm44924475652384"/> standard library module <a class="orm:hideurl" href="https://oreil.ly/xS4bC"><span class="code">ctypes</span></a>. This section includes a complete example on how to create an extension using Cython.</dd>
<dt>“Embedding Python”</dt>
<dd>Includes reference tables and a conceptual overview of embedding a Python interpreter within a larger application, using Python’s C API for embedding.<a contenteditable="false" data-primary="" data-startref="Pextend25" data-type="indexterm" id="idm44924475648976"/></dd>
</dl>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="ch01fn163"><sup><a href="ch25.xhtml#ch01fn163-marker">1</a></sup> There are many other such tools, but we tried to pick just the most popular and promising ones.</p></div></div></section></div></body></html>