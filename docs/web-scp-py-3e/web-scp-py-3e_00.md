# 前言

对于那些尚未掌握这种技能的人来说，计算机编程可能看起来像是一种魔法。如果编程是魔法，*网页抓取*就是巫术：这种魔法的应用，尽管印象深刻且有用，却令人惊讶地轻松。

在我作为软件工程师的多年经历中，我发现很少有编程实践能像网页抓取一样，能够同时激发程序员和普通人的兴奋。能够编写一个简单的机器人来收集数据并将其流到终端或存储在数据库中，虽然不难，但每次都能带来某种特定的兴奋感和可能性感，无论你以前做过多少次。

不幸的是，当我与其他程序员谈论网页抓取时，关于这种实践存在许多误解和混淆。有些人不确定它是否合法（它是合法的），或者如何处理类似于 JavaScript 密集页面或需要登录的问题。许多人对如何启动一个大型网页抓取项目甚至是如何找到他们正在寻找的数据感到困惑。本书旨在解答关于网页抓取的许多常见问题和误解，同时提供关于大多数常见网页抓取任务的全面指南。

网页抓取是一个多样化且快速变化的领域，我尝试提供高层次的概念和具体示例，以涵盖您可能会遇到的任何数据收集项目。在整本书中，提供了代码示例来演示这些概念，并允许您尝试它们。这些代码示例可以在[GitHub](https://github.com/REMitchell/python-scraping)上查看和下载。

# 什么是网页抓取？

从互联网自动收集数据的行为几乎与互联网本身同样古老。尽管*网页抓取*不是一个新术语，但在过去的几年中，这种做法更常被称为*屏幕抓取*、*数据挖掘*、*网页采集*或类似变体。今天的普遍共识似乎更偏向于*网页抓取*，因此这是我在整本书中使用的术语，尽管我还会将特定遍历多个页面的程序称为*网络爬虫*，或称网页抓取程序本身为*机器人*。

理论上，网页抓取是通过除了程序与 API 交互之外的任何手段来收集数据的实践（或者显然地，通过人类使用网络浏览器）。这通常通过编写一个自动化程序来实现，该程序查询 Web 服务器，请求数据（通常以 HTML 和其他组成网页的文件形式），然后解析该数据以提取所需信息。

在实践中，网络爬取涵盖了各种编程技术和技术，如数据分析、自然语言解析和信息安全。由于这个领域的范围非常广泛，本书在第 I 部分涵盖了网络爬取和爬行的基础知识，并在第 II 部分深入探讨了高级主题。我建议所有读者仔细研究第一部分，并根据需要深入研究第二部分中更具体的内容。

# 为什么要进行网络爬取？

如果你的唯一上网方式是通过浏览器，那么你将错过许多可能性。虽然浏览器很方便执行 JavaScript、显示图像和以更具人类可读格式排列对象（等等），但网络爬虫在快速收集和处理大量数据方面表现出色。与通过监视器的狭窄窗口一次查看一页不同，你可以一次查看跨越数千甚至数百万页的数据库。

此外，网络爬虫可以访问传统搜索引擎无法到达的地方。在谷歌搜索“到波士顿的最便宜航班”将会得到大量广告和热门航班搜索网站。谷歌只知道这些网站在其内容页面上说了些什么，而不知道各种查询输入到航班搜索应用程序中的确切结果。然而，一个成熟的网络爬虫可以跟踪波士顿航班的价格变化，跨越多个网站，并告诉你购买机票的最佳时间。

你可能会问：“难道数据收集不是 API 的用武之地吗？”（如果你对 API 不熟悉，请参见第十五章。）嗯，如果你找到一个适合你目的的 API，API 确实很棒。它们旨在提供一种方便的方式，从一个计算机程序向另一个计算机程序传送格式良好的数据流。你可以找到许多类型的数据的 API，比如 Twitter 帖子或维基百科页面。总体而言，最好使用 API（如果存在），而不是构建一个获取相同数据的机器人。然而，由于多种原因，API 可能不存在或对你的目的无用：

+   你正在收集跨多个网站的相对小、有限数据集，而没有一个统一的 API。

+   你需要的数据相对较少或不常见，创建者认为不值得提供一个 API。

+   源没有建立 API 所需的基础设施或技术能力。

+   数据是有价值和/或受保护的，不打算广泛传播。

即使 API *存在*，它提供的请求量和速率限制、数据类型或数据格式可能不足以满足你的目的。

这就是网络爬取的用武之地。除了少数例外，如果你能在浏览器中查看数据，你就可以通过 Python 脚本访问它。如果你可以在脚本中访问它，你就可以将它存储到数据库中。如果你可以将其存储到数据库中，你几乎可以对这些数据进行任何操作。

显然，几乎无限数据访问的许多极其实用的应用程序存在：市场预测，机器语言翻译，甚至医学诊断都极大地受益于能够从新闻网站，翻译文本和健康论坛中检索和分析数据的能力。

即使在艺术世界中，网络抓取也为创作开辟了新的领域。2006 年的项目 [“We Feel Fine”](http://wefeelfine.org/) 由 Jonathan Harris 和 Sep Kamvar 对许多英语博客网站进行了抓取，以寻找以 “I feel” 或 “I am feeling” 开头的短语。这导致了一种流行的数据可视化，描述了世界每天和每分钟的感受。

无论你从事哪个领域，几乎总能通过网络抓取更有效地指导业务实践，提高生产力，甚至拓展到全新的领域。

# 关于本书

本书旨在不仅作为网络抓取的介绍，还作为收集、转换和使用来自不合作来源的数据的全面指南。尽管它使用 Python 编程语言并涵盖了许多 Python 基础知识，但不应作为语言入门书籍使用。

如果你完全不懂 Python，这本书可能有些难度，请不要将其作为 Python 入门书籍。话虽如此，我尽力将所有概念和代码样例保持在初中级 Python 编程水平，以使内容对广大读者都具有可访问性。为此，在适当的情况下，偶尔解释更高级的 Python 编程和通用计算机科学主题。如果你是一个更高级的读者，可以随意略过这些部分！

如果你正在寻找更全面的 Python 资源，[*介绍 Python*](http://bit.ly/1CbHTcE) 由 Bill Lubanovic（O’Reilly）编写的这本指南是一个不错的选择，尽管有些冗长。对于注意力较短的人来说，Jessica McKellar（O’Reilly）的视频系列 [*Python 入门*](http://oreil.ly/2HOqSNM) 是一个极好的资源。我也很喜欢前任教授 Allen Downey（O’Reilly）的 *[Think Python](http://oreil.ly/2fjbT2F)*。尤其是最后一本书非常适合初学者，它教授 Python 语言以及计算机科学和软件工程概念。

技术书籍通常专注于单一的语言或技术，但网络抓取是一个相对分散的主题，其实践要求使用数据库，Web 服务器，HTTP，HTML，Internet 安全，图像处理，数据科学和其他工具。本书试图从“数据收集”的角度覆盖所有这些内容和其他主题。尽管它不应作为任何这些主题的完整处理，但我相信它们的详细覆盖足以帮助你开始编写网络抓取器！

第一部分深入讨论了网页抓取和网络爬虫的主题，并且重点关注本书中使用的少数几个库。第一部分可以作为这些库和技术的全面参考（某些例外情况下，将提供额外参考）。第一部分教授的技能对于所有编写网页抓取器的人都可能很有用，无论他们的特定目标或应用程序如何。

第二部分涵盖了读者在编写网络爬虫时可能会发现有用的其他主题，但这些主题并非始终对所有爬虫都有用。遗憾的是，这些主题过于广泛，无法完全在单一章节中详细讨论。因此，经常会引用其他资源以获取更多信息。

本书的结构使您能够轻松跳转到章节中寻找您寻找的网页抓取技术或信息。当一个概念或代码片段建立在先前章节提到的另一个上时，我明确引用了它所在的章节。

# 本书使用的约定

本书使用以下排版约定：

*Italic*

指示新术语、URL、电子邮件地址、文件名和文件扩展名。

`Constant width`

用于程序清单，以及段落中用于引用程序元素（如变量或函数名称、数据库、数据类型、环境变量、语句和关键字）。

**`Constant width bold`**

显示用户应输入的命令或其他文本。

*`Constant width italic`*

显示应由用户提供的值或由上下文确定的值。

###### 提示

此元素表示提示或建议。

###### 注意

此元素表示一般注释。

###### 警告

此元素表示警告或注意事项。

# 使用代码示例

补充材料（代码示例、练习等）可在[*https://github.com/REMitchell/python-scraping*](https://github.com/REMitchell/python-scraping)下载。

本书旨在帮助您完成工作。如果本书中的示例代码对您有用，您可以在您的程序和文档中使用它。除非您复制了代码的大部分内容，否则无需联系我们寻求许可。例如，编写一个使用本书中几个代码块的程序不需要许可。出售或分发包含 O’Reilly 书籍示例的 CD-ROM 需要许可。通过引用本书并引用示例代码回答问题不需要许可。将本书中大量示例代码合并到您产品的文档中需要许可。

我们感激但不要求署名。通常，署名包括标题、作者、出版商和 ISBN。例如：“*Python 网络抓取*, 第三版, 作者 Ryan Mitchell (O’Reilly). 版权 2024 Ryan Mitchell, 978-1-098-14535-4.”

如果您认为您对代码示例的使用超出了公平使用或此处授予的权限，请随时通过*permissions@oreilly.com*联系我们。

不幸的是，印刷书籍很难保持最新。通过网络抓取，这增加了一个挑战，因为书中引用的许多库和网站以及代码常常依赖的内容可能会偶尔发生更改，导致代码示例可能失败或产生意外结果。如果您选择运行代码示例，请从 GitHub 仓库运行而不是直接从书本复制。我和选择贡献的本书读者（包括您也可能是其中之一！）将努力保持仓库与所需的修改同步更新。

除了代码示例外，通常还提供终端命令以说明如何安装和运行软件。总体而言，这些命令是针对基于 Linux 的操作系统设计的，但通常也适用于具有正确配置的 Python 环境和 pip 安装的 Windows 用户。当情况不同时，我提供了所有主要操作系统的说明，或者为 Windows 用户提供了外部参考来完成任务。

# [O’Reilly Online Learning](https://www.oreilly.com/about/contact.html)

###### 注意

超过 40 年来，[*O’Reilly Media*](https://oreilly.com)为技术和业务培训提供了知识和洞察，帮助公司取得成功。

我们独特的专家和创新者网络通过书籍、文章以及我们的在线学习平台分享他们的知识和专业知识。O’Reilly 的在线学习平台为您提供即时访问的培训课程、深入的学习路径、交互式编码环境以及来自 O’Reilly 和 200 多家其他出版商的大量文本和视频。更多信息，请访问[*https://oreilly.com*](https://oreilly.com)。

# 如何联系我们

请将有关本书的评论和问题寄给出版商：

+   O’Reilly Media, Inc.

+   1005 Gravenstein Highway North

+   Sebastopol, CA 95472

+   800-889-8969 (在美国或加拿大)

+   707-829-7019 (国际或本地)

+   707-829-0104 (传真)

+   *support@oreilly.com*

+   [*https://www.oreilly.com/about/contact.html*](https://www.oreilly.com/about/contact.html)

我们为本书设有网页，列出勘误、示例和任何额外信息。您可以访问[*https://oreil.ly/web_scraping_with_python*](https://oreil.ly/web_scraping_with_python)。

关于我们的书籍和课程的新闻和信息，请访问[*https://oreilly.com*](https://oreilly.com)。

在 LinkedIn 上找到我们：[*https://linkedin.com/company/oreilly-media*](https://linkedin.com/company/oreilly-media)

在 Twitter 上关注我们：[*https://twitter.com/oreillymedia*](https://twitter.com/oreillymedia)

在 YouTube 上观看我们：[*https://youtube.com/oreillymedia*](https://youtube.com/oreillymedia)

# 致谢

正如一些最好的产品是源自用户反馈的大海中一样，这本书没有多少有用的形式是没有许多合作者、助威者和编辑的帮助而存在的。感谢 O’Reilly 的员工和他们对这个有些不寻常主题的惊人支持；感谢我的朋友和家人提供的建议并容忍我突然的读书；感谢我在 Gerson Lehrman Group 的同事们，我现在可能欠他们很多工作时间。

感谢我的编辑们：Sara Hunter、John Obelenus 和 Tracey Larvenz。他们的反馈、指导和偶尔的严厉批评是无价的。正是由于他们的建议，有很多章节和代码示例是直接写出来的。

第一章和第二章的灵感，以及第三版中许多新内容的包含，要感谢 Bryan Specht。他留下的遗产比他自己所知的还要广泛深远，但他留下的空缺需要那份遗产填补得更加广大。

最后，感谢 Jim Waldo，他多年前启动了整个项目，当时他邮寄了一台 Linux 机和 Eric Roberts（Addison-Wesley 出版社）的《C 语言的艺术与科学》给一个年轻而受影响的青少年。
