<html><head></head><body><section data-pdf-bookmark="Chapter 21. Py at Work" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch_business">&#13;
<h1><span class="label">Chapter 21. </span>Py at Work</h1>&#13;
&#13;
<blockquote>&#13;
<p><a data-primary="business applications" data-type="indexterm" id="ix_ch21-business-asciidoc0"/><a data-primary="Python 3" data-secondary="business applications" data-type="indexterm" id="ix_ch21-business-asciidoc1"/>“Business!” cried the Ghost, wringing its hands again.&#13;
“Mankind was my business…”</p>&#13;
<p data-type="attribution">Charles Dickens, <cite>A Christmas Carol</cite></p>&#13;
</blockquote>&#13;
&#13;
<p>The businessman’s uniform is a suit and tie.&#13;
But before he can&#13;
<em>get down to business</em>,&#13;
he tosses his jacket over a chair,&#13;
loosens his tie,&#13;
rolls up his sleeves,&#13;
and pours some coffee.&#13;
Meanwhile, the business woman&#13;
has already been getting work done.&#13;
Maybe with a latte.</p>&#13;
&#13;
<p>In business and government,&#13;
we use all of the technologies from the earlier chapters—databases, the web, systems, and networks.&#13;
Python’s productivity is making it more popular in the&#13;
<a href="http://bit.ly/py-enterprise">enterprise</a>&#13;
and with&#13;
<a href="http://bit.ly/py-startups">startups</a>.</p>&#13;
&#13;
<p>Organizations have long fought&#13;
incompatible file formats,&#13;
arcane network protocols,&#13;
language lock-in,&#13;
and the universal lack of&#13;
accurate documentation.&#13;
They can create faster, cheaper, stretchier applications&#13;
by using with tools such as these:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Dynamic languages like Python</p>&#13;
</li>&#13;
<li>&#13;
<p>The web as a universal graphical user interface</p>&#13;
</li>&#13;
<li>&#13;
<p>RESTful APIs as language-independent service interfaces</p>&#13;
</li>&#13;
<li>&#13;
<p>Relational and NoSQL databases</p>&#13;
</li>&#13;
<li>&#13;
<p>“Big data” and analytics</p>&#13;
</li>&#13;
<li>&#13;
<p>Clouds for deployment and capital savings</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The Microsoft Office Suite" data-type="sect1"><div class="sect1" id="microsoft_office">&#13;
<h1>The Microsoft Office Suite</h1>&#13;
&#13;
<p><a data-primary="business applications" data-secondary="Microsoft Office Suite" data-type="indexterm" id="idm45794963334040"/><a data-primary="Microsoft Office Suite" data-type="indexterm" id="idm45794963333064"/>Business is heavily dependent on Microsoft Office&#13;
applications and file formats.&#13;
Although they are not well known,&#13;
and in some cases poorly documented,&#13;
there are some Python libraries that can help.&#13;
Here are some that process Microsoft Office documents:</p>&#13;
<dl>&#13;
<dt><a href="https://pypi.python.org/pypi/docx">docx</a></dt>&#13;
<dd>&#13;
<p>This library creates, reads, and writes&#13;
Microsoft Office Word 2007 <em>.docx</em> files.</p>&#13;
</dd>&#13;
<dt><a href="http://www.python-excel.org">python-excel</a></dt>&#13;
<dd>&#13;
<p>This one discusses the <code>xlrd</code>, <code>xlwt</code>, and <code>xlutils</code>&#13;
modules via a PDF <a href="http://bit.ly/py-excel">tutorial</a>.&#13;
Excel can also read and write comma-separated values (CSV) files,&#13;
which you know how to process by using the standard <code>csv</code> module.</p>&#13;
</dd>&#13;
<dt><a href="http://bit.ly/oletools">oletools</a></dt>&#13;
<dd>&#13;
<p>This library extracts data from Office formats.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p><a data-primary="OpenOffice" data-type="indexterm" id="idm45794963322792"/><a href="http://openoffice.org">OpenOffice</a> is&#13;
an open source alternative to Office.&#13;
It runs on Linux, Unix, Windows, and macOS,&#13;
and reads and writes Office file formats,&#13;
It also installs a version of Python 3 for its own use.&#13;
You can program OpenOffice&#13;
<a href="https://oreil.ly/mLiCr">in Python</a>&#13;
with the&#13;
<a href="https://oreil.ly/FASNB">PyUNO</a>&#13;
library.</p>&#13;
&#13;
<p>OpenOffice was owned by Sun Microsystems,&#13;
and when Oracle acquired Sun,&#13;
some people feared for its future availability.&#13;
<a data-primary="LibreOffice" data-type="indexterm" id="idm45794963319176"/><a href="https://www.libreoffice.org">LibreOffice</a> was spun off as a result.&#13;
<a href="http://bit.ly/docu-hacker">DocumentHacker</a>&#13;
describes using the Python UNO library with LibreOffice.</p>&#13;
&#13;
<p>OpenOffice and LibreOffice had to&#13;
reverse engineer the Microsoft file formats,&#13;
which is not easy.&#13;
The&#13;
<a href="http://dag.wiee.rs/home-made/unoconv">Universal Office Converter</a> module&#13;
depends on the UNO library in OpenOffice or LibreOffice.&#13;
It can convert many file formats:&#13;
documents, spreadsheets, graphics, and presentations.</p>&#13;
&#13;
<p>If you have a mystery file,&#13;
<a href="https://github.com/ahupp/python-magic">python-magic</a>&#13;
can guess its format by analyzing&#13;
specific byte sequences.</p>&#13;
&#13;
<p>The&#13;
<a href="http://appyframework.org/pod.html">python open document</a> library&#13;
lets you provide Python code within templates&#13;
to create dynamic documents.</p>&#13;
&#13;
<p><a data-primary="PDF" data-type="indexterm" id="idm45794963313080"/>Although not a Microsoft format,&#13;
Adobe’s PDF is very common in business. <a href="http://www.reportlab.com/opensource"><span class="keep-together">ReportLab</span></a>&#13;
has open source and commercial versions&#13;
of its Python-based PDF generator.&#13;
If you need to edit a PDF, you might find some help at&#13;
<a href="http://bit.ly/add-text-pdf">StackOverflow</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Carrying Out Business Tasks" data-type="sect1"><div class="sect1" id="business_tasks">&#13;
<h1>Carrying Out Business Tasks</h1>&#13;
&#13;
<p><a data-primary="business applications" data-secondary="business tasks" data-type="indexterm" id="idm45794963308888"/>You can find a Python module for almost anything.&#13;
Visit <a href="https://pypi.python.org/pypi">PyPI</a>&#13;
and type something into the search box.&#13;
Many modules are interfaces to the public APIs of various services.&#13;
You might be interested in some examples related to business tasks:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Ship via <a href="https://github.com/gtaylor/python-fedex">Fedex</a> or&#13;
<a href="https://github.com/openlabs/PyUPS">UPS</a>.</p>&#13;
</li>&#13;
<li>&#13;
<p>Mail with the <a href="https://github.com/jzempel/stamps">stamps.com</a> API.</p>&#13;
</li>&#13;
<li>&#13;
<p>Read a discussion of&#13;
<a href="http://bit.ly/py-biz"><em>Python for business intelligence</em></a>.</p>&#13;
</li>&#13;
<li>&#13;
<p>If Aeropresses are flying off the shelves in Anoka,&#13;
was it customer activity or poltergeists?&#13;
<a href="http://cubes.databrewery.org">Cubes</a> is an&#13;
Online Analytical Processing (OLAP) web server and data browser.</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://www.openerp.com/">OpenERP</a> is a large commercial&#13;
Enterprise Resource Planning (ERP) system written in&#13;
Python and JavaScript, with thousands of add-on modules.</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Processing Business Data" data-type="sect1"><div class="sect1" id="idm45794963296888">&#13;
<h1>Processing Business Data</h1>&#13;
&#13;
<p><a data-primary="business applications" data-secondary="data processing" data-type="indexterm" id="ix_ch21-business-asciidoc2"/><a data-primary="data processing (business data)" data-type="indexterm" id="ix_ch21-business-asciidoc3"/>Businesses have a particular fondness for data.&#13;
Sadly, many of them conjure up perverse ways of&#13;
making data harder to use.</p>&#13;
&#13;
<p><a data-primary="spreadsheets" data-type="indexterm" id="idm45794963292776"/>Spreadsheets were a good invention,&#13;
and over time businesses became addicted to them.&#13;
Many nonprogrammers were tricked into programming&#13;
because they were called <em>macros</em> instead of programs.&#13;
But the universe is expanding and data is trying to keep up.&#13;
Older versions of Excel were limited to 65,536 rows,&#13;
and even newer versions choke at a million or so.&#13;
When an organization’s data outgrow the limits&#13;
of a single computer,&#13;
it’s like headcount growing past a hundred people or so—suddenly you need new layers, intermediaries, and communication.</p>&#13;
&#13;
<p>Excessive data programs aren’t caused by the size of data&#13;
on single desktops; rather, they’re the result of&#13;
the aggregate of data pouring into the business.&#13;
Relational databases handle millions of rows without exploding,&#13;
but only so many writes or updates at a time.&#13;
A plain old text or binary file can grow gigabytes in size,&#13;
but if you need to process it all at once,&#13;
you need enough memory.&#13;
Traditional desktop software isn’t designed for all this.&#13;
Companies such as Google and Amazon had to invent solutions&#13;
to handle so much data at scale.&#13;
<a href="http://bit.ly/py-netflix">Netflix</a>&#13;
is an example built on Amazon’s AWS cloud,&#13;
using Python&#13;
to glue together&#13;
RESTful APIs,&#13;
security,&#13;
deployment,&#13;
and&#13;
databases.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Extracting, Transforming, and Loading" data-type="sect2"><div class="sect2" id="etl">&#13;
<h2>Extracting, Transforming, and Loading</h2>&#13;
&#13;
<p><a data-primary="data processing (business data)" data-secondary="extracting/transforming/loading data" data-type="indexterm" id="ix_ch21-business-asciidoc4"/><a data-primary="ETL (extract, transform, load)" data-type="indexterm" id="ix_ch21-business-asciidoc5"/>The underwater portions of the data icebergs include all the&#13;
work to get the data in the first place.&#13;
If you speak enterprise, the common term is&#13;
extract, transform, load, or <em>ETL</em>.&#13;
<a data-primary="data munging" data-type="indexterm" id="idm45794963283736"/><a data-primary="data wrangling" data-type="indexterm" id="idm45794963283000"/>Synonyms such as&#13;
<em>data munging</em>&#13;
or <em>data wrangling</em>&#13;
give the impression of taming an unruly beast,&#13;
which might be apt metaphors.&#13;
This would seem to be a solved engineering matter by now,&#13;
but it remains largely an art.&#13;
I talked a bit about this in <a data-type="xref" href="ch12.html#ch_munging">Chapter 12</a>.&#13;
We address <em>data science</em> more broadly in <a data-type="xref" href="ch22.html#ch_science">Chapter 22</a>,&#13;
because this is where most developers&#13;
spend a large part of their time.</p>&#13;
&#13;
<p>If you’ve seen&#13;
<em>The Wizard of Oz</em>,&#13;
you probably remember&#13;
(besides the flying monkeys)&#13;
the part at the end—when the good witch told Dorothy that&#13;
she could always go home to Kansas&#13;
just by clicking her ruby slippers.&#13;
Even when I was young I thought,&#13;
“Now she tells her!”&#13;
Although, in retrospect,&#13;
I realize the movie would have been much shorter&#13;
if she’d shared that tip earlier.</p>&#13;
&#13;
<p>But this isn’t a movie;&#13;
we’re talking about the world of business here,&#13;
where making tasks shorter is a good thing.&#13;
So, let me share some tips with you now.&#13;
Most of the tools that you need for&#13;
day-to-day data work in business&#13;
are those that you’ve already read about here.&#13;
Those include high-level data structures&#13;
such as dictionaries and objects,&#13;
thousands of standard and third-party libraries,&#13;
and an expert community that’s just a google away.</p>&#13;
&#13;
<p>If you’re a computer programmer working for some business,&#13;
your workflow almost always includes the following:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Extracting data from weird file formats or databases</p>&#13;
</li>&#13;
<li>&#13;
<p>“Cleaning up” the data, which covers a lot of ground,&#13;
all strewn with pointy objects</p>&#13;
</li>&#13;
<li>&#13;
<p>Converting things like dates, times, and character sets</p>&#13;
</li>&#13;
<li>&#13;
<p>Actually doing something with the data</p>&#13;
</li>&#13;
<li>&#13;
<p>Storing resulting data in a file or database</p>&#13;
</li>&#13;
<li>&#13;
<p>Rolling back to step 1 again; lather, rinse, repeat</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>Here’s an example:&#13;
you want to move data from a spreadsheet to a database.&#13;
You can save the spreadsheet in CSV format&#13;
and use the Python libraries from <a data-type="xref" href="ch16.html#ch_databases">Chapter 16</a>.&#13;
Or, you can look for a module that&#13;
reads the binary spreadsheet format directly.&#13;
Your fingers know how to type <code>python excel</code>&#13;
into Google&#13;
and find sites such as&#13;
<a href="http://www.python-excel.org">Working with Excel files in Python</a>.&#13;
You can install one of the packages by using <code>pip</code>,&#13;
and locate a Python database driver for the last part of the task.&#13;
I mentioned SQLAlchemy and the direct&#13;
low-level database drivers in that same chapter.&#13;
Now you need some code in the middle,&#13;
and that’s where Python’s data structures&#13;
and libraries can save you time.</p>&#13;
&#13;
<p>Let’s try an example here,&#13;
and then we’ll try again with a library that saves a few steps.&#13;
We’ll read a CSV file,&#13;
aggregate the counts in one column by unique values in another,&#13;
and print the results.&#13;
If we did this in SQL, we would use SELECT, JOIN, and GROUP BY.</p>&#13;
&#13;
<p>First, the file, <em>zoo.csv</em>, which has columns for the type of animal,&#13;
how many times it has bitten a visitor,&#13;
the number of stitches required,&#13;
and how much we’ve paid the visitor&#13;
not to tell local television stations:</p>&#13;
&#13;
<pre data-type="programlisting" id="ch21_ex1">animal,bites,stitches,hush&#13;
bear,1,35,300&#13;
marmoset,1,2,250&#13;
bear,2,42,500&#13;
elk,1,30,100&#13;
weasel,4,7,50&#13;
duck,2,0,10</pre>&#13;
&#13;
<p>We want to see which animal is costing us the most,&#13;
so we aggregate the total hush money by the type of animal.&#13;
(We’ll leave bites and stitches to an intern.)&#13;
We use the <code>csv</code> module from <a data-type="xref" href="ch16.html#csv">“CSV”</a>&#13;
and <code>Counter</code> from <a data-type="xref" href="ch11.html#counter">“Count Items with Counter()”</a>.&#13;
Save this code as <em>zoo_counts.py</em>:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting" id="ch21_ex2"><code class="kn">import</code> <code class="nn">csv</code>&#13;
<code class="kn">from</code> <code class="nn">collections</code> <code class="kn">import</code> <code class="n">Counter</code>&#13;
&#13;
<code class="n">counts</code> <code class="o">=</code> <code class="n">Counter</code><code class="p">()</code>&#13;
<code class="k">with</code> <code class="nb">open</code><code class="p">(</code><code class="s1">'zoo.csv'</code><code class="p">,</code> <code class="s1">'rt'</code><code class="p">)</code> <code class="k">as</code> <code class="n">fin</code><code class="p">:</code>&#13;
    <code class="n">cin</code> <code class="o">=</code> <code class="n">csv</code><code class="o">.</code><code class="n">reader</code><code class="p">(</code><code class="n">fin</code><code class="p">)</code>&#13;
    <code class="k">for</code> <code class="n">num</code><code class="p">,</code> <code class="n">row</code> <code class="ow">in</code> <code class="nb">enumerate</code><code class="p">(</code><code class="n">cin</code><code class="p">):</code>&#13;
        <code class="k">if</code> <code class="n">num</code> <code class="o">&gt;</code> <code class="mi">0</code><code class="p">:</code>&#13;
            <code class="n">counts</code><code class="p">[</code><code class="n">row</code><code class="p">[</code><code class="mi">0</code><code class="p">]]</code> <code class="o">+=</code> <code class="nb">int</code><code class="p">(</code><code class="n">row</code><code class="p">[</code><code class="o">-</code><code class="mi">1</code><code class="p">])</code>&#13;
<code class="k">for</code> <code class="n">animal</code><code class="p">,</code> <code class="n">hush</code> <code class="ow">in</code> <code class="n">counts</code><code class="o">.</code><code class="n">items</code><code class="p">():</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="s2">"</code><code class="si">%10s</code><code class="s2"> </code><code class="si">%10s</code><code class="s2">"</code> <code class="o">%</code> <code class="p">(</code><code class="n">animal</code><code class="p">,</code> <code class="n">hush</code><code class="p">))</code></pre>&#13;
&#13;
<p>We skipped the first row&#13;
because it contained only the column names.&#13;
<code>counts</code> is a <code>Counter</code> object,&#13;
and takes care of initializing the sum for each animal to zero.&#13;
We also applied a little formatting to right-align the output.&#13;
Let’s try it:</p>&#13;
<pre>$ <strong>python zoo_counts.py</strong>&#13;
      duck         10&#13;
       elk        100&#13;
      bear        800&#13;
    weasel         50&#13;
  marmoset        250</pre>&#13;
&#13;
<p>Hah! It was the bear.&#13;
He was our prime suspect all along,&#13;
but now we have the <span class="keep-together">numbers.</span></p>&#13;
&#13;
<p>Next, let’s replicate this with a data processing toolkit called&#13;
<a href="http://bubbles.databrewery.org">Bubbles</a>.&#13;
You can install it by typing this command:</p>&#13;
<pre>$ <strong>pip install bubbles</strong></pre>&#13;
&#13;
<p>It requires SQLAlchemy; if you don’t have that,&#13;
<code>pip install sqlalchemy</code>&#13;
will do the trick.&#13;
Here’s the test program (call it <em>bubbles1.py</em>),&#13;
adapted from the&#13;
<a href="http://bit.ly/py-bubbles">documentation</a>:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting" id="ch21_ex3"><code class="kn">import</code> <code class="nn">bubbles</code>&#13;
&#13;
<code class="n">p</code> <code class="o">=</code> <code class="n">bubbles</code><code class="o">.</code><code class="n">Pipeline</code><code class="p">()</code>&#13;
<code class="n">p</code><code class="o">.</code><code class="n">source</code><code class="p">(</code><code class="n">bubbles</code><code class="o">.</code><code class="n">data_object</code><code class="p">(</code><code class="s1">'csv_source'</code><code class="p">,</code> <code class="s1">'zoo.csv'</code><code class="p">,</code> <code class="n">infer_fields</code><code class="o">=</code><code class="bp">True</code><code class="p">))</code>&#13;
<code class="n">p</code><code class="o">.</code><code class="n">aggregate</code><code class="p">(</code><code class="s1">'animal'</code><code class="p">,</code> <code class="s1">'hush'</code><code class="p">)</code>&#13;
<code class="n">p</code><code class="o">.</code><code class="n">pretty_print</code><code class="p">()</code></pre>&#13;
&#13;
<p>And now, the moment of truth:</p>&#13;
<pre>$ <strong>python bubbles1.py</strong>&#13;
2014-03-11 19:46:36,806 DEBUG calling aggregate(rows)&#13;
2014-03-11 19:46:36,807 INFO called aggregate(rows)&#13;
2014-03-11 19:46:36,807 DEBUG calling pretty_print(records)&#13;
+--------+--------+------------+&#13;
|animal  |hush_sum|record_count|&#13;
+--------+--------+------------+&#13;
|duck    |      10|           1|&#13;
|weasel  |      50|           1|&#13;
|bear    |     800|           2|&#13;
|elk     |     100|           1|&#13;
|marmoset|     250|           1|&#13;
+--------+--------+------------+&#13;
2014-03-11 19:46:36,807 INFO called pretty_print(records)</pre>&#13;
&#13;
<p>If you read the documentation,&#13;
you can avoid those debug print lines,&#13;
and maybe change the format of the table.</p>&#13;
&#13;
<p>Looking at the two examples, we see that&#13;
the <code>bubbles</code> example used a single function call (<code>aggregate</code>)&#13;
to replace our manual reading and counting of the CSV format.&#13;
Depending on your needs,&#13;
data toolkits can save a lot of work.</p>&#13;
&#13;
<p>In a more realistic example,&#13;
our zoo file might have thousands of rows&#13;
(it’s a dangerous place),&#13;
with misspellings such as <code>bare</code>,&#13;
commas in numbers,&#13;
and so on.&#13;
For good examples of practical data problems&#13;
with Python code,&#13;
I’d also recommend the <span class="keep-together">following:</span></p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="http://bit.ly/data_crunching"><em>Data Crunching: Solve Everyday Problems Using Java, Python, and More</em></a>—Greg Wilson (Pragmatic Bookshelf).</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://automatetheboringstuff.com"><em>Automate the Boring Stuff</em></a>—Al Sweigart (No Starch).</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Data cleanup tools can save a lot of time,&#13;
and Python has many of them.&#13;
For another example,&#13;
<a href="http://petl.readthedocs.org">PETL</a>&#13;
does row and column extraction and renaming.&#13;
Its <a href="http://bit.ly/petl-related">related work</a> page&#13;
lists many useful modules and products.&#13;
<a data-type="xref" href="ch22.html#ch_science">Chapter 22</a> has detailed discussions of&#13;
some especially useful data tools:&#13;
Pandas, NumPy, and IPython.&#13;
Although they’re currently best known among scientists,&#13;
they’re becoming popular among financial and data developers.&#13;
At the 2012 Pydata conference,&#13;
<a href="http://bit.ly/py-big-data">AppData</a>&#13;
discussed how these three and other Python tools help process&#13;
15 terabytes of data daily.&#13;
Python handles very large real-world data loads.</p>&#13;
&#13;
<p>You may also look back at the data&#13;
serialization and validation tools discussed in&#13;
<a data-type="xref" href="ch17.html#serialization">“Data Serialization”</a>.<a data-startref="ix_ch21-business-asciidoc5" data-type="indexterm" id="idm45794963131912"/><a data-startref="ix_ch21-business-asciidoc4" data-type="indexterm" id="idm45794963131192"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Data Validation" data-type="sect2"><div class="sect2" id="idm45794963288088">&#13;
<h2>Data Validation</h2>&#13;
&#13;
<p><a data-primary="data processing (business data)" data-secondary="validation" data-type="indexterm" id="idm45794963129448"/><a data-primary="validation, data" data-type="indexterm" id="idm45794963128504"/>When cleaning up data, you’ll often need to check:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Data type, such as integer, float, or string</p>&#13;
</li>&#13;
<li>&#13;
<p>Range of values</p>&#13;
</li>&#13;
<li>&#13;
<p>Correct values, such as a working phone number or email address</p>&#13;
</li>&#13;
<li>&#13;
<p>Duplicates</p>&#13;
</li>&#13;
<li>&#13;
<p>Missing data</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>This is especially common when processing web requests and responses.</p>&#13;
&#13;
<p>Useful Python packages for particular data types include:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://pypi.org/project/validate_email"><code>validate_email</code></a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://pypi.org/project/phonenumbers"><code>phonenumber</code></a></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Some useful general tools are:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://validators.readthedocs.io"><code>validators</code></a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://pydantic-docs.helpmanual.io"><code>pydantic</code></a>—For Python 3.6 and above; uses type hints</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://marshmallow.readthedocs.io/en/3.0"><code>marshmallow</code></a>—Also serializes and deserializes</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://docs.python-cerberus.org/en/stable"><code>cerberus</code></a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://libraries.io/search?keywords=validation&amp;languages=Python">many others</a></p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Additional Sources of Information" data-type="sect2"><div class="sect2" id="idm45794963110024">&#13;
<h2>Additional Sources of Information</h2>&#13;
&#13;
<p><a data-primary="business applications" data-secondary="government data sources" data-type="indexterm" id="idm45794963108856"/>Sometimes, you need data that originates somewhere else.&#13;
Some business and government data sources include:</p>&#13;
<dl>&#13;
<dt><a href="https://www.data.gov">data.gov</a></dt>&#13;
<dd>&#13;
<p>A gateway to thousands of data sets and tools.&#13;
Its <a href="https://www.data.gov/developers/apis">APIs</a>&#13;
are built on <a href="http://ckan.org">CKAN</a>,&#13;
a Python data management system.</p>&#13;
</dd>&#13;
<dt><a href="http://sunlightfoundation.com">Opening government with Python</a></dt>&#13;
<dd>&#13;
<p>See the <a href="http://bit.ly/opengov-py">video</a>&#13;
and <a href="http://goo.gl/8Yh3s">slides</a>.</p>&#13;
</dd>&#13;
<dt><a href="http://bit.ly/py-sun">python-sunlight</a></dt>&#13;
<dd>&#13;
<p>Libraries to access the&#13;
<a href="http://sunlightfoundation.com/api">Sunlight APIs</a>.</p>&#13;
</dd>&#13;
<dt><a href="https://froide.readthedocs.io">froide</a></dt>&#13;
<dd>&#13;
<p>A Django-based platform for managing freedom of information requests.</p>&#13;
</dd>&#13;
<dt><a href="http://blog.visual.ly/data-sources">30 places to find open data on the web</a></dt>&#13;
<dd>&#13;
<p>Some handy links.<a data-startref="ix_ch21-business-asciidoc3" data-type="indexterm" id="idm45794963016616"/><a data-startref="ix_ch21-business-asciidoc2" data-type="indexterm" id="idm45794963015816"/></p>&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Open Source Python Business Packages" data-type="sect1"><div class="sect1" id="idm45794963014872">&#13;
<h1>Open Source Python Business Packages</h1>&#13;
<dl>&#13;
<dt><a href="https://www.odoo.com">Odoo</a></dt>&#13;
<dd>&#13;
<p><a data-primary="business applications" data-secondary="open source packages" data-type="indexterm" id="idm45794963012088"/>Extensive ERP platform</p>&#13;
</dd>&#13;
<dt><a href="http://www.tryton.org">Tryton</a></dt>&#13;
<dd>&#13;
<p>Another extensive business platform</p>&#13;
</dd>&#13;
<dt><a href="http://oscarcommerce.com">Oscar</a></dt>&#13;
<dd>&#13;
<p>Ecommerce framework for Django</p>&#13;
</dd>&#13;
<dt><a href="https://gridstudio.io">Grid Studio</a></dt>&#13;
<dd>&#13;
<p>Python-based spreadsheet, runs locally or in the cloud</p>&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Python in Finance" data-type="sect1"><div class="sect1" id="finance">&#13;
<h1>Python in Finance</h1>&#13;
&#13;
<p><a data-primary="business applications" data-secondary="financial tools" data-type="indexterm" id="idm45794963003912"/><a data-primary="financial applications" data-type="indexterm" id="idm45794963002936"/>Recently, the financial industry has developed&#13;
a great interest in Python.&#13;
Adapting software from <a data-type="xref" href="ch22.html#ch_science">Chapter 22</a> as well as some of their own,&#13;
<em>quants</em> are building a new generation of financial tools:</p>&#13;
<dl>&#13;
<dt><a href="http://quant-econ.net">Quantitative economics</a></dt>&#13;
<dd>&#13;
<p>A tool for economic modeling, with lots of math and Python code</p>&#13;
</dd>&#13;
<dt><a href="http://www.python-for-finance.com">Python for finance</a></dt>&#13;
<dd>&#13;
<p>Features the book&#13;
<em>Derivatives Analytics with Python: Data Analytics, Models, Simulation, Calibration, and Hedging</em> by Yves Hilpisch (Wiley)</p>&#13;
</dd>&#13;
<dt><a href="https://www.quantopian.com">Quantopian</a></dt>&#13;
<dd>&#13;
<p>An interactive website on which you can write your own Python code&#13;
and run it against historic stock data to see how it would have done</p>&#13;
</dd>&#13;
<dt><a href="http://gbeced.github.io/pyalgotrade">PyAlgoTrade</a></dt>&#13;
<dd>&#13;
<p>Another that you can use for stock backtesting,&#13;
but on your own computer</p>&#13;
</dd>&#13;
<dt><a href="http://www.quandl.com">Quandl</a></dt>&#13;
<dd>&#13;
<p>Search millions of financial datasets</p>&#13;
</dd>&#13;
<dt><a href="https://code.google.com/p/ultra-finance">Ultra-finance</a></dt>&#13;
<dd>&#13;
<p>A real-time stock collection library</p>&#13;
</dd>&#13;
<dt><a href="http://bit.ly/python-finance"><em>Python for Finance</em></a> (O’Reilly)</dt>&#13;
<dd>&#13;
<p>A book by Yves Hilpisch with Python examples for financial modeling</p>&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Business Data Security" data-type="sect1"><div class="sect1" id="idm45794962986696">&#13;
<h1>Business Data Security</h1>&#13;
&#13;
<p><a data-primary="business applications" data-secondary="data security" data-type="indexterm" id="idm45794962985480"/><a data-primary="security issues" data-secondary="business data" data-type="indexterm" id="idm45794962984504"/>Security is a special concern for business.&#13;
Entire books are devoted to this topic,&#13;
so we just mention a few Python-related tips here.</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a data-type="xref" href="ch17.html#scapy">“Scapy”</a> discusses <code>scapy</code>,&#13;
a Python-powered language for packet forensics.&#13;
It has been used to explain some major network attacks.</p>&#13;
</li>&#13;
<li>&#13;
<p>The&#13;
<a href="http://www.pythonsecurity.org">Python Security</a>&#13;
site has discussions of security topics,&#13;
details on some Python modules,&#13;
and cheat sheets.</p>&#13;
</li>&#13;
<li>&#13;
<p>The book&#13;
<a href="http://bit.ly/violent-python"><em>Violent Python</em></a>&#13;
(subtitled&#13;
<em>A Cookbook for Hackers, Forensic Analysts, Penetration Testers and Security Engineers</em>)&#13;
by TJ O’Connor (Syngress)&#13;
is an extensive review of Python and computer security.</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Maps" data-type="sect1"><div class="sect1" id="maps">&#13;
<h1>Maps</h1>&#13;
&#13;
<p><a data-primary="business applications" data-secondary="maps" data-type="indexterm" id="ix_ch21-business-asciidoc6"/><a data-primary="maps" data-type="indexterm" id="ix_ch21-business-asciidoc7"/>Maps have become valuable to many businesses.&#13;
Python is very good at making maps,&#13;
so we’re going to spend a little more time in this area.&#13;
Managers love graphics,&#13;
and if you can quickly whip up a nice map&#13;
for your organization’s website&#13;
it wouldn’t hurt.</p>&#13;
&#13;
<p>In the early days of the web,&#13;
I used to visit an experimental mapmaking website at Xerox.&#13;
When big sites such as Google Maps came along,&#13;
they were a revelation&#13;
(along the lines of “why didn’t I think of that and make millions?”).&#13;
Now mapping and <em>location-based services</em>&#13;
are everywhere, and are particularly useful in mobile devices.</p>&#13;
&#13;
<p>Many terms overlap here:&#13;
mapping,&#13;
cartography,&#13;
GIS (geographic information system),&#13;
GPS (Global Positioning System),&#13;
geospatial analysis,&#13;
and many more.&#13;
The blog at <a href="http://bit.ly/geospatial-py">Geospatial Python</a>&#13;
has an image of the “800-pound gorilla” systems—GDAL/OGR,&#13;
GEOS,&#13;
and&#13;
PROJ.4 (projections)—and surrounding systems, represented as monkeys.&#13;
Many of these have Python interfaces.&#13;
Let’s talk about some of these,&#13;
beginning with the simplest&#13;
formats.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Formats" data-type="sect2"><div class="sect2" id="map_formats">&#13;
<h2>Formats</h2>&#13;
&#13;
<p><a data-primary="maps" data-secondary="formats" data-type="indexterm" id="idm45794962967720"/>The mapping world has lots of formats:&#13;
vector (lines),&#13;
raster (images),&#13;
metadata (words),&#13;
and various combinations.</p>&#13;
&#13;
<p><a data-primary="Esri" data-type="indexterm" id="idm45794962966232"/><a data-primary="shapefile" data-secondary="drawing a map from" data-type="indexterm" id="idm45794962965528"/>Esri,&#13;
a pioneer of geographic systems,&#13;
invented the <em>shapefile</em> format over 20 years ago.&#13;
A shapefile actually consists of multiple files,&#13;
including at the very least the following:</p>&#13;
<dl>&#13;
<dt><em>.shp</em></dt>&#13;
<dd>&#13;
<p>The “shape” (vector) information</p>&#13;
</dd>&#13;
<dt><em>.shx</em></dt>&#13;
<dd>&#13;
<p>The shape index</p>&#13;
</dd>&#13;
<dt><em>.dbf</em></dt>&#13;
<dd>&#13;
<p>An attribute database</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Let’s grab a shapefile for our next example—visit the Natural Earth&#13;
<a href="http://bit.ly/cultural-vectors">1:110m Cultural Vectors page</a>.&#13;
Under “Admin 1 - States and Provinces,”&#13;
click the green&#13;
<a href="https://oreil.ly/7BR2o">download states and provinces</a> box&#13;
to download a zip file.&#13;
After it downloads to your computer, unzip it;&#13;
you should see these resulting files:</p>&#13;
<pre>ne_110m_admin_1_states_provinces_shp.README.html&#13;
ne_110m_admin_1_states_provinces_shp.sbn&#13;
ne_110m_admin_1_states_provinces_shp.VERSION.txt&#13;
ne_110m_admin_1_states_provinces_shp.sbx&#13;
ne_110m_admin_1_states_provinces_shp.dbf&#13;
ne_110m_admin_1_states_provinces_shp.shp&#13;
ne_110m_admin_1_states_provinces_shp.prj&#13;
ne_110m_admin_1_states_provinces_shp.shx</pre>&#13;
&#13;
<p>We’ll use these for our examples.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Draw a Map from a Shapefile" data-type="sect2"><div class="sect2" id="map_shapefile">&#13;
<h2>Draw a Map from a Shapefile</h2>&#13;
&#13;
<p><a data-primary="maps" data-secondary="shapefiles and" data-type="indexterm" id="ix_ch21-business-asciidoc8"/><a data-primary="shapefile" data-secondary="about" data-type="indexterm" id="ix_ch21-business-asciidoc9"/>This section is an overly simplified demonstration&#13;
of reading and displaying a shapefile.&#13;
You’ll see that the result has problems,&#13;
and that you’d be better off working with a higher-level&#13;
mapping package,&#13;
such as those in the sections that follow.</p>&#13;
&#13;
<p>You’ll need this library to read a shapefile:</p>&#13;
<pre>$ <strong>pip install pyshp</strong></pre>&#13;
&#13;
<p>Now for the program, <em>map1.py</em>,&#13;
which I’ve modified from a Geospatial Python&#13;
<a href="http://bit.ly/raster-shape">blog post</a>:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting" id="appb_EXd"><code class="k">def</code> <code class="nf">display_shapefile</code><code class="p">(</code><code class="n">name</code><code class="p">,</code> <code class="n">iwidth</code><code class="o">=</code><code class="mi">500</code><code class="p">,</code> <code class="n">iheight</code><code class="o">=</code><code class="mi">500</code><code class="p">):</code>&#13;
    <code class="kn">import</code> <code class="nn">shapefile</code>&#13;
    <code class="kn">from</code> <code class="nn">PIL</code> <code class="kn">import</code> <code class="n">Image</code><code class="p">,</code> <code class="n">ImageDraw</code>&#13;
    <code class="n">r</code> <code class="o">=</code> <code class="n">shapefile</code><code class="o">.</code><code class="n">Reader</code><code class="p">(</code><code class="n">name</code><code class="p">)</code>&#13;
    <code class="n">mleft</code><code class="p">,</code> <code class="n">mbottom</code><code class="p">,</code> <code class="n">mright</code><code class="p">,</code> <code class="n">mtop</code> <code class="o">=</code> <code class="n">r</code><code class="o">.</code><code class="n">bbox</code>&#13;
    <code class="c1"># map units</code>&#13;
    <code class="n">mwidth</code> <code class="o">=</code> <code class="n">mright</code> <code class="o">-</code> <code class="n">mleft</code>&#13;
    <code class="n">mheight</code> <code class="o">=</code> <code class="n">mtop</code> <code class="o">-</code> <code class="n">mbottom</code>&#13;
    <code class="c1"># scale map units to image units</code>&#13;
    <code class="n">hscale</code> <code class="o">=</code> <code class="n">iwidth</code><code class="o">/</code><code class="n">mwidth</code>&#13;
    <code class="n">vscale</code> <code class="o">=</code> <code class="n">iheight</code><code class="o">/</code><code class="n">mheight</code>&#13;
    <code class="n">img</code> <code class="o">=</code> <code class="n">Image</code><code class="o">.</code><code class="n">new</code><code class="p">(</code><code class="s2">"RGB"</code><code class="p">,</code> <code class="p">(</code><code class="n">iwidth</code><code class="p">,</code> <code class="n">iheight</code><code class="p">),</code> <code class="s2">"white"</code><code class="p">)</code>&#13;
    <code class="n">draw</code> <code class="o">=</code> <code class="n">ImageDraw</code><code class="o">.</code><code class="n">Draw</code><code class="p">(</code><code class="n">img</code><code class="p">)</code>&#13;
    <code class="k">for</code> <code class="n">shape</code> <code class="ow">in</code> <code class="n">r</code><code class="o">.</code><code class="n">shapes</code><code class="p">():</code>&#13;
        <code class="n">pixels</code> <code class="o">=</code> <code class="p">[</code>&#13;
            <code class="p">(</code><code class="nb">int</code><code class="p">(</code><code class="n">iwidth</code> <code class="o">-</code> <code class="p">((</code><code class="n">mright</code> <code class="o">-</code> <code class="n">x</code><code class="p">)</code> <code class="o">*</code> <code class="n">hscale</code><code class="p">)),</code> <code class="nb">int</code><code class="p">((</code><code class="n">mtop</code> <code class="o">-</code> <code class="n">y</code><code class="p">)</code> <code class="o">*</code> <code class="n">vscale</code><code class="p">))</code>&#13;
            <code class="k">for</code> <code class="n">x</code><code class="p">,</code> <code class="n">y</code> <code class="ow">in</code> <code class="n">shape</code><code class="o">.</code><code class="n">points</code><code class="p">]</code>&#13;
        <code class="k">if</code> <code class="n">shape</code><code class="o">.</code><code class="n">shapeType</code> <code class="o">==</code> <code class="n">shapefile</code><code class="o">.</code><code class="n">POLYGON</code><code class="p">:</code>&#13;
            <code class="n">draw</code><code class="o">.</code><code class="n">polygon</code><code class="p">(</code><code class="n">pixels</code><code class="p">,</code> <code class="n">outline</code><code class="o">=</code><code class="s1">'black'</code><code class="p">)</code>&#13;
        <code class="k">elif</code> <code class="n">shape</code><code class="o">.</code><code class="n">shapeType</code> <code class="o">==</code> <code class="n">shapefile</code><code class="o">.</code><code class="n">POLYLINE</code><code class="p">:</code>&#13;
            <code class="n">draw</code><code class="o">.</code><code class="n">line</code><code class="p">(</code><code class="n">pixels</code><code class="p">,</code> <code class="n">fill</code><code class="o">=</code><code class="s1">'black'</code><code class="p">)</code>&#13;
    <code class="n">img</code><code class="o">.</code><code class="n">show</code><code class="p">()</code>&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="kn">import</code> <code class="nn">sys</code>&#13;
    <code class="n">display_shapefile</code><code class="p">(</code><code class="n">sys</code><code class="o">.</code><code class="n">argv</code><code class="p">[</code><code class="mi">1</code><code class="p">],</code> <code class="mi">700</code><code class="p">,</code> <code class="mi">700</code><code class="p">)</code></pre>&#13;
&#13;
<p>This reads the shapefile and iterates through its individual shapes.&#13;
I’m checking for only two shape types:&#13;
a polygon, which connects the last point to the first,&#13;
and a polyline, which doesn’t.&#13;
I’ve based my logic on the original post&#13;
and a quick look at the documentation for <code>pyshp</code>,&#13;
so I’m not really sure how it will work.&#13;
Sometimes, we just need to make a start and&#13;
deal with any problems as we find them.</p>&#13;
&#13;
<p>So, let’s run it.&#13;
The argument is the base name of the shapefile files,&#13;
without any extension:</p>&#13;
<pre>$ <strong>python map1.py ne_110m_admin_1_states_provinces_shp</strong></pre>&#13;
&#13;
<p>You should see something like <a data-type="xref" href="#business_map_us">Figure 21-1</a>.</p>&#13;
&#13;
<p>Well, it drew a map that resembles the United States, but:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>It looks like a cat dragged yarn across Alaska and Hawaii;&#13;
this is a <em>bug</em>.</p>&#13;
</li>&#13;
<li>&#13;
<p>The country is squished; I need a <em>projection</em>.</p>&#13;
</li>&#13;
<li>&#13;
<p>The picture isn’t pretty; I need better <em>style</em> control.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<figure><div class="figure" id="business_map_us">&#13;
<img alt="inp2 2101" src="assets/inp2_2101.png"/>&#13;
<h6><span class="label">Figure 21-1. </span>Preliminary map</h6>&#13;
</div></figure>&#13;
&#13;
<p>To address the first point:&#13;
I have a problem somewhere in my logic,&#13;
but what should I do?&#13;
<a data-type="xref" href="ch19.html#ch_pythonista">Chapter 19</a> discusses development tips, including debugging,&#13;
but we can consider other options here.&#13;
I could write some tests and bear down until I fix this,&#13;
or I could just try some other mapping library.&#13;
Maybe something at a higher level&#13;
would solve all three of my problems&#13;
(the stray lines, squished appearance, and primitive style).</p>&#13;
&#13;
<p>As far as I can tell,&#13;
there is no bare-bones pure Python&#13;
mapping package.&#13;
Luckily, there are some fancier ones,&#13;
so let’s take a look.<a data-startref="ix_ch21-business-asciidoc9" data-type="indexterm" id="idm45794962749288"/><a data-startref="ix_ch21-business-asciidoc8" data-type="indexterm" id="idm45794962748568"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Geopandas" data-type="sect2"><div class="sect2" id="geopandas">&#13;
<h2>Geopandas</h2>&#13;
&#13;
<p><a data-primary="geopandas" data-type="indexterm" id="idm45794962746040"/><a data-primary="maps" data-secondary="geopandas and" data-type="indexterm" id="idm45794962745336"/><a href="http://geopandas.org">Geopandas</a>&#13;
integrates <code>matplotlib</code>, <code>pandas</code>, and other&#13;
Python libraries into a geospatial data platform.</p>&#13;
&#13;
<p>The base package is installed with the familiar&#13;
<code>pip install geopandas</code>,&#13;
but it relies on other packages that you will also&#13;
need to install with <code>pip</code> if you don’t have them already:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>numpy</code></p>&#13;
</li>&#13;
<li>&#13;
<p><code>pandas</code> (version 0.23.4 or later)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>shapely</code> (interface to GEOS)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>fiona</code> (interface to GDAL)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>pyproj</code> (interface to PROJ)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>six</code></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Geopandas can read shapefiles&#13;
(including those from the previous section),&#13;
and handily includes two from Natural Earth:&#13;
country/continent outlines,&#13;
and national capital cities.&#13;
<a data-type="xref" href="#geopandas_example">Example 21-1</a> is a simple demo that uses both of them.</p>&#13;
<div data-type="example" id="geopandas_example">&#13;
<h5><span class="label">Example 21-1. </span>geopandas.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">import</code> <code class="nn">geopandas</code>&#13;
<code class="kn">import</code> <code class="nn">matplotlib.pyplot</code> <code class="kn">as</code> <code class="nn">plt</code>&#13;
&#13;
<code class="n">world_file</code> <code class="o">=</code> <code class="n">geopandas</code><code class="o">.</code><code class="n">datasets</code><code class="o">.</code><code class="n">get_path</code><code class="p">(</code><code class="s1">'naturalearth_lowres'</code><code class="p">)</code>&#13;
<code class="n">world</code> <code class="o">=</code> <code class="n">geopandas</code><code class="o">.</code><code class="n">read_file</code><code class="p">(</code><code class="n">world_file</code><code class="p">)</code>&#13;
<code class="n">cities_file</code> <code class="o">=</code> <code class="n">geopandas</code><code class="o">.</code><code class="n">datasets</code><code class="o">.</code><code class="n">get_path</code><code class="p">(</code><code class="s1">'naturalearth_cities'</code><code class="p">)</code>&#13;
<code class="n">cities</code> <code class="o">=</code> <code class="n">geopandas</code><code class="o">.</code><code class="n">read_file</code><code class="p">(</code><code class="n">cities_file</code><code class="p">)</code>&#13;
<code class="n">base</code> <code class="o">=</code> <code class="n">world</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">color</code><code class="o">=</code><code class="s1">'orchid'</code><code class="p">)</code>&#13;
<code class="n">cities</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">ax</code><code class="o">=</code><code class="n">base</code><code class="p">,</code> <code class="n">color</code><code class="o">=</code><code class="s1">'black'</code><code class="p">,</code> <code class="n">markersize</code><code class="o">=</code><code class="mi">2</code><code class="p">)</code>&#13;
<code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code></pre></div>&#13;
&#13;
<p>Run that, and you should get the map shown in <a data-type="xref" href="#world_map">Figure 21-2</a>.</p>&#13;
&#13;
<figure><div class="figure" id="world_map">&#13;
<img alt="inp2 2102" src="assets/inp2_2102.png"/>&#13;
<h6><span class="label">Figure 21-2. </span>Geopandas map</h6>&#13;
</div></figure>&#13;
&#13;
<p>To me,&#13;
geopandas currently looks like the best combination&#13;
for geographic data management and display.&#13;
But there are many worthy contenders, which we look at in the next section.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Other Mapping Packages" data-type="sect2"><div class="sect2" id="idm45794962747448">&#13;
<h2>Other Mapping Packages</h2>&#13;
&#13;
<p><a data-primary="maps" data-secondary="packages" data-type="indexterm" id="idm45794962689848"/>Here’s a grab bag of links to other Python mapping software; many cannot be installed fully with <code>pip</code>,&#13;
but some can with <code>conda</code> (the alternative Python&#13;
package installer that’s especially handy for&#13;
scientific software):</p>&#13;
<dl>&#13;
<dt><a href="https://pypi.org/project/pyshp">pyshp</a></dt>&#13;
<dd>&#13;
<p>A pure-Python shapefile library,&#13;
mentioned earlier in <a data-type="xref" href="#map_shapefile">“Draw a Map from a Shapefile”</a>.</p>&#13;
</dd>&#13;
<dt><a href="http://kartograph.org">kartograph</a></dt>&#13;
<dd>&#13;
<p>Renders shapefiles into SVG maps on the server or client.</p>&#13;
</dd>&#13;
<dt><a href="https://shapely.readthedocs.io">shapely</a></dt>&#13;
<dd>&#13;
<p>Addresses geometric questions such as,&#13;
“What buildings in this town are within the 50-year flood contour?”</p>&#13;
</dd>&#13;
<dt><a href="http://matplotlib.org/basemap">basemap</a></dt>&#13;
<dd>&#13;
<p>Based on <code>matplotlib</code>, draws maps and data overlays.&#13;
Unfortunately, it has been deprecated in favor of Cartopy.</p>&#13;
</dd>&#13;
<dt><a href="https://scitools.org.uk/cartopy/docs/latest">cartopy</a></dt>&#13;
<dd>&#13;
<p>Succeeds Basemap, and does some of the things that <code>geopandas</code> does.</p>&#13;
</dd>&#13;
<dt><a href="https://python-visualization.github.io/folium">folium</a></dt>&#13;
<dd>&#13;
<p>Works with leaflet.js, used by <code>geopandas</code>.</p>&#13;
</dd>&#13;
<dt><a href="https://plot.ly/python/maps">plotly</a></dt>&#13;
<dd>&#13;
<p>Another plotting package that includes mapping features.</p>&#13;
</dd>&#13;
<dt><a href="https://dash.plot.ly">dash</a></dt>&#13;
<dd>&#13;
<p>Uses Plotly, Flask and JavaScript to create interactive visualizations,&#13;
including maps.</p>&#13;
</dd>&#13;
<dt><a href="https://github.com/Toblerity/Fiona">fiona</a></dt>&#13;
<dd>&#13;
<p>Wraps the OGR library,&#13;
which handles shapefiles and other vector formats.</p>&#13;
</dd>&#13;
<dt><a href="https://oreil.ly/BJeha">Open Street Map</a></dt>&#13;
<dd>&#13;
<p>Accesses the vast&#13;
<a href="https://www.openstreetmap.org">OpenStreetMap</a> world maps.</p>&#13;
</dd>&#13;
<dt><a href="http://mapnik.org">mapnik</a></dt>&#13;
<dd>&#13;
<p>A C++ library with Python bindings,&#13;
for vector (line) and raster (image) maps.</p>&#13;
</dd>&#13;
<dt><a href="http://vincent.readthedocs.org">Vincent</a></dt>&#13;
<dd>&#13;
<p>Translates to Vega, a JavaScript visualization tool;&#13;
see the tutorial:&#13;
<a href="https://oreil.ly/0TbTC">Mapping data in Python with pandas and vincent</a>.</p>&#13;
</dd>&#13;
<dt><a href="http://bit.ly/py-arcgis">Python for ArcGIS</a></dt>&#13;
<dd>&#13;
<p>Links to Python resources for Esri’s commercial ArcGIS product.</p>&#13;
</dd>&#13;
<dt><a href="http://bit.ly/geos-py">Using geospatial data with python</a></dt>&#13;
<dd>&#13;
<p>Video presentations.</p>&#13;
</dd>&#13;
<dt><a href="http://bit.ly/pythonmap">So you’d like to make a map using Python</a></dt>&#13;
<dd>&#13;
<p>Uses <code>pandas</code>, <code>matplotlib</code>, <code>shapely</code>,&#13;
and other Python modules to create maps of historic plaque locations.</p>&#13;
</dd>&#13;
<dt><a href="http://bit.ly/py-geo-dev"><em>Python Geospatial Development</em></a> (Packt)</dt>&#13;
<dd>&#13;
<p>A book by Eric Westra with examples using <code>mapnik</code> and other tools.</p>&#13;
</dd>&#13;
<dt><a href="http://bit.ly/learn-geo-py"><em>Learning Geospatial Analysis with Python</em></a> (Packt)</dt>&#13;
<dd>&#13;
<p>Another book by Joel Lawhead reviewing formats and libraries, with geospatial algorithms.</p>&#13;
</dd>&#13;
<dt><a href="https://github.com/thinkingmachines/geomancer">geomancer</a></dt>&#13;
<dd>&#13;
<p>Geospatial engineering, such as the distance from a point&#13;
to the nearest Irish bar.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>If you’re interested in maps, try downloading&#13;
and installing one of these packages&#13;
and see what you can do.&#13;
Or, you can avoid installing software and&#13;
try connecting to a remote web service API yourself;&#13;
<a data-type="xref" href="ch18.html#ch_web">Chapter 18</a> shows you how to connect to web servers&#13;
and decode JSON responses.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Applications and Data" data-type="sect2"><div class="sect2" id="map_other">&#13;
<h2>Applications and Data</h2>&#13;
&#13;
<p><a data-primary="maps" data-secondary="applications and data" data-type="indexterm" id="idm45794962646136"/>I’ve been talking about drawing maps,&#13;
but you can do a lot more with map data.&#13;
<em>Geocoding</em> converts between addresses and geographic coordinates.&#13;
There are many geocoding&#13;
<a href="https://oreil.ly/Zqw0W">APIs</a>&#13;
(see <a href="http://bit.ly/free-geo-api">ProgrammableWeb’s comparison</a>)&#13;
and Python libraries:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://code.google.com/p/geopy">geopy</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://pypi.python.org/pypi/pygeocoder">pygeocoder</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://py-googlemaps.sourceforge.net">googlemaps</a></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>If you sign up with Google or another source to get an API key,&#13;
you can access other services such as step-by-step travel directions or&#13;
local search.</p>&#13;
&#13;
<p>Here are a few sources of mapping data:</p>&#13;
<dl>&#13;
<dt><a class="orm:hideurl" href="http://www.census.gov/geo/maps-data">http://www.census.gov/geo/maps-data</a></dt>&#13;
<dd>&#13;
<p>Overview of the US Census Bureau’s map files</p>&#13;
</dd>&#13;
<dt><a class="orm:hideurl" href="http://www.census.gov/geo/maps-data/data/tiger">http://www.census.gov/geo/maps-data/data/tiger.html</a></dt>&#13;
<dd>&#13;
<p>Heaps of geographic and demographic map data</p>&#13;
</dd>&#13;
<dt><a class="orm:hideurl" href="http://wiki.openstreetmap.org/wiki/Potential_Datasources">http://wiki.openstreetmap.org/wiki/Potential_Datasources</a></dt>&#13;
<dd>&#13;
<p>Worldwide sources</p>&#13;
</dd>&#13;
<dt><a class="orm:hideurl" href="http://www.naturalearthdata.com">http://www.naturalearthdata.com</a></dt>&#13;
<dd>&#13;
<p>Vector and raster map data at three scales</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>I should mention the&#13;
<a href="http://www.datasciencetoolkit.org">Data Science Toolkit</a> here.&#13;
It includes free bidirectional geocoding,&#13;
coordinates to political boundaries and statistics,&#13;
and more.&#13;
You can also download all the data and software as a&#13;
virtual machine (VM) and run&#13;
it self-contained on your own computer.&#13;
<a data-startref="ix_ch21-business-asciidoc7" data-type="indexterm" id="idm45794962627448"/><a data-startref="ix_ch21-business-asciidoc6" data-type="indexterm" id="idm45794962626728"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Coming Up" data-type="sect1"><div class="sect1" id="idm45794962976184">&#13;
<h1>Coming Up</h1>&#13;
&#13;
<p>We go to a Science Fair and see all the Python exhibits.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Things to Do" data-type="sect1"><div class="sect1" id="idm45794962624488">&#13;
<h1>Things to Do</h1>&#13;
&#13;
<p>21.1&#13;
<a data-primary="business applications" data-secondary="practice exercises" data-type="indexterm" id="idm45794962623160"/>Install <code>geopandas</code> and run <a data-type="xref" href="#geopandas_example">Example 21-1</a>.&#13;
Try modifying things like colors and marker sizes.<a data-startref="ix_ch21-business-asciidoc1" data-type="indexterm" id="idm45794962468600"/><a data-startref="ix_ch21-business-asciidoc0" data-type="indexterm" id="idm45794962467992"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>