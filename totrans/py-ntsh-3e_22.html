<html><head></head><body>
<div id="sbo-rt-content"><section data-nutshell-tab="Structured Text: HTML" data-pdf-bookmark="Chapter 22. Structured Text: HTML" data-type="chapter" epub:type="chapter"><div class="chapter" id="structured_text_html">
<h1><span class="label">Chapter 22. </span>Structured Text: HTML</h1>
<p>Most<a contenteditable="false" data-primary="structured text" data-secondary="HyperText Markup Language (HTML)" data-tertiary="working with HTML" data-type="indexterm" id="idm44924484729168"/> documents on the web use<a contenteditable="false" data-primary="HyperText Markup Language (HTML)" data-type="indexterm" id="idm44924484727424"/><a contenteditable="false" data-primary="HTML (HyperText Markup Language)" data-type="indexterm" id="idm44924484726272"/> HTML, the HyperText Markup Language. <em>Markup<a contenteditable="false" data-primary="markup" data-type="indexterm" id="idm44924484724736"/></em> is the insertion of special tokens, known as<a contenteditable="false" data-primary="tags" data-type="indexterm" id="idm44924484723408"/> <em>tags</em>, in a text document, to structure the text. HTML is, in theory, an application of the large, general standard known as SGML, the<a contenteditable="false" data-primary="SGML (Standard Generalized Markup Language)" data-type="indexterm" id="idm44924484721760"/><a contenteditable="false" data-primary="Standard Generalized Markup Language (SGML)" data-type="indexterm" id="idm44924484720560"/> <a href="https://oreil.ly/X-3xi">Standard Generalized Markup Language</a>. In practice, many documents on the web use HTML in sloppy or incorrect ways.</p>
<p>HTML was designed for presenting documents in a browser. As web content evolved, users realized it lacked the capability for<a contenteditable="false" data-primary="semantic markup" data-type="indexterm" id="idm44924484717904"/> <em>semantic markup</em>, in which the markup indicates the meaning of the delineated text rather than simply its appearance. Complete, precise extraction of the information in an HTML document often turns out to be unfeasible. A more rigorous standard called<a contenteditable="false" data-primary="XML (eXtensible Markup Language)" data-type="indexterm" id="idm44924484716224"/><a contenteditable="false" data-primary="eXtensible Markup Language (XML)" data-type="indexterm" id="idm44924484715152"/><a contenteditable="false" data-primary="Extensible HyperText Markup Language (XHTML)" data-type="indexterm" id="idm44924484714032"/><a contenteditable="false" data-primary="XHTML (Extensible HyperText Markup Language)" data-type="indexterm" id="idm44924484712896"/> XHTML attempted to remedy these shortcomings. XHTML is similar to traditional HTML, but it is defined in terms of XML, the eXtensible Markup Language, and more precisely than HTML. You can handle well-formed XHTML with the tools covered in <a data-type="xref" href="ch23.xhtml#structured_text_xml">Chapter 23</a>. However, as of this writing, XHTML has not enjoyed overwhelming success, getting scooped instead by the more pragmatic HTML5.</p>
<p>Despite the difficulties, it’s often possible to extract at least some useful information from HTML documents (a task known as<a contenteditable="false" data-primary="web scraping" data-type="indexterm" id="idm44924484709904"/><a contenteditable="false" data-primary="scraping" data-type="indexterm" id="idm44924484708800"/><a contenteditable="false" data-primary="spidering" data-type="indexterm" id="idm44924484707664"/> <em>web scraping</em>, <em>spidering</em>, or just <em>scraping</em>). Python’s standard library tries to help, supplying the <span class="code">html</span> package for the task of parsing HTML documents, whether for the purpose of presenting the documents or, more typically, as part of an attempt to extract information from them. However, when you’re dealing with somewhat-broken web pages (which is almost always the case!), the third-party module <a href="https://oreil.ly/9-cUQ"><span class="code">BeautifulSoup</span></a> usually offers your last, best hope. In this book, for pragmatic reasons, we mostly cover <span class="code">BeautifulSoup</span>, ignoring the standard library modules competing with it. The reader looking for alternatives should also investigate the increasingly popular <a href="https://scrapy.org"><span class="code">scrapy</span> package</a>.</p>
<p>Generating HTML and embedding Python in HTML are also reasonably frequent tasks. The standard Python library doesn’t support HTML generation or embedding, but you can use Python string formatting, and third-party modules can also help. <span class="code">BeautifulSoup</span> lets you alter an HTML tree (so, in particular, you can build one up programmatically, even “from scratch”); an often preferable alternative approach is <em>templating</em>, supported, for example, by the third-party module <a href="http://jinja.pocoo.org"><span class="code">jinja2</span></a>, whose bare essentials we cover in <a data-type="xref" href="#the_jinjatwo_package">“The jinja2 Package”</a>.</p>
<section data-pdf-bookmark="The html.entities Module" data-type="sect1"><div class="sect1" id="the_htmldotentities_module">
<h1>The html.entities Module</h1>
<p>The<a contenteditable="false" data-primary="standard library modules" data-secondary="html.entities" data-type="indexterm" id="idm44924484695504"/><a contenteditable="false" data-primary="html.entities module" data-type="indexterm" id="idm44924484694080"/><a contenteditable="false" data-primary="structured text" data-secondary="HyperText Markup Language (HTML)" data-tertiary="html.entities module" data-type="indexterm" id="idm44924484692976"/> <span class="code">html.entities</span> module in Python’s standard library supplies a few attributes, all of them mappings (see <a data-type="xref" href="#attributes_of_htmldotentities">Table 22-1</a>). They come in handy whatever general approach you’re using to parse, edit, or generate HTML, including the <span class="code">BeautifulSoup</span> package covered in the following section.</p>
<table class="border" id="attributes_of_htmldotentities">
<caption><span class="label">Table 22-1. </span>Attributes of <span class="code">html.entities</span></caption>
<tbody>
<tr>
<td><span class="code">codepoi⁠n⁠t⁠2​n⁠a⁠m⁠e</span></td>
<td>A mapping from Unicode codepoints to HTML entity names. For example, <span class="code">entities.codepoint2name[228]</span> is <span class="code">'auml'</span>, since Unicode character 228, <span class="code">ä</span>, “lowercase a with diaeresis,” is encoded in HTML as <span class="code">'&amp;auml;'</span>.</td>
</tr>
<tr>
<td><span class="code">entitydefs</span></td>
<td>A mapping from HTML entity names to Unicode equivalent single-character strings. For example, <span class="code">entities.entitydefs['auml']</span> is <span class="code">'ä'</span>, and <span class="code">entities.entitydefs['sigma']</span> is <span class="code">'σ'</span>.</td>
</tr>
<tr>
<td><span class="code">html5</span></td>
<td>A mapping from HTML5 named character references to equivalent single-character strings. For example, <span class="code">entities.xhtml5['gt;']</span> is <span class="code">'&gt;'</span>. The trailing semicolon in the key <em>does</em> matter—a few, but far from all, HTML5 named character references can optionally be spelled without a trailing semicolon, and in those cases both keys (with and without the trailing semicolon) are present in <span class="code">entities.xhtml5</span>.</td>
</tr>
<tr>
<td><span class="code">name2codepoint</span></td>
<td>A mapping from HTML entity names to Unicode codepoints. For example, <span class="code">entities.name2codepoint['auml']</span> is <span class="code">228</span>.</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="The BeautifulSoup Third-Party Package" data-type="sect1"><div class="sect1" id="the_beautifulsoup_third_party_package">
<h1>The BeautifulSoup Third-Party Package</h1>
<p><a href="https://oreil.ly/xx57e"><span class="code">BeautifulSoup</span></a> lets<a contenteditable="false" data-primary="structured text" data-secondary="HyperText Markup Language (HTML)" data-tertiary="BeautifulSoup package" data-type="indexterm" id="STbsoup22"/><a contenteditable="false" data-primary="BeautifulSoup package" data-secondary="benefits of" data-type="indexterm" id="idm44924484663760"/> you parse HTML even if it’s rather badly formed. It uses simple heuristics to compensate for typical HTML brokenness, and succeeds at this hard task surprisingly well in most cases. The current major version of <span class="code">BeautifulSoup</span> is version 4, also known as <span class="code">bs4</span>. In this book, we specifically cover version 4.10; as of this writing, that’s the latest stable version of <span class="code">bs4</span>.</p>
<div data-type="tip">
<h1>Installing Versus Importing BeautifulSoup</h1>
<p><span class="code">BeautifulSoup</span><a contenteditable="false" data-primary="BeautifulSoup package" data-secondary="installing versus importing" data-type="indexterm" id="idm44924484658272"/> is one of those annoying modules whose packaging requires you to use different names inside and outside Python. You install the module by running <span class="code"><strong>pip install beautifulsoup4</strong></span> at a shell command prompt, but when you import it in your Python code, you use <span class="code"><strong>import</strong></span> <span class="code">bs4</span>.</p>
</div>
<section data-pdf-bookmark="The BeautifulSoup Class" data-type="sect2"><div class="sect2" id="the_beautifulsoup_class">
<h2>The BeautifulSoup Class</h2>
<p>The<a contenteditable="false" data-primary="BeautifulSoup package" data-secondary="BeautifulSoup class" data-type="indexterm" id="idm44924484651904"/> <span class="code">bs4</span> module supplies the <span class="code">BeautifulSoup</span> class, which you instantiate by calling it with one or two arguments: first, <span class="code">htmltext</span>—either a file-like object (which is read to get the HTML text to parse) or a string (which is the text to parse)—and second, an optional <span class="code">parser</span> argument.</p>
<section data-pdf-bookmark="Which parser BeautifulSoup uses" data-type="sect3"><div class="sect3" id="which_parser_beautifulsoup_uses">
<h3>Which parser BeautifulSoup uses</h3>
<p>If you don’t pass a <span class="code">parser</span> argument, <span class="code">BeautifulSoup</span> “sniffs around” to pick the best parser (but you may get a <span class="code">GuessedAtParserWarning</span> warning in this case). If you haven’t installed any other parser, <span class="code">BeautifulSoup</span> defaults to<a contenteditable="false" data-primary="standard library modules" data-secondary="html.parser" data-type="indexterm" id="idm44924484642160"/> <span class="code">html.parser</span> from the Python standard library; if you have other parsers installed, <span class="code">BeautifulSoup</span> defaults to one of them (<span class="code">lxml</span> is currently the preferred one). Unless specified otherwise, the following examples use the default Python <span class="code">html.parser</span>. To get more control and to avoid the differences between parsers mentioned in the <span class="code">BeautifulSoup</span> <a href="https://oreil.ly/pxxVI">documentation</a>, pass the name of the parser library to use as the second argument as you instantiate <span class="code">BeautifulSoup</span>.<sup><a data-type="noteref" href="ch22.xhtml#ch01fn158" id="ch01fn158-marker">1</a></sup></p>
<p>For example, if you have installed the third-party package <span class="code">html5lib</span> (to parse HTML in the same way as all major browsers do, albeit slowly), you may call:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="n">soup</code> <code class="o">=</code> <code class="n">bs4</code><code class="o">.</code><code class="n">BeautifulSoup</code><code class="p">(</code><code class="n">thedoc</code><code class="p">,</code> <code class="s1">'html5lib'</code><code class="p">)</code></pre>
<p>When you pass <span class="code">'xml'</span> as the second argument, you must already have the third-party package <span class="code">lxml</span> installed. <span class="code">BeautifulSoup</span> then parses the document as XML, rather than as HTML. In this case, the attribute <span class="code">is_xml</span> of <span class="code">soup</span> is <span class="code"><strong>True</strong></span>; otherwise, <span class="code">soup.is_xml</span> is <span class="code"><strong>False</strong></span>. You can also use <span class="code">lxml</span> to parse HTML, if you pass <span class="code">'lxml'</span> as the second argument. More generally, you may need to install the appropriate parser library depending on the second argument you choose to pass to a call to <span class="code">bs4.BeautifulSoup</span>; <span class="code">BeautifulSoup</span> reminds you with a warning message if you don’t.</p>
<p>Here’s an example of using different parsers on the same string:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><strong><code class="kn">import</code></strong><code> </code><code class="nn">bs4</code><code class="o">,</code><code> </code><code class="nn">lxml</code><code class="o">,</code><code> </code><code class="nn">html5lib</code><code>
</code><code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><code class="n">sh</code><code> </code><code class="o">=</code><code> </code><code class="n">bs4</code><code class="o">.</code><code class="n">BeautifulSoup</code><code class="p">(</code><code class="s1">'</code><code class="s1">&lt;p&gt;hello</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">html.parser</code><code class="s1">'</code><code class="p">)</code><code>
</code><code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><code class="n">sx</code><code> </code><code class="o">=</code><code> </code><code class="n">bs4</code><code class="o">.</code><code class="n">BeautifulSoup</code><code class="p">(</code><code class="s1">'</code><code class="s1">&lt;p&gt;hello</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">xml</code><code class="s1">'</code><code class="p">)</code><code>
</code><code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><code class="n">sl</code><code> </code><code class="o">=</code><code> </code><code class="n">bs4</code><code class="o">.</code><code class="n">BeautifulSoup</code><code class="p">(</code><code class="s1">'</code><code class="s1">&lt;p&gt;hello</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">lxml</code><code class="s1">'</code><code class="p">)</code><code>
</code><code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><code class="n">s5</code><code> </code><code class="o">=</code><code> </code><code class="n">bs4</code><code class="o">.</code><code class="n">BeautifulSoup</code><code class="p">(</code><code class="s1">'</code><code class="s1">&lt;p&gt;hello</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">html5lib</code><code class="s1">'</code><code class="p">)</code><code>
</code><code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><strong><code class="k">for</code></strong><code> </code><code class="n">s</code><code> </code><strong><code class="ow">in</code></strong><code> </code><code class="p">[</code><code class="n">sh</code><code class="p">,</code><code> </code><code class="n">sx</code><code class="p">,</code><code> </code><code class="n">sl</code><code class="p">,</code><code> </code><code class="n">s5</code><code class="p">]</code><code class="p">:</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>   </code><code class="nb">print</code><code class="p">(</code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">s</code><code class="o">.</code><code class="n">is_xml</code><code class="p">)</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code></pre>
<pre data-type="programlisting">
<strong>&lt;p&gt;hello&lt;/p&gt; False</strong>
<strong>&lt;?xml version="1.0" encoding="utf-8"?&gt;</strong>
<strong>&lt;p&gt;hello&lt;/p&gt; True</strong>
<strong>&lt;html&gt;&lt;body&gt;&lt;p&gt;hello&lt;/p&gt;&lt;/body&gt;&lt;/html&gt; False</strong>
<strong>&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;hello&lt;/p&gt;&lt;/body&gt;&lt;/html&gt; False</strong></pre>
<div data-type="note" epub:type="note">
<h1>Differences between parsers in fixing invalid HTML input</h1>
<p>In the preceding example, <span class="code">'html.parser'</span> simply inserts the end tag <span class="code">&lt;/p&gt;</span>, missing from the input. Other parsers vary in the degree to which they repair invalid HTML input by adding required tags, such as <span class="code">&lt;html&gt;</span>, <span class="code">&lt;head&gt;</span>, and <span class="code">&lt;body&gt;</span>, as you can see in the example.</p>
</div>
</div></section>
<section data-pdf-bookmark="BeautifulSoup, Unicode, and encoding" data-type="sect3"><div class="sect3" id="beautifulsoupcomma_unicodecomma_and_enc">
<h3>BeautifulSoup, Unicode, and encoding</h3>
<p><span class="code">BeautifulSoup</span><a contenteditable="false" data-primary="Unicode characters" data-secondary="BeautifulSoup package and" data-type="indexterm" id="idm44924484474656"/> uses Unicode, deducing or guessing the encoding<sup><a data-type="noteref" href="ch22.xhtml#ch01fn159" id="ch01fn159-marker">2</a></sup> when the input is a bytestring or binary file. For output, the <span class="code">prettify</span> method returns a <span class="code">str</span> representation of the tree, including tags and their attributes. <span class="code">prettify</span> formats the string with whitespace and newlines added to indent elements, displaying the nesting structure. To have it instead return a <span class="code">bytes</span> object (a bytestring) in a given encoding, pass it the encoding name as an argument. If you don’t want the result to be “prettified,” use the <span class="code">encode</span> method to get a bytestring, and the <span class="code">decode</span> method to get a Unicode string. For example:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">s</code> <code class="o">=</code> <code class="n">bs4</code><code class="o">.</code><code class="n">BeautifulSoup</code><code class="p">(</code><code class="s1">'&lt;p&gt;hello'</code><code class="p">,</code> <code class="s1">'html.parser'</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">s</code><code class="o">.</code><code class="n">prettify</code><code class="p">())</code></pre>
<pre data-type="programlisting">
<strong>&lt;p&gt;</strong>
<strong> hello</strong>
<strong>&lt;/p&gt;</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">s</code><code class="o">.</code><code class="n">decode</code><code class="p">())</code></pre>
<pre data-type="programlisting">
<strong>&lt;p&gt;hello&lt;/p&gt;</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">s</code><code class="o">.</code><code class="n">encode</code><code class="p">())</code></pre>
<pre data-type="programlisting">
<strong>b'&lt;p&gt;hello&lt;/p&gt;'</strong></pre>
</div></section>
</div></section>
<section data-pdf-bookmark="The Navigable Classes of bs4" data-type="sect2"><div class="sect2" id="the_navigable_classes_of_bsfour">
<h2>The Navigable Classes of bs4</h2>
<p>An<a contenteditable="false" data-primary="BeautifulSoup package" data-secondary="navigable classes of" data-type="indexterm" id="BSPnavigable22"/> instance <span class="code"><em>b</em></span> of class <span class="code">BeautifulSoup</span> supplies attributes and methods to “navigate” the parsed HTML tree, returning instances of<a contenteditable="false" data-primary="navigable classes (BeautifulSoup)" data-type="indexterm" id="navclass22"/> <em>navigable classes</em> <span class="code">Tag</span> and <span class="code">NavigableString</span>, along with subclasses of <span class="code">NavigableString</span> (<span class="code">CData</span>, <span class="code">Comment</span>, <span class="code">Declaration</span>, <span class="code">Doctype</span>, and <span class="code">ProcessingInstruction</span>, differing only in how they are emitted when you output them).</p>
<p>Each instance of a navigable class lets you keep navigating—i.e., dig for more information—with pretty much the same set of navigational attributes and search methods as <span class="code"><em>b</em></span> itself. There are differences: instances of <span class="code">Tag</span> can have HTML attributes and child nodes in the HTML tree, while instances of <span class="code">NavigableString</span> cannot (instances of <span class="code">NavigableString</span> always have one text string, a parent <span class="code">Tag</span>, and zero or more siblings, i.e., other children of the same parent tag).</p>
<div data-type="tip">
<h1>Navigable Class Terminology</h1>
<p>When we say “instances of <span class="code">NavigableString</span>,” we include instances of any of its subclasses; when we say “instances of <span class="code">Tag</span>,” we include instances of <span class="code">BeautifulSoup</span> since the latter is a subclass of <span class="code">Tag</span>. Instances of navigable classes are also known as the <em>elements</em> or <em>nodes</em> of the tree.</p>
</div>
<p>All instances of navigable classes have attribute <span class="code">name</span>: it’s the tag string for <span class="code">Tag</span> instances, <span class="code">'[document]'</span> for <span class="code">BeautifulSoup</span> instances, and <span class="code"><strong>None</strong></span> for instances of <span class="code">NavigableString</span>.</p>
<p>Instances of <span class="code">Tag</span> let you access their HTML attributes by indexing, or you can get them all as a <span class="code">dict</span> via the <span class="code">.attrs</span> Python attribute of the instance.</p>
<section data-pdf-bookmark="Indexing instances of Tag" data-type="sect3"><div class="sect3" id="indexing_instances_of_tag">
<h3>Indexing instances of Tag</h3>
<p>When <span class="code"><em>t</em></span> is an instance of <span class="code">Tag</span>, <span class="code"><em>t</em></span><span class="code">['foo']</span> looks for an HTML attribute named <span class="code">foo</span> within <span class="code"><em>t</em></span>’s HTML attributes and returns the string for the <span class="code">foo</span> attribute. When <span class="code"><em>t</em></span> has no HTML attribute named <span class="code">foo</span>, <span class="code"><em>t</em></span><span class="code">['foo']</span> raises a <span class="code">KeyError</span> exception; just like on a <span class="code">dict</span>, call <span class="code"><em>t</em></span><span class="code">.get('foo', default=<strong>None</strong>)</span> to get the value of the <span class="code">default</span> argument instead of an exception.</p>
<p>A few attributes, such as <span class="code">class</span>, are defined in the HTML standard as being able to have multiple values (e.g., <span class="code">&lt;body class="foo bar"&gt;...&lt;/body&gt;</span>). In these cases, the indexing returns a <span class="code">list</span> of values—for example, <span class="code">soup.body['class']</span> would be <span class="code">['foo', 'bar']</span> (again, you get a <span class="code">KeyError</span> exception when the attribute isn’t present at all; use the <span class="code">get</span> method, instead of indexing, to get a default value instead).</p>
<p>To get a <span class="code">dict</span> that maps attribute names to values (or, in a few cases defined in the HTML standard, <span class="code">list</span>s of values), use the attribute <span class="code"><em>t</em></span><span class="code">.attrs</span>:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">s</code> <code class="o">=</code> <code class="n">bs4</code><code class="o">.</code><code class="n">BeautifulSoup</code><code class="p">(</code><code class="s1">'&lt;p foo="bar" class="ic"&gt;baz'</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">s</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s1">'foo'</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">s</code><code class="o">.</code><code class="n">p</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s1">'foo'</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>'bar'</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">s</code><code class="o">.</code><code class="n">p</code><code class="o">.</code><code class="n">attrs</code></pre>
<pre data-type="programlisting">
<strong>{'foo': 'bar', 'class': ['ic']}</strong></pre>
<div data-type="tip">
<h1>How to Check if a Tag Instance Has a Certain Attribute</h1>
<p>To check if a <span class="code">Tag</span> instance <span class="code"><em>t</em></span>’s HTML attributes include one named <span class="code">'foo'</span>, <em>don’t</em> use <span class="code">if 'foo' in</span> <span class="code"><em>t</em></span>:—the <span class="code">in</span> operator on <span class="code">Tag</span> instances looks among the <span class="code">Tag</span>’s <em>children</em>, <em>not</em> its <em>attributes</em>. Rather, use <span class="code">if 'foo' in</span> <span class="code"><em>t</em></span><span class="code">.attrs:</span> or, better, <span class="code">if</span> <span class="code"><em>t</em></span><span class="code">.has_attr('foo'):</span>.</p>
</div>
</div></section>
<section data-pdf-bookmark="Getting an actual string" data-type="sect3"><div class="sect3" id="getting_an_actual_string">
<h3>Getting an actual string</h3>
<p>When you have an instance of <span class="code">NavigableString</span>, you often want to access the actual text string it contains. When you have an instance of <span class="code">Tag</span>, you may want to access the unique string it contains, or, should it contain more than one, all of them—perhaps with their text stripped of any whitespace surrounding it. Here’s how you can best accomplish these tasks.</p>
<p>When you have a <span class="code">NavigableString</span> instance <span class="code"><em>s</em></span> and you need to stash or process its text somewhere, without further navigation on it, call <span class="code">str(<em>s</em>)</span>. Or, use <span class="code"><em>s</em></span><span class="code">.encode(codec='utf8')</span> to get a bytestring, or <span class="code"><em>s</em></span><span class="code">.decode()</span> to get a text string (i.e., Unicode). These give you the actual string, without references to the <span class="code">BeautifulSoup</span> tree that would impede garbage collection (<span class="code"><em>s</em></span> supports all methods of Unicode strings, so call those directly if they do all that you need).</p>
<p>Given an instance <span class="code"><em>t</em></span> of <span class="code">Tag</span> containing a single <span class="code">NavigableString</span> instance <span class="code"><em>s</em></span>, you can use <span class="code"><em>t</em></span><span class="code">.string</span> to fetch <span class="code"><em>s</em></span> (or, to just get the text you want from <span class="code"><em>s</em></span>, use <span class="code"><em>t</em></span><span class="code">.string.decode()</span>). <span class="code"><em>t</em></span><span class="code">.string</span> only works when <span class="code"><em>t</em></span> has a single child that’s a <span class="code">NavigableString</span>, or a single child that’s a <span class="code">Tag</span> whose only child is a <span class="code">NavigableString</span>; otherwise, <span class="code"><em>t</em></span><span class="code">.string</span> is <span class="code"><strong>None</strong></span>.</p>
<p>As an iterator on <em>all</em> contained (navigable) strings, use <span class="code"><em>t</em></span><span class="code">.strings</span>. You can use <span class="code">''.join(<em>t</em>.strings)</span> to get all the strings concatenated into one, in a single step. To ignore whitespace around each contained string, use the iterator <span class="code"><em>t</em></span><span class="code">.stripped_strings</span> (which also skips all-whitespace strings).</p>
<p>Alternatively, call <span class="code"><em>t</em></span><span class="code">.get_text()</span>: this returns a single (Unicode) string with all the text in <span class="code"><em>t</em></span>’s descendants, in tree order (equivalent to accessing the attribute <span class="code"><em>t</em></span><span class="code">.text</span>). You can optionally pass, as the only positional argument, a string to use as separator. The default is the empty string, <span class="code">''</span>. Pass the named parameter <span class="code">strip=</span><span class="code"><strong>True</strong></span> to have each string stripped of surrounding whitespace and all-whitespace strings skipped.</p>
<p>The following examples demonstrate these methods for getting strings from within tags:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">soup</code> <code class="o">=</code> <code class="n">bs4</code><code class="o">.</code><code class="n">BeautifulSoup</code><code class="p">(</code><code class="s1">'&lt;p&gt;Plain &lt;b&gt;bold&lt;/b&gt;&lt;/p&gt;'</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">soup</code><code class="o">.</code><code class="n">p</code><code class="o">.</code><code class="n">string</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>None</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">soup</code><code class="o">.</code><code class="n">p</code><code class="o">.</code><code class="n">b</code><code class="o">.</code><code class="n">string</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>bold</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="s1">''</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="n">soup</code><code class="o">.</code><code class="n">strings</code><code class="p">))</code></pre>
<pre data-type="programlisting">
<strong>Plain bold</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">soup</code><code class="o">.</code><code class="n">get_text</code><code class="p">())</code></pre>
<pre data-type="programlisting">
<strong>Plain bold</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">soup</code><code class="o">.</code><code class="n">text</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>Plain bold</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">soup</code><code class="o">.</code><code class="n">get_text</code><code class="p">(</code><code class="n">strip</code><code class="o">=</code><code class="kc">True</code><code class="p">))</code></pre>
<pre data-type="programlisting">
<strong>Plainbold</strong></pre>
</div></section>
<section data-pdf-bookmark="Attribute references on instances of BeautifulSoup and Tag" data-type="sect3"><div class="sect3" id="attribute_references_on_instances_of_be">
<h3>Attribute references on instances of BeautifulSoup and Tag</h3>
<p>The simplest, most elegant way to navigate down an HTML tree or subtree in <span class="code">bs4</span> is to use Python’s attribute reference syntax (as long as each tag you name is unique, or you care only about the first tag so named at each level of descent).</p>
<p>Given any instance <span class="code"><em>t</em></span> of <span class="code">Tag</span>, a construct like <span class="code"><em>t</em></span><span class="code">.foo.bar</span> looks for the first tag <span class="code">foo</span> within <span class="code"><em>t</em></span>’s descendants and gets a <span class="code">Tag</span> instance <span class="code"><em>ti</em></span> for it, then looks for the first tag <span class="code">bar</span> within <span class="code"><em>ti</em></span>’s descendants and returns a <span class="code">Tag</span> instance for the <span class="code">bar</span> tag.</p>
<p>It’s a concise, elegant way to navigate down the tree, when you know there’s a single occurrence of a certain tag within a navigable instance’s descendants, or when the first occurrence of several is all you care about. But beware: if any level of lookup doesn’t find the tag it’s looking for, the attribute reference’s value is <span class="code"><strong>None</strong></span>, and then any further attribute reference raises <span class="code">AttributeError</span>.</p>
<div data-type="warning" epub:type="warning">
<h1>Beware of Typos in Attribute References on Tag Instances</h1>
<p>Due to this <span class="code">BeautifulSoup</span> behavior, any typo you make in an attribute reference on a <span class="code">Tag</span> instance gives a value of <span class="code"><strong>None</strong></span>, not an <span class="code">AttributeError</span> exception—so, be especially careful!</p>
</div>
<p><span class="code">bs4</span> also offers more general ways to navigate down, up, and sideways along the tree. In particular, each navigable class instance has attributes that identify a single “relative” or, in plural form, an iterator over all relatives of that ilk.</p>
</div></section>
<section data-pdf-bookmark="contents, children, and descendants" data-type="sect3"><div class="sect3" id="contentscomma_childrencomma_and_descend">
<h3>contents, children, and descendants</h3>
<p>Given an instance <span class="code"><em>t</em></span> of <span class="code">Tag</span>, you can get a list of all of its children as <span class="code"><em>t</em></span><span class="code">.contents</span>, or an iterator on all children as <span class="code"><em>t</em></span><span class="code">.children</span>. For an iterator on all <em>descendants</em> (children, children of children, and so on), use <span class="code"><em>t</em></span><span class="code">.descendants</span>:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><code class="n">soup</code><code> </code><code class="o">=</code><code> </code><code class="n">bs4</code><code class="o">.</code><code class="n">BeautifulSoup</code><code class="p">(</code><code class="s1">'</code><code class="s1">&lt;p&gt;Plain &lt;b&gt;bold&lt;/b&gt;&lt;/p&gt;</code><code class="s1">'</code><code class="p">)</code><code>
</code><code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><code class="nb">list</code><code class="p">(</code><code class="n">t</code><code class="o">.</code><code class="n">name</code><code> </code><strong><code class="k">for</code></strong><code> </code><code class="n">t</code><code> </code><strong><code class="ow">in</code></strong><code> </code><code class="n">soup</code><code class="o">.</code><code class="n">p</code><code class="o">.</code><code class="n">children</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>[None, 'b']</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><code class="nb">list</code><code class="p">(</code><code class="n">t</code><code class="o">.</code><code class="n">name</code><code> </code><strong><code class="k">for</code></strong><code> </code><code class="n">t</code><code> </code><strong><code class="ow">in</code></strong><code> </code><code class="n">soup</code><code class="o">.</code><code class="n">p</code><code class="o">.</code><code class="n">descendants</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>[None, 'b', None]</strong></pre>
<p>The <span class="code">names</span> that are <span class="code"><strong>None</strong></span> correspond to the <span class="code">NavigableString</span> nodes; only the first one of them is a <em>child</em> of the <span class="code">p</span> tag, but both are <em>descendants</em> of that tag.</p>
</div></section>
<section data-pdf-bookmark="parent and parents" data-type="sect3"><div class="sect3" id="parent_and_parents">
<h3>parent and parents</h3>
<p>Given an instance <span class="code"><em>n</em></span> of any navigable class, its parent node is <span class="code"><em>n</em></span><span class="code">.parent</span>:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">soup</code> <code class="o">=</code> <code class="n">bs4</code><code class="o">.</code><code class="n">BeautifulSoup</code><code class="p">(</code><code class="s1">'&lt;p&gt;Plain &lt;b&gt;bold&lt;/b&gt;&lt;/p&gt;'</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">soup</code><code class="o">.</code><code class="n">b</code><code class="o">.</code><code class="n">parent</code><code class="o">.</code><code class="n">name</code></pre>
<pre data-type="programlisting">
<strong>'p'</strong></pre>
<p>An iterator on all ancestors, going upwards in the tree, is <span class="code"><em>n</em></span><span class="code">.parents</span>. This includes instances of <span class="code">NavigableString</span>, since they have parents, too. An instance <span class="code"><em>b</em></span> of <span class="code">BeautifulSoup</span> has <span class="code"><em>b</em></span><span class="code">.parent</span> <span class="code"><strong>None</strong></span>, and <span class="code"><em>b</em></span><span class="code">.parents</span> is an empty iterator.</p>
</div></section>
<section data-pdf-bookmark="next_sibling, previous_sibling, next_siblings, and previous_siblings" data-type="sect3"><div class="sect3" id="next_siblingcomma_previous_siblingcomma">
<h3>next_sibling, previous_sibling, next_siblings, and previous_siblings</h3>
<p>Given an instance <span class="code"><em>n</em></span> of any navigable class, its sibling node to the immediate left is <span class="code"><em>n</em></span><span class="code">.previous_sibling</span>, and the one to the immediate right is <span class="code"><em>n</em></span><span class="code">.next_sibling</span>; either or both can be <span class="code"><strong>None</strong></span> if <span class="code"><em>n</em></span> has no such sibling. An iterator on all left siblings, going leftward in the tree, is <span class="code"><em>n</em></span><span class="code">.previous_siblings</span>; an iterator on all right siblings, going rightward in the tree, is <span class="code"><em>n</em></span><span class="code">.next_siblings</span> (either or both iterators can be empty). This includes instances of <span class="code">NavigableString</span>, since they have siblings, too. For an instance <span class="code"><em>b</em></span> of <span class="code">BeautifulSoup</span>, <span class="code"><em>b</em></span><span class="code">.previous_sibling</span> and <span class="code"><em>b</em></span><span class="code">.next_sibling</span> are both <span class="code"><strong>None</strong></span>, and both of its sibling iterators are empty:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">soup</code> <code class="o">=</code> <code class="n">bs4</code><code class="o">.</code><code class="n">BeautifulSoup</code><code class="p">(</code><code class="s1">'&lt;p&gt;Plain &lt;b&gt;bold&lt;/b&gt;&lt;/p&gt;'</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">soup</code><code class="o">.</code><code class="n">b</code><code class="o">.</code><code class="n">previous_sibling</code><code class="p">,</code> <code class="n">soup</code><code class="o">.</code><code class="n">b</code><code class="o">.</code><code class="n">next_sibling</code></pre>
<pre data-type="programlisting">
<strong>('Plain ', None)</strong></pre>
</div></section>
<section data-pdf-bookmark="next_element, previous_element, next_elements, and previous_elements" data-type="sect3"><div class="sect3" id="next_elementcomma_previous_elementcomma">
<h3>next_element, previous_element, next_elements, and previous_elements</h3>
<p>Given an instance <span class="code"><em>n</em></span> of any navigable class, the node parsed just before it is <span class="code"><em>n</em></span><span class="code">.previous_element</span>, and the one parsed just after it is <span class="code"><em>n</em></span><span class="code">.next_element</span>; either or both can be <span class="code"><strong>None</strong></span> when <span class="code"><em>n</em></span> is the first or last node parsed, respectively. An iterator on all previous elements, going backward in the tree, is <span class="code"><em>n</em></span><span class="code">.previous_elements</span>; an iterator on all following elements, going forward in the tree, is <span class="code"><em>n</em></span><span class="code">.next_elements</span> (either or both iterators can be empty). Instances of <span class="code">NavigableString</span> have such attributes, too. For an instance <span class="code"><em>b</em></span> of <span class="code">BeautifulSoup</span>, <span class="code"><em>b</em></span><span class="code">.previous_element</span> and <span class="code"><em>b</em></span><span class="code">.next_element</span> are both <span class="code"><strong>None</strong></span>, and both of its element iterators are empty:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">soup</code> <code class="o">=</code> <code class="n">bs4</code><code class="o">.</code><code class="n">BeautifulSoup</code><code class="p">(</code><code class="s1">'&lt;p&gt;Plain &lt;b&gt;bold&lt;/b&gt;&lt;/p&gt;'</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">soup</code><code class="o">.</code><code class="n">b</code><code class="o">.</code><code class="n">previous_element</code><code class="p">,</code> <code class="n">soup</code><code class="o">.</code><code class="n">b</code><code class="o">.</code><code class="n">next_element</code></pre>
<pre data-type="programlisting">
<strong>('Plain ', 'bold')</strong></pre>
<p>As shown in the previous example, the <span class="code">b</span> tag has no <span class="code">next_sibling</span> (since it’s the last child of its parent); however, it does have a <span class="code">next_element</span> (the node parsed just after it, which in this case is the <span class="code">'bold'</span> string it contains).<a contenteditable="false" data-primary="" data-startref="navclass22" data-type="indexterm" id="idm44924483652480"/><a contenteditable="false" data-primary="" data-startref="BSPnavigable22" data-type="indexterm" id="idm44924483648832"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="bs4 find… Methods (aka Search Methods)" data-type="sect2"><div class="sect2" id="bsfour_find_methods_left_parenthesisaka">
<h2>bs4 find… Methods (aka Search Methods)</h2>
<p>Each navigable class in <span class="code">bs4</span> offers several methods whose names start with<a contenteditable="false" data-primary="find method" data-secondary="bs4.BeautifulSoup" data-type="indexterm" id="idm44924483644928"/> <span class="code">find</span>, known as<a contenteditable="false" data-primary="BeautifulSoup package" data-secondary="search methods" data-type="indexterm" id="BSPsearch22"/><a contenteditable="false" data-primary="search methods" data-type="indexterm" id="searmeth22"/> <em>search methods</em>, to locate tree nodes that satisfy specified conditions.</p>
<p>Search methods come in pairs—one method of each pair walks all the relevant parts of the tree and returns a list of nodes satisfying the conditions, while the other one stops and returns a single node satisfying all the conditions as soon as it finds it (or <span class="code"><strong>None</strong></span> when it finds no such node). Calling the latter method is therefore like calling the former one with argument <span class="code">limit=1</span>, then indexing the resulting one-item list to get its single item, but faster and more elegant.</p>
<p>So, for example, for any <span class="code">Tag</span> instance <span class="code"><em>t</em></span> and any group of positional and named arguments represented by <span class="code">...</span>, the following equivalence always holds:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="n">just_one</code><code> </code><code class="o">=</code><code> </code><em><code class="n">t</code></em><code class="o">.</code><code class="n">find</code><code class="p">(</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">)</code><code>
</code><code class="n">other_way_list</code><code> </code><code class="o">=</code><code> </code><em><code class="n">t</code></em><code class="o">.</code><code class="n">find_all</code><code class="p">(</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code> </code><code class="n">limit</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code>
</code><code class="n">other_way</code><code> </code><code class="o">=</code><code> </code><code class="n">other_way_list</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code> </code><strong><code class="k">if</code></strong><code> </code><code class="n">other_way_list</code><code> </code><strong><code class="k">else</code><code> </code><code class="kc">None</code></strong><code>
</code><strong><code class="k">assert</code></strong><code> </code><code class="n">just_one</code><code> </code><code class="o">==</code><code> </code><code class="n">other_way</code></pre>
<p>The method pairs are listed in <a data-type="xref" href="#bsfour_finddotdotdot_method_pairs">Table 22-2</a>.</p>
<table class="border" id="bsfour_finddotdotdot_method_pairs">
<caption><span class="label">Table 22-2. </span><span class="code">bs4</span> <span class="code">find...</span> method pairs</caption>
<tbody>
<tr>
<td><span class="code">find</span>,<br/>
<span class="code">find_all</span></td>
<td><span class="code"><em>b</em></span><span class="code">.find(...)</span>,<br/>
<span class="code"><em>b</em></span><span class="code">.find_all(...)</span><br/>
			Searches the <em>descendants</em> of <span class="code"><em>b</em></span> or, when you pass named argument <span class="code">recursive=</span><span class="code"><strong>False</strong></span> (available only for these two methods, not for other search methods), <span class="code"><em>b</em></span>’s <em>children</em> only. These methods are not available on <span class="code">NavigableString</span> instances, since they have no descendants; all other search methods are available on <span class="code">Tag</span> and <span class="code">NavigableString</span> instances.<br/>
			Since <span class="code">find_all</span> is frequently needed, <span class="code">bs4</span> offers an elegant shortcut: calling a tag is like calling its <span class="code">find_all</span> method. In other words, when <span class="code"><em>b</em></span> is a <span class="code">Tag</span>, <span class="code"><em>b</em></span><span class="code">(...)</span> is the same as <span class="code"><em>b</em></span><span class="code">.find_all(...)</span>.<br/>
			Another shortcut, already mentioned in <a data-type="xref" href="#attribute_references_on_instances_of_be">“Attribute references on instances of BeautifulSoup and Tag”</a>, is that <span class="code"><em>b</em></span><span class="code">.foo.bar</span> is like <span class="code"><em>b</em></span><span class="code">.find('foo').find('bar')</span>.</td>
</tr>
<tr>
<td><span class="code">find_next</span>,<br/>
<span class="code">find_all_next</span></td>
<td><span class="code"><em>b</em></span><span class="code">.find_next(...)</span>,<br/>
<span class="code"><em>b</em></span><span class="code">.find_all_next(...)</span><br/>
			Searches the <span class="code">next_elements</span> of <span class="code"><em>b</em></span>.</td>
</tr>
<tr>
<td><span class="code">f⁠i⁠n⁠d⁠_⁠n⁠e⁠x⁠t⁠_​s⁠i⁠b⁠l⁠i⁠n⁠g</span>,<br/>
<span class="code">f⁠i⁠n⁠d⁠_⁠n⁠e⁠x⁠t⁠_​s⁠i⁠b⁠l⁠i⁠n⁠g⁠s</span></td>
<td><span class="code"><em>b</em></span><span class="code">.find_next_sibling(...)</span>,<br/>
<span class="code"><em>b</em></span><span class="code">.find_next_siblings(...)</span><br/>
			Searches the <span class="code">next_siblings</span> of <span class="code"><em>b</em></span>.</td>
</tr>
<tr>
<td><span class="code">find_parent</span>,<br/>
<span class="code">find_parents</span></td>
<td><span class="code"><em>b</em></span><span class="code">.find_parent(...)</span>,<br/>
<span class="code"><em>b</em></span><span class="code">.find_parents(...)</span><br/>
			Searches the <span class="code">parents</span> of <span class="code"><em>b</em></span>.</td>
</tr>
<tr>
<td><span class="code">find_previous</span>,<br/>
<span class="code">f⁠i⁠n⁠d⁠_⁠a⁠l⁠l⁠_​p⁠r⁠e⁠v⁠i⁠o⁠u⁠s</span></td>
<td><span class="code"><em>b</em></span><span class="code">.find_previous(...)</span>,<br/>
<span class="code"><em>b</em></span><span class="code">.find_all_previous(...)</span><br/>
			Searches the <span class="code">previous_elements</span> of <span class="code"><em>b</em></span>.</td>
</tr>
<tr>
<td><span class="code">find_previ⁠o⁠u⁠s⁠_​s⁠i⁠b⁠l⁠ing</span>,<br/>
<span class="code">find_previ⁠o⁠u⁠s⁠_​s⁠i⁠b⁠lings</span></td>
<td><span class="code"><em>b</em></span><span class="code">.find_previous_sibling(...)</span>, <span class="code"><em>b</em></span><span class="code">.find_previous_siblings(...)</span><br/>
			Searches the <span class="code">previous_siblings</span> of <span class="code"><em>b</em></span>.</td>
</tr>
</tbody>
</table>
<section data-pdf-bookmark="Arguments of search methods" data-type="sect3"><div class="sect3" id="arguments_of_search_methods">
<h3>Arguments of search methods</h3>
<p>Each search method has three optional arguments: <span class="code"><em>name</em></span><em>,</em> <span class="code"><em>attrs</em></span>, and <span class="code"><em>string</em></span><em>.</em> <span class="code"><em>name</em></span> and <span class="code"><em>string</em></span> are <em>filters</em>, as described in the following subsection; <span class="code"><em>attrs</em></span> is a <span class="code">dict</span>, as described later in this section. In addition, as mentioned in <a data-type="xref" href="#bsfour_finddotdotdot_method_pairs">Table 22-2</a>, <span class="code">find</span> and <span class="code">find_all</span> only (not the other search methods) can optionally be called with the named argument <span class="code">recursive=</span><span class="code"><strong>False</strong></span>, to limit the search to children, rather than all descendants.</p>
<p>Any search method returning a <span class="code">list</span> (i.e., one whose name is plural or starts with <span class="code">find_all</span>) can optionally take the named argument <span class="code">limit</span>: its value, if any, is an integer, putting an upper bound on the length of the <span class="code">list</span> it returns (when you pass <span class="code">limit</span>, the returned <span class="code">list</span> result is truncated if necessary).</p>
<p>After these optional arguments, each search method can optionally have any number of arbitrary named arguments: the argument name can be any identifier (except the name of one of the search method’s specific arguments), while the value is a filter.</p>
<section data-pdf-bookmark="Filters" data-type="sect4"><div class="sect4" id="filters">
<h4>Filters</h4>
<p>A <em>filter</em> is applied against a <em>target</em> that can be a tag’s name (when passed as the <span class="code"><em>name</em></span> argument), a <span class="code">Tag</span>’s <span class="code">string</span> or a <span class="code">NavigableString</span>’s textual content (when passed as the <span class="code"><em>string</em></span> argument), or a <span class="code">Tag</span>’s attribute (when passed as the value of a named argument, or in the <span class="code"><em>attrs</em></span> argument). Each filter can be:</p>
<dl>
<dt>A Unicode string</dt>
<dd>The filter succeeds when the string exactly equals the target.</dd>
<dt>A bytestring</dt>
<dd>It’s decoded to Unicode using <span class="code">utf-8</span>, and the filter succeeds when the resulting Unicode string exactly equals the target.</dd>
<dt>A regular expression object (as produced by <span class="code">re.compile</span>, covered in <a data-type="xref" href="ch10.xhtml#regular_expressions_and_the_re_module">“Regular Expressions and the re Module”</a>)</dt>
<dd>The filter succeeds when the <span class="code">search</span> method of the RE, called with the target as the argument, succeeds.</dd>
<dt>A list of strings</dt>
<dd>The filter succeeds if any of the strings exactly equals the target (if any of the strings are bytestrings, they’re decoded to Unicode using <span class="code">utf-8</span>).</dd>
<dt>A function object</dt>
<dd>The filter succeeds when the function, called with the <span class="code">Tag</span> or <span class="code">NavigableString</span> instance as the argument, returns <span class="code">True</span>.</dd>
<dt class="plain"><span class="code"><strong>True</strong></span></dt>
<dd>The filter always succeeds.</dd>
</dl>
<p>As a synonym of “the filter succeeds,” we also say “the target matches the filter.”</p>
<p>Each search method finds all relevant nodes that match all of its filters (that is, it implicitly performs a logical <span class="code"><strong>and</strong></span> operation on its filters on each candidate node). (Don’t confuse this logic with that of a specific filter having a <span class="code">list</span> as an argument value. That one filter matches when any of the items in the <span class="code">list</span> do; that is, the filter implicitly performs a logical <span class="code"><strong>or</strong></span> operation on the items of the <span class="code">list</span> that is its argument value.)</p>
</div></section>
<section data-pdf-bookmark="name" data-type="sect4"><div class="sect4" id="name">
<h4>name</h4>
<p>To look for <span class="code">Tags</span> whose <span class="code">name</span> matches a filter, pass the filter as the first positional argument to the search method, or pass it as <span class="code">name=</span><span class="code"><em>filter</em></span>:</p>
<pre data-code-language="python" data-type="programlisting">
<em><code class="c1"># return all instances of Tag 'b' in the document</code></em><code>
</code><code class="n">soup</code><code class="o">.</code><code class="n">find_all</code><code class="p">(</code><code class="s1">'</code><code class="s1">b</code><code class="s1">'</code><code class="p">)</code><code> </code><em><code class="c1"># or soup.find_all(name='b')</code></em><code>
</code><code>
</code><em><code class="c1"># return all instances of Tags 'b' and 'bah' in the document</code></em><code>
</code><code class="n">soup</code><code class="o">.</code><code class="n">find_all</code><code class="p">(</code><code class="p">[</code><code class="s1">'</code><code class="s1">b</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">bah</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code>
</code><code>
</code><em><code class="c1"># return all instances of Tags starting with 'b' in the document</code></em><code>
</code><code class="n">soup</code><code class="o">.</code><code class="n">find_all</code><code class="p">(</code><code class="n">re</code><code class="o">.</code><code class="n">compile</code><code class="p">(</code><code class="sa">r</code><code class="s1">'</code><code class="s1">^b</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>
</code><code>
</code><em><code class="c1"># return all instances of Tags including string 'bah' in the document</code></em><code>
</code><code class="n">soup</code><code class="o">.</code><code class="n">find_all</code><code class="p">(</code><code class="n">re</code><code class="o">.</code><code class="n">compile</code><code class="p">(</code><code class="sa">r</code><code class="s1">'</code><code class="s1">bah</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>
</code><code>
</code><em><code class="c1"># return all instances of Tags whose parent's name is 'foo'</code></em><code>
</code><strong><code class="k">def</code></strong><code> </code><code class="nf">child_of_foo</code><code class="p">(</code><code class="n">tag</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><strong><code class="k">return</code></strong><code> </code><code class="n">tag</code><code class="o">.</code><code class="n">parent</code><code class="o">.</code><code class="n">name</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">foo</code><code class="s1">'</code><code>
</code><code>
</code><code class="n">soup</code><code class="o">.</code><code class="n">find_all</code><code class="p">(</code><code class="n">child_of_foo</code><code class="p">)</code></pre>
</div></section>
<section data-pdf-bookmark="string" data-type="sect4"><div class="sect4" id="string-id00004">
<h4>string</h4>
<p>To look for <span class="code">Tag</span> nodes whose <span class="code">.string</span>’s text matches a filter, or <span class="code">NavigableString</span> nodes whose text matches a filter, pass the filter as <span class="code">string=</span><span class="code"><em>filter</em></span>:</p>
<pre data-code-language="python" data-type="programlisting">
<em><code class="c1"># return all instances of NavigableString whose text is 'foo'</code></em><code>
</code><code class="n">soup</code><code class="o">.</code><code class="n">find_all</code><code class="p">(</code><code class="n">string</code><code class="o">=</code><code class="s1">'</code><code class="s1">foo</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>
</code><em><code class="c1"># return all instances of Tag 'b' whose .string's text is 'foo'</code></em><code>
</code><code class="n">soup</code><code class="o">.</code><code class="n">find_all</code><code class="p">(</code><code class="s1">'</code><code class="s1">b</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">string</code><code class="o">=</code><code class="s1">'</code><code class="s1">foo</code><code class="s1">'</code><code class="p">)</code></pre>
</div></section>
<section data-pdf-bookmark="attrs" data-type="sect4"><div class="sect4" id="attrs">
<h4>attrs</h4>
<p>To look for <span class="code">Tag</span> nodes that have attributes whose values match filters, use a <span class="code">dict</span> <span class="code"><em>d</em></span> with attribute names as keys, and filters as the corresponding values. Then, pass <span class="code"><em>d</em></span> as the second positional argument to the search method, or pass <span class="code">attrs=</span><span class="code"><em>d</em></span>.</p>
<p>As a special case, you can use, as a value in <span class="code"><em>d</em></span>, <span class="code"><strong>None</strong></span> instead of a filter; this matches nodes that <em>lack</em> the corresponding attribute.</p>
<p>As a separate special case, if the value <span class="code"><em>f</em></span> of <span class="code">attrs</span> is not a <span class="code">dict</span>, but a filter, that is equivalent to having <span class="code">attrs={'class':</span> <span class="code"><em>f</em></span><span class="code">}</span>. (This convenient shortcut helps because looking for tags with a certain CSS class is a frequent task.)</p>
<p>You cannot apply both special cases at once: to search for tags without any CSS class, you must explicitly pass <span class="code">attrs={'class':</span> <span class="code"><strong>None</strong></span><span class="code">}</span> (i.e., use the first special case, but not at the same time as the second one):</p>
<pre data-code-language="python" data-type="programlisting">
<em><code class="c1"># return all instances of Tag 'b' w/an attribute 'foo' and no 'bar'</code></em><code>
</code><code class="n">soup</code><code class="o">.</code><code class="n">find_all</code><code class="p">(</code><code class="s1">'</code><code class="s1">b</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="p">{</code><code class="s1">'</code><code class="s1">foo</code><code class="s1">'</code><code class="p">:</code><code> </code><strong><code class="kc">True</code></strong><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">bar</code><code class="s1">'</code><code class="p">:</code><code> </code><strong><code class="kc">None</code></strong><code class="p">}</code><code class="p">)</code></pre>
<div data-type="tip">
<h1>Matching Tags with Multiple CSS Classes</h1>
<p>Unlike most attributes, a tag’s <span class="code">'class'</span> attribute can have multiple values. These are shown in HTML as a space-separated string (e.g., <span class="code">'&lt;p class='foo bar baz'&gt;...'</span>), and in <span class="code">bs4</span> as a list of strings (e.g., <span class="code"><em>t</em></span><span class="code">['class']</span> being <span class="code">['foo', 'bar', 'baz']</span>).</p>
<p>When you filter by CSS class in any search method, the filter matches a tag if it matches <em>any</em> of the multiple CSS classes of such a tag.</p>
<p>To match tags by multiple CSS classes, you can write a custom function and pass it as the filter to the search method; or, if you don’t need other added functionality of search methods, you can eschew search methods and instead use the method <span class="code"><em>t</em></span><span class="code">.select</span>, covered in the following section, and go with the syntax of CSS selectors.</p>
</div>
</div></section>
<section data-pdf-bookmark="Other named arguments" data-type="sect4"><div class="sect4" id="other_named_arguments">
<h4>Other named arguments</h4>
<p>Named arguments, beyond those whose names are known to the search method, are taken to augment the constraints, if any, specified in <span class="code">attrs</span>. For example, calling a search method with <span class="code"><em>foo</em></span><span class="code">=<em>bar</em></span> is like calling<a contenteditable="false" data-primary="" data-startref="searmeth22" data-type="indexterm" id="idm44924483183872"/><a contenteditable="false" data-primary="" data-startref="BSPsearch22" data-type="indexterm" id="idm44924483182496"/> it with <span class="code">attrs={'</span><span class="code"><em>foo</em>':</span> <span class="code"><em>bar</em></span><span class="code">}</span>.</p>
</div></section>
</div></section>
</div></section>
<section data-pdf-bookmark="bs4 CSS Selectors" data-type="sect2"><div class="sect2" id="bsfour_css_selectors">
<h2>bs4 CSS Selectors</h2>
<p><span class="code">bs4</span> tags<a contenteditable="false" data-primary="BeautifulSoup package" data-secondary="CSS selectors" data-type="indexterm" id="idm44924483175488"/><a contenteditable="false" data-primary="CSS selectors" data-type="indexterm" id="idm44924483174080"/> supply the methods <span class="code">select</span> and <span class="code">select_one</span>, roughly equivalent to <span class="code">find_all</span> and <span class="code">find</span> but accepting as the single argument a string that is a <a href="https://oreil.ly/8bNZk">CSS selector</a> and returning, respectively, the list of <span class="code">Tag</span> nodes satisfying that selector or the first such <span class="code">Tag</span> node. For example:</p>
<pre data-code-language="python" data-type="programlisting">
<strong><code class="k">def</code></strong><code> </code><code class="nf">foo_child_of_bar</code><code class="p">(</code><code class="n">t</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><strong><code class="k">return</code></strong><code> </code><code class="n">t</code><code class="o">.</code><code class="n">name</code><code class="o">==</code><code class="s1">'</code><code class="s1">foo</code><code class="s1">'</code><code> </code><strong><code class="ow">and</code></strong><code> </code><code class="n">t</code><code class="o">.</code><code class="n">parent</code><code> </code><strong><code class="ow">and</code></strong><code> </code><code class="n">t</code><code class="o">.</code><code class="n">parent</code><code class="o">.</code><code class="n">name</code><code class="o">==</code><code class="s1">'</code><code class="s1">bar</code><code class="s1">'</code><code>
</code><code>
</code><em><code class="c1"># return tags with name 'foo' children of tags with name 'bar'</code></em><code>
</code><code class="n">soup</code><code class="o">.</code><code class="n">find_all</code><code class="p">(</code><code class="n">foo_child_of_bar</code><code class="p">)</code><code>
</code><code>
</code><em><code class="c1"># equivalent to using find_all(), with no custom filter function needed</code></em><code>
</code><code class="n">soup</code><code class="o">.</code><code class="n">select</code><code class="p">(</code><code class="s1">'</code><code class="s1">bar &gt; foo</code><code class="s1">'</code><code class="p">)</code></pre>
<p><span class="code">bs4</span> supports only a subset of the rich CSS selector functionality, and we do not cover CSS selectors further in this book. (For complete coverage of CSS, we recommend O’Reilly’s <a class="orm:hideurl" href="https://www.oreilly.com/library/view/css-the-definitive/9781449325053/"><em>CSS: The Definitive Guide</em></a>, by Eric Meyer and Estelle Weyl.) In most cases, the search methods covered in the previous section are better choices; however, in a few special cases, calling <span class="code">select</span> can save you the (small) trouble of writing a custom filter function.</p>
</div></section>
<section data-pdf-bookmark="An HTML Parsing Example with BeautifulSoup" data-type="sect2"><div class="sect2" id="an_html_parsing_example_with_beautifuls">
<h2>An HTML Parsing Example with BeautifulSoup</h2>
<p>The<a contenteditable="false" data-primary="BeautifulSoup package" data-secondary="parsing example" data-type="indexterm" id="idm44924483116368"/> following example uses <span class="code">bs4</span> to perform a typical task: fetch a page from the web, parse it, and output the HTTP hyperlinks in the page:</p>
<pre data-code-language="python" data-type="programlisting">
<strong><code class="kn">import</code></strong><code> </code><code class="nn">urllib</code><code class="nn">.</code><code class="nn">request</code><code class="o">,</code><code> </code><code class="nn">urllib</code><code class="nn">.</code><code class="nn">parse</code><code class="o">,</code><code> </code><code class="nn">bs4</code><code>
</code><code>
</code><code class="n">f</code><code> </code><code class="o">=</code><code> </code><code class="n">urllib</code><code class="o">.</code><code class="n">request</code><code class="o">.</code><code class="n">urlopen</code><code class="p">(</code><code class="s1">'</code><code class="s1">http://www.python.org</code><code class="s1">'</code><code class="p">)</code><code>
</code><code class="n">b</code><code> </code><code class="o">=</code><code> </code><code class="n">bs4</code><code class="o">.</code><code class="n">BeautifulSoup</code><code class="p">(</code><code class="n">f</code><code class="p">)</code><code>
</code><code>
</code><code class="n">seen</code><code> </code><code class="o">=</code><code> </code><code class="nb">set</code><code class="p">(</code><code class="p">)</code><code>
</code><strong><code class="k">for</code></strong><code> </code><code class="n">anchor</code><code> </code><strong><code class="ow">in</code></strong><code> </code><code class="n">b</code><code class="p">(</code><code class="s1">'</code><code class="s1">a</code><code class="s1">'</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="n">url</code><code> </code><code class="o">=</code><code> </code><code class="n">anchor</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s1">'</code><code class="s1">href</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>    </code><strong><code class="k">if</code></strong><code> </code><code class="n">url</code><code> </code><strong><code class="ow">is</code><code> </code><code class="kc">None</code><code> </code><code class="ow">or</code></strong><code> </code><code class="n">url</code><code> </code><strong><code class="ow">in</code></strong><code> </code><code class="n">seen</code><code class="p">:</code><code>
</code><code>        </code><strong><code class="k">continue</code></strong><code>
</code><code>    </code><code class="n">seen</code><code class="o">.</code><code class="n">add</code><code class="p">(</code><code class="n">url</code><code class="p">)</code><code>
</code><code>    </code><code class="n">pieces</code><code> </code><code class="o">=</code><code> </code><code class="n">urllib</code><code class="o">.</code><code class="n">parse</code><code class="o">.</code><code class="n">urlparse</code><code class="p">(</code><code class="n">url</code><code class="p">)</code><code>
</code><code>    </code><strong><code class="k">if</code></strong><code> </code><code class="n">pieces</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">startswith</code><code class="p">(</code><code class="s1">'</code><code class="s1">http</code><code class="s1">'</code><code class="p">)</code><code class="p">:</code><code>
</code><code>        </code><code class="nb">print</code><code class="p">(</code><code class="n">urllib</code><code class="o">.</code><code class="n">parse</code><code class="o">.</code><code class="n">urlunparse</code><code class="p">(</code><code class="n">pieces</code><code class="p">)</code><code class="p">)</code></pre>
<p>We first call the instance of class <span class="code">bs4.BeautifulSoup</span> (equivalent to calling its <span class="code">find_all</span> method) to obtain all instances of a certain tag (here, tag <span class="code">'&lt;a&gt;'</span>), then the <span class="code">get</span> method of instances of the tag in question to obtain the value of an attribute (here, <span class="code">'href'</span>), or <span class="code"><strong>None</strong></span> when that attribute is missing.<a contenteditable="false" data-primary="" data-startref="STbsoup22" data-type="indexterm" id="idm44924482968736"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Generating HTML" data-type="sect1"><div class="sect1" id="generating_html">
<h1>Generating HTML</h1>
<p>Python<a contenteditable="false" data-primary="structured text" data-secondary="HyperText Markup Language (HTML)" data-tertiary="generating HTML" data-type="indexterm" id="STgenhtml22"/><a contenteditable="false" data-primary="HTML (HyperText Markup Language)" data-type="indexterm" id="htmlgen22"/><a contenteditable="false" data-primary="HyperText Markup Language (HTML)" data-type="indexterm" id="hypegen22"/> does not come with tools specifically meant to generate HTML, nor with ones that let you embed Python code directly within HTML pages. Development and maintenance are eased by separating logic and presentation issues through <em>templating</em>, covered in <a data-type="xref" href="#templating">“Templating”</a>. An alternative is to use <span class="code">bs4</span> to create HTML documents in your Python code by gradually altering very minimal initial documents. Since these alterations rely on <span class="code">bs4</span> <em>parsing</em> some HTML, using different parsers affects the output, as mentioned in <a data-type="xref" href="#which_parser_beautifulsoup_uses">“Which parser BeautifulSoup uses”</a>.</p>
<section data-pdf-bookmark="Editing and Creating HTML with bs4" data-type="sect2"><div class="sect2" id="editing_and_creating_html_with_bsfour">
<h2>Editing and Creating HTML with bs4</h2>
<p>You<a contenteditable="false" data-primary="BeautifulSoup package" data-secondary="editing and creating HTML with" data-type="indexterm" id="BSPcrehtml22"/> have various options for editing an instance <span class="code"><em>t</em></span> of <span class="code">Tag</span>. You can alter the tag name by assigning to <span class="code"><em>t</em></span><span class="code">.name</span>, and you can alter <span class="code"><em>t</em></span>’s attributes by treating <span class="code"><em>t</em></span> as a mapping: assign to an indexing to add or change an attribute, or delete the indexing to remove an attribute (for example, <span class="code"><strong>del</strong></span> <span class="code"><em>t</em></span><span class="code">['foo']</span> removes the attribute <span class="code">foo</span>). If you assign some <span class="code">str</span> to <span class="code"><em>t</em></span><span class="code">.string</span>, all previous <span class="code"><em>t</em></span><span class="code">.contents</span> (<span class="code">Tag</span>s and/or strings—the whole subtree of <span class="code"><em>t</em></span>’s descendants) are discarded and replaced with a new <span class="code">NavigableString</span> instance with that <span class="code">str</span> as its textual content.</p>
<p>Given an instance <span class="code"><em>s</em></span> of <span class="code">NavigableString</span>, you can replace its textual content: calling <span class="code"><em>s</em></span><span class="code">.replace_with('other')</span> replaces <span class="code"><em>s</em></span>’s text with <span class="code">'other'</span>.</p>
<section data-pdf-bookmark="Building and adding new nodes" data-type="sect3"><div class="sect3" id="building_and_adding_new_nodes">
<h3>Building and adding new nodes</h3>
<p>Altering existing nodes is important, but creating new ones and adding them to the tree is crucial for building an HTML document from scratch.</p>
<p>To create a new <span class="code">NavigableString</span> instance, call the class with the text content as the single argument:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="n">s</code> <code class="o">=</code> <code class="n">bs4</code><code class="o">.</code><code class="n">NavigableString</code><code class="p">(</code><code class="s1">' some text '</code><code class="p">)</code></pre>
<p>To create a new <span class="code">Tag</span> instance, call the <span class="code">new_tag</span> method of a <span class="code">BeautifulSoup</span> instance, with the tag name as the single positional argument and (optionally) named arguments for attributes:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">soup</code> <code class="o">=</code> <code class="n">bs4</code><code class="o">.</code><code class="n">BeautifulSoup</code><code class="p">()</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">t</code> <code class="o">=</code> <code class="n">soup</code><code class="o">.</code><code class="n">new_tag</code><code class="p">(</code><code class="s1">'foo'</code><code class="p">,</code> <code class="n">bar</code><code class="o">=</code><code class="s1">'baz'</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">t</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>&lt;foo bar="baz"&gt;&lt;/foo&gt;</strong></pre>
<p>To add a node to the children of a <span class="code">Tag</span>, use the <span class="code">Tag</span>’s <span class="code">append</span> method. This adds the node after any existing children:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">t</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">s</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">t</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>&lt;foo bar="baz"&gt; some text &lt;/foo&gt;</strong></pre>
<p>If you want the new node to go elsewhere than at the end, at a certain index among <span class="code"><em>t</em></span>’s children, call <span class="code"><em>t</em></span><span class="code">.insert(<em>n, s</em>)</span> to put <span class="code"><em>s</em></span> at index <span class="code"><em>n</em></span> in <span class="code"><em>t</em></span><span class="code">.contents</span> (<span class="code"><em>t</em></span><span class="code">.append</span> and <span class="code"><em>t</em></span><span class="code">.insert</span> work as if <span class="code"><em>t</em></span> is a list of its children).</p>
<p>If you have a navigable element <span class="code"><em>b</em></span> and want to add a new node <span class="code"><em>x</em></span> as <span class="code"><em>b</em></span>’s <span class="code">previous_sibling</span>, call <span class="code"><em>b</em></span><span class="code">.insert_before(<em>x</em>)</span>. If instead you want <span class="code"><em>x</em></span> to become <span class="code"><em>b</em></span>’s <span class="code">next_sibling</span>, call <span class="code"><em>b</em></span><span class="code">.insert_after(<em>x</em>)</span>.</p>
<p>If you want to wrap a new parent node <span class="code"><em>t</em></span> around <span class="code"><em>b</em></span>, call <span class="code"><em>b</em></span><span class="code">.wrap(<em>t</em>)</span> (which also returns the newly wrapped tag). For example:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">t</code><code class="o">.</code><code class="n">string</code><code class="o">.</code><code class="n">wrap</code><code class="p">(</code><code class="n">soup</code><code class="o">.</code><code class="n">new_tag</code><code class="p">(</code><code class="s1">'moo'</code><code class="p">,</code> <code class="nb">zip</code><code class="o">=</code><code class="s1">'zaap'</code><code class="p">)))</code></pre>
<pre data-type="programlisting">
<strong>&lt;moo zip="zaap"&gt; some text &lt;/moo&gt;</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">t</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>&lt;foo bar="baz"&gt;&lt;moo zip="zaap"&gt; some text &lt;/moo&gt;&lt;/foo&gt;</strong></pre>
</div></section>
<section data-pdf-bookmark="Replacing and removing nodes" data-type="sect3"><div class="sect3" id="replacing_and_removing_nodes">
<h3>Replacing and removing nodes</h3>
<p>You can call <span class="code"><em>t</em></span><span class="code">.replace_with</span> on any tag <span class="code"><em>t</em></span>: the call replaces <span class="code"><em>t</em></span>, and all its previous contents, with the argument, and returns <span class="code"><em>t</em></span> with its original contents. For example:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">soup</code> <code class="o">=</code> <code class="n">bs4</code><code class="o">.</code><code class="n">BeautifulSoup</code><code class="p">(</code>
<code class="o">...</code>        <code class="s1">'&lt;p&gt;first &lt;b&gt;second&lt;/b&gt; &lt;i&gt;third&lt;/i&gt;&lt;/p&gt;'</code><code class="p">,</code> <code class="s1">'lxml'</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">i</code> <code class="o">=</code> <code class="n">soup</code><code class="o">.</code><code class="n">i</code><code class="o">.</code><code class="n">replace_with</code><code class="p">(</code><code class="s1">'last'</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">soup</code><code class="o">.</code><code class="n">b</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">i</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">soup</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>&lt;html&gt;&lt;body&gt;&lt;p&gt;first &lt;b&gt;second&lt;i&gt;third&lt;/i&gt;&lt;/b&gt; last&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</strong></pre>
<p>You can call <span class="code"><em>t</em></span><span class="code">.unwrap</span> on any tag <span class="code"><em>t</em></span>: the call replaces <span class="code"><em>t</em></span> with its contents, and returns <span class="code"><em>t</em></span> “emptied” (that is, without contents). For example:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">empty_i</code> <code class="o">=</code> <code class="n">soup</code><code class="o">.</code><code class="n">i</code><code class="o">.</code><code class="n">unwrap</code><code class="p">()</code>
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">soup</code><code class="o">.</code><code class="n">b</code><code class="o">.</code><code class="n">wrap</code><code class="p">(</code><code class="n">empty_i</code><code class="p">))</code></pre>
<pre data-type="programlisting">
<strong>&lt;i&gt;&lt;b&gt;secondthird&lt;/b&gt;&lt;/i&gt;</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">soup</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>&lt;html&gt;&lt;body&gt;&lt;p&gt;first &lt;i&gt;&lt;b&gt;secondthird&lt;/b&gt;&lt;/i&gt; last&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</strong></pre>
<p><span class="code"><em>t</em></span><span class="code">.clear</span> removes <span class="code"><em>t</em></span>’s contents, destroys them, and leaves <span class="code"><em>t</em></span> empty (but still in its original place in the tree). <span class="code"><em>t</em></span><span class="code">.decompose</span> removes and destroys both <span class="code"><em>t</em></span> itself, and its contents:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><em><code class="c1"># remove everything between &lt;i&gt; and &lt;/i&gt; but leave tags</code></em><code class="c1">	</code><code>
</code><code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><code class="n">soup</code><code class="o">.</code><code class="n">i</code><code class="o">.</code><code class="n">clear</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><code class="nb">print</code><code class="p">(</code><code class="n">soup</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>&lt;html&gt;&lt;body&gt;&lt;p&gt;first &lt;i&gt;&lt;/i&gt; last&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><em><code class="c1"># remove everything between &lt;p&gt; and &lt;/p&gt; incl. tags</code></em><code>
</code><code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><code class="n">soup</code><code class="o">.</code><code class="n">p</code><code class="o">.</code><code class="n">decompose</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><code class="nb">print</code><code class="p">(</code><code class="n">soup</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>&lt;html&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;</strong></pre>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><em><code class="c1"># remove &lt;body&gt; and &lt;/body&gt;</code></em><code>
</code><code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><code class="n">soup</code><code class="o">.</code><code class="n">body</code><code class="o">.</code><code class="n">decompose</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="o">&gt;&gt;</code><code class="o">&gt;</code><code> </code><code class="nb">print</code><code class="p">(</code><code class="n">soup</code><code class="p">)</code></pre>
<pre data-type="programlisting">
<strong>&lt;html&gt;&lt;/html&gt;</strong></pre>
<p>Lastly, <span class="code"><em>t</em></span><span class="code">.extract</span> extracts and returns <span class="code"><em>t</em></span> and its contents, but does not destroy anything.<a contenteditable="false" data-primary="" data-startref="BSPcrehtml22" data-type="indexterm" id="idm44924482412256"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Building HTML with bs4" data-type="sect2"><div class="sect2" id="building_html_with_bsfour">
<h2>Building HTML with bs4</h2>
<p>Here’s<a contenteditable="false" data-primary="BeautifulSoup package" data-secondary="building HTML with" data-type="indexterm" id="idm44924482409136"/> an example of how to use <span class="code">bs4</span>’s methods to generate HTML. Specifically, the following function takes a sequence of “rows” (sequences) and returns a string that’s an HTML table to display their values:</p>
<pre data-code-language="python" data-type="programlisting">
<strong><code class="k">def</code></strong><code> </code><code class="nf">mktable_with_bs4</code><code class="p">(</code><code class="n">seq_of_rows</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="n">tabsoup</code><code> </code><code class="o">=</code><code> </code><code class="n">bs4</code><code class="o">.</code><code class="n">BeautifulSoup</code><code class="p">(</code><code class="s1">'</code><code class="s1">&lt;table&gt;</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>    </code><code class="n">tab</code><code> </code><code class="o">=</code><code> </code><code class="n">tabsoup</code><code class="o">.</code><code class="n">table</code><code>
</code><code>    </code><strong><code class="k">for</code></strong><code> </code><code class="n">row</code><code> </code><strong><code class="ow">in</code></strong><code> </code><code class="n">seq_of_rows</code><code class="p">:</code><code>
</code><code>        </code><code class="n">tr</code><code> </code><code class="o">=</code><code> </code><code class="n">tabsoup</code><code class="o">.</code><code class="n">new_tag</code><code class="p">(</code><code class="s1">'</code><code class="s1">tr</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>        </code><code class="n">tab</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">tr</code><code class="p">)</code><code>
</code><code>        </code><strong><code class="k">for</code></strong><code> </code><code class="n">item</code><code> </code><strong><code class="ow">in</code></strong><code> </code><code class="n">row</code><code class="p">:</code><code>
</code><code>            </code><code class="n">td</code><code> </code><code class="o">=</code><code> </code><code class="n">tabsoup</code><code class="o">.</code><code class="n">new_tag</code><code class="p">(</code><code class="s1">'</code><code class="s1">td</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>            </code><code class="n">tr</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">td</code><code class="p">)</code><code>
</code><code>            </code><code class="n">td</code><code class="o">.</code><code class="n">string</code><code> </code><code class="o">=</code><code> </code><code class="nb">str</code><code class="p">(</code><code class="n">item</code><code class="p">)</code><code>
</code><code>    </code><strong><code class="k">return</code></strong><code> </code><code class="n">tab</code></pre>
<p>Here is an example using the function we just defined:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">example</code> <code class="o">=</code> <code class="p">(</code>
<code class="o">...</code>     <code class="p">(</code><code class="s1">'foo'</code><code class="p">,</code> <code class="s1">'g&gt;h'</code><code class="p">,</code> <code class="s1">'g&amp;h'</code><code class="p">),</code>
<code class="o">...</code>     <code class="p">(</code><code class="s1">'zip'</code><code class="p">,</code> <code class="s1">'zap'</code><code class="p">,</code> <code class="s1">'zop'</code><code class="p">),</code>
<code class="o">...</code> <code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">mktable_with_bs4</code><code class="p">(</code><code class="n">example</code><code class="p">))</code></pre>
<pre data-type="programlisting">
<strong>&lt;table&gt;&lt;tr&gt;&lt;td&gt;foo&lt;/td&gt;&lt;td&gt;g&amp;gt;h&lt;/td&gt;&lt;td&gt;g&amp;amp;h&lt;/td&gt;&lt;/tr&gt;</strong>
<strong>&lt;tr&gt;&lt;td&gt;zip&lt;/td&gt;&lt;td&gt;zap&lt;/td&gt;&lt;td&gt;zop&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</strong></pre>
<p>Note that <span class="code">bs4</span> automatically converts markup characters such as <span class="code">&lt;</span>, <span class="code">&gt;</span>, and <span class="code">&amp;</span> to their corresponding HTML entities; for example, <span class="code">'g&gt;h'</span> renders as <span class="code">'g&amp;gt;h'</span>.</p>
</div></section>
<section data-pdf-bookmark="Templating" data-type="sect2"><div class="sect2" id="templating">
<h2>Templating</h2>
<p>To<a contenteditable="false" data-primary="templating" data-type="indexterm" id="temp22"/> generate HTML, the best approach is often <em>templating</em>. You start with a <span class="keep-together"><em>template</em>—a</span> text string (often read from a file, database, etc.) that is almost valid HTML, but includes markers, known as<a contenteditable="false" data-primary="placeholders" data-type="indexterm" id="idm44924482224672"/> <em>placeholders</em>, where dynamically generated text must be inserted—and your program generates the needed text and substitutes it into the template.</p>
<p>In the simplest case, you can use markers of the form <span class="code">{<em>name</em>}</span>. Set the dynamically generated text as the value for key <span class="code">'<em>name</em>'</span> in some dictionary <span class="code"><em>d</em></span><em>.</em> The Python string formatting method <span class="code">.format</span> (covered in <a data-type="xref" href="ch09.xhtml#string_formatting">“String Formatting”</a>) lets you do the rest: when <span class="code"><em>t</em></span> is the template string, <span class="code"><em>t</em></span><span class="code">.format(<em>d</em>)</span> is a copy of the template with all values properly substituted.</p>
<p>In general, beyond substituting placeholders, you’ll also want to use conditionals, perform loops, and deal with other advanced formatting and presentation tasks; in the spirit of separating “business logic” from “presentation issues,” you’d prefer it if all of the latter were part of your templating. This is where dedicated third-party templating packages come in. There are many of them, but all of this book’s authors, having used and <a class="orm:hideurl" href="https://learning.oreilly.com/library/view/python-cookbook/0596001673/ch03s23.xhtml">authored</a> some in the past, currently prefer <a href="https://oreil.ly/PYYm5"><span class="code">jinja2</span></a>, covered next.</p>
</div></section>
<section data-pdf-bookmark="The jinja2 Package" data-type="sect2"><div class="sect2" id="the_jinjatwo_package">
<h2>The jinja2 Package</h2>
<p>For<a contenteditable="false" data-primary="jinja2 package" data-type="indexterm" id="jinja22"/> serious templating tasks, we recommend <span class="code">jinja2</span> (available on <a href="https://oreil.ly/1DgV9">PyPI</a>, like other third-party Python packages, so, easily installable with <span class="code"><strong>pip install jinja2</strong></span>).</p>
<p>The <a href="https://oreil.ly/w6IiV"><span class="code">jinja2</span> docs</a> are excellent and thorough, covering the templating language itself (conceptually modeled on Python, but with many differences to support embedding it in HTML, and the peculiar needs specific to presentation issues); the API your Python code uses to connect to <span class="code">jinja2</span>, and expand or extend it if necessary; as well as other issues, from installation to internationalization, from sandboxing code to porting from other templating engines—not to mention, precious tips and tricks.</p>
<p>In this section, we cover only a tiny subset of <span class="code">jinja2</span>’s power, just what you need to get started after installing it. We earnestly recommend studying <span class="code">jinja2</span>’s docs to get the huge amount of extra, useful information they effectively convey.</p>
<section data-pdf-bookmark="The jinja2.Environment class" data-type="sect3"><div class="sect3" id="the_jinjatwodotenvironment_class">
<h3>The jinja2.Environment class</h3>
<p>When you use <span class="code">jinja2</span>, there’s always an <span class="code">Environment</span> instance involved—in a few cases you could let it default to a generic “shared environment,” but that’s not recommended. Only in very advanced usage, when you’re getting templates from different sources (or with different templating language syntax), would you ever define multiple environments—usually, you instantiate a single <span class="code">Environment</span> instance <span class="code"><em>env</em></span>, good for all the templates you need to render.</p>
<p>You can customize <span class="code"><em>env</em></span> in many ways as you build it, by passing named arguments to its constructor (including altering crucial aspects of templating language syntax, such as which delimiters start and end blocks, variables, comments, etc.). The one named argument you’ll almost always pass in real-life use is <span class="code">loader</span> (the others are rarely set).</p>
<p>An environment’s <span class="code">loader</span> specifies where to load templates from, on request—usually some directory in a filesystem, or perhaps some database (you’d have to code a custom subclass of <span class="code">jinja2.Loader</span> for the latter purpose), but there are other possibilities. You need a <span class="code">loader</span> to let templates enjoy some of <span class="code">jinja2</span>’s most powerful features, such as <a href="https://oreil.ly/yhG7y"><em>template inheritance</em></a>.</p>
<p>You can equip <span class="code"><em>env</em></span>, as you instantiate it, with custom <a href="https://oreil.ly/ouZ9A">filters</a>, <a href="https://oreil.ly/2NL9l">tests</a>, <a href="https://oreil.ly/K4wHT">extensions</a>, and so on (each of those can also be added later).</p>
<p>In the examples presented later, we assume <span class="code"><em>env</em></span> was instantiated with nothing but <span class="code">loader=jinja2.FileSystemLoader('<em>/path/to/templates</em>')</span>, and not further enriched—in fact, for simplicity, we won’t even make use of the <span class="code">loader</span> argument.</p>
<p><span class="code"><em>env</em></span><span class="code">.get_template(<em>name</em>)</span> fetches, compiles, and returns an instance of <span class="code">jinja2.Template</span> based on what <span class="code">env.loader(<em>name</em>)</span> returns. In the examples at the end of this section, for simplicity, we’ll instead use the rarely warranted <span class="code">env.from_string(<em>s</em>)</span> to build an instance of <span class="code">jinja2.Template</span> from string <span class="code"><em>s</em></span>.</p>
</div></section>
<section data-pdf-bookmark="The jinja2.Template class" data-type="sect3"><div class="sect3" id="the_jinjatwodottemplate_class">
<h3>The jinja2.Template class</h3>
<p>An instance <span class="code"><em>t</em></span> of <span class="code">jinja2.Template</span> has many attributes and methods, but the one you’ll be using almost exclusively in real life is:</p>
<table class="border">
<tbody>
<tr>
<td class="width-15"><span class="code">render</span></td>
<td><span class="code"><em>t</em></span><span class="code">.render(...<em>context</em>...)</span><br/>
			The <span class="code"><em>context</em></span> argument(s) are the same you might pass to a <span class="code">dict</span> constructor—a mapping instance, and/or named arguments enriching and potentially overriding the mapping’s key-to-value connections.<br/>
<span class="code"><em>t</em></span><span class="code">.render(<em>context</em>)</span> returns a (Unicode) string resulting from the <span class="code"><em>context</em></span> arguments applied to the template <span class="code"><em>t</em></span>.</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="Building HTML with jinja2" data-type="sect3"><div class="sect3" id="building_html_with_jinjatwo">
<h3>Building HTML with jinja2</h3>
<p>Here’s an example of how to use a <span class="code">jinja2</span> template to generate HTML. Specifically, just like in <a data-type="xref" href="#building_html_with_bsfour">“Building HTML with bs4”</a>, the following function takes a sequence of “rows” (sequences) and returns an HTML table to display their values:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="n">TABLE_TEMPLATE</code><code> </code><code class="o">=</code><code> </code><code class="s1">'''</code><code class="se">\
</code><code class="s1">&lt;table&gt;</code><code class="s1">
</code><code class="s1">{</code><code class="si">% f</code><code class="s1">or s in s_of_s </code><code class="s1">%</code><code class="s1">}</code><code class="s1">
</code><code class="s1">  &lt;tr&gt;</code><code class="s1">
</code><code class="s1">  </code><code class="s1">{</code><code class="si">% f</code><code class="s1">or item in s </code><code class="s1">%</code><code class="s1">}</code><code class="s1">
</code><code class="s1">    &lt;td&gt;</code><code class="s1">{{</code><code class="s1">item}}&lt;/td&gt;</code><code class="s1">
</code><code class="s1">  </code><code class="s1">{</code><code class="si">% e</code><code class="s1">ndfor </code><code class="s1">%</code><code class="s1">}</code><code class="s1">
</code><code class="s1">  &lt;/tr&gt;</code><code class="s1">
</code><code class="s1">{</code><code class="si">% e</code><code class="s1">ndfor </code><code class="s1">%</code><code class="s1">}</code><code class="s1">
</code><code class="s1">&lt;/table&gt;</code><code class="s1">'''</code><code>
</code><strong><code class="k">def</code></strong><code> </code><code class="nf">mktable_with_jinja2</code><code class="p">(</code><code class="n">s_of_s</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="n">env</code><code> </code><code class="o">=</code><code> </code><code class="n">jinja2</code><code class="o">.</code><code class="n">Environment</code><code class="p">(</code><code>
</code><code>        </code><code class="n">trim_blocks</code><code class="o">=</code><strong><code class="kc">True</code></strong><code class="p">,</code><code>
</code><code>        </code><code class="n">lstrip_blocks</code><code class="o">=</code><strong><code class="kc">True</code></strong><code class="p">,</code><code>
</code><code>        </code><code class="n">autoescape</code><code class="o">=</code><strong><code class="kc">True</code></strong><code class="p">)</code><code>
</code><code>    </code><code class="n">t</code><code> </code><code class="o">=</code><code> </code><code class="n">env</code><code class="o">.</code><code class="n">from_string</code><code class="p">(</code><code class="n">TABLE_TEMPLATE</code><code class="p">)</code><code>
</code><code>    </code><strong><code class="k">return</code></strong><code> </code><code class="n">t</code><code class="o">.</code><code class="n">render</code><code class="p">(</code><code class="n">s_of_s</code><code class="o">=</code><code class="n">s_of_s</code><code class="p">)</code></pre>
<p>The function builds the environment with option <span class="code">autoescape=</span><span class="code"><strong>True</strong></span>, to automatically “escape” strings containing markup characters such as <span class="code">&lt;</span>, <span class="code">&gt;</span>, and <span class="code">&amp;</span>; for example, with <span class="code">autoescape=</span><span class="code"><strong>True</strong></span>, <span class="code">'g&gt;h'</span> renders as <span class="code">'g&amp;gt;h'</span>.</p>
<p>The options <span class="code">trim_blocks=</span><span class="code"><strong>True</strong></span> and <span class="code">lstrip_blocks=</span><span class="code"><strong>True</strong></span> are purely cosmetic, just to ensure that both the template string and the rendered HTML string can be nicely formatted; of course, when a browser renders HTML, it does not matter whether the HTML text itself is nicely formatted.</p>
<p>Normally, you would always build the environment with the <span class="code">loader</span> argument and have it load templates from files or other storage with method calls such as <span class="code"><em>t</em></span> <span class="code">=</span> <span class="code"><em>env</em></span><span class="code">.get_template(<em>template_name</em>)</span>. In this example, just to present everything in one place, we omit the loader and build the template from a string by calling the method <span class="code"><em>env</em></span><span class="code">.from_string</span> instead. Note that <span class="code">jinja2</span> is not HTML- or XML-specific, so its use alone does not guarantee the validity of the generated content, which you should carefully check if standards conformance is a requirement.</p>
<p>The example uses only the two most common features out of the many dozens that the <span class="code">jinja2</span> templating language offers: <em>loops</em> (that is, blocks enclosed in <span class="code">{% for ... %}</span> and <span class="code">{% endfor %}</span>) and <em>parameter substitution</em> (inline expressions enclosed in <span class="code">{{</span> and <span class="code">}}</span>).</p>
<p>Here is an example use of the function we just<a contenteditable="false" data-primary="" data-startref="jinja22" data-type="indexterm" id="idm44924481984608"/><a contenteditable="false" data-primary="" data-startref="temp22" data-type="indexterm" id="idm44924481983232"/><a contenteditable="false" data-primary="" data-startref="hypegen22" data-type="indexterm" id="idm44924481981856"/><a contenteditable="false" data-primary="" data-startref="htmlgen22" data-type="indexterm" id="idm44924481980480"/><a contenteditable="false" data-primary="" data-startref="STgenhtml22" data-type="indexterm" id="idm44924481979104"/> defined:</p>
<pre data-code-language="python" data-type="programlisting">
<code class="o">&gt;&gt;&gt;</code> <code class="n">example</code> <code class="o">=</code> <code class="p">(</code>
<code class="o">...</code>   <code class="p">(</code><code class="s1">'foo'</code><code class="p">,</code> <code class="s1">'g&gt;h'</code><code class="p">,</code> <code class="s1">'g&amp;h'</code><code class="p">),</code>
<code class="o">...</code>   <code class="p">(</code><code class="s1">'zip'</code><code class="p">,</code> <code class="s1">'zap'</code><code class="p">,</code> <code class="s1">'zop'</code><code class="p">),</code>
<code class="o">...</code> <code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">mktable_with_jinja2</code><code class="p">(</code><code class="n">example</code><code class="p">))</code></pre>
<pre data-type="programlisting">
<strong>&lt;table&gt;</strong>
<strong>  &lt;tr&gt;</strong>
<strong>    &lt;td&gt;foo&lt;/td&gt;</strong>
<strong>    &lt;td&gt;g&amp;gt;h&lt;/td&gt;</strong>
<strong>    &lt;td&gt;g&amp;amp;h&lt;/td&gt;</strong>
<strong>  &lt;/tr&gt;</strong>
<strong>  &lt;tr&gt;</strong>
<strong>    &lt;td&gt;zip&lt;/td&gt;</strong>
<strong>    &lt;td&gt;zap&lt;/td&gt;</strong>
<strong>    &lt;td&gt;zop&lt;/td&gt;</strong>
<strong>  &lt;/tr&gt;</strong>
<strong>&lt;/table&gt;</strong></pre>
</div></section>
</div></section>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="ch01fn158"><sup><a href="ch22.xhtml#ch01fn158-marker">1</a></sup> The <span class="code">BeautifulSoup</span> <a href="https://oreil.ly/B-xCI">documentation</a> provides detailed information about installing various parsers.</p><p data-type="footnote" id="ch01fn159"><sup><a href="ch22.xhtml#ch01fn159-marker">2</a></sup> As explained in the <span class="code">BeautifulSoup</span> <a href="https://oreil.ly/vTXcK">documentation</a>, which also shows various ways to guide, or completely override, <span class="code">BeautifulSoup</span>’s guesses about encoding.</p></div></div></section></div></body></html>