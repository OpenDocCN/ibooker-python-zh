<html><head></head><body><section data-pdf-bookmark="Chapter 1. The Modern Web" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch01">&#13;
<h1><span class="label">Chapter 1. </span>The Modern Web</h1>&#13;
&#13;
<blockquote>&#13;
<p>The <a data-primary="Berners-Lee, Tim" data-type="indexterm" id="id332"/>Web as I envisaged it, we have not seen it yet.&#13;
The future is still so much bigger than the past.</p>&#13;
<p data-type="attribution">Tim Berners-Lee</p>&#13;
</blockquote>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Preview" data-type="sect1"><div class="sect1" id="id295">&#13;
<h1>Preview</h1>&#13;
&#13;
<p>Once upon a time, the web was small and simple.&#13;
Developers had such fun throwing PHP, HTML, and MySQL calls&#13;
into single files and proudly telling everyone&#13;
to check out their website.&#13;
But the web grew over time&#13;
to zillions, nay, squillions of pages—and the early playground&#13;
became a metaverse of theme parks.</p>&#13;
&#13;
<p>In this chapter, I’ll point out some areas&#13;
that have become ever more relevant to the modern web:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Services and APIs</p>&#13;
</li>&#13;
<li>&#13;
<p>Concurrency</p>&#13;
</li>&#13;
<li>&#13;
<p>Layers</p>&#13;
</li>&#13;
<li>&#13;
<p>Data</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>The next chapter will show what Python offers in these areas.&#13;
After that, we’ll dive into the FastAPI web framework&#13;
and see what it has to offer.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before less_space" data-pdf-bookmark="Services and APIs" data-type="sect1"><div class="sect1" id="id3">&#13;
<h1>Services and APIs</h1>&#13;
&#13;
<p>The web is a great connecting fabric.&#13;
Although much activity still occurs on the&#13;
<em>content</em> side—HTML, JavaScript, images, and so on—there’s an increasing emphasis on the application programming interfaces (APIs)&#13;
that connect things.</p>&#13;
&#13;
<p>Commonly,&#13;
a web <em>service</em> <a data-primary="services" data-type="indexterm" id="id333"/>handles&#13;
low-level database access and middle-level business logic&#13;
(often lumped together as a <a data-primary="backend" data-type="indexterm" id="id334"/><em>backend</em>),&#13;
while JavaScript or mobile apps provide a rich top-level <a data-primary="frontend" data-type="indexterm" id="id335"/><em>frontend</em>&#13;
(interactive user interface).&#13;
These fore and aft worlds have become more complex and divergent,&#13;
usually requiring developers to specialize in one or the other.&#13;
It’s harder to be a <em>full stack</em> developer than it used to&#13;
be.<sup><a data-type="noteref" href="ch01.html#id336" id="id336-marker">1</a></sup></p>&#13;
&#13;
<p>These two worlds talk to each other using APIs.&#13;
In the modern web, API design is as important as&#13;
the design of websites themselves.&#13;
An <a data-primary="APIs (application programming interfaces)" data-secondary="defined" data-type="indexterm" id="id337"/>API is a contract, similar to a database schema.&#13;
Defining and modifying APIs is now a major job.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Kinds of APIs" data-type="sect2"><div class="sect2" id="id4">&#13;
<h2>Kinds of APIs</h2>&#13;
&#13;
<p>Each <a data-primary="APIs (application programming interfaces)" data-secondary="kinds of" data-type="indexterm" id="icd001"/>API defines the following:</p>&#13;
<dl>&#13;
<dt>Protocol</dt>&#13;
<dd>&#13;
<p>The control structure</p>&#13;
</dd>&#13;
<dt>Format</dt>&#13;
<dd>&#13;
<p>The content structure</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Multiple API methods have developed as technology&#13;
has evolved from isolated machines,&#13;
to multitasking systems,&#13;
to networked servers.&#13;
You’ll probably run across one or more of these at some point,&#13;
so the following is a brief summary before getting to&#13;
<em>HTTP</em> and its friends, which are featured in this book:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Before networking, an API usually meant a very close connection,&#13;
like a function call to a<a data-primary="libraries" data-type="indexterm" id="id338"/> <em>library</em> in the same language as your&#13;
application—say, calculating a square root in a math library.</p>&#13;
</li>&#13;
<li>&#13;
<p><em>Remote procedure calls (RPCs)</em> <a data-primary="RPCs (remote procedure calls)" data-type="indexterm" id="id339"/>were<a data-primary="remote procedure calls (RPCs)" data-type="indexterm" id="id340"/> invented to call&#13;
functions in other processes,&#13;
on the same machine or others,&#13;
as though they were in the&#13;
calling application.&#13;
A popular current example is <a data-primary="gRPC" data-type="indexterm" id="id341"/><a href="https://grpc.io">gRPC</a>.</p>&#13;
</li>&#13;
<li>&#13;
<p><em>Messaging</em> <a data-primary="messaging" data-type="indexterm" id="id342"/>sends small chunks of data in pipelines&#13;
among processes.&#13;
Messages may be verb-like commands&#13;
or may just indicate noun-like <em>events</em> of interest.&#13;
Current popular messaging solutions,&#13;
which vary broadly from toolkits to full servers,&#13;
include&#13;
<a data-primary="Apache Kafka" data-type="indexterm" id="id343"/><a data-primary="Kafka, Apache" data-type="indexterm" id="id344"/><a href="https://kafka.apache.org">Apache Kafka</a>,&#13;
<a data-primary="RabbitMQ" data-type="indexterm" id="id345"/><a href="https://www.rabbitmq.com">RabbitMQ</a>,&#13;
<a data-primary="NATS" data-type="indexterm" id="id346"/><a href="https://nats.io">NATS</a>,&#13;
and&#13;
<a data-primary="ZeroMQ" data-type="indexterm" id="id347"/><a href="https://zeromq.org">ZeroMQ</a>.&#13;
Communication can follow different patterns:</p>&#13;
<dl>&#13;
<dt><a data-primary="request-response" data-type="indexterm" id="id348"/>Request-response</dt>&#13;
<dd>&#13;
<p>One: one, like a web browser calling a web server.</p>&#13;
</dd>&#13;
<dt><a data-primary="pub-sub (publish-subscribe)" data-type="indexterm" id="id349"/>Publish-subscribe, or <em>pub-sub</em></dt>&#13;
<dd>&#13;
<p>A <em>publisher</em> emits messages,&#13;
and <em>subscribers</em> act on each according to some data in the message,&#13;
like a subject.</p>&#13;
</dd>&#13;
<dt><a data-primary="queues" data-type="indexterm" id="id350"/>Queues</dt>&#13;
<dd>&#13;
<p>Like pub-sub, but only one of a pool of subscribers&#13;
grabs the message and acts on it.</p>&#13;
</dd>&#13;
</dl>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Any of these may be used alongside a web service—for example, performing a slow backend task like sending an email&#13;
or creating a thumbnail image<a data-primary="APIs (application programming interfaces)" data-secondary="kinds of" data-startref="icd001" data-type="indexterm" id="id351"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="HTTP" data-type="sect2"><div class="sect2" id="id5">&#13;
<h2>HTTP</h2>&#13;
&#13;
<p><a data-primary="HTTP" data-type="indexterm" id="id352"/>Berners-Lee<a data-primary="Berners-Lee, Tim" data-type="indexterm" id="id353"/> proposed three components for his World Wide Web:</p>&#13;
<dl>&#13;
<dt><a data-primary="HTML" data-type="indexterm" id="id354"/>HTML</dt>&#13;
<dd>&#13;
<p>A language for displaying data</p>&#13;
</dd>&#13;
<dt>HTTP</dt>&#13;
<dd>&#13;
<p>A client-server protocol</p>&#13;
</dd>&#13;
<dt><a data-primary="URLs" data-type="indexterm" id="id355"/>URLs</dt>&#13;
<dd>&#13;
<p>An addressing scheme for web resources</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Although these seem obvious in retrospect,&#13;
they turned out to be a ridiculously useful combination.&#13;
As the web evolved, people experimented,&#13;
and some ideas, like the <code>IMG</code> tag, survived the Darwinian struggle.&#13;
And as needs became clearer,&#13;
people got serious about defining standards.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="REST(ful)" data-type="sect2"><div class="sect2" id="id6">&#13;
<h2>REST(ful)</h2>&#13;
&#13;
<p>One <a data-primary="RESTful API design" data-type="indexterm" id="icd002"/>chapter in <a data-primary="Fielding, Roy" data-type="indexterm" id="id356"/>Roy Fielding’s Ph.D.&#13;
<a href="https://oreil.ly/TwGmX">thesis</a> defined <em>Representational State Transfer (REST)</em>—an&#13;
<em>architectural style</em> for HTTP use.<sup><a data-type="noteref" href="ch01.html#id357" id="id357-marker">2</a></sup>&#13;
Although often referenced, it’s been largely&#13;
<a href="https://oreil.ly/bsSry">misunderstood</a>.</p>&#13;
&#13;
<p class="pagebreak-before">A roughly shared adaptation has evolved and dominates the modern web.&#13;
It’s called <em>RESTful</em>,&#13;
with these characteristics:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Uses HTTP and client-server protocol</p>&#13;
</li>&#13;
<li>&#13;
<p>Stateless (each connection is independent)</p>&#13;
</li>&#13;
<li>&#13;
<p>Cacheable</p>&#13;
</li>&#13;
<li>&#13;
<p>Resource-based</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>A <em>resource</em> <a data-primary="resources" data-type="indexterm" id="id358"/>is data that you can distinguish&#13;
and perform operations on.&#13;
A web service provides an <a data-primary="endpoints (routes)" data-type="indexterm" id="id359"/><em>endpoint</em>—a<a data-primary="routes (endpoints)" data-type="indexterm" id="id360"/> distinct URL and <a data-primary="HTTP verbs" data-type="indexterm" id="id361"/>HTTP <em>verb</em> (action)—for each feature that it wants to expose.&#13;
An endpoint is also called a <em>route</em>,&#13;
because it routes the URL to a function.</p>&#13;
&#13;
<p>Database users are familiar with the <em>CRUD</em>&#13;
acronym of procedures: <a data-primary="CRUD (create, read, update, delete)" data-type="indexterm" id="id362"/>create, read, update, delete.&#13;
The HTTP verbs are pretty CRUDdy:</p>&#13;
<dl>&#13;
<dt><code>POST</code></dt>&#13;
<dd>&#13;
<p>Create (write)</p>&#13;
</dd>&#13;
<dt><code>PUT</code></dt>&#13;
<dd>&#13;
<p>Modify completely (replace)</p>&#13;
</dd>&#13;
<dt><code>PATCH</code></dt>&#13;
<dd>&#13;
<p>Modify partially (update)</p>&#13;
</dd>&#13;
<dt><code>GET</code></dt>&#13;
<dd>&#13;
<p>Um, get (read, retrieve)</p>&#13;
</dd>&#13;
<dt><code>DELETE</code></dt>&#13;
<dd>&#13;
<p>Uh, delete</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>A client sends a<a data-primary="HTTP requests" data-type="indexterm" id="id363"/> <em>request</em> to a RESTful endpoint&#13;
with data in one of the following areas of an HTTP message:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Headers</p>&#13;
</li>&#13;
<li>&#13;
<p>The URL string</p>&#13;
</li>&#13;
<li>&#13;
<p>Query parameters</p>&#13;
</li>&#13;
<li>&#13;
<p>Body values</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>In turn, an <a data-primary="HTTP responses" data-type="indexterm" id="id364"/>HTTP <em>response</em> returns these:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>An integer&#13;
<a href="https://oreil.ly/oBena"><em>status code</em></a>&#13;
indicating the following:</p>&#13;
<dl>&#13;
<dt>100s</dt>&#13;
<dd>&#13;
<p>Info, keep going</p>&#13;
</dd>&#13;
<dt>200s</dt>&#13;
<dd>&#13;
<p>Success</p>&#13;
</dd>&#13;
<dt>300s</dt>&#13;
<dd>&#13;
<p>Redirection</p>&#13;
</dd>&#13;
<dt>400s</dt>&#13;
<dd>&#13;
<p>Client error</p>&#13;
</dd>&#13;
<dt>500s</dt>&#13;
<dd>&#13;
<p>Server error</p>&#13;
</dd>&#13;
</dl>&#13;
</li>&#13;
<li>&#13;
<p>Various headers</p>&#13;
</li>&#13;
<li>&#13;
<p>A body, which may be empty, single, or <em>chunked</em> (in successive pieces)</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>At least one status code is an Easter egg:&#13;
<code>418</code> (I’m a <a href="https://www.google.com/teapot">teapot</a>)&#13;
is supposed to be returned by a web-connected teapot,&#13;
if asked to brew <span class="keep-together">coffee</span>.</p>&#13;
&#13;
<figure><div class="figure" id="fig-teapot">&#13;
<img alt="fapi 01in01" src="assets/fapi_01in01.png" width="100"/>&#13;
<h6/>&#13;
</div></figure>&#13;
&#13;
<p>You’ll find many websites and books on RESTful API design,&#13;
all with useful rules of thumb.&#13;
This book will dole some out on the way<a data-primary="RESTful API design" data-startref="icd002" data-type="indexterm" id="id365"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="JSON and API Data Formats" data-type="sect2"><div class="sect2" id="id7">&#13;
<h2>JSON and API Data Formats</h2>&#13;
&#13;
<p><a data-primary="JSON (JavaScript Object Notation)" data-type="indexterm" id="id366"/>Frontend applications&#13;
can exchange plain ASCII text&#13;
with backend web services,&#13;
but how can you express data structures like lists of things?</p>&#13;
&#13;
<p>Just about when we really started to need it,&#13;
along came <em>JavaScript Object Notation (JSON)</em>—another simple idea that solves an important problem&#13;
and seems obvious with hindsight.&#13;
Although the <em>J</em> stands for <em>JavaScript</em>,&#13;
the syntax looks a lot like Python too.</p>&#13;
&#13;
<p>JSON has largely replaced older attempts like XML and SOAP.&#13;
In the rest of this book, you’ll see that&#13;
JSON is the default web service input and output format.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="JSON:API" data-type="sect2"><div class="sect2" id="id8">&#13;
<h2>JSON:API</h2>&#13;
&#13;
<p><a data-primary="JSON:API proposal" data-type="indexterm" id="id367"/>The combination of RESTful design and JSON data formats&#13;
is common now.&#13;
But some wiggle room still remains for ambiguity&#13;
and nerd tussles.&#13;
The recent <a href="https://jsonapi.org">JSON:API</a> proposal&#13;
aims to tighten specs a bit.&#13;
This book will use the loose RESTful approach,&#13;
but JSON:API or something similarly rigorous may be useful&#13;
if you have significant tussles.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="GraphQL" data-type="sect2"><div class="sect2" id="id9">&#13;
<h2>GraphQL</h2>&#13;
&#13;
<p><a data-primary="GraphQL" data-type="indexterm" id="id368"/>RESTful interfaces can be cumbersome for some purposes.&#13;
Facebook (now Meta) designed&#13;
<a href="https://graphql.org">Graph Query Language (<em>GraphQL</em>)</a>&#13;
to specify more flexible service queries.&#13;
I won’t go into GraphQL in this book,&#13;
but you may want to look into it if you find&#13;
RESTful design inadequate for your application.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Concurrency" data-type="sect1"><div class="sect1" id="id10">&#13;
<h1>Concurrency</h1>&#13;
&#13;
<p><a data-primary="concurrency" data-type="indexterm" id="icd003"/>Besides the growth of service orientation,&#13;
the rapid expansion of the number of connections to&#13;
web services requires ever better efficiency and scale.</p>&#13;
&#13;
<p>We want to reduce the following:</p>&#13;
<dl>&#13;
<dt>Latency</dt>&#13;
<dd>&#13;
<p>The up-front wait time</p>&#13;
</dd>&#13;
<dt>Throughput</dt>&#13;
<dd>&#13;
<p>The number of&#13;
bytes per second between the service and its callers</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>In the old web&#13;
days,<sup><a data-type="noteref" href="ch01.html#id369" id="id369-marker">3</a></sup>&#13;
people dreamed of&#13;
supporting hundreds of simultaneous connections,&#13;
then fretted about the “10K problem,”&#13;
and now assume millions at a time.</p>&#13;
&#13;
<p>The term <em>concurrency</em> doesn’t mean full parallelism.&#13;
Multiple processing isn’t occurring in the same nanosecond,&#13;
in a single CPU.&#13;
Instead, concurrency mostly avoids <a data-primary="busy waiting" data-type="indexterm" id="id370"/><em>busy waiting</em> (idling the CPU until a response is delivered).&#13;
CPUs are zippy, but networks and disks are&#13;
thousands to millions of times slower.&#13;
So, whenever we talk to a network or disk, we don’t&#13;
want to just sit there with a blank stare until it responds.</p>&#13;
&#13;
<p>Normal <a data-primary="Python" data-secondary="synchronous processing" data-type="indexterm" id="id371"/>Python execution is<a data-primary="synchronous processing" data-type="indexterm" id="id372"/> <em>synchronous</em>: one thing at a time,&#13;
in the order specified by the code.&#13;
Sometimes we want to be<a data-primary="asynchronous processing" data-type="indexterm" id="id373"/> <em>asynchronous</em>:&#13;
do a little of one thing,&#13;
then a little of another thing,&#13;
back to the first thing, and so on.&#13;
If all our code uses the CPU to calculate things (<em>CPU bound</em>),&#13;
there’s really no spare time to be asynchronous.&#13;
But if we perform something that makes the CPU wait for&#13;
an external thing to complete (I/O bound), we can be asynchronous.</p>&#13;
&#13;
<p>Asynchronous systems provide an<a data-primary="event loops" data-type="indexterm" id="id374"/> <em>event loop</em>:&#13;
requests for slow operations are sent and noted,&#13;
but we don’t hold up the CPU waiting for their responses.&#13;
Instead, some immediate processing is done&#13;
on each pass through the loop,&#13;
and any responses that came in during that time are handled&#13;
in the next pass.</p>&#13;
&#13;
<p>The effects can be dramatic.&#13;
Later in this book, you’ll see how FastAPI’s support&#13;
of asynchronous processing makes it much faster than typical&#13;
web frameworks.</p>&#13;
&#13;
<p>Asynchronous processing isn’t magic.&#13;
You still have to be careful to avoid doing too much&#13;
CPU-intensive work&#13;
during the event loop,&#13;
because that will slow down everything. Later in this book, you’ll see the uses of Python’s&#13;
<code>async</code> and <code>await</code> keywords,&#13;
and how FastAPI lets you mix&#13;
both synchronous and asynchronous&#13;
processing<a data-primary="concurrency" data-startref="icd003" data-type="indexterm" id="id375"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Layers" data-type="sect1"><div class="sect1" id="id11">&#13;
<h1>Layers</h1>&#13;
&#13;
<p><a data-primary="layers" data-type="indexterm" id="icd004"/><em>Shrek</em> fans may remember he noted his&#13;
layers of personality,&#13;
to which Donkey replied, “Like an onion?”</p>&#13;
&#13;
<figure><div class="figure" id="fig-onion">&#13;
<img alt="fapi 01in02" src="assets/fapi_01in02.png" width="100"/>&#13;
<h6/>&#13;
</div></figure>&#13;
&#13;
<p>Well, if ogres and tearful vegetables can have layers,&#13;
then so can software.&#13;
To manage size and complexity,&#13;
many applications have long used a so-called&#13;
<em>three-tier model</em><a data-primary="three-tier model" data-type="indexterm" id="id376"/>.<sup><a data-type="noteref" href="ch01.html#id377" id="id377-marker">4</a></sup>&#13;
This isn’t terribly new.&#13;
Terms differ,<sup><a data-type="noteref" href="ch01.html#id378" id="id378-marker">5</a></sup>&#13;
but for this book I’m using the following&#13;
simple separation of terms (see <a data-type="xref" href="#fig-vert-layers">Figure 1-1</a>):</p>&#13;
<dl>&#13;
<dt><a data-primary="Web layer" data-type="indexterm" id="id379"/>Web</dt>&#13;
<dd>&#13;
<p>Input/output layer over HTTP, which assembles client requests, calls the Service Layer, and returns responses</p>&#13;
</dd>&#13;
<dt><a data-primary="Service layer" data-type="indexterm" id="id380"/>Service</dt>&#13;
<dd>&#13;
<p>The business logic, which calls the Data layer when needed</p>&#13;
</dd>&#13;
<dt><a data-primary="Data layer" data-type="indexterm" id="id381"/>Data</dt>&#13;
<dd>&#13;
<p>Access to data stores and other services</p>&#13;
</dd>&#13;
<dt><a data-primary="Model box" data-type="indexterm" id="id382"/>Model</dt>&#13;
<dd>&#13;
<p>Data definitions shared by all layers</p>&#13;
</dd>&#13;
<dt>Web client</dt>&#13;
<dd>&#13;
<p>Web browser or other HTTP client-side software</p>&#13;
</dd>&#13;
<dt><a data-primary="databases" data-type="indexterm" id="id383"/>Database</dt>&#13;
<dd>&#13;
<p>The data store, often an SQL or NoSQL server</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="fig-vert-layers">&#13;
<img alt="fapi 0101" src="assets/fapi_0101.png"/>&#13;
<h6><span class="label">Figure 1-1. </span>Vertical layers<a data-primary="layers" data-secondary="vertical" data-type="indexterm" id="id384"/></h6>&#13;
</div></figure>&#13;
&#13;
<p>These components will help you scale your site&#13;
without having to start from scratch.&#13;
They’re not laws of quantum&#13;
mechanics,&#13;
so consider them guidelines for this book’s exposition.</p>&#13;
&#13;
<p>The layers talk to one another via <a data-primary="APIs (application programming interfaces)" data-secondary="communication between layers/boxes" data-type="indexterm" id="id385"/>APIs.&#13;
These can be simple function calls to separate Python modules,&#13;
but could access external code via any method.&#13;
As I showed earlier, this could include RPCs, messages, and so on.&#13;
In this book, I’m assuming a single web server,&#13;
with Python code importing other Python modules.&#13;
The separation and information hiding is handled by the modules.</p>&#13;
&#13;
<p>The <a data-primary="Web layer" data-type="indexterm" id="id386"/><em>Web layer</em> is the one that users see,&#13;
via <em>client</em> applications and APIs.&#13;
We’re usually talking about a RESTful web interface,&#13;
with URLs, and JSON-encoded requests and responses.&#13;
But alternative text&#13;
(or command-line interface, CLI)&#13;
clients <a data-primary="CLI (command-line interface)" data-type="indexterm" id="id387"/>also could be built alongside the Web layer.&#13;
Python Web code may import Service-layer modules&#13;
but should not import Data modules.</p>&#13;
&#13;
<p>The <a data-primary="Service layer" data-type="indexterm" id="id388"/><em>Service layer</em> contains the actual details of whatever this&#13;
website provides.&#13;
This layer essentially looks like a <em>library</em>.&#13;
It imports Data modules to access databases and external services&#13;
but should not know the details.</p>&#13;
&#13;
<p>The <a data-primary="Data layer" data-type="indexterm" id="id389"/><em>Data layer</em> provides the Service layer access to data,&#13;
through files or client calls to other services.&#13;
Alternative Data layers may also exist,&#13;
communicating with a single Service layer.</p>&#13;
&#13;
<p>The <a data-primary="Model box" data-type="indexterm" id="id390"/><em>Model box</em> isn’t an actual layer&#13;
but a source of data definitions shared by the layers.&#13;
This isn’t needed if you’re passing built-in Python&#13;
data structures among them.&#13;
As you will see, FastAPI’s inclusion of Pydantic&#13;
enables the definition of data structures with&#13;
many useful features.</p>&#13;
&#13;
<p class="pagebreak-before">Why make these divisions?&#13;
Among many reasons, each layer can be:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Written by specialists.</p>&#13;
</li>&#13;
<li>&#13;
<p>Tested in isolation.</p>&#13;
</li>&#13;
<li>&#13;
<p>Replaced or supplemented: you might add a second&#13;
Web layer, using a different API such as gRPC,&#13;
alongside a web one.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Follow one rule from <em>Ghostbusters</em>:&#13;
Don’t cross the streams.&#13;
That is, don’t let web details leak out of the Web layer,&#13;
or database details out of the Data layer.</p>&#13;
&#13;
<p>You can visualize&#13;
<em>layers</em> as a vertical stack<a data-primary="layers" data-secondary="vertical" data-type="indexterm" id="id391"/>,&#13;
like a cake in the Great British Bake Off.<sup><a data-type="noteref" href="ch01.html#id392" id="id392-marker">6</a></sup></p>&#13;
&#13;
<figure><div class="figure" id="fig-cake">&#13;
<img alt="fapi 01in03" src="assets/fapi_01in03.png" width="100"/>&#13;
<h6/>&#13;
</div></figure>&#13;
&#13;
<p>Here are some reasons for <a data-primary="layers" data-secondary="separation of" data-type="indexterm" id="id393"/>separation of the layers:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>If you don’t separate the layers, expect a hallowed web meme: <em>Now you have two problems</em>.</p>&#13;
</li>&#13;
<li>&#13;
<p>Once the layers are mixed, later separation will be <em>very</em> difficult.</p>&#13;
</li>&#13;
<li>&#13;
<p>You’ll need to know two or more specialties&#13;
to understand and write tests if code logic gets muddled.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>By the way,&#13;
even though I call them <em>layers</em>,&#13;
you don’t need to assume that one layer is&#13;
“above” or “below” another,&#13;
and that commands flow with gravity.&#13;
Vertical chauvinism!&#13;
You could also view layers as <a data-primary="layers" data-secondary="sideways-communicating boxes" data-type="indexterm" id="id394"/>sideways-communicating boxes (<a data-type="xref" href="#fig-horiz-layers">Figure 1-2</a>).</p>&#13;
&#13;
<figure><div class="figure" id="fig-horiz-layers">&#13;
<img alt="fapi 0102" src="assets/fapi_0102.png"/>&#13;
<h6><span class="label">Figure 1-2. </span>Sideways-communicating boxes</h6>&#13;
</div></figure>&#13;
&#13;
<p>However you visualize them,&#13;
the <em>only</em> communication paths between&#13;
the boxes/layers are the arrows <a data-primary="APIs (application programming interfaces)" data-secondary="communication between layers/boxes" data-type="indexterm" id="id395"/>(APIs).&#13;
This is important for testing and debugging.&#13;
If undocumented doors exist in a factory,&#13;
the night watchman will inevitably be surprised.</p>&#13;
&#13;
<p>The arrows between the web client and Web layer&#13;
use HTTP or HTTPS to transport mostly JSON text.&#13;
The arrows between the Data layer and database&#13;
use a database-specific protocol and carry SQL (or other) text.&#13;
The arrows between the layers themselves are function calls&#13;
carrying data models.</p>&#13;
&#13;
<p>Also, the recommended data formats flowing through the arrows are as follows:</p>&#13;
<dl>&#13;
<dt>Client ⇔ <a data-primary="Web layer" data-type="indexterm" id="id396"/>Web</dt>&#13;
<dd>&#13;
<p>RESTful HTTP with JSON</p>&#13;
</dd>&#13;
<dt>Web ⇔ <a data-primary="Service layer" data-type="indexterm" id="id397"/>Service</dt>&#13;
<dd>&#13;
<p>Models</p>&#13;
</dd>&#13;
<dt>Service ⇔ <a data-primary="Data layer" data-type="indexterm" id="id398"/>Data</dt>&#13;
<dd>&#13;
<p>Models</p>&#13;
</dd>&#13;
<dt>Data ⇔ Databases and services</dt>&#13;
<dd>&#13;
<p>Specific APIs</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Based on my own experience,&#13;
this is how I’ve chosen to structure the topics in this book.&#13;
It’s workable and has scaled to fairly complex sites,&#13;
but isn’t sacred.&#13;
You may have a better design!&#13;
However you do it,&#13;
these are the important points:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Separate domain-specific details.</p>&#13;
</li>&#13;
<li>&#13;
<p>Define standard APIs between the layers.</p>&#13;
</li>&#13;
<li>&#13;
<p>Don’t cheat; don’t leak.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Sometimes deciding&#13;
which layer is the best home for code is a challenge.&#13;
For example, <a data-type="xref" href="ch11.html#ch11">Chapter 11</a> looks at authentication and authorization requirements&#13;
and how to implement them—as an extra layer&#13;
between Web and Service,&#13;
or within one of them.&#13;
Software development is sometimes as much art as science.<a data-primary="layers" data-startref="icd004" data-type="indexterm" id="id399"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Data" data-type="sect1"><div class="sect1" id="id12">&#13;
<h1>Data</h1>&#13;
&#13;
<p><a data-primary="databases" data-type="indexterm" id="id400"/>The web has often been used as a&#13;
frontend to relational databases,&#13;
although many other ways of storing and accessing data&#13;
have evolved, such as&#13;
NoSQL or NewSQL databases.</p>&#13;
&#13;
<p>But beyond databases,&#13;
<em>machine learning (ML)</em>—<a data-primary="ML (machine learning)" data-type="indexterm" id="id401"/>or <a data-primary="deep learning" data-type="indexterm" id="id402"/><em>deep learning</em> or&#13;
just <em>AI</em><a data-primary="AI (artificial intelligence)" data-type="indexterm" id="id403"/>—is<a data-primary="artificial intelligence" data-see="AI" data-type="indexterm" id="id404"/> fundamentally remaking the technology landscape.&#13;
The development of large models requires <em>lots</em>&#13;
of messing with data, which has traditionally been called <a data-primary="ETL (extract, transform, load)" data-type="indexterm" id="id405"/>extract, transform, load (ETL).</p>&#13;
&#13;
<p>As a general-purpose service architecture,&#13;
the web can help with many of the fiddly bits of ML systems.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Review" data-type="sect1"><div class="sect1" id="id296">&#13;
<h1>Review</h1>&#13;
&#13;
<p>The web uses many APIs, but especially RESTful ones.&#13;
Asynchronous calls allow better concurrency,&#13;
which speeds up the overall process.&#13;
Web service applications are often large enough to divide into layers.&#13;
Data has become a major area in its own right.&#13;
All these concepts are addressed in the&#13;
Python programming language,&#13;
coming in the next chapter.</p>&#13;
</div></section>&#13;
<div data-type="footnotes"><p data-type="footnote" id="id336"><sup><a href="ch01.html#id336-marker">1</a></sup> I gave up trying a few years ago.</p><p data-type="footnote" id="id357"><sup><a href="ch01.html#id357-marker">2</a></sup> <em>Style</em> means a higher-level pattern, like <em>client-server</em>, rather than a specific design.</p><p data-type="footnote" id="id369"><sup><a href="ch01.html#id369-marker">3</a></sup> Around when caveman played hacky sack with giant ground sloths.</p><p data-type="footnote" id="id377"><sup><a href="ch01.html#id377-marker">4</a></sup> Choose your own dialect: tier/layer, tomato/tomahto/arigato.</p><p data-type="footnote" id="id378"><sup><a href="ch01.html#id378-marker">5</a></sup> You’ll often see the term <em>Model-View-Controller (MVC)</em> and <a data-primary="MVC (Model-View-Controller)" data-type="indexterm" id="id406"/>variations. Commonly accompanied by religious wars, toward which I’m agnostic.</p><p data-type="footnote" id="id392"><sup><a href="ch01.html#id392-marker">6</a></sup> As viewers know, if your layers get sloppy, you may not return to the tent the next week.</p></div></div></section></body></html>