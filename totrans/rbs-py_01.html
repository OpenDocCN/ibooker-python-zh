<html><head></head><body>
<section data-type="chapter" epub:type="chapter" class="preface" data-pdf-bookmark="Chapter 1. Introduction to Robust Python"><div class="preface" id="intro">
<h1 class="calibre10" id="calibre_pb_0"><span class="calibre">Chapter 1. </span>Introduction to Robust Python</h1>


<p class="author1">This book is all about making your Python more manageable. As your codebase grows, you need a specific toolbox of tips, tricks, and strategies to build maintainable code. This book will guide you toward fewer bugs and happier developers. You’ll be taking a hard look at how you write code, and you’ll learn the implications of your decisions. When discussing how code is written, I am reminded of these wise words from C.A.R. Hoare:</p>
<blockquote class="pcalibre2 calibre28 pcalibre1">
<p class="calibre29">There are two ways of constructing a software design: One way is to make it so simple that there are obviously no deficiencies, and the other way is to make it so complicated that there are no obvious deficiencies. The first method is far more difficult.<sup class="calibre11"><a data-type="noteref" id="idm45644759414136-marker" href="part0003_split_011.html#idm45644759414136" class="calibre5">1</a></sup></p></blockquote>

<p class="author1">This book is about developing systems the first way. It will be more difficult, yes, but have no fear. I will be your guide on your journey to leveling up your Python game such that, as C.A.R. Hoare says above, <em class="calibre6">there are obviously no deficiencies</em> in your code. Ultimately, this is a book all about writing <em class="calibre6">robust</em> Python.</p>

<p class="author1">In this chapter we’re going to cover what <em class="calibre6">robustness</em> means and why you should care about it. We’ll go through how your communication method implies certain benefits and drawbacks, and how best to represent your intentions. <a href="https://oreil.ly/SHq8i" class="calibre5">“The Zen of Python”</a> states that, when developing code, “There should be one -- and preferably only one -- obvious way to do it.” You’ll learn how to evaluate whether your code is written in an obvious way, and what you can do to fix it. First, we need to address the basics. What is <em class="calibre6">robustness</em> in the first place?<a data-type="indexterm" data-primary="robustness" id="ix_robu" class="calibre5"/></p>






</div></section>

<section data-type="chapter" epub:type="chapter" class="preface" data-pdf-bookmark="Chapter 1. Introduction to Robust Python">
<div class="preface" id="intro">
<section data-type="sect1" data-pdf-bookmark="Robustness" class="preface"><div class="preface" id="idm45644759406680">
<h1 class="calibre12" id="calibre_pb_1">Robustness</h1>

<p class="author1">Every book needs <a data-type="indexterm" data-primary="robustness" data-secondary="about" id="idm45644759404984" class="calibre5"/>at least one dictionary definition, so I’ll get this out of the way nice and early. Merriam-Webster offers many definitions for <a href="https://oreil.ly/2skKO" class="calibre5"><em class="calibre6">robustness</em></a>:</p>
<ol class="calibre30">
<li value="1" class="calibre31">
<p class="author1">having or exhibiting strength or vigorous health</p>
</li>
<li value="2" class="calibre31">
<p class="author1">having or showing vigor, strength, or firmness</p>
</li>
<li value="3" class="calibre31">
<p class="author1">strongly formed or constructed</p>
</li>
<li value="4" class="calibre31">
<p class="author1">capable of performing without failure under a wide range of conditions</p>
</li>

</ol>

<p class="author1">These are fantastic descriptions of what to aim for. We want a <em class="calibre6">healthy</em> system, one that meets expectations for years. We want our software to <em class="calibre6">exhibit strength</em>; it should be obvious that this code will stand the test of time. We want a <em class="calibre6">strongly constructed</em> system, one that is built upon solid foundations. Crucially, we want a system that is <em class="calibre6">capable of performing without failure</em>; the system should not become vulnerable as changes are introduced.</p>

<p class="author1">It is common to think of a software like a skyscraper, some grand structure that stands as a bulwark against all change and a paragon of immortality. The truth is, unfortunately, messier. Software systems constantly evolve. Bugs are fixed, user interfaces get tweaked, and features are added, removed, and then re-added. Frameworks shift, components go out of date, and security bugs arise. Software changes. Developing software is more akin to handling sprawl in city planning than it is constructing a static building. With ever changing codebases, how can you make your code robust? How can you build a strong foundation that is resilient to bugs?</p>

<p class="author1">The truth is, you have to accept change. Your code will be split apart, stitched together, and reworked. New use cases will alter huge swaths of code—and that’s OK.<a data-type="indexterm" data-primary="robustness" data-secondary="embracing change" id="idm45644759394840" class="calibre5"/> Embrace it. Understand that it’s not enough that your code can easily be changed; it might be best for it to be deleted and rewritten as it goes out of date. That doesn’t diminish its value; it will still have a long life in the spotlight. Your job is to make it easy to rewrite parts of the system. Once you start to accept the ephemeral nature of your code, you start to realize that it’s not enough to write bug-free code for the present; you need to enable the codebase’s future owners to be able to change your code with confidence. That is what this book is about.</p>

<p class="author1">You are going to learn to build strong systems. This strength doesn’t come from rigidity, as exhibited by a bar of iron. It instead comes from flexibility. Your code needs to be strong like a tall willow tree, swaying in the wind, flexing but not breaking. Your software will need to handle situations you would never dream of. Your codebase needs to be able to adapt to new circumstances, because it won’t always be you maintaining it. Those future maintainers need to know they are working in a healthy codebase. Your codebase needs to communicate its strength. You must write Python code in a way that reduces failure, even as future maintainers tear it apart and reconstruct it.</p>

<p class="author1">Writing robust code means deliberately thinking about the future. You want future maintainers to look at your code and understand your intentions easily, not curse your name during late-night debugging sessions. You must convey your thoughts, reasoning, and cautions. Future developers will need to bend your code into new shapes—and will want to do so without worrying that each change may cause it to collapse like a teetering house of cards.</p>

<p class="author1">Put simply, you don’t want your systems to fail, especially when the unexpected happens. Testing and quality assurance are huge parts of this, but neither of those bake quality completely in. They are more suited to illuminating gaps in expectations and offering a safety net. Instead, you must make your software stand the test of time.<a data-type="indexterm" data-primary="clean code" data-secondary="importance of" id="idm45644759390408" class="calibre5"/> In order to do that, you must write <em class="calibre6">clean and maintainable</em> code.</p>

<p class="author1">Clean code expresses its intent clearly and concisely, in that order. When you look at a line of code and say to yourself, “ah, that makes complete sense,” that’s an indicator of clean code.<a data-type="indexterm" data-primary="robustness" data-secondary="importance of clean code" id="idm45644759388216" class="calibre5"/> The more you have to step through a debugger, the more you have to look at a lot of other code to figure out what’s happening, the more you have to stop and stare at the code, the less clean it is. Clean code does not favor clever tricks if it makes the code unreadable to other developers. Just like C.A.R. Hoare said earlier, you do not want to make your code so obtuse that it will be difficult to understand upon visual inspection.</p>
<aside data-type="sidebar" epub:type="sidebar" class="calibre32"><div class="sidebar" id="idm45644759386472">
<h5 class="calibre33">The Importance of Clean Code</h5>
<p class="author1">Having clean code is paramount to having robust code; consider it table stakes for any meaningful project.<a data-type="indexterm" data-primary="functions" data-secondary="in clean code" data-secondary-sortas="clean" id="idm45644759384840" class="calibre5"/><a data-type="indexterm" data-primary="variables" data-secondary="naming well" id="idm45644759383592" class="calibre5"/> There are often specific practices tied to writing clean code, including:</p>

<ul class="printings">
<li class="calibre9">
<p class="author1">Organizing your code in an appropriately granular fashion</p>
</li>
<li class="calibre9">
<p class="author1">Providing good documentation</p>
</li>
<li class="calibre9">
<p class="author1">Naming your variables/functions/types well</p>
</li>
<li class="calibre9">
<p class="author1">Keeping functions short and simple</p>
</li>
</ul>

<p class="author1">While the motifs of clean code weave throughout this book, I will not be dedicating substantial time to these specific practices. There are other books that capture clean code practices much better. I recommend <em class="calibre6">Clean Code</em> by Robert C. Martin (Prentice Hall), <em class="calibre6">The Pragmatic Programmer</em> by Andy Hunt and Dave Thomas (Addison-Wesley), and <em class="calibre6">Code Complete</em> by Steve McConnell (Microsoft Press). All three of these books greatly improved my skills as a developer and are great resources for anyone looking to grow.</p>

<p class="author1">While you should absolutely strive to write code cleanly, you must be prepared to work in codebases that aren’t a shining example of cleanliness. Software development is a messy endeavor, and there will be times where the purity of clean code will be sacrificed for various reasons, both business and technical. Use the advice given <span class="calibre">in this book</span> to help drive toward cleaner code through discussions about <span class="calibre">maintainability</span>.<a data-type="indexterm" data-primary="robustness" data-secondary="maintainability of code" id="idm45644754055592" class="calibre5"/><a data-type="indexterm" data-primary="maintainable code" id="idm45644754054584" class="calibre5"/></p>
</div></aside>

<p class="author1">Maintainable code is code that…well, can be easily maintained. Maintenance begins immediately after the first commit and continues until not a single developer is looking at the project anymore. Developers will be fixing bugs, adding features, reading code, extracting code for use in other libraries, and more. Maintainable code makes these tasks frictionless. Software lives for years, if not decades. Focus on your maintainability <em class="calibre6">today</em>.</p>

<p class="author1">You don’t want to be the reason systems fail, whether you are actively working on them or not. You need to be proactive in making your system stand the test of time. You need a testing strategy to be your safety net, but you also need to be able to avoid falling in the first place. So with all that in mind, I offer my definition of robustness in terms of your codebase:</p>
<blockquote class="pcalibre2 calibre28 pcalibre1">
<p class="calibre29">A robust codebase is resilient and error-free in spite of constant change.</p></blockquote>








</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" class="preface" data-pdf-bookmark="Chapter 1. Introduction to Robust Python">
<div class="preface" id="intro">
<section data-type="sect1" data-pdf-bookmark="Robustness" class="preface">
<div class="preface" id="idm45644759406680">
<section data-type="sect2" data-pdf-bookmark="Why Does Robustness Matter?" class="preface"><div class="preface" id="idm45644754050968">
<h2 class="calibre34" id="calibre_pb_2">Why Does Robustness Matter?</h2>

<p class="author1">A lot of energy goes into making software do what it’s supposed to, but it’s not easy to know when you’re done.<a data-type="indexterm" data-primary="robustness" data-secondary="why it matters" id="idm45644754049336" class="calibre5"/> Development milestones are not easily predicted. Human factors such as UX, accessibility, and documentation only increase the complexity. Now add in testing to ensure that you’ve covered a slice of known and unknown behaviors, and you are looking at lengthy development cycles.</p>

<p class="author1">The purpose of software is to provide value. It is in every stakeholder’s interests to deliver that full value as early as possible. Given the uncertainty around some development schedules, there is often extra pressure to meet expectations. We’ve all been on the wrong end of an unrealistic schedule or deadline. Unfortunately, many of the tools to make software incredibly robust only add onto our development cycle in the short term.</p>

<p class="author1">It’s true that there is an inherent tension between immediate delivery of value and making code robust. If your software is “good enough,” why add even more complexity? To answer that, consider how often that piece of software will be iterated upon.<a data-type="indexterm" data-primary="software value" id="idm45644754046392" class="calibre5"/> Delivering software value is typically not a static exercise; it’s rare that a system provides value and is never modified again. Software is ever-evolving by its very nature. The codebase needs to be prepared to deliver value frequently and for long periods of time. This is where robust software engineering practices come into play. If you can’t painlessly deliver features quickly and without compromising quality, you need to re-evaluate techniques to make your code more maintainable.</p>

<p class="author1">If you deliver your system late, or broken, you incur real-time costs. Think through your codebase. Ask yourself what happens if your code breaks a year from now because someone wasn’t able to understand your code. How much value do you lose? Your value might be measured in money, time, or even lives. Ask yourself what happens if the value isn’t delivered on time? What are the repercussions? If the answers to these questions are scary, good news, the work you’re doing is valuable. But it also underscores why it’s so important to eliminate future errors.</p>

<p class="author1">Multiple developers work on the same codebase simlutaneously. Many software projects will outlast most of those developers. You need to find a way to communicate to the present and future developers, without having the benefit of being there in person to explain. Future developers will be building off of <em class="calibre6">your</em> decisions. Every false trail, every rabbit hole, and every yak-shaving<sup class="calibre11"><a data-type="noteref" id="idm45644754042936-marker" href="part0003_split_011.html#idm45644754042936" class="calibre5">2</a></sup> adventure will slow them down, which impedes value. You need empathy for those who come after you. You need to step into their shoes. This book is your gateway to thinking about your collaborators and maintainers. You need to think about sustainable engineering practices. You need to write code that lasts. The first step to making code that lasts is being able to communicate through your code. You need to make sure future developers understand your intent.<a data-type="indexterm" data-primary="robustness" data-startref="ix_robu" id="idm45644754040168" class="calibre5"/></p>
</div></section>





</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" class="preface" data-pdf-bookmark="Chapter 1. Introduction to Robust Python">
<div class="preface" id="intro">
<section data-type="sect1" data-pdf-bookmark="What’s Your Intent?" class="preface"><div class="preface" id="idm45644759406088">
<h1 class="calibre12" id="calibre_pb_3">What’s Your Intent?</h1>

<p class="author1">Why should you strive to write clean and maintainable code? <a data-type="indexterm" data-primary="intent" id="ix_int" class="calibre5"/>Why should you care so much about robustness? The heart of these answers lies in communication. You’re not delivering static systems. The code will continue to change. You also have to consider that maintainers change over time. Your goal, when writing code, is to deliver value. It’s also to write your code in such a way that other developers can deliver value just as quickly. In order to do that, you need to be able to communicate reasoning and intent without ever meeting your future maintainers.</p>

<p class="author1">Let’s take a look at a code block found in a hypothetical legacy system. I want you to estimate how long it takes for you to understand what this code is doing. It’s OK if you’re not familiar with all the concepts here, or if you feel like this code is convoluted (it intentionally is!).</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="c"># Take a meal recipe and change the number of servings</code>
<code class="c"># by adjusting each ingredient</code>
<code class="c"># A recipe's first element is the number of servings, and the remainder</code>
<code class="c"># of elements is (name, amount, unit), such as ("flour", 1.5, "cup")</code>
<code class="k">def</code> <code class="nf">adjust_recipe</code><code class="calibre17">(</code><code class="n">recipe</code><code class="calibre17">,</code> <code class="n">servings</code><code class="calibre17">):</code>
    <code class="n">new_recipe</code> <code class="calibre17">=</code> <code class="calibre17">[</code><code class="n">servings</code><code class="calibre17">]</code>
    <code class="n">old_servings</code> <code class="calibre17">=</code> <code class="n">recipe</code><code class="calibre17">[</code><code class="mi">0</code><code class="calibre17">]</code>
    <code class="n">factor</code> <code class="calibre17">=</code> <code class="n">servings</code> <code class="calibre17">/</code> <code class="n">old_servings</code>
    <code class="n">recipe</code><code class="calibre17">.</code><code class="n">pop</code><code class="calibre17">(</code><code class="mi">0</code><code class="calibre17">)</code>
    <code class="k">while</code> <code class="n">recipe</code><code class="calibre17">:</code>
        <code class="n">ingredient</code><code class="calibre17">,</code> <code class="n">amount</code><code class="calibre17">,</code> <code class="n">unit</code> <code class="calibre17">=</code> <code class="n">recipe</code><code class="calibre17">.</code><code class="n">pop</code><code class="calibre17">(</code><code class="mi">0</code><code class="calibre17">)</code>
        <code class="c"># please only use numbers that will be easily measurable</code>
        <code class="n">new_recipe</code><code class="calibre17">.</code><code class="n">append</code><code class="calibre17">((</code><code class="n">ingredient</code><code class="calibre17">,</code> <code class="n">amount</code> <code class="calibre17">*</code> <code class="n">factor</code><code class="calibre17">,</code> <code class="n">unit</code><code class="calibre17">))</code>
    <code class="k">return</code> <code class="n">new_recipe</code></pre>

<p class="author1">This function takes a recipe and adjusts every ingredient to handle a new number of servings. However, this code prompts many questions.</p>

<ul class="printings">
<li class="calibre9">
<p class="author1">What is the <code class="calibre17">pop</code> for?</p>
</li>
<li class="calibre9">
<p class="author1">What does <code class="calibre17">recipe[0]</code> signify? Why is that the old servings?</p>
</li>
<li class="calibre9">
<p class="author1">Why do I need a comment for numbers that will be easily measurable?</p>
</li>
</ul>

<p class="author1">This is a bit of questionable Python, for sure. I won’t blame you if you feel the need to rewrite it.  It looks much nicer written like this:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">def</code> <code class="nf">adjust_recipe</code><code class="calibre17">(</code><code class="n">recipe</code><code class="calibre17">,</code> <code class="n">servings</code><code class="calibre17">):</code>
    <code class="n">old_servings</code> <code class="calibre17">=</code> <code class="n">recipe</code><code class="calibre17">.</code><code class="n">pop</code><code class="calibre17">(</code><code class="mi">0</code><code class="calibre17">)</code>
    <code class="n">factor</code> <code class="calibre17">=</code> <code class="n">servings</code> <code class="calibre17">/</code> <code class="n">old_servings</code>
    <code class="n">new_recipe</code> <code class="calibre17">=</code> <code class="calibre17">{</code><code class="n">ingredient</code><code class="calibre17">:</code> <code class="calibre17">(</code><code class="n">amount</code><code class="calibre17">*</code><code class="n">factor</code><code class="calibre17">,</code> <code class="n">unit</code><code class="calibre17">)</code>
                  <code class="k">for</code> <code class="n">ingredient</code><code class="calibre17">,</code> <code class="n">amount</code><code class="calibre17">,</code> <code class="n">unit</code> <code class="calibre19">in</code> <code class="n">recipe</code><code class="calibre17">}</code>
    <code class="n">new_recipe</code><code class="calibre17">[</code><code class="s">"servings"</code><code class="calibre17">]</code> <code class="calibre17">=</code> <code class="n">servings</code>
    <code class="k">return</code> <code class="n">new_recipe</code></pre>

<p class="author1">Those who favor clean code probably prefer the second version (I certainly do). No raw loops.<a data-type="indexterm" data-primary="clean code" data-secondary="example of" id="idm45644758460728" class="calibre5"/> Variables do not mutate. I’m returning a dictionary instead of a list of tuples. All these changes can be seen as positive, depending on the circumstances. But I may have just introduced three subtle bugs.</p>

<ul class="printings">
<li class="calibre9">
<p class="author1">In the original code snippet, I was clearing out the original recipe. Now I am not. Even if it’s just one area of calling code that is relying on this behavior, I broke that calling code’s assumptions.</p>
</li>
<li class="calibre9">
<p class="author1">By returning a dictionary, I have removed the ability to have duplicate ingredients in a list. This might have an effect on recipes that have multiple parts (such as a main dish and a sauce) that both use the same ingredient.</p>
</li>
<li class="calibre9">
<p class="author1">If any of the ingredients are named “servings” I’ve just introduced a collision with naming.</p>
</li>
</ul>

<p class="author1">Whether these are bugs or not depends on two interrelated things: the original author’s intent and calling code. The author intended to solve a problem, but I am unsure of why they wrote the code the way they did. Why are they popping elements? Why is “servings” a tuple inside the list? Why is a list used? Presumably, the original author knew why, and communicated it locally to their peers. Their peers wrote calling code based on those assumptions, but as time wore on, that intent became lost. Without communication to the future, I am left with two options of maintaining this code:</p>

<ul class="printings">
<li class="calibre9">
<p class="author1">Look at all calling code and confirm that this behavior is not relied upon before implementing. Good luck if this is a public API for a library with external callers. I would spend a lot of time doing this, which would frustrate me.</p>
</li>
<li class="calibre9">
<p class="author1">Make the change and wait to see what the fallout is (customer complaints, broken tests, etc.). If I’m lucky, nothing bad will happen. If I’m not, I would spend a lot of time fixing use cases, which would frustrate me.</p>
</li>
</ul>

<p class="author1">Neither option feels productive in a maintenance setting (especially if I have to modify this code). I don’t want to waste time; I want to deal with my current task quickly and move on to the next one. It gets worse if I consider how to call this code. Think about how you interact with previously unseen code. You might see other examples of calling code, copy them to fit your use case, and never realize that you needed to pass a specific string called “servings” as the first element of your list.</p>

<p class="author1">These are the sorts of decisions that will make you scratch your head. We’ve all seen them in larger codebases. They aren’t written maliciously, but organically over time with the best intentions.<a data-type="indexterm" data-primary="maintainable code" data-secondary="developer's original intent and" id="idm45644758288904" class="calibre5"/> Functions start simple, but as use cases grow and multiple developers contribute, that code tends to morph and obscure original intent. This is a sure sign that maintainability is suffering. You need to express intent in your code up front.</p>

<p class="author1">So what if the original author made use of better naming patterns and better type usage? What would that code look like?</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">def</code> <code class="nf">adjust_recipe</code><code class="calibre17">(</code><code class="n">recipe</code><code class="calibre17">,</code> <code class="n">servings</code><code class="calibre17">):</code>
    <code class="sd">"""</code>
<code class="sd">    Take a meal recipe and change the number of servings</code>
<code class="sd">    :param recipe: a `Recipe` indicating what needs to be adusted</code>
<code class="sd">    :param servings: the number of servings</code>
<code class="sd">    :return Recipe: a recipe with serving size and ingredients adjusted</code>
<code class="sd">                    for the new servings</code>
<code class="sd">    """</code>
    <code class="c"># create a copy of the ingredients</code>
    <code class="n">new_ingredients</code> <code class="calibre17">=</code> <code class="nb">list</code><code class="calibre17">(</code><code class="n">recipe</code><code class="calibre17">.</code><code class="n">get_ingredients</code><code class="calibre17">())</code>
    <code class="n">recipe</code><code class="calibre17">.</code><code class="n">clear_ingredients</code><code class="calibre17">()</code>

    <code class="k">for</code> <code class="n">ingredient</code> <code class="calibre19">in</code> <code class="n">new_ingredients</code><code class="calibre17">:</code>
            <code class="n">ingredient</code><code class="calibre17">.</code><code class="n">adjust_propoprtion</code><code class="calibre17">(</code><code class="n">Fraction</code><code class="calibre17">(</code><code class="n">servings</code><code class="calibre17">,</code> <code class="n">recipe</code><code class="calibre17">.</code><code class="n">servings</code><code class="calibre17">))</code>
    <code class="k">return</code> <code class="n">Recipe</code><code class="calibre17">(</code><code class="n">servings</code><code class="calibre17">,</code> <code class="n">new_ingredients</code><code class="calibre17">)</code></pre>

<p class="author1">This looks much better, is better documented, and expresses original intent clearly. The original developer encoded their ideas directly into the code. From this snippet, you know the following is true:</p>

<ul class="printings">
<li class="calibre9">
<p class="author1">I am using a <code class="calibre17">Recipe</code> class. This allows me to abstract away certain operations.<a data-type="indexterm" data-primary="classes" id="idm45644758176024" class="calibre5"/> Presumably, inside the class itself there is an invariant that allows for duplicate ingredients. (I’ll talk more about classes and invariants in <a data-type="xref" href="part0014_split_000.html#classes" class="calibre5">Chapter 10</a>.) This provides a common vocabulary that makes the function’s behavior more explicit.</p>
</li>
<li class="calibre9">
<p class="author1">Servings are now an explicit part of a <code class="calibre17">Recipe</code> class, rather than needing to be the first element of the list, which was handled as a special case. This greatly simplifies calling code, and prevents inadvertent collisions.</p>
</li>
<li class="calibre9">
<p class="author1">It is very apparent that I want to clear out ingredients on the old recipe. No ambiguous reason for why I needed to do a <code class="calibre17">.pop(0)</code>.</p>
</li>
<li class="calibre9">
<p class="author1">Ingredients are a separate class, and handle <a href="https://oreil.ly/YxUHK" class="calibre5">fractions</a> rather than an explicit <code class="calibre17">float</code>. It’s clearer for all involved that I am dealing with fractional units, and can easily do things such as <code class="calibre17">limit_denominator()</code>, which can be called when people want to restrict measuring units (instead of relying on a comment).</p>
</li>
</ul>

<p class="author1">I’ve replaced variables with types, such as a recipe type and an ingredient type.<a data-type="indexterm" data-primary="variables" data-secondary="replacement with types" id="idm45644758167864" class="calibre5"/> I’ve also defined operations (<code class="calibre17">clear_ingredients</code>, <code class="calibre17">adjust_proportion</code>) to communicate my intent. By making these changes, I’ve made the code’s behavior crystal clear to future readers. They no longer have to come talk to me to understand the code. Instead, they comprehend what I’m doing without ever talking to me. This is <em class="calibre6">asynchronous communication</em> at its finest.<a data-type="indexterm" data-primary="intent" data-startref="ix_int" id="idm45644758165240" class="calibre5"/></p>








</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" class="preface" data-pdf-bookmark="Chapter 1. Introduction to Robust Python">
<div class="preface" id="intro">
<section data-type="sect1" data-pdf-bookmark="What’s Your Intent?" class="preface">
<div class="preface" id="idm45644759406088">
<section data-type="sect2" data-pdf-bookmark="Asynchronous Communication" class="preface"><div class="preface" id="idm45644758164136">
<h2 class="calibre34" id="calibre_pb_4">Asynchronous Communication</h2>

<p class="author1">It’s weird writing about asynchronous communication in a Python book without mentioning <code class="calibre17">async</code> and <code class="calibre17">await</code>. But<a data-type="indexterm" data-primary="asynchronous communication (real world)" id="ix_async" class="calibre5"/> I’m afraid I have to discuss asynchronous communication in a much more complex place: <em class="calibre6">the real world</em>.</p>

<p class="author1">Asynchronous communication means that producing information and consuming that information are independent of each other. There is a time gap between the production and consumption. It might be a few hours, as is the case of collaborators in different time zones. Or it might be years, as future maintainers try to do a deep dive into the inner workings of code. You can’t predict when somebody will need to understand your logic. You might not even be working on that codebase (or for that company) by the time they consume the information you produced.</p>

<p class="author1">Contrast that with <em class="calibre6">synchronous communication</em>. Synchronous communication is the exchange of ideas live (in real time). <a data-type="indexterm" data-primary="synchronous communication" id="idm45644758157592" class="calibre5"/>This form of direct communication is one of the best ways to express your thoughts but unfortunately, it doesn’t scale, and you won’t always be around to answer questions.<a data-type="indexterm" data-primary="communication methods, cost versus proximity" id="idm45644758156536" class="calibre5"/><a data-type="indexterm" data-primary="costs" data-secondary="for communication methods" data-secondary-sortas="comunication" id="idm45644758155832" class="calibre5"/></p>

<p class="author1">In order to evaluate how appropriate each method of communication is when trying to understand intentions, let’s look at two axes: proximity and cost.</p>

<p class="author1"><em class="calibre6">Proximity</em> is how close in time the communicators need to be in order for that communication to be fruitful.<a data-type="indexterm" data-primary="cost versus proximity in communication methods" id="idm45644758153224" class="calibre5"/><a data-type="indexterm" data-primary="proximity (in communication)" id="idm45644758152488" class="calibre5"/> Some methods of communication excel with real-time transfer of information. Other methods of communication excel at communicating years later.</p>

<p class="author1"><em class="calibre6">Cost</em> is the measure of effort to communicate. You must weigh the time and money expended to communicate with the value provided. Your future consumers then have to weigh the cost of consuming the information with the value they are trying to deliver. Writing code and not providing any other communication channels is your baseline; you have to do this to produce value. To evaluate additional communication channels’ cost, here is what I factor in:</p>
<dl class="calibre13">
<dt class="calibre14">Discoverability</dt>
<dd class="calibre15">
<p class="calibre16">How easy was it to find this information outside of a normal workflow? How ephemeral is the knowledge? Is it easy to search for information?</p>
</dd>
<dt class="calibre14">Maintenance cost</dt>
<dd class="calibre15">
<p class="calibre16">How accurate is the information? How often does it need to be updated? What goes wrong if this information is out of date?</p>
</dd>
<dt class="calibre14">Production cost</dt>
<dd class="calibre15">
<p class="calibre16">How much time and money went into producing the communication?</p>
</dd>
</dl>

<p class="author1">In <a data-type="xref" href="part0003_split_004.html#figure_1_1" class="calibre5">Figure 1-1</a>, I plot some common communication methods’ cost and proximity required, based on my own experience.</p>

<figure class="calibre36"><div id="figure_1_1" class="figure">
<h6 class="calibre37"><span class="calibre">Figure 1-1. </span>Plotting cost and proximity of communcation methods</h6>
</div></figure>

<p class="author1">There are four quadrants that make up the cost/proximity graph.</p>
<dl class="calibre13">
<dt class="calibre14">Low cost, high proximity required</dt>
<dd class="calibre15">
<p class="calibre16">These are cheap to produce and consume, but are not scalable across time.<a data-type="indexterm" data-primary="low cost, high proximity communications" id="idm45644758140184" class="calibre5"/> Direct communication and instant messaging are great examples of these methods. Treat these as snapshots of information in time; they are only valuable when the user is actively listening. Don’t rely on these methods to communicate to the future.</p>
</dd>
<dt class="calibre14">High cost, high proximity required</dt>
<dd class="calibre15">
<p class="calibre16">These are costly events, and often only happen once (such as meetings or conferences).<a data-type="indexterm" data-primary="high cost, high proximity communications" id="idm45644758137816" class="calibre5"/> These events should deliver a lot of value at the time of communication, because they do not provide much value to the future. How many times have you been to a meeting that felt like a waste of time? You’re feeling the direct loss of value. Talks require a multiplicative cost for each attendee (time spent, hosting space, logistics, etc.). Code reviews are rarely looked at once they are done.</p>
</dd>
<dt class="calibre14">High cost, low proximity required</dt>
<dd class="calibre15">
<p class="calibre16">These are costly, but that cost can be paid back over time in value delivered, due to the low proximity needed.<a data-type="indexterm" data-primary="high cost, low proximity communications" id="idm45644758135048" class="calibre5"/> Emails and agile boards contain a wealth of information, but are not discoverable by others. These are great for bigger concepts that don’t need frequent updates. It becomes a nightmare to try and sift through all the noise just to find the nugget of information you are looking for. Video recordings and design documentation are great for understanding snapshots in time, but are costly to keep updated. Don’t rely on these communication methods to understand day-to-day decisions.</p>
</dd>
<dt class="calibre14">Low cost, low proximity required</dt>
<dd class="calibre15">
<p class="calibre16">These are cheap to create, and are easily consumable.<a data-type="indexterm" data-primary="low cost, low proximity communications" id="idm45644758132408" class="calibre5"/> Code comments, version control history, and project READMEs all fall into this category, since they are adjacent to the source code we write. Users can view this communication years after it was produced. Anything that a developer encounters during their day-to-day workflow is inherently discoverable. These communication methods are a natural fit for the first place someone will look after the source code. However, your code is one of your best documentation tools, as it is the living record and single source of truth for your system.</p>
</dd>
</dl>
</div></section>





</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" class="preface" data-pdf-bookmark="Chapter 1. Introduction to Robust Python">
<div class="preface" id="intro">
<section data-type="sect1" data-pdf-bookmark="What’s Your Intent?" class="preface">
<div class="preface" id="idm45644759406088">
<section data-type="sect2" data-pdf-bookmark="Asynchronous Communication" class="preface">
<div class="preface" id="idm45644758164136">
<div data-type="note" epub:type="note" class="calibre21"><h1 class="calibre38" id="calibre_pb_5">Discussion Topic</h1>
<p class="author1">This plot in <a data-type="xref" href="part0003_split_004.html#figure_1_1" class="calibre5">Figure 1-1</a> was created based on generalized use cases. Think about the communication paths you and your organization use. Where would you plot them on the graph? How easy is it to consume accurate information? How costly is it to produce information? Your answers to these questions may result in a slightly different graph, but the single source of truth will be in the executable software you deliver.</p>
</div>

<p class="author1">Low cost, low proximity communication methods are the best tools for communicating to the future. You should strive to minimize the cost of production and of consumption of communication. You have to write software to deliver value anyway, so the lowest cost option is making your code your primary communication tool. Your codebase becomes the best possible option for expressing your decisions, opinions, and workarounds clearly.</p>

<p class="author1">However, for this assertion to hold true, the code has to be cheap to consume as well. Your intent has to come across clearly in your code. Your goal is to minimize the time needed for a reader of your code to understand it. Ideally, a reader does not need to read your implementation, but just your function signature. Through the use of good types, comments and variable names, it should be crystal clear what your code does.</p>
<aside data-type="sidebar" epub:type="sidebar" class="calibre32"><div class="sidebar" id="idm45644758126328">
<h5 class="calibre33">Self-Documenting Code</h5>
<p class="author1">The wrong response to <a data-type="xref" href="part0003_split_004.html#figure_1_1" class="calibre5">Figure 1-1</a> is “Self-documenting code is all I need!” Code should absolutely self-document <em class="calibre6">what</em> is being done, but can’t cover every use case of communication.<a data-type="indexterm" data-primary="documentation" data-secondary="self-documenting code" id="idm45644758123512" class="calibre5"/> For example, version control will give you a history of changes. Design documents discuss sweeping ideals that are not local to any one code file. Meetings (when done right) can be an important event for synchronizing plan execution. Talks are great for sharing ideas with a large audience all at once. While this book focuses on what you can do in your code, don’t throw away any other valuable means of communication.<a data-type="indexterm" data-primary="asynchronous communication (real world)" data-startref="ix_async" id="idm45644758096376" class="calibre5"/></p>
</div></aside>
</div></section>





</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" class="preface" data-pdf-bookmark="Chapter 1. Introduction to Robust Python">
<div class="preface" id="intro">
<section data-type="sect1" data-pdf-bookmark="Examples of Intent in Python" class="preface"><div class="preface" id="idm45644754038440">
<h1 class="calibre12" id="calibre_pb_6">Examples of Intent in Python</h1>

<p class="author1">Now that I’ve talked through what intent is and how it matters, let’s look at examples through a Python lens.<a data-type="indexterm" data-primary="intent" data-secondary="examples in Python" id="ix_intex" class="calibre5"/> How can you make sure that you are correctly expressing your intentions? I will take a look at two different examples of how a decision affects intentions: collections and iteration.</p>








</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" class="preface" data-pdf-bookmark="Chapter 1. Introduction to Robust Python">
<div class="preface" id="intro">
<section data-type="sect1" data-pdf-bookmark="Examples of Intent in Python" class="preface">
<div class="preface" id="idm45644754038440">
<section data-type="sect2" data-pdf-bookmark="Collections" class="preface"><div class="preface" id="idm45644758092472">
<h2 class="calibre34" id="calibre_pb_7">Collections</h2>

<p class="author1">When you pick a collection, you are communicating specific information. You must pick the right collection for the task at hand. Otherwise, maintainers will infer the wrong intention from your code.</p>

<p class="author1">Consider this code that takes a list of cookbooks and provides a mapping between authors and the number of books written:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">def</code> <code class="nf">create_author_count_mapping</code><code class="calibre17">(</code><code class="n">cookbooks</code><code class="calibre17">:</code> <code class="nb">list</code><code class="calibre17">[</code><code class="n">Cookbook</code><code class="calibre17">]):</code>
    <code class="n">counter</code> <code class="calibre17">=</code> <code class="calibre17">{}</code>
    <code class="k">for</code> <code class="n">cookbook</code> <code class="calibre19">in</code> <code class="n">cookbooks</code><code class="calibre17">:</code>
        <code class="k">if</code> <code class="n">cookbook</code><code class="calibre17">.</code><code class="n">author</code> <code class="calibre19">not</code> <code class="calibre19">in</code> <code class="n">counter</code><code class="calibre17">:</code>
            <code class="n">counter</code><code class="calibre17">[</code><code class="n">cookbook</code><code class="calibre17">.</code><code class="n">author</code><code class="calibre17">]</code> <code class="calibre17">=</code> <code class="mi">0</code>
        <code class="n">counter</code><code class="calibre17">[</code><code class="n">cookbook</code><code class="calibre17">.</code><code class="n">author</code><code class="calibre17">]</code> <code class="calibre17">+=</code> <code class="mi">1</code>
    <code class="k">return</code> <code class="n">counter</code></pre>

<p class="author1">What does my use of collections tell you? Why am I not passing a dictionary or a set? Why am I not returning a list? Based on my current usage of collections, here’s what you can assume:</p>

<ul class="printings">
<li class="calibre9">
<p class="author1">I pass in a list of cookbooks. There may be duplicate cookbooks in this list (I might be counting a shelf of cookbooks in a store with multiple copies).</p>
</li>
<li class="calibre9">
<p class="author1">I am returning a dictionary. Users can look up a specific author, or iterate over the entire dictionary. I do not have to worry about duplicate authors in the returned collection.</p>
</li>
</ul>

<p class="author1">What if I wanted to communicate that no duplicates should be passed into this function? A list communicates the wrong intention. Instead, I should have chosen a set to communicate that this code absolutely will not handle duplicates.</p>

<p class="author1">Choosing a collection tells readers about your specific intentions. Here’s a list of common collection types, and the intention they convey:</p>
<dl class="calibre13">
<dt class="calibre14">List</dt>
<dd class="calibre15">
<p class="calibre16">This is a collection to be iterated over.<a data-type="indexterm" data-primary="lists" id="idm45644758043592" class="calibre5"/> It is <em class="calibre6">mutable</em>: able to be changed at any time. Very rarely do you expect to be retrieving specific elements from the middle of the list (using a static list index). There may be duplicate elements. The cookbooks on a shelf might be stored in a list.</p>
</dd>
<dt class="calibre14">String</dt>
<dd class="calibre15">
<p class="calibre16">An immutable collection of characters.<a data-type="indexterm" data-primary="strings" id="idm45644758040776" class="calibre5"/> The name of a cookbook would be a string.</p>
</dd>
<dt class="calibre14">Generator</dt>
<dd class="calibre15">
<p class="calibre16">A collection to be iterated over, and never indexed into.<a data-type="indexterm" data-primary="generators" id="idm45644758038664" class="calibre5"/> Each element access is performed lazily, so it may take time and/or resources through each loop iteration. They are great for computationally expensive or infinite collections. An online database of recipes might be returned as a generator; you don’t want to fetch all the recipes in the world when the user is only going to look at the first 10 results of a search.</p>
</dd>
<dt class="calibre14">Tuple</dt>
<dd class="calibre15">
<p class="calibre16">An immutable collection.<a data-type="indexterm" data-primary="tuples" id="idm45644758036168" class="calibre5"/> You do not expect it to change, so it is more likely to extract specific elements from the middle of the tuple (either through indices or unpacking). It is very rarely iterated over. The information about a specific cookbook might be represented as a tuple, such as <code class="calibre17">(cookbook_name, author, pagecount)</code>.</p>
</dd>
<dt class="calibre14">Set</dt>
<dd class="calibre15">
<p class="calibre16">An iterable collection that contains no duplicates.<a data-type="indexterm" data-primary="sets" id="idm45644758033304" class="calibre5"/> You cannot rely on ordering of elements. The ingredients in a cookbook might be stored as a set.</p>
</dd>
<dt class="calibre14">Dictionary</dt>
<dd class="calibre15">
<p class="calibre16">A mapping from keys to values.<a data-type="indexterm" data-primary="dictionaries" id="idm45644758031032" class="calibre5"/> Keys are unique across the dictionary. Dictionaries are typically iterated over, or indexed into using dynamic keys. A cookbook’s index is a great example of a key to value mapping (from topic to page number.)</p>
</dd>
</dl>

<p class="author1">Do not use the wrong collection for your purposes. Too many times have I come across a list that should not have had duplicates or a dictionary that wasn’t actually being used to map keys to values. Every time there is a disconnect between what you intend and what is in code, you create a maintenance burden. Maintainers must pause, work out what you really meant, and then work around their faulty assumptions (and your faulty assumptions, too).</p>
<aside data-type="sidebar" epub:type="sidebar" class="calibre32"><div class="sidebar" id="idm45644758029000">
<h5 class="calibre33">Dynamic Versus Static Indexing</h5>
<p class="author1">Depending on the collection type you are using, you may or may not want to use a <em class="calibre6">static index</em>. <a data-type="indexterm" data-primary="indexing" data-secondary="dynamic versus static, for collections" id="idm45644758026776" class="calibre5"/>A static index is what you get when you use a constant literal to index into the collection, such as <code class="calibre17">my_list[4]</code> or <code class="calibre17">my_dict["Python"]</code>. In general, lists and dictionaries will not often need a use case for this. You have no guarantee that the collection has the element you are looking for at that index, due to their dynamic nature. If you are looking for specific fields in these types of collections, this is a good sign that you need a user-defined type (explored in Chapters <a data-type="xref" data-xrefstyle="select:labelnumber" href="part0012_split_000.html#enum" class="calibre5">8</a>, <a data-type="xref" data-xrefstyle="select:labelnumber" href="part0013_split_000.html#dataclasses" class="calibre5">9</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="part0014_split_000.html#classes" class="calibre5">10</a>). It is safe to statically index into a tuple, since they are fixed size. Sets and generators are never indexed into.</p>

<p class="author1">Exceptions to this rule include:</p>

<ul class="printings">
<li class="calibre9">
<p class="author1">Getting the first or last element of a sequence (<code class="calibre17">my_list[0]</code> or <code class="calibre17">my_list[-1]</code>)</p>
</li>
<li class="calibre9">
<p class="author1">Using a dictionary as an intermediate data type such as when reading JSON or YAML</p>
</li>
<li class="calibre9">
<p class="author1">Operations on a sequence dealing specifically with fixed chunks (e.g., always splitting after the third element or checking for a specific character in a fixed-format string)</p>
</li>
<li class="calibre9">
<p class="author1">Performance reasons for a specific collection type</p>
</li>
</ul>

<p class="author1">In contrast, <em class="calibre6">dynamic indexing</em> occurs whenever <a data-type="indexterm" data-primary="dynamic versus static indexing of collections" id="idm45644758014040" class="calibre5"/>you index into a collection with a variable that is not known until runtime. This is the most appropriate choice for lists and dictionaries. You’ll see this when iterating over collections or searching for a specific element with an <code class="calibre17">index()</code> function.</p>
</div></aside>

<p class="author1">These are basic collections, but there are more ways to express intent. Here are some special collection types that are even more expressive in communicating to the future:</p>
<dl class="calibre13">
<dt class="calibre14"><code class="calibre17">frozenset</code></dt>
<dd class="calibre15">
<p class="calibre16">A set that is immutable.</p>
</dd>
<dt class="calibre14"><code class="calibre17">OrderedDict</code></dt>
<dd class="calibre15">
<p class="calibre16">A dictionary that preserves order of elements based on insertion time. As of <span class="calibre">CPython</span> 3.6 and Python 3.7, built-in dictionaries will also preserve order of elements based on insertion of time.</p>
</dd>
<dt class="calibre14"><code class="calibre17">defaultdict</code></dt>
<dd class="calibre15">
<p class="calibre16">A dictionary that provides a default value if the key is missing. For example, I could rewrite my earlier example as follows:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">from</code> <code class="nn">collections</code> <code class="k">import</code> <code class="n">defaultdict</code>
<code class="k">def</code> <code class="nf">create_author_count_mapping</code><code class="calibre17">(</code><code class="n">cookbooks</code><code class="calibre17">:</code> <code class="n">List</code><code class="calibre17">[</code><code class="n">Cookbook</code><code class="calibre17">]):</code>
    <code class="n">counter</code> <code class="calibre17">=</code> <code class="n">defaultdict</code><code class="calibre17">(</code><code class="k">lambda</code><code class="calibre17">:</code> <code class="mi">0</code><code class="calibre17">)</code>
    <code class="k">for</code> <code class="n">cookbook</code> <code class="calibre19">in</code> <code class="n">cookbooks</code><code class="calibre17">:</code>
        <code class="n">counter</code><code class="calibre17">[</code><code class="n">cookbook</code><code class="calibre17">.</code><code class="n">author</code><code class="calibre17">]</code> <code class="calibre17">+=</code> <code class="mi">1</code>
    <code class="k">return</code> <code class="n">counter</code></pre>

<p class="calibre16">This introduces a new behavior for end users—if they query the dictionary for a value that doesn’t exist, they will receive a 0. This might be beneficial in some use cases, but if it’s not, you can just return <code class="calibre17">dict(counter)</code> instead.</p>
</dd>
<dt class="calibre14"><code class="calibre17">Counter</code></dt>
<dd class="calibre15">
<p class="calibre16">A special type of dictionary used for counting how many times an element appears. This greatly simplifies our above code to the following:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">from</code> <code class="nn">collections</code> <code class="k">import</code> <code class="n">Counter</code>
<code class="k">def</code> <code class="nf">create_author_count_mapping</code><code class="calibre17">(</code><code class="n">cookbooks</code><code class="calibre17">:</code> <code class="n">List</code><code class="calibre17">[</code><code class="n">Cookbook</code><code class="calibre17">]):</code>
    <code class="k">return</code> <code class="n">Counter</code><code class="calibre17">(</code><code class="n">book</code><code class="calibre17">.</code><code class="n">author</code> <code class="k">for</code> <code class="n">book</code> <code class="calibre19">in</code> <code class="n">cookbooks</code><code class="calibre17">)</code></pre>
</dd>
</dl>

<p class="author1">Take a minute to reflect on that last example. Notice how using a <code class="calibre17">Counter</code> gives us much more concise code without sacrificing readability. If your readers are familiar with <code class="calibre17">Counter</code>, the meaning of this function (and how the implementation works) is immediately apparent. This is a great example of communicating intent to the <span class="calibre">future through</span> better selection of collection types. I’ll explore collections further in <a data-type="xref" href="part0008_split_000.html#collections" class="calibre5">Chapter 5</a>.</p>

<p class="author1">There are plenty of additional types to explore, including <code class="calibre17">array</code>, <code class="calibre17">bytes</code>, and <code class="calibre17">range</code>. Whenever you come across a new collection type, built-in or otherwise, ask yourself how it differs from other collections and what it conveys to future readers.</p>
</div></section>













</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" class="preface" data-pdf-bookmark="Chapter 1. Introduction to Robust Python">
<div class="preface" id="intro">
<section data-type="sect1" data-pdf-bookmark="Examples of Intent in Python" class="preface">
<div class="preface" id="idm45644754038440">
<section data-type="sect2" data-pdf-bookmark="Iteration" class="preface"><div class="preface" id="idm45644758091880">
<h2 class="calibre34" id="calibre_pb_8">Iteration</h2>

<p class="author1">Iteration is another example where the abstraction you choose dictates the intent you convey.</p>

<p class="author1">How many times have you seen code like this?</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="n">text</code> <code class="calibre17">=</code> <code class="s">"This is some generic text"</code>
<code class="n">index</code> <code class="calibre17">=</code> <code class="mi">0</code>
<code class="k">while</code> <code class="n">index</code> <code class="calibre17">&lt;</code> <code class="nb">len</code><code class="calibre17">(</code><code class="n">text</code><code class="calibre17">):</code>
    <code class="k">print</code><code class="calibre17">(</code><code class="n">text</code><code class="calibre17">[</code><code class="n">index</code><code class="calibre17">])</code>
    <code class="n">index</code> <code class="calibre17">+=</code> <code class="mi">1</code></pre>

<p class="author1">This simple code prints each character on a separate line. This is perfectly fine for a first pass at Python for this problem, but the solution quickly evolves into the more <em class="calibre6">Pythonic</em> (code written in an idiomatic style that aims to emphasize simplicity and is recognizable to most Python developers):</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">for</code> <code class="n">character</code> <code class="calibre19">in</code> <code class="n">text</code><code class="calibre17">:</code>
    <code class="k">print</code><code class="calibre17">(</code><code class="n">character</code><code class="calibre17">)</code></pre>

<p class="author1">Take a moment and reflect on why this option is preferable. The <code class="calibre17">for</code> loop is a more appropriate choice; it communicates intentions more clearly. Just like collection types, the looping construct you select explicitly communicates different concepts. Here’s a list of some common looping constructs and what they convey:</p>
<dl class="calibre13">
<dt class="calibre14"><code class="calibre17">for</code> loops</dt>
<dd class="calibre15">
<p class="calibre16"><code class="calibre17">for</code> loops are used for iterating over each element in a collection or range and performing an action/side effect.</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">for</code> <code class="n">cookbook</code> <code class="calibre19">in</code> <code class="n">cookbooks</code><code class="calibre17">:</code>
    <code class="k">print</code><code class="calibre17">(</code><code class="n">cookbook</code><code class="calibre17">)</code></pre>
</dd>
<dt class="calibre14"><code class="calibre17">while</code> loops</dt>
<dd class="calibre15">
<p class="calibre16"><code class="calibre17">while</code> loops are used for iterating as long as a certain condition is true.</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">while</code> <code class="n">is_cookbook_open</code><code class="calibre17">(</code><code class="n">cookbook</code><code class="calibre17">):</code>
    <code class="n">narrate</code><code class="calibre17">(</code><code class="n">cookbook</code><code class="calibre17">)</code></pre>
</dd>
<dt class="calibre14">Comprehensions</dt>
<dd class="calibre15">
<p class="calibre16">Comprehensions are used for transforming one collection into another (normally, this does not have side effects, especially if the comprehension is lazy).</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="n">authors</code> <code class="calibre17">=</code> <code class="calibre17">[</code><code class="n">cookbook</code><code class="calibre17">.</code><code class="n">author</code> <code class="k">for</code> <code class="n">cookbook</code> <code class="calibre19">in</code> <code class="n">cookbooks</code><code class="calibre17">]</code></pre>
</dd>
<dt class="calibre14">Recursion</dt>
<dd class="calibre15">
<p class="calibre16">Recursion is used when the substructure of a collection is identical to the structure of a collection (for example, each child of a tree is also a tree).</p>

<pre data-type="programlisting" data-code-language="python" class="calibre35"><code class="k">def</code> <code class="nf">list_ingredients</code><code class="calibre17">(</code><code class="n">item</code><code class="calibre17">):</code>
    <code class="k">if</code> <code class="nb">isinstance</code><code class="calibre17">(</code><code class="n">item</code><code class="calibre17">,</code> <code class="n">PreparedIngredient</code><code class="calibre17">):</code>
        <code class="n">list_ingredients</code><code class="calibre17">(</code><code class="n">item</code><code class="calibre17">)</code>
    <code class="k">else</code><code class="calibre17">:</code>
        <code class="k">print</code><code class="calibre17">(</code><code class="n">ingredient</code><code class="calibre17">)</code></pre>
</dd>
</dl>

<p class="author1">You want each line of your codebase to deliver value. Furthermore, you want each line to clearly communicate what that value is to future developers. This drives a need to minimize any amount of boilerplate, scaffolding, and superfluous code. In the example above, I am iterating over each element and performing a side effect (printing an element), which makes the <code class="calibre17">for</code> loop an ideal looping construct. I am not wasting code. In contrast, the <code class="calibre17">while</code> loop requires us to explicitly track looping until a certain condition occurs. In other words, I need to track a specific condition and mutate a variable every iteration. This distracts from the value the loop provides, and provides unwanted cognitive burden.</p>
</div></section>













</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" class="preface" data-pdf-bookmark="Chapter 1. Introduction to Robust Python">
<div class="preface" id="intro">
<section data-type="sect1" data-pdf-bookmark="Examples of Intent in Python" class="preface">
<div class="preface" id="idm45644754038440">
<section data-type="sect2" data-pdf-bookmark="Law of Least Surprise" class="preface"><div class="preface" id="idm45644757639000">
<h2 class="calibre34" id="calibre_pb_9">Law of Least Surprise</h2>

<p class="author1">Distractions from intent are bad, but there’s a class of communication that is even worse: when code actively surprises your future collaborators. You want to adhere to the <em class="calibre6">Law of Least Surprise</em>; when someone reads through the codebase, they should almost never be surprised at behavior or implementation (and when they are surprised, there should be a great comment near the code to explain why it is that way). This is why communicating intent is paramount. Clear, clean code lowers the likelihood of miscommunication.</p>
<div data-type="note" epub:type="note" class="calibre21"><h6 class="calibre22">Note</h6>
<p class="author1">The <em class="calibre6">Law Of Least Surprise</em>, also known as the <em class="calibre6">Law of Least Astonishment</em>, states that a program should always respond to the user in the way that astonishes them the least.<sup class="calibre11"><a data-type="noteref" id="idm45644757634344-marker" href="part0003_split_011.html#idm45644757634344" class="calibre5">3</a></sup> Surprising behavior leads to confusion. Confusion leads to misplaced assumptions. Misplaced assumptions lead to bugs. And that is how you get unreliable <span class="calibre">software</span>.</p>
</div>

<p class="author1">Bear in mind, you can write completely correct code and still surprise someone in the future. There was one nasty bug I was chasing early in my career that crashed due <span class="calibre">to corrupted memory</span>. Putting the code under a debugger or putting in too many print statements affected timing such that the bug would not manifest (a true <span class="calibre">“heisenbug”</span>).<sup class="calibre11"><a data-type="noteref" id="idm45644757628952-marker" href="part0003_split_011.html#idm45644757628952" class="calibre5">4</a></sup> There were literally thousands of lines of code that related to this bug.</p>

<p class="author1">So I had to do a manual bisect, splitting the code in half, see which half actually had the crash by removing the other half, and then do it all over again in that code half. After two weeks of tearing my hair out, I finally decided to inspect an innocuous sounding function called <code class="calibre17">getEvent</code>. It turns out that this function was actually <em class="calibre6">setting</em> an event with invalid data. Needless to say, I was very surprised. The function was completely correct in what it was doing, but because I missed the intent of the code, I overlooked the bug for at least three days. Surprising your collaborators will cost their time.</p>

<p class="author1">A lot of this surprise ends up coming from complexity.<a data-type="indexterm" data-primary="complexity" data-secondary="necessary and accidental" id="idm45644757625400" class="calibre5"/> There are two types of complexity: <em class="calibre6">necessary complexity</em> and <em class="calibre6">accidental complexity</em>. Necessary complexity is the complexity inherent in your domain.<a data-type="indexterm" data-primary="necessary complexity" id="idm45644757623496" class="calibre5"/> Deep learning models are necessarily complex; they are not something you browse through the inner workings of and understand in a few minutes. Optimizing object–relational mapping (ORM) is necessarily complex; there is a large variety of possible user inputs have to be accounted for. You won’t be able to remove necessary complexity, so your best bet would be to try and contain it, lest it sprawls across your codebase and ends up becoming accidental complexity instead.</p>

<p class="author1">In contrast, accidental complexity<a data-type="indexterm" data-primary="accidental complexity" id="idm45644757621784" class="calibre5"/> is complexity that produces superfluous, wasteful, or confusing statements in code. It’s what happens when a system evolves over time and developers are jamming features in without reevaluating old code to determine whether their original assertions hold true. I once worked on a project where adding a single command-line option (and associated means of programmatically setting it) touched no fewer than 10 files. Why would adding one simple value ever need to require changes all over the codebase?</p>

<p class="author1">You know you have accidental complexity if you’ve ever experienced the following:</p>

<ul class="printings">
<li class="calibre9">
<p class="author1">Things that sound simple (adding users, changing a UI control, etc.) are non-trivial to implement.</p>
</li>
<li class="calibre9">
<p class="author1">Difficulty onboarding new developers into understanding your codebase. New developers on a project are your best indicators of how maintainable your code is right now—no need to wait years.</p>
</li>
<li class="calibre9">
<p class="author1">Estimates for adding functionality are always high, yet you slip the schedule nonetheless.</p>
</li>
</ul>

<p class="author1">Remove accidental complexity and isolate your necessary complexity wherever possible. Those will be the stumbling blocks for your future collaborators. These sources of complexity compound miscommunication, as they obscure and diffuse intent throughout the codebase.</p>
</div></section>





</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" class="preface" data-pdf-bookmark="Chapter 1. Introduction to Robust Python">
<div class="preface" id="intro">
<section data-type="sect1" data-pdf-bookmark="Examples of Intent in Python" class="preface">
<div class="preface" id="idm45644754038440">
<section data-type="sect2" data-pdf-bookmark="Law of Least Surprise" class="preface">
<div class="preface" id="idm45644757639000">
<div data-type="note" epub:type="note" class="calibre21"><h1 class="calibre38" id="calibre_pb_10">Discussion Topic</h1>
<p class="author1">What accidental complexities do you have in your codebase? How challenging would it be to understand simple concepts if you were dropped into the codebase with no communication to other developers? What can you do to simplify complexities identified in this exercise (especially if they are in often-changing code)?</p>
</div>

<p class="author1">Throughout the rest of the book, I will look at different techniques for communicating intent in Python.<a data-type="indexterm" data-primary="intent" data-secondary="examples in Python" data-startref="ix_intex" id="idm45644757613560" class="calibre5"/></p>
</div></section>





</div></section>













</div></section>

<section data-type="chapter" epub:type="chapter" class="preface" data-pdf-bookmark="Chapter 1. Introduction to Robust Python">
<div class="preface" id="intro">
<section data-type="sect1" data-pdf-bookmark="Closing Thoughts" class="preface"><div class="preface" id="idm45644757638504">
<h1 class="calibre12" id="calibre_pb_11">Closing Thoughts</h1>

<p class="author1">Robust code matters. Clean code matters. Your code needs to be maintainable for the entire lifetime of the codebase, and in order to ensure that outcome, you need to put active foresight into what you are communicating and how. You need to clearly embody your knowledge as close to the code as possible. It will feel like a burden to continuously look forward, but with practice it becomes natural, and you start reaping the benefits as you work in your own codebase.</p>

<p class="author1">Every time you map a real-world concept to code, you are creating an abstraction, whether it is through the use of a collection or your decision to keep functions separate. Every abstraction is a choice, and every choice communicates something, whether intentional or not. I encourage you to think about each line of code you are writing and ask yourself, “What will a future developer learn from this?” You owe it to future maintainers to enable them to deliver value at the same speed that you can today. Otherwise, your codebase will get bloated, schedules will slip, and complexity will grow. It is your job as a developer to mitigate that risk.</p>

<p class="author1">Look for potential hotspots, such as incorrect abstractions (such as collections or iteration) or accidental complexity. These are prime areas where communication can break down over time. If these types of hotspots are in areas that change often, they are a priority to address now.</p>

<p class="author1">In the next chapter, you’re going to take what you learned from this chapter and apply it to a fundamental Python concept: types. The types you choose express your intent to future developers, and picking the correct types will lead to better maintainability.</p>
</div></section>







<div data-type="footnotes" class="calibre25"><p data-type="footnote" id="idm45644759414136" class="calibre26"><sup class="calibre27"><a href="part0003_split_000.html#idm45644759414136-marker" class="calibre5">1</a></sup> Charles Antony Richard Hoare. “The Emperor’s Old Clothes.” <em class="calibre6">Commun. ACM</em> 24, 2 (Feb. 1981), 75–83. <a href="https://doi.org/10.1145/358549.358561" class="calibre5"><em class="calibre6">https://doi.org/10.1145/358549.358561</em></a>.</p><p data-type="footnote" id="idm45644754042936" class="calibre26"><sup class="calibre27"><a href="part0003_split_002.html#idm45644754042936-marker" class="calibre5">2</a></sup> Yak-shaving describes a situation where you frequently have to solve unrelated problems before you can even begin to tackle the original problem. You can learn about the origins of the term at <a href="https://oreil.ly/4iZm7" class="calibre5"><em class="calibre6">https://oreil.ly/4iZm7</em></a>.</p><p data-type="footnote" id="idm45644757634344" class="calibre26"><sup class="calibre27"><a href="part0003_split_009.html#idm45644757634344-marker" class="calibre5">3</a></sup> Geoffrey James. <em class="calibre6">The Tao of Programming</em>. <a href="https://oreil.ly/NcKNK" class="calibre5"><em class="calibre6">https://oreil.ly/NcKNK</em></a>.</p><p data-type="footnote" id="idm45644757628952" class="calibre26"><sup class="calibre27"><a href="part0003_split_009.html#idm45644757628952-marker" class="calibre5">4</a></sup> A bug that displays different behavior when being observed. <em class="calibre6">SIGSOFT ’83: Proceedings of the ACM SIGSOFT/SIGPLAN software engineering symposium on High-level debugging</em>.</p></div></div></section></body></html>