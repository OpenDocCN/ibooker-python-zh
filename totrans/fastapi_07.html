<html><head></head><body><section data-pdf-bookmark="Chapter 5. Pydantic, Type Hints, and Models Tour" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch05">&#13;
<h1><span class="label">Chapter 5. </span>Pydantic, Type Hints, and Models Tour</h1>&#13;
&#13;
<blockquote>&#13;
<p>Data validation and settings management using Python type hints.</p>&#13;
&#13;
<p>Fast and extensible, Pydantic plays nicely with your linters/IDE/brain.&#13;
Define how data should be in pure, canonical Python 3.6+;&#13;
validate it with Pydantic.</p>&#13;
<p data-type="attribution">Samuel Colvin, <cite>developer of Pydantic</cite></p>&#13;
</blockquote>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Preview" data-type="sect1"><div class="sect1" id="id52">&#13;
<h1>Preview</h1>&#13;
&#13;
<p>FastAPI stands largely on a Python package called Pydantic.&#13;
This uses <a data-primary="models" data-type="indexterm" id="id536"/><em>models</em> <a data-primary="Python" data-secondary="models" data-type="indexterm" id="id537"/>(Python object classes) to&#13;
define data structures.&#13;
These are heavily used in FastAPI applications&#13;
and are a real advantage when writing larger applications.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Type Hinting" data-type="sect1"><div class="sect1" id="id53">&#13;
<h1>Type Hinting</h1>&#13;
&#13;
<p>It’s<a data-primary="type hinting" data-type="indexterm" id="icd040"/> time<a data-primary="Python" data-secondary="type hinting" data-type="indexterm" id="icd045"/> to&#13;
learn a little more about Python <em>type hints</em>.</p>&#13;
&#13;
<p><a data-type="xref" href="ch02.html#ch02">Chapter 2</a> mentioned that, in many computer languages,&#13;
a variable points directly to a value in memory.&#13;
This requires the programmer to declare its type, so&#13;
the size and bits of the value can be determined.&#13;
In Python, variables are just names associated with objects,&#13;
and it’s the objects that have types.</p>&#13;
&#13;
<p>In standard programming,&#13;
a variable is usually associated with the&#13;
same object.&#13;
If we associate a type hint with that variable,&#13;
we can avoid some programming mistakes.&#13;
So Python added type hinting to the language,&#13;
in the standard typing module.&#13;
The Python interpreter ignores&#13;
the type hint syntax and runs the program as though it isn’t there.&#13;
Then what’s the point?</p>&#13;
&#13;
<p>You might treat a variable as a string in one line,&#13;
and forget later and assign it an object of a different type.&#13;
Although compilers for other languages would complain,&#13;
Python won’t.&#13;
The standard Python interpreter will catch&#13;
normal syntax errors and runtime exceptions,&#13;
but not mixing types for a variable.&#13;
Helper tools like mypy pay attention to type hints&#13;
and warn you about&#13;
any mismatches.</p>&#13;
&#13;
<p>Also, the hints are available to Python developers,&#13;
who can write tools that do more than type error checking.&#13;
The following sections describe how the Pydantic package&#13;
was developed to address needs that weren’t obvious.&#13;
Later, you’ll see how its integration with FastAPI&#13;
makes a lot of web development issues much easier to handle.</p>&#13;
&#13;
<p>By the way, what do type hints look like?&#13;
There’s one syntax for variables&#13;
and another for function return values.</p>&#13;
&#13;
<p>Variable type hints <a data-primary="variable type hints" data-type="indexterm" id="id538"/>may<a data-primary="type hinting" data-secondary="variable type hints" data-type="indexterm" id="id539"/> include only the type:</p>&#13;
&#13;
<pre data-type="programlisting"><em>name</em>: <em>type</em></pre>&#13;
&#13;
<p>or also initialize the variable with a value:</p>&#13;
&#13;
<pre data-type="programlisting"><em>name</em>: <em>type</em> = <em>value</em></pre>&#13;
&#13;
<p>The <em>type</em> can be one of the standard Python simple types like <code>int</code>&#13;
or <code>str</code>, or collection types like <code>tuple</code>, <code>list</code>, or <code>dict</code>:</p>&#13;
&#13;
<pre data-type="programlisting">thing: str = "yeti"</pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Before Python 3.9, you need to import capitalized versions&#13;
of these standard type names from the typing module:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">typing</code> <code class="kn">import</code> <code class="n">Str</code>&#13;
<code class="n">thing</code><code class="p">:</code> <code class="n">Str</code> <code class="o">=</code> <code class="s2">"yeti"</code></pre>&#13;
</div>&#13;
&#13;
<p>Here are some examples with initializations:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">physics_magic_number</code><code class="p">:</code> <code class="nb">float</code> <code class="o">=</code> <code class="mf">1.0</code><code class="o">/</code><code class="mf">137.03599913</code>&#13;
<code class="n">hp_lovecraft_noun</code><code class="p">:</code> <code class="nb">str</code> <code class="o">=</code> <code class="s2">"ichor"</code>&#13;
<code class="n">exploding_sheep</code><code class="p">:</code> <code class="nb">tuple</code> <code class="o">=</code> <code class="s2">"sis"</code><code class="p">,</code> <code class="s2">"boom"</code><code class="p">,</code> <code class="n">bah</code><code class="err">!</code><code class="s2">"</code><code class="w"/>&#13;
<code class="n">responses</code><code class="p">:</code> <code class="nb">dict</code> <code class="o">=</code> <code class="p">{</code><code class="s2">"Marco"</code><code class="p">:</code> <code class="s2">"Polo"</code><code class="p">,</code> <code class="s2">"answer"</code><code class="p">:</code> <code class="mi">42</code><code class="p">}</code></pre>&#13;
&#13;
<p>You can also include subtypes of collections:</p>&#13;
&#13;
<pre data-type="programlisting"><em>name</em>: dict[<em>keytype</em>, <em>valtype</em>] = {<em>key1</em>: <em>val1</em>, <em>key2</em>: <em>val2</em>}</pre>&#13;
&#13;
<p>The typing module has useful extras for subtypes;&#13;
the most common are as follows:</p>&#13;
<dl>&#13;
<dt><code>Any</code></dt>&#13;
<dd>&#13;
<p>Any type</p>&#13;
</dd>&#13;
<dt><code>Union</code></dt>&#13;
<dd>&#13;
<p>Any type of those specified, such as <code>Union[str, int]</code>.</p>&#13;
</dd>&#13;
</dl>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>In Python 3.10 and up, you can say <code><em>type1</em> | <em>type2</em></code> instead&#13;
of <code>Union[<em>type1</em>, <em>type2</em>]</code>.</p>&#13;
</div>&#13;
&#13;
<p>Examples of Pydantic definitions for a Python <code>dict</code> include the following:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">typing</code> <code class="kn">import</code> <code class="n">Any</code>&#13;
<code class="n">responses</code><code class="p">:</code> <code class="nb">dict</code><code class="p">[</code><code class="nb">str</code><code class="p">,</code> <code class="n">Any</code><code class="p">]</code> <code class="o">=</code> <code class="p">{</code><code class="s2">"Marco"</code><code class="p">:</code> <code class="s2">"Polo"</code><code class="p">,</code> <code class="s2">"answer"</code><code class="p">:</code> <code class="mi">42</code><code class="p">}</code></pre>&#13;
&#13;
<p>Or, a little more specific:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">typing</code> <code class="kn">import</code> <code class="n">Union</code>&#13;
<code class="n">responses</code><code class="p">:</code> <code class="nb">dict</code><code class="p">[</code><code class="nb">str</code><code class="p">,</code> <code class="n">Union</code><code class="p">[</code><code class="nb">str</code><code class="p">,</code> <code class="nb">int</code><code class="p">]]</code> <code class="o">=</code> <code class="p">{</code><code class="s2">"Marco"</code><code class="p">:</code> <code class="s2">"Polo"</code><code class="p">,</code> <code class="s2">"answer"</code><code class="p">:</code> <code class="mi">42</code><code class="p">}</code></pre>&#13;
&#13;
<p>or (Python 3.10 and up):</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">responses</code><code class="p">:</code> <code class="nb">dict</code><code class="p">[</code><code class="nb">str</code><code class="p">,</code> <code class="nb">str</code> <code class="o">|</code> <code class="nb">int</code><code class="p">]</code> <code class="o">=</code> <code class="p">{</code><code class="s2">"Marco"</code><code class="p">:</code> <code class="s2">"Polo"</code><code class="p">,</code> <code class="s2">"answer"</code><code class="p">:</code> <code class="mi">42</code><code class="p">}</code></pre>&#13;
&#13;
<p>Notice that a type-hinted variable line is legal Python,&#13;
but a bare variable line is not:</p>&#13;
&#13;
<pre data-type="programlisting">$ <strong>python</strong>&#13;
...&#13;
&gt;&gt;&gt; <strong>thing0</strong>&#13;
Traceback (most recent call last):&#13;
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;&#13;
NameError: name <em>thing0</em> is not defined&#13;
&gt;&gt;&gt; <strong>thing0: str</strong></pre>&#13;
&#13;
<p>Also, incorrect type uses are not caught by the regular&#13;
Python interpreter:</p>&#13;
&#13;
<pre data-type="programlisting">$ <strong>python</strong>&#13;
...&#13;
&gt;&gt;&gt; <strong>thing1: str = "yeti"</strong>&#13;
&gt;&gt;&gt; <strong>thing1 = 47</strong></pre>&#13;
&#13;
<p>But they will be caught by<a data-primary="mypy" data-type="indexterm" id="id540"/> mypy.&#13;
If you don’t already have it, run <code>pip install mypy</code>.&#13;
Save those two preceding lines to a file called&#13;
<em>stuff.py</em>,<sup><a data-type="noteref" href="ch05.html#id541" id="id541-marker">1</a></sup>&#13;
and then try this:</p>&#13;
&#13;
<pre data-type="programlisting">$ <strong>mypy stuff.py</strong>&#13;
stuff.py:2: error: Incompatible types in assignment&#13;
(expression has type "int", variable has type "str")&#13;
Found 1 error in 1 file (checked 1 source file)</pre>&#13;
&#13;
<p>A function return type <a data-primary="type hinting" data-secondary="function return type hints" data-type="indexterm" id="id542"/>hint <a data-primary="function return type hints" data-type="indexterm" id="id543"/>uses an arrow instead of a colon:</p>&#13;
&#13;
<pre data-type="programlisting"><em>function</em>(<em>args</em>) -&gt; <em>type</em>:</pre>&#13;
&#13;
<p class="pagebreak-before">Here’s a Pydantic example of a function return:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">get_thing</code><code class="p">()</code> <code class="o">-&gt;</code> <code class="nb">str</code><code class="p">:</code>&#13;
   <code class="k">return</code> <code class="s2">"yeti"</code></pre>&#13;
&#13;
<p>You can use any type, including classes that you’ve defined&#13;
or combinations of them.&#13;
You’ll see that in a few<a data-primary="Python" data-secondary="type hinting" data-startref="icd045" data-type="indexterm" id="id544"/> pages<a data-primary="type hinting" data-startref="icd040" data-type="indexterm" id="id545"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Data Grouping" data-type="sect1"><div class="sect1" id="id54">&#13;
<h1>Data Grouping</h1>&#13;
&#13;
<p>Often <a data-primary="data grouping" data-type="indexterm" id="icd041"/>we need to keep a related group of variables together&#13;
rather than passing around lots of individual variables.&#13;
How do we integrate multiple variables as a group&#13;
and keep the type hints?</p>&#13;
&#13;
<p>Let’s leave behind our tepid greeting example from previous chapters&#13;
and start using richer data from now on.&#13;
As in the rest of this book,&#13;
we’ll use examples of <em>cryptids</em> (imaginary creatures)&#13;
and the (also imaginary) explorers who seek them.&#13;
Our initial cryptid definitions will include only string variables for the following:</p>&#13;
<dl>&#13;
<dt><code>name</code></dt>&#13;
<dd>&#13;
<p>Key</p>&#13;
</dd>&#13;
<dt><code>country</code></dt>&#13;
<dd>&#13;
<p>Two-character ISO country code (3166-1 alpha 2) or <code>*</code> = all</p>&#13;
</dd>&#13;
<dt><code>area</code></dt>&#13;
<dd>&#13;
<p>Optional; United States state or other country subdivision</p>&#13;
</dd>&#13;
<dt><code>description</code></dt>&#13;
<dd>&#13;
<p>Free-form</p>&#13;
</dd>&#13;
<dt><code>aka</code></dt>&#13;
<dd>&#13;
<p>Also known as…​</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>And explorers will have the following:</p>&#13;
<dl>&#13;
<dt><code>name</code></dt>&#13;
<dd>&#13;
<p>Key</p>&#13;
</dd>&#13;
<dt><code>country</code></dt>&#13;
<dd>&#13;
<p>Two-character ISO country code</p>&#13;
</dd>&#13;
<dt><code>description</code></dt>&#13;
<dd>&#13;
<p>Free-form</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p class="pagebreak-before">Python’s historic data grouping structures&#13;
(beyond the basic <code>int</code>, <code>string</code>, and such)&#13;
are listed here:</p>&#13;
<dl>&#13;
<dt><code>tuple</code></dt>&#13;
<dd>&#13;
<p><a data-primary="tuples" data-type="indexterm" id="id546"/>An immutable sequence of objects</p>&#13;
</dd>&#13;
<dt><code>list</code></dt>&#13;
<dd>&#13;
<p><a data-primary="lists" data-type="indexterm" id="id547"/>A mutable sequence of objects</p>&#13;
</dd>&#13;
<dt><code>set</code></dt>&#13;
<dd>&#13;
<p><a data-primary="sets" data-type="indexterm" id="id548"/>Mutable distinct objects</p>&#13;
</dd>&#13;
<dt><code>dict</code></dt>&#13;
<dd>&#13;
<p><a data-primary="dicts (dictionaries)" data-type="indexterm" id="icd046"/>Mutable key-value object pairs (the key needs to be of an immutable type)</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Tuples (<a data-type="xref" href="#ex-5-1">Example 5-1</a>) and lists (<a data-type="xref" href="#ex-5-2">Example 5-2</a>) let you access a member variable only by its offset,&#13;
so you have to remember what went where.</p>&#13;
<div data-type="example" id="ex-5-1">&#13;
<h5><span class="label">Example 5-1. </span>Using a tuple</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="o">&gt;&gt;&gt;</code> <code class="n">tuple_thing</code> <code class="o">=</code> <code class="p">(</code><code class="s2">"yeti"</code><code class="p">,</code> <code class="s2">"CN"</code><code class="p">,</code> <code class="s2">"Himalayas"</code><code class="p">,</code>&#13;
    <code class="s2">"Hirsute Himalayan"</code><code class="p">,</code> <code class="s2">"Abominable Snowman"</code><code class="p">)</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="s2">"Name is"</code><code class="p">,</code> <code class="n">tuple_thing</code><code class="p">[</code><code class="mi">0</code><code class="p">])</code>&#13;
<code class="n">Name</code> <code class="ow">is</code> <code class="n">yeti</code></pre></div>&#13;
<div data-type="example" id="ex-5-2">&#13;
<h5><span class="label">Example 5-2. </span>Using a list</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="o">&gt;&gt;&gt;</code> <code class="n">list_thing</code> <code class="o">=</code> <code class="p">[</code><code class="s2">"yeti"</code><code class="p">,</code> <code class="s2">"CN"</code><code class="p">,</code> <code class="s2">"Himalayas"</code><code class="p">,</code>&#13;
    <code class="s2">"Hirsute Himalayan"</code><code class="p">,</code> <code class="s2">"Abominable Snowman"</code><code class="p">]</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="s2">"Name is"</code><code class="p">,</code> <code class="n">list_thing</code><code class="p">[</code><code class="mi">0</code><code class="p">])</code>&#13;
<code class="n">Name</code> <code class="ow">is</code> <code class="n">yeti</code></pre></div>&#13;
&#13;
<p><a data-type="xref" href="#ex-5-3">Example 5-3</a> shows that you can get a little more explanatory by&#13;
defining names for the integer offsets.</p>&#13;
<div data-type="example" id="ex-5-3">&#13;
<h5><span class="label">Example 5-3. </span>Using tuples and named offsets</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="o">&gt;&gt;&gt;</code> <code class="n">NAME</code> <code class="o">=</code> <code class="mi">0</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="n">COUNTRY</code> <code class="o">=</code> <code class="mi">1</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="n">AREA</code> <code class="o">=</code> <code class="mi">2</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="n">DESCRIPTION</code> <code class="o">=</code> <code class="mi">3</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="n">AKA</code> <code class="o">=</code> <code class="mi">4</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="n">tuple_thing</code> <code class="o">=</code> <code class="p">(</code><code class="s2">"yeti"</code><code class="p">,</code> <code class="s2">"CN"</code><code class="p">,</code> <code class="s2">"Himalayas"</code><code class="p">,</code>&#13;
    <code class="s2">"Hirsute Himalayan"</code><code class="p">,</code> <code class="s2">"Abominable Snowman"</code><code class="p">)</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="s2">"Name is"</code><code class="p">,</code> <code class="n">tuple_thing</code><code class="p">[</code><code class="n">NAME</code><code class="p">])</code>&#13;
<code class="n">Name</code> <code class="ow">is</code> <code class="n">yeti</code></pre></div>&#13;
&#13;
<p>Dictionaries are a little better in <a data-type="xref" href="#ex-5-4">Example 5-4</a>,&#13;
giving you access by descriptive keys.</p>&#13;
<div data-type="example" id="ex-5-4">&#13;
<h5><span class="label">Example 5-4. </span>Using a dictionary</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="o">&gt;&gt;&gt;</code> <code class="n">dict_thing</code> <code class="o">=</code> <code class="p">{</code><code class="s2">"name"</code><code class="p">:</code> <code class="s2">"yeti"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="s2">"country"</code><code class="p">:</code> <code class="s2">"CN"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="s2">"area"</code><code class="p">:</code> <code class="s2">"Himalayas"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="s2">"description"</code><code class="p">:</code> <code class="s2">"Hirsute Himalayan"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="s2">"aka"</code><code class="p">:</code> <code class="s2">"Abominable Snowman"</code><code class="p">}</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="s2">"Name is"</code><code class="p">,</code> <code class="n">dict_thing</code><code class="p">[</code><code class="s2">"name"</code><code class="p">])</code>&#13;
<code class="n">Name</code> <code class="ow">is</code> <code class="n">yeti</code></pre></div>&#13;
&#13;
<p><a data-primary="dicts (dictionaries)" data-startref="icd046" data-type="indexterm" id="id549"/>Sets contain only unique values, so they’re not very helpful for&#13;
clustering various variables.</p>&#13;
&#13;
<p>In <a data-type="xref" href="#ex-5-5">Example 5-5</a>, a <em>named tuple</em> is&#13;
a <a data-primary="tuples" data-type="indexterm" id="id550"/>tuple that gives you access by integer offset <em>or</em> name.</p>&#13;
<div data-type="example" id="ex-5-5">&#13;
<h5><span class="label">Example 5-5. </span>Using a named tuple</h5>&#13;
&#13;
<pre data-type="programlisting">&gt;&gt;&gt; from collections import namedtuple&#13;
&gt;&gt;&gt; CreatureNamedTuple = namedtuple("CreatureNamedTuple",&#13;
...     "name, country, area, description, aka")&#13;
&gt;&gt;&gt; namedtuple_thing = CreatureNamedTuple("yeti",&#13;
...     "CN",&#13;
...     "Himalaya",&#13;
...     "Hirsute HImalayan",&#13;
...     "Abominable Snowman")&#13;
&gt;&gt;&gt; print("Name is", namedtuple_thing[0])&#13;
Name is yeti&#13;
&gt;&gt;&gt; print("Name is", namedtuple_thing.name)&#13;
Name is yeti</pre></div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>You can’t say <code>namedtuple_thing["name"]</code>.&#13;
It’s a <code>tuple</code>, not a <code>dict</code>,&#13;
so the index needs to be an integer.</p>&#13;
</div>&#13;
&#13;
<p><a data-type="xref" href="#ex-5-6">Example 5-6</a> defines a new Python <code>class</code>&#13;
and adds all the&#13;
attributes with <code>self</code>.&#13;
But you’ll need to do a lot of typing just to define them.</p>&#13;
<div data-type="example" id="ex-5-6">&#13;
<h5><span class="label">Example 5-6. </span>Using a standard class</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="o">&gt;&gt;&gt;</code> <code class="k">class</code> <code class="nc">CreatureClass</code><code class="p">():</code>&#13;
<code class="o">...</code>     <code class="k">def</code> <code class="fm">__init__</code><code class="p">(</code><code class="bp">self</code><code class="p">,</code>&#13;
<code class="o">...</code>       <code class="n">name</code><code class="p">:</code> <code class="nb">str</code><code class="p">,</code>&#13;
<code class="o">...</code>       <code class="n">country</code><code class="p">:</code> <code class="nb">str</code><code class="p">,</code>&#13;
<code class="o">...</code>       <code class="n">area</code><code class="p">:</code> <code class="nb">str</code><code class="p">,</code>&#13;
<code class="o">...</code>       <code class="n">description</code><code class="p">:</code> <code class="nb">str</code><code class="p">,</code>&#13;
<code class="o">...</code>       <code class="n">aka</code><code class="p">:</code> <code class="nb">str</code><code class="p">):</code>&#13;
<code class="o">...</code>         <code class="bp">self</code><code class="o">.</code><code class="n">name</code> <code class="o">=</code> <code class="n">name</code>&#13;
<code class="o">...</code>         <code class="bp">self</code><code class="o">.</code><code class="n">country</code> <code class="o">=</code> <code class="n">country</code>&#13;
<code class="o">...</code>         <code class="bp">self</code><code class="o">.</code><code class="n">area</code> <code class="o">=</code> <code class="n">area</code>&#13;
<code class="o">...</code>         <code class="bp">self</code><code class="o">.</code><code class="n">description</code> <code class="o">=</code> <code class="n">description</code>&#13;
<code class="o">...</code>         <code class="bp">self</code><code class="o">.</code><code class="n">aka</code> <code class="o">=</code> <code class="n">aka</code>&#13;
<code class="o">...</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="n">class_thing</code> <code class="o">=</code> <code class="n">CreatureClass</code><code class="p">(</code>&#13;
<code class="o">...</code>     <code class="s2">"yeti"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="s2">"CN"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="s2">"Himalayas"</code>&#13;
<code class="o">...</code>     <code class="s2">"Hirsute Himalayan"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="s2">"Abominable Snowman"</code><code class="p">)</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="s2">"Name is"</code><code class="p">,</code> <code class="n">class_thing</code><code class="o">.</code><code class="n">name</code><code class="p">)</code>&#13;
<code class="n">Name</code> <code class="ow">is</code> <code class="n">yeti</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>You might think, what’s so bad about that?&#13;
With a regular class, you can add more data (attributes),&#13;
but especially behavior (methods).&#13;
You might decide, one madcap day,&#13;
to add a method that looks up an explorer’s&#13;
favorite songs.&#13;
(This wouldn’t apply to a&#13;
creature.<sup><a data-type="noteref" href="ch05.html#id551" id="id551-marker">2</a></sup>)&#13;
But the use case here is just to move a clump of data&#13;
undisturbed&#13;
among the layers, and to validate on the way in and out.&#13;
Also, methods are square pegs&#13;
that would struggle to fit in the round holes of a database.</p>&#13;
</div>&#13;
&#13;
<p>Does Python have anything similar&#13;
to what other computer languages&#13;
call a <em>record</em>  or a <em>struct</em> (a group of names and values)?&#13;
A recent addition to Python is the <a data-primary="dataclasses" data-type="indexterm" id="id552"/><em>dataclass</em>.&#13;
<a data-type="xref" href="#ex-5-7">Example 5-7</a> shows how all that <code>self</code> stuff&#13;
disappears with dataclasses.</p>&#13;
<div data-type="example" id="ex-5-7">&#13;
<h5><span class="label">Example 5-7. </span>Using a dataclass</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="o">&gt;&gt;&gt;</code> <code class="kn">from</code> <code class="nn">dataclasses</code> <code class="kn">import</code> <code class="n">dataclass</code>&#13;
<code class="o">&gt;&gt;&gt;</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="nd">@dataclass</code>&#13;
<code class="o">...</code> <code class="k">class</code> <code class="nc">CreatureDataClass</code><code class="p">():</code>&#13;
<code class="o">...</code>     <code class="n">name</code><code class="p">:</code> <code class="nb">str</code>&#13;
<code class="o">...</code>     <code class="n">country</code><code class="p">:</code> <code class="nb">str</code>&#13;
<code class="o">...</code>     <code class="n">area</code><code class="p">:</code> <code class="nb">str</code>&#13;
<code class="o">...</code>     <code class="n">description</code><code class="p">:</code> <code class="nb">str</code>&#13;
<code class="o">...</code>     <code class="n">aka</code><code class="p">:</code> <code class="nb">str</code>&#13;
<code class="o">...</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="n">dataclass_thing</code> <code class="o">=</code> <code class="n">CreatureDataClass</code><code class="p">(</code>&#13;
<code class="o">...</code>     <code class="s2">"yeti"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="s2">"CN"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="s2">"Himalayas"</code>&#13;
<code class="o">...</code>     <code class="s2">"Hirsute Himalayan"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="s2">"Abominable Snowman"</code><code class="p">)</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="s2">"Name is"</code><code class="p">,</code> <code class="n">dataclass_thing</code><code class="o">.</code><code class="n">name</code><code class="p">)</code>&#13;
<code class="n">Name</code> <code class="ow">is</code> <code class="n">yeti</code></pre></div>&#13;
&#13;
<p>This is pretty good for the keeping-variables-together part.&#13;
But we want more, so let’s ask Santa for these:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>A <em>union</em> of possible alternative types</p>&#13;
</li>&#13;
<li>&#13;
<p>Missing/optional values</p>&#13;
</li>&#13;
<li>&#13;
<p>Default values</p>&#13;
</li>&#13;
<li>&#13;
<p>Data validation</p>&#13;
</li>&#13;
<li>&#13;
<p>Serialization to and from formats like JSON</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Alternatives" data-type="sect1"><div class="sect1" id="id55">&#13;
<h1>Alternatives</h1>&#13;
&#13;
<p>It’s tempting to use Python’s built-in data structures,&#13;
especially dictionaries.&#13;
But you’ll inevitably find that dictionaries are a bit too “loose.”&#13;
Freedom comes at a price.&#13;
You need to check <em>everything</em>:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Is the key optional?</p>&#13;
</li>&#13;
<li>&#13;
<p>If the key is missing, is there a default value?</p>&#13;
</li>&#13;
<li>&#13;
<p>Does the key exist?</p>&#13;
</li>&#13;
<li>&#13;
<p>If so, is the key’s value of the right type?</p>&#13;
</li>&#13;
<li>&#13;
<p>If so, is the value in the right range or matching a pattern?</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>At least three solutions address at least&#13;
some of these requirements:</p>&#13;
<dl>&#13;
<dt><a href="https://oreil.ly/mxANA">Dataclasses</a></dt>&#13;
<dd>&#13;
<p><a data-primary="dataclasses" data-type="indexterm" id="id553"/>Part of standard Python.</p>&#13;
</dd>&#13;
<dt><a href="https://www.attrs.org">attrs</a></dt>&#13;
<dd>&#13;
<p><a data-primary="attrs" data-type="indexterm" id="id554"/>Third party, but a superset of dataclasses.</p>&#13;
</dd>&#13;
<dt><a href="https://docs.pydantic.dev">Pydantic</a></dt>&#13;
<dd>&#13;
<p><a data-primary="Pydantic" data-type="indexterm" id="icd047"/>Also third party, but integrated into FastAPI,&#13;
so an easy choice if you’re already using FastAPI.&#13;
And if you’re reading this book, that’s likely.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>A handy comparison&#13;
of the three is on <a href="https://oreil.ly/pkQD3">YouTube</a>.&#13;
One takeaway is that Pydantic stands out for validation,&#13;
and its integration with FastAPI catches many potential&#13;
data errors.&#13;
Another is that Pydantic relies on inheritance (from&#13;
the <code>BaseModel</code> class),&#13;
and the other two use Python decorators to define their objects.&#13;
This is more a matter of style.</p>&#13;
&#13;
<p>In <a href="https://oreil.ly/gU28a">another comparison</a>,&#13;
Pydantic outperformed older validation packages like&#13;
<a href="https://marshmallow.readthedocs.io">marshmallow</a>&#13;
and the intriguingly named&#13;
<a href="https://github.com/alecthomas/voluptuous">Voluptuous</a>.&#13;
Another big plus for Pydantic is that it uses standard&#13;
Python type hint syntax;&#13;
older libraries pre-dated type hints and rolled their own.</p>&#13;
&#13;
<p>So I’m going with Pydantic in this book,&#13;
but you may find uses for either of the alternatives&#13;
if you’re not using FastAPI.</p>&#13;
&#13;
<p>Pydantic provides ways to specify any combination of these checks:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Required versus optional</p>&#13;
</li>&#13;
<li>&#13;
<p>Default value if unspecified but required</p>&#13;
</li>&#13;
<li>&#13;
<p>The data type or types expected</p>&#13;
</li>&#13;
<li>&#13;
<p>Value range restrictions</p>&#13;
</li>&#13;
<li>&#13;
<p>Other function-based checks if needed</p>&#13;
</li>&#13;
<li>&#13;
<p>Serialization <a data-primary="Pydantic" data-startref="icd047" data-type="indexterm" id="id555"/>and <a data-primary="data grouping" data-startref="icd041" data-type="indexterm" id="id556"/>deserialization</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="A Simple Example" data-type="sect1"><div class="sect1" id="id184">&#13;
<h1>A Simple Example</h1>&#13;
&#13;
<p>You’ve <a data-primary="Pydantic" data-secondary="simple example using" data-type="indexterm" id="icd042"/>seen how to feed a simple string to a web endpoint&#13;
via the URL, a query parameter, or the HTTP body.&#13;
The problem is that you usually request and receive&#13;
groups of data, of many types. That’s where Pydantic models first appear in FastAPI.</p>&#13;
&#13;
<p>This initial example will use three files:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><em>model.py</em> defines a Pydantic model.</p>&#13;
</li>&#13;
<li>&#13;
<p><em>data.py</em> is a fake data source, defining an instance of a model.</p>&#13;
</li>&#13;
<li>&#13;
<p><em>web.py</em> defines a FastAPI web endpoint that returns the fake data.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>For simplicity in this chapter,&#13;
let’s keep all the files in the same directory.&#13;
In later chapters that discuss larger websites,&#13;
we’ll separate them into their respective layers. First, define the <em>model</em> for a creature in <a data-type="xref" href="#ex-5-8">Example 5-8</a>.</p>&#13;
<div data-type="example" id="ex-5-8">&#13;
<h5><span class="label">Example 5-8. </span>Define a creature model: <span class="plain">model.py</span></h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">pydantic</code> <code class="kn">import</code> <code class="n">BaseModel</code>&#13;
&#13;
<code class="k">class</code> <code class="nc">Creature</code><code class="p">(</code><code class="n">BaseModel</code><code class="p">):</code>&#13;
    <code class="n">name</code><code class="p">:</code> <code class="nb">str</code>&#13;
    <code class="n">country</code><code class="p">:</code> <code class="nb">str</code>&#13;
    <code class="n">area</code><code class="p">:</code> <code class="nb">str</code>&#13;
    <code class="n">description</code><code class="p">:</code> <code class="nb">str</code>&#13;
    <code class="n">aka</code><code class="p">:</code> <code class="nb">str</code>&#13;
&#13;
<code class="n">thing</code> <code class="o">=</code> <code class="n">Creature</code><code class="p">(</code>&#13;
    <code class="n">name</code><code class="o">=</code><code class="s2">"yeti"</code><code class="p">,</code>&#13;
    <code class="n">country</code><code class="o">=</code><code class="s2">"CN"</code><code class="p">,</code>&#13;
    <code class="n">area</code><code class="o">=</code><code class="s2">"Himalayas"</code><code class="p">,</code>&#13;
    <code class="n">description</code><code class="o">=</code><code class="s2">"Hirsute Himalayan"</code><code class="p">,</code>&#13;
    <code class="n">aka</code><code class="o">=</code><code class="s2">"Abominable Snowman"</code><code class="p">)</code>&#13;
<code class="p">)</code>&#13;
<code class="nb">print</code><code class="p">(</code><code class="s2">"Name is"</code><code class="p">,</code> <code class="n">thing</code><code class="o">.</code><code class="n">name</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>The <code>Creature</code> class inherits from Pydantic’s <code>BaseModel</code>.&#13;
That <code>: str</code> part after <code>name</code>, <code>country</code>, <code>area</code>,&#13;
<code>description</code>, and <code>aka</code>&#13;
is a type hint that each is a Python string.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>In this example, all fields are required.&#13;
In Pydantic, if <code>Optional</code> is not in the type description,&#13;
the field must have a value.</p>&#13;
</div>&#13;
&#13;
<p>In <a data-type="xref" href="#ex-5-9">Example 5-9</a>,&#13;
pass the arguments in any order if you include their names.</p>&#13;
<div data-type="example" id="ex-5-9">&#13;
<h5><span class="label">Example 5-9. </span>Create a creature</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="o">&gt;&gt;&gt;</code> <code class="n">thing</code> <code class="o">=</code> <code class="n">Creature</code><code class="p">(</code>&#13;
<code class="o">...</code>     <code class="n">name</code><code class="o">=</code><code class="s2">"yeti"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="n">country</code><code class="o">=</code><code class="s2">"CN"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="n">area</code><code class="o">=</code><code class="s2">"Himalayas"</code>&#13;
<code class="o">...</code>     <code class="n">description</code><code class="o">=</code><code class="s2">"Hirsute Himalayan"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="n">aka</code><code class="o">=</code><code class="s2">"Abominable Snowman"</code><code class="p">)</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="s2">"Name is"</code><code class="p">,</code> <code class="n">thing</code><code class="o">.</code><code class="n">name</code><code class="p">)</code>&#13;
<code class="n">Name</code> <code class="ow">is</code> <code class="n">yeti</code></pre></div>&#13;
&#13;
<p>For now, <a data-type="xref" href="#ex-5-10">Example 5-10</a> defines a teeny source of data;&#13;
in later chapters, databases will do this.&#13;
The type hint <code>list[Creature]</code>&#13;
tells Python that this is a list of <code>Creature</code> objects only.</p>&#13;
<div data-type="example" id="ex-5-10">&#13;
<h5><span class="label">Example 5-10. </span>Define fake data in <span class="plain">data.py</span></h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">model</code> <code class="kn">import</code> <code class="n">Creature</code>&#13;
&#13;
<code class="n">_creatures</code><code class="p">:</code> <code class="nb">list</code><code class="p">[</code><code class="n">Creature</code><code class="p">]</code> <code class="o">=</code> <code class="p">[</code>&#13;
    <code class="n">Creature</code><code class="p">(</code><code class="n">name</code><code class="o">=</code><code class="s2">"yeti"</code><code class="p">,</code>&#13;
             <code class="n">country</code><code class="o">=</code><code class="s2">"CN"</code><code class="p">,</code>&#13;
             <code class="n">area</code><code class="o">=</code><code class="s2">"Himalayas"</code><code class="p">,</code>&#13;
             <code class="n">description</code><code class="o">=</code><code class="s2">"Hirsute Himalayan"</code><code class="p">,</code>&#13;
             <code class="n">aka</code><code class="o">=</code><code class="s2">"Abominable Snowman"</code>&#13;
             <code class="p">),</code>&#13;
    <code class="n">Creature</code><code class="p">(</code><code class="n">name</code><code class="o">=</code><code class="s2">"sasquatch"</code><code class="p">,</code>&#13;
             <code class="n">country</code><code class="o">=</code><code class="s2">"US"</code><code class="p">,</code>&#13;
             <code class="n">area</code><code class="o">=</code><code class="s2">"*"</code><code class="p">,</code>&#13;
             <code class="n">description</code><code class="o">=</code><code class="s2">"Yeti's Cousin Eddie"</code><code class="p">,</code>&#13;
             <code class="n">aka</code><code class="o">=</code><code class="s2">"Bigfoot"</code><code class="p">)</code>&#13;
<code class="p">]</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">get_creatures</code><code class="p">()</code> <code class="o">-&gt;</code> <code class="nb">list</code><code class="p">[</code><code class="n">Creature</code><code class="p">]:</code>&#13;
    <code class="k">return</code> <code class="n">_creatures</code></pre></div>&#13;
&#13;
<p>(We’re using <code>"*"</code> for Bigfoot’s <code>area</code> because he’s almost everywhere.)</p>&#13;
&#13;
<p>This code imports the <em>model.py</em> that we just wrote.&#13;
It does a little data hiding by calling its list of&#13;
<code>Creature</code> objects <code>_creatures</code>, and providing the&#13;
<code>get_creatures()</code> function to return them.</p>&#13;
&#13;
<p><a data-type="xref" href="#ex-5-11">Example 5-11</a> lists <em>web.py</em>,&#13;
a file that defines a FastAPI web endpoint.</p>&#13;
<div data-type="example" id="ex-5-11">&#13;
<h5><span class="label">Example 5-11. </span>Define a FastAPI web endpoint: <span class="plain">web.py</span></h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">model</code> <code class="kn">import</code> <code class="n">Creature</code>&#13;
<code class="kn">from</code> <code class="nn">fastapi</code> <code class="kn">import</code> <code class="n">FastAPI</code>&#13;
&#13;
<code class="n">app</code> <code class="o">=</code> <code class="n">FastAPI</code><code class="p">()</code>&#13;
&#13;
<code class="nd">@app</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s2">"/creature"</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">get_all</code><code class="p">()</code> <code class="o">-&gt;</code> <code class="nb">list</code><code class="p">[</code><code class="n">Creature</code><code class="p">]:</code>&#13;
    <code class="kn">from</code> <code class="nn">data</code> <code class="kn">import</code> <code class="n">get_creatures</code>&#13;
    <code class="k">return</code> <code class="n">get_creatures</code><code class="p">()</code></pre></div>&#13;
&#13;
<p>Now fire up this one-endpoint server in <a data-type="xref" href="#ex-5-12">Example 5-12</a>.</p>&#13;
<div data-type="example" id="ex-5-12">&#13;
<h5><span class="label">Example 5-12. </span>Start Uvicorn</h5>&#13;
&#13;
<pre data-type="programlisting">$ <strong>uvicorn creature:app</strong>&#13;
INFO:     Started server process [24782]&#13;
INFO:     Waiting for application startup.&#13;
INFO:     Application startup complete.&#13;
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)</pre></div>&#13;
&#13;
<p>In another window, <a data-type="xref" href="#ex-5-13">Example 5-13</a> accesses the web application with the HTTPie web client&#13;
(try your browser or the Requests module if you like too).</p>&#13;
<div data-type="example" id="ex-5-13">&#13;
<h5><span class="label">Example 5-13. </span>Test with HTTPie</h5>&#13;
&#13;
<pre data-type="programlisting">$ <strong>http http://localhost:8000/creature</strong>&#13;
HTTP/1.1 200 OK&#13;
content-length: 183&#13;
content-type: application/json&#13;
date: Mon, 12 Sep 2022 02:21:15 GMT&#13;
server: uvicorn&#13;
&#13;
[&#13;
    {&#13;
        "aka": "Abominable Snowman",&#13;
        "area": "Himalayas",&#13;
        "country": "CN",&#13;
        "name": "yeti",&#13;
        "description": "Hirsute Himalayan"&#13;
    },&#13;
    {&#13;
        "aka": "Bigfoot",&#13;
        "country": "US",&#13;
        "area": "*",&#13;
        "name": "sasquatch",&#13;
        "description": "Yeti's Cousin Eddie"&#13;
    }</pre></div>&#13;
&#13;
<p>FastAPI and Starlette automatically convert the original&#13;
<code>Creature</code> model object list into a JSON string.&#13;
This is the default output format in FastAPI,&#13;
so we don’t need to specify it.</p>&#13;
&#13;
<p>Also, the window in which you originally started&#13;
the Uvicorn web server should&#13;
have printed a log line<a data-primary="Pydantic" data-secondary="simple example using" data-startref="icd042" data-type="indexterm" id="id557"/>:</p>&#13;
&#13;
<pre data-type="programlisting">INFO:     127.0.0.1:52375 - "GET /creature HTTP/1.1" 200 OK</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Validate Types" data-type="sect1"><div class="sect1" id="id56">&#13;
<h1>Validate Types</h1>&#13;
&#13;
<p>The <a data-primary="Pydantic" data-secondary="validating types" data-type="indexterm" id="icd043"/>previous<a data-primary="type validation" data-type="indexterm" id="icd048"/> section showed how to do the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Apply type hints to variables and functions</p>&#13;
</li>&#13;
<li>&#13;
<p>Define and use a Pydantic model</p>&#13;
</li>&#13;
<li>&#13;
<p>Return a list of models from a data source</p>&#13;
</li>&#13;
<li>&#13;
<p>Return the model list to a web client,&#13;
automatically converting the model list to JSON</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Now, let’s really put it to work validating data.</p>&#13;
&#13;
<p>Try assigning a value of the wrong type to one or more&#13;
of the <code>Creature</code> fields.&#13;
Let’s use a standalone test for this&#13;
(Pydantic doesn’t apply on any web code;&#13;
it’s a data thing).</p>&#13;
&#13;
<p><a data-type="xref" href="#ex-5-14">Example 5-14</a> lists <em>test1.py</em>.</p>&#13;
<div class="pagebreak-before less_space" data-type="example" id="ex-5-14">&#13;
<h5><span class="label">Example 5-14. </span>Test the Creature model</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">model</code> <code class="kn">import</code> <code class="n">Creature</code>&#13;
&#13;
<code class="n">dragon</code> <code class="o">=</code> <code class="n">Creature</code><code class="p">(</code>&#13;
    <code class="n">name</code><code class="o">=</code><code class="s2">"dragon"</code><code class="p">,</code>&#13;
    <code class="n">description</code><code class="o">=</code><code class="p">[</code><code class="s2">"incorrect"</code><code class="p">,</code> <code class="s2">"string"</code><code class="p">,</code> <code class="s2">"list"</code><code class="p">],</code>&#13;
    <code class="n">country</code><code class="o">=</code><code class="s2">"*"</code> <code class="p">,</code>&#13;
    <code class="n">area</code><code class="o">=</code><code class="s2">"*"</code><code class="p">,</code>&#13;
    <code class="n">aka</code><code class="o">=</code><code class="s2">"firedrake"</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>Now try the test in <a data-type="xref" href="#ex-5-15">Example 5-15</a>.</p>&#13;
<div data-type="example" id="ex-5-15">&#13;
<h5><span class="label">Example 5-15. </span>Run the test</h5>&#13;
&#13;
<pre data-type="programlisting">$ <strong>python test1.py</strong>&#13;
Traceback (most recent call last):&#13;
  File ".../test1.py", line 3, in &lt;module&gt;&#13;
    dragon = Creature(&#13;
  File "pydantic/main.py", line 342, in&#13;
    pydantic.main.BaseModel.<em>init</em>&#13;
    pydantic.error_wrappers.ValidationError:&#13;
    1 validation error for Creature description&#13;
  str type expected (type=type_error.str)</pre></div>&#13;
&#13;
<p>This finds that we’ve assigned a list of strings to the&#13;
<code>description</code> field,&#13;
and it wants a plain old <a data-primary="type validation" data-startref="icd048" data-type="indexterm" id="id558"/>string<a data-primary="Pydantic" data-secondary="validating types" data-startref="icd043" data-type="indexterm" id="id559"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Validate Values" data-type="sect1"><div class="sect1" id="id57">&#13;
<h1>Validate Values</h1>&#13;
&#13;
<p>Even<a data-primary="Pydantic" data-secondary="validating values" data-type="indexterm" id="icd044"/> if <a data-primary="value validation" data-type="indexterm" id="icd049"/>the value’s type matches its specification&#13;
in the <code>Creature</code> class, more checks may need to pass.&#13;
Some restrictions can be placed on the value itself:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Integer (<code>conint</code>) or float:</p>&#13;
<dl>&#13;
<dt><code>gt</code></dt>&#13;
<dd>&#13;
<p>Greater than</p>&#13;
</dd>&#13;
<dt><code>lt</code></dt>&#13;
<dd>&#13;
<p>Less than</p>&#13;
</dd>&#13;
<dt><code>ge</code></dt>&#13;
<dd>&#13;
<p>Greater than or equal to</p>&#13;
</dd>&#13;
<dt><code>le</code></dt>&#13;
<dd>&#13;
<p>Less than or equal to</p>&#13;
</dd>&#13;
<dt><code>multiple_of</code></dt>&#13;
<dd>&#13;
<p>An integer multiple of a value</p>&#13;
</dd>&#13;
</dl>&#13;
</li>&#13;
<li>&#13;
<p>String (<code>constr</code>):</p>&#13;
<dl>&#13;
<dt><code>min_length</code></dt>&#13;
<dd>&#13;
<p>Minimum character (not byte) length</p>&#13;
</dd>&#13;
<dt><code>max_length</code></dt>&#13;
<dd>&#13;
<p>Maximum character length</p>&#13;
</dd>&#13;
<dt><code>to_upper</code></dt>&#13;
<dd>&#13;
<p>Convert to uppercase</p>&#13;
</dd>&#13;
<dt><code>to_lower</code></dt>&#13;
<dd>&#13;
<p>Convert to lowercase</p>&#13;
</dd>&#13;
<dt><code>regex</code></dt>&#13;
<dd>&#13;
<p>Match a Python regular expression</p>&#13;
</dd>&#13;
</dl>&#13;
</li>&#13;
<li>&#13;
<p>Tuple, list, or set:</p>&#13;
<dl>&#13;
<dt><code>min_items</code></dt>&#13;
<dd>&#13;
<p>Minimum number of elements</p>&#13;
</dd>&#13;
<dt><code>max_items</code></dt>&#13;
<dd>&#13;
<p>Maximum number of elements</p>&#13;
</dd>&#13;
</dl>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>These are specified in the type parts of the model.</p>&#13;
&#13;
<p><a data-type="xref" href="#ex-5-16">Example 5-16</a> ensures that the <code>name</code> field is always&#13;
at least two characters long.&#13;
Otherwise, <code>""</code> (an empty string) is a valid string.</p>&#13;
<div data-type="example" id="ex-5-16">&#13;
<h5><span class="label">Example 5-16. </span>See a validation failure</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="o">&gt;&gt;&gt;</code> <code class="kn">from</code> <code class="nn">pydantic</code> <code class="kn">import</code> <code class="n">BaseModel</code><code class="p">,</code> <code class="n">constr</code>&#13;
<code class="o">&gt;&gt;&gt;</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="k">class</code> <code class="nc">Creature</code><code class="p">(</code><code class="n">BaseModel</code><code class="p">):</code>&#13;
<code class="o">...</code>     <code class="n">name</code><code class="p">:</code> <code class="n">constr</code><code class="p">(</code><code class="n">min_length</code><code class="o">=</code><code class="mi">2</code><code class="p">)</code>&#13;
<code class="o">...</code>     <code class="n">country</code><code class="p">:</code> <code class="nb">str</code>&#13;
<code class="o">...</code>     <code class="n">area</code><code class="p">:</code> <code class="nb">str</code>&#13;
<code class="o">...</code>     <code class="n">description</code><code class="p">:</code> <code class="nb">str</code>&#13;
<code class="o">...</code>     <code class="n">aka</code><code class="p">:</code> <code class="nb">str</code>&#13;
<code class="o">...</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="n">bad_creature</code> <code class="o">=</code> <code class="n">Creature</code><code class="p">(</code><code class="n">name</code><code class="o">=</code><code class="s2">"!"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="n">description</code><code class="o">=</code><code class="s2">"it's a raccoon"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="n">area</code><code class="o">=</code><code class="s2">"your attic"</code><code class="p">)</code>&#13;
<code class="n">Traceback</code> <code class="p">(</code><code class="n">most</code> <code class="n">recent</code> <code class="n">call</code> <code class="n">last</code><code class="p">):</code>&#13;
  <code class="n">File</code> <code class="s2">"&lt;stdin&gt;"</code><code class="p">,</code> <code class="n">line</code> <code class="mi">1</code><code class="p">,</code> <code class="ow">in</code> <code class="o">&lt;</code><code class="n">module</code><code class="o">&gt;</code>&#13;
  <code class="n">File</code> <code class="s2">"pydantic/main.py"</code><code class="p">,</code> <code class="n">line</code> <code class="mi">342</code><code class="p">,</code>&#13;
  <code class="ow">in</code> <code class="n">pydantic</code><code class="o">.</code><code class="n">main</code><code class="o">.</code><code class="n">BaseModel</code><code class="o">.</code><code class="fm">__init__</code>&#13;
<code class="n">pydantic</code><code class="o">.</code><code class="n">error_wrappers</code><code class="o">.</code><code class="n">ValidationError</code><code class="p">:</code>&#13;
<code class="mi">1</code> <code class="n">validation</code> <code class="n">error</code> <code class="k">for</code> <code class="n">Creature</code> <code class="n">name</code>&#13;
  <code class="n">ensure</code> <code class="n">this</code> <code class="n">value</code> <code class="n">has</code> <code class="n">at</code> <code class="n">least</code> <code class="mi">2</code> <code class="n">characters</code>&#13;
  <code class="p">(</code><code class="nb">type</code><code class="o">=</code><code class="n">value_error</code><code class="o">.</code><code class="n">any_str</code><code class="o">.</code><code class="n">min_length</code><code class="p">;</code> <code class="n">limit_value</code><code class="o">=</code><code class="mi">2</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>That <code>constr</code> means a<a data-primary="constrained strings" data-type="indexterm" id="id560"/> <em>constrained string</em>.&#13;
<a data-type="xref" href="#ex-5-17">Example 5-17</a> uses an alternative,&#13;
the <span class="keep-together">Pydantic</span> <code>Field</code> specification.</p>&#13;
<div data-type="example" id="ex-5-17">&#13;
<h5><span class="label">Example 5-17. </span>Another validation failure, using <code>Field</code></h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="o">&gt;&gt;&gt;</code> <code class="kn">from</code> <code class="nn">pydantic</code> <code class="kn">import</code> <code class="n">BaseModel</code><code class="p">,</code> <code class="n">Field</code>&#13;
<code class="o">&gt;&gt;&gt;</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="k">class</code> <code class="nc">Creature</code><code class="p">(</code><code class="n">BaseModel</code><code class="p">):</code>&#13;
<code class="o">...</code>     <code class="n">name</code><code class="p">:</code> <code class="nb">str</code> <code class="o">=</code> <code class="n">Field</code><code class="p">(</code><code class="o">...</code><code class="p">,</code> <code class="n">min_length</code><code class="o">=</code><code class="mi">2</code><code class="p">)</code>&#13;
<code class="o">...</code>     <code class="n">country</code><code class="p">:</code> <code class="nb">str</code>&#13;
<code class="o">...</code>     <code class="n">area</code><code class="p">:</code> <code class="nb">str</code>&#13;
<code class="o">...</code>     <code class="n">description</code><code class="p">:</code> <code class="nb">str</code>&#13;
<code class="o">...</code>     <code class="n">aka</code><code class="p">:</code> <code class="nb">str</code>&#13;
<code class="o">...</code>&#13;
<code class="o">&gt;&gt;&gt;</code> <code class="n">bad_creature</code> <code class="o">=</code> <code class="n">Creature</code><code class="p">(</code><code class="n">name</code><code class="o">=</code><code class="s2">"!"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="n">area</code><code class="o">=</code><code class="s2">"your attic"</code><code class="p">,</code>&#13;
<code class="o">...</code>     <code class="n">description</code><code class="o">=</code><code class="s2">"it's a raccoon"</code><code class="p">)</code>&#13;
<code class="n">Traceback</code> <code class="p">(</code><code class="n">most</code> <code class="n">recent</code> <code class="n">call</code> <code class="n">last</code><code class="p">):</code>&#13;
  <code class="n">File</code> <code class="s2">"&lt;stdin&gt;"</code><code class="p">,</code> <code class="n">line</code> <code class="mi">1</code><code class="p">,</code> <code class="ow">in</code> <code class="o">&lt;</code><code class="n">module</code><code class="o">&gt;</code>&#13;
  <code class="n">File</code> <code class="s2">"pydantic/main.py"</code><code class="p">,</code> <code class="n">line</code> <code class="mi">342</code><code class="p">,</code>&#13;
  <code class="ow">in</code> <code class="n">pydantic</code><code class="o">.</code><code class="n">main</code><code class="o">.</code><code class="n">BaseModel</code><code class="o">.</code><code class="fm">__init__</code>&#13;
<code class="n">pydantic</code><code class="o">.</code><code class="n">error_wrappers</code><code class="o">.</code><code class="n">ValidationError</code><code class="p">:</code>&#13;
<code class="mi">1</code> <code class="n">validation</code> <code class="n">error</code> <code class="k">for</code> <code class="n">Creature</code> <code class="n">name</code>&#13;
  <code class="n">ensure</code> <code class="n">this</code> <code class="n">value</code> <code class="n">has</code> <code class="n">at</code> <code class="n">least</code> <code class="mi">2</code> <code class="n">characters</code>&#13;
  <code class="p">(</code><code class="nb">type</code><code class="o">=</code><code class="n">value_error</code><code class="o">.</code><code class="n">any_str</code><code class="o">.</code><code class="n">min_length</code><code class="p">;</code> <code class="n">limit_value</code><code class="o">=</code><code class="mi">2</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>That <code>...</code> argument to <code>Field()</code> means that a value is required,&#13;
and that there’s no default value.</p>&#13;
&#13;
<p>This is a minimal introduction to Pydantic.&#13;
The main takeaway is that it lets you automate the validation of&#13;
your data.&#13;
You’ll see how useful this is when getting data from&#13;
either the Web or Data layers<a data-primary="Pydantic" data-secondary="validating values" data-startref="icd044" data-type="indexterm" id="id561"/><a data-primary="value validation" data-startref="icd049" data-type="indexterm" id="id562"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Review" data-type="sect1"><div class="sect1" id="id304">&#13;
<h1>Review</h1>&#13;
&#13;
<p>Models are the best way to define data that will&#13;
be passed around in your web application.&#13;
Pydantic leverages Python’s <em>type hints</em>&#13;
to define data models to pass around in your application. Coming next: defining <em>dependencies</em> to separate&#13;
specific details from your general code.</p>&#13;
</div></section>&#13;
<div data-type="footnotes"><p data-type="footnote" id="id541"><sup><a href="ch05.html#id541-marker">1</a></sup> Do I have any detectable imagination? Hmm…​no.</p><p data-type="footnote" id="id551"><sup><a href="ch05.html#id551-marker">2</a></sup> Except that small group of yodeling yetis (a good name for a band).</p></div></div></section></body></html>