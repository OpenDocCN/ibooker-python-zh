# 第三章：应用网页抓取

尽管网页抓取器几乎可以帮助任何业务，但真正的诀窍通常是找出*如何*。就像人工智能或者说实际上是编程一样，您不能只是挥动魔术棒，期望它能改善您的底线。

将网页抓取实践应用于您的业务需要真正的策略和仔细的规划，以便有效地使用它。您需要识别特定问题，弄清楚您需要哪些数据来解决这些问题，然后概述输入、输出和算法，使您的网页抓取器能够生成这些数据。

# 项目分类

在计划网页抓取项目时，您应考虑它如何适应以下几类之一。

您的网页抓取器是“广泛的”还是“有针对性的”？您可以编写模板来指导有针对性的网页抓取器，但需要不同的技术来处理广泛的抓取器：

+   您是否会抓取单个网站或甚至该网站内的固定页面集？如果是这样，这是一个非常有针对性的网页抓取项目。

+   您是否需要抓取已知数量的网站？这仍然是一个相当有针对性的抓取器，但您可能需要为每个网站编写少量的自定义代码，并投入更多时间来规划您的网页抓取器的架构。

+   您是否正在抓取大量未知的网站并动态发现新目标？您将构建一个必须自动检测并对网站结构做出假设的爬虫吗？您可能正在编写一个广泛或非定向的抓取器。

您是否需要运行抓取器仅一次，还是这将是一个持续的工作，重新获取数据或不断寻找新的页面进行抓取？

+   一次性的网页抓取项目可以很快且便宜地编写。代码不必漂亮！这个项目的最终结果是数据本身——您可能会将 Excel 或 CSV 文件交给业务部门，他们会很高兴。项目完成后，代码就可以丢弃了。

+   任何涉及监视、重新扫描新数据或更新数据的项目都需要更强大的代码来进行维护。它可能还需要自己的监控基础设施，以便在遇到错误、无法运行或使用的时间或资源超出预期时进行检测。

收集的数据是否是您的最终产品，还是需要更深入的分析或操作？

+   在简单数据收集的情况下，网页抓取器将数据存入数据库，就像它发现的那样，或者可能会进行简单的清理（例如从产品价格中去掉美元符号）。

+   当需要更高级的分析时，您可能甚至不知道哪些数据是重要的。在这种情况下，您必须更多地考虑您的抓取器的架构。

我鼓励您考虑每个项目可能属于哪些类别，以及如何修改该项目的范围以适应您业务的需求。

# 电子商务

尽管我编写过从网络收集各种有趣数据的网络爬虫，但我收到的最受欢迎的请求之一是从电子商务网站收集产品和定价数据。

通常，这些请求来自拥有竞争电子商务网站的人或者正在进行研究、计划推出新产品或市场的人。在电子商务中，您可能首先想到的指标是“定价”。您希望了解您的价格与竞争对手相比如何。但是，您可能希望收集的其他可能性和数据有很多。

许多产品并非所有产品都有各种尺寸、颜色和款式可选。这些变化可能与不同的成本和供应情况相关联。可能有助于跟踪每种产品的每种变体，以及每个主要产品清单。请注意，对于每种变体，您可能会找到一个独特的 SKU（库存保持单位）识别代码，该代码对于单个产品变体和电子商务网站是唯一的（如果您稍后再查看，目标网站的 SKU 与沃尔玛的 SKU 将不同，但 SKU 将保持不变）。即使在网站上看不到 SKU，您可能会在页面的 HTML 某处或填充网站产品数据的 JavaScript API 中找到它。

在抓取电子商务网站时，记录产品的可用单位数量可能也很重要。与 SKU 一样，单位可能不会立即显示在网站上。您可能会发现这些信息隐藏在网站使用的 HTML 或 API 中。确保还要跟踪产品缺货的情况！这对于评估市场需求可能很有用，甚至可以影响您自己产品的定价（如果有库存）。

当产品打折销售时，您通常会在网站上清晰标出销售价格和原始价格。确保分别记录这两个价格。通过跟踪销售情况，您可以分析竞争对手的促销和折扣策略。

产品评论和评级是另一个有用的信息片段。当然，您不能直接在自己的网站上显示竞争对手网站上产品评论的文本。但是，分析这些评论的原始数据可以帮助您了解哪些产品受欢迎或趋势。

## 市场营销

在线品牌管理和营销通常涉及大量数据的聚合。与其在社交媒体上滚动或花费数小时搜索公司名称，不如让网络爬虫完成所有繁重的工作！

网络爬虫可以被恶意攻击者用来实质性“复制”网站，以销售假冒商品或欺诈潜在客户。幸运的是，网络爬虫也可以通过扫描搜索引擎结果来帮助防范，以寻找公司商标和其他知识产权的欺诈或不当使用。一些公司，如 MarqVision，还将这些网络爬虫作为服务出售，允许品牌外包网络扒取过程，检测欺诈并发布下架通知。

另一方面，不是所有使用品牌商标的行为都构成侵权。如果您的公司被提及是为了评论或审查的目的，您可能希望知道！网络爬虫可以汇总和跟踪公众对公司及其品牌的情感和认知。

在网络上跟踪您的品牌时，不要忘记您的竞争对手！您可以考虑扒取那些评论竞争产品或讨论竞争对手品牌的人的信息，以便向他们提供折扣或推广促销活动。

当涉及到营销和互联网时，人们常常首先想到的是“社交媒体”。扒取社交媒体的好处在于通常只有少数几个大型网站允许您编写有针对性的爬虫。这些网站包含数以百万计的格式良好的帖子，具有类似的数据和属性（如点赞、分享和评论），可以轻松在不同网站间进行比较。

社交媒体的不利之处在于获取数据可能会遇到障碍。像 Twitter 这样的网站提供 API，可以免费或收费使用。其他社交媒体网站则通过技术和法律保护其数据。我建议在扒取 Facebook 和 LinkedIn 等网站数据之前，先咨询公司的法律顾问。

跟踪与您品牌相关的话题的指标（点赞、分享和评论）可以帮助识别热门话题或参与的机会。跟踪流行度与内容长度、包含的图像/媒体以及语言使用等属性的关系，还可以确定哪些内容更容易与您的目标受众产生共鸣。

如果通过与拥有数亿粉丝的人合作赞助您的产品超出了公司的预算范围，您可以考虑“微影响者”或“纳米影响者”——拥有较小社交媒体影响力的用户，他们甚至可能不认为自己是影响者！构建一个网络爬虫来查找并针对那些经常发布与您品牌相关话题的账户将非常有帮助。

# 学术研究

虽然本章的大部分示例最终都是为了推动资本主义的发展，但网络爬虫也用于追求知识。网络爬虫在医学、社会学和心理学研究等许多领域中都被广泛应用。

例如，罗格斯大学开设了一门名为“计算社会科学”的课程，教授学生使用 Web 爬虫收集研究项目所需的数据。一些大学课程，如奥斯陆大学的“收集和分析大数据”，甚至将这本书列入了课程表！

2017 年，美国国家卫生研究院支持的一个项目从美国监狱的监犯记录中抓取数据，以估计感染 HIV 的监犯数量。¹ 这个项目引发了一场广泛的伦理分析，权衡了这项研究的好处与监犯群体隐私的风险。最终，研究继续进行，但我建议在使用 Web 爬虫进行研究时，特别是在医学领域，先考虑项目的伦理问题。

另一项健康研究对*卫报*关于肥胖问题的数百条评论进行了抓取，并分析了这些评论的修辞。² 虽然规模比其他研究项目小，但值得考虑的是，Web 爬虫也可以用于需要“小数据”和定性分析的项目。

这里有另一个利用 Web 爬虫的小众研究项目的例子。2016 年，进行了一项全面研究，对加拿大每所社区学院的营销材料进行了爬取和定性分析。³ 研究人员确定了现代设施和“非传统组织符号”是最受欢迎的推广内容。

在经济研究中，日本银行发表了一篇论文⁴，介绍了他们利用 Web 爬虫获取“替代数据”的情况。也就是说，除了银行通常使用的数据外，还包括 GDP 统计和公司财务报告之外的数据。在这篇论文中，他们透露了替代数据的一种来源是 Web 爬虫，他们使用 Web 爬虫来调整价格指数。

# 产品构建

您是否有一个商业想法，只需一个相对公开的、常识性的信息数据库就能启动它？看起来周围并没有一个价格合理、方便的信息来源？您可能需要一个 Web 爬虫。

Web 爬虫可以快速提供数据，使您能够获得推出的最低可行产品。以下是 Web 爬虫可能是最佳解决方案的几种情况：

一个列出热门旅游目的地和活动的旅行网站

在这种情况下，一个简单的地理信息数据库是不够的。你想知道人们会去看 Cristo Redentor，而不仅仅是访问巴西里约热内卢。企业目录也不太适用。虽然人们可能对大英博物馆非常感兴趣，但街对面的 Sainsbury's 并没有同样的吸引力。然而，已经有许多旅游评论网站包含了有关热门旅游目的地的信息。

产品评论博客

爬取产品名称和关键词或描述列表，然后使用你喜欢的生成式聊天 AI 填充其余部分。

谈到人工智能，这些模型需要数据——通常是大量的数据！无论您是想要预测趋势还是生成逼真的自然语言，网络爬取通常是获取产品训练数据集的最佳途径之一。

许多商业服务产品需要具有密切保护的行业知识，可能是昂贵或难以获得的，比如工业材料供应商列表、小众领域专家的联系信息或公司的空缺职位。网络爬虫可以聚合在网上各个地方找到的这些信息片段，让您可以以相对较低的前期成本建立一个全面的数据库。

# 旅行

无论您是想要开始一个基于旅行的业务，还是对在下次度假中节省资金充满热情，旅行业都值得特别认可，因为它提供了许多网络爬取应用程序。

酒店、航空公司和租车服务在各自的市场内产品差异很小，竞争者众多。这意味着价格通常非常相似，并且随着市场条件的变化频繁波动。

虽然像 Kayak 和 Trivago 这样的网站现在可能已经足够庞大和强大，可以支付或提供 API，但所有公司都必须从某个地方开始。网络爬虫可以是开始一个新的旅行聚合网站的绝佳方式，从整个网络中找到用户最佳的优惠。

即使你不打算开始新的业务，你是否坐过飞机或计划未来要坐飞机？如果你正在寻找本书中测试技能的想法，我强烈推荐编写一个旅游网站爬虫作为一个很好的第一个项目。庞大的数据量和数据的时间变化使得这些都是一些有趣的工程挑战。

旅游网站在抵御爬虫攻击时，也是一个很好的折中点。他们希望被搜索引擎爬取和索引，也希望使他们的数据用户友好且易于访问。然而，他们与其他旅游网站竞争激烈，可能需要使用本书后面介绍的一些更高级的技术。注意你的浏览器标头和 cookie 是一个很好的第一步。

如果你发现自己被某个特定的旅游网站阻止，并且不确定如何通过 Python 访问它的内容，可以放心，很可能有另一个具有完全相同数据的旅游网站可以尝试。

# 销售

网页抓取器是获取销售线索的理想工具。如果您知道一个网站上有您目标市场联系信息的来源，其余的事情就很简单了。无论您的领域有多么小众，在与销售客户的工作中，我已经抓取了青少年运动队教练、健身房业主、皮肤护理供应商以及许多其他类型的目标受众的名单。

招聘行业（我认为它是销售的一个子集）经常利用网页抓取器的两面。候选人简介和职位列表都被抓取。由于 LinkedIn 有强有力的反抓取政策，插件（如 Instant Data Scraper 或 Dux-Soup）通常用于在手动浏览器访问时抓取候选人的简介。这使招聘人员能够在抓取页面之前快速浏览候选人，以确保他们适合工作描述。

类似 Yelp 的目录可以帮助在“价格昂贵性”、是否接受信用卡、提供送货或宴会服务、是否提供酒精饮料等属性上定制搜索。虽然 Yelp 主要以其餐厅评论而闻名，但它也提供关于本地木工、零售店、会计师、汽车修理店等详细信息。

像 Yelp 这样的网站不仅仅是向顾客宣传企业——联系信息也可以用来进行销售介绍。再次强调，详细的筛选工具将帮助您精准定位您的目标市场。

抓取员工目录或职业网站也可以是获取员工姓名和联系信息的宝贵来源，这将有助于进行更个人化的销售介绍。检查 Google 的结构化数据标签（见下一节，“SERP 抓取”）是构建广泛网络抓取器的一个良策，可以针对许多网站进行抓取可靠、格式良好的联系信息。

本书中几乎所有的例子都是关于抓取网站的“内容”——它们呈现的可读信息。然而，甚至网站的底层代码也可以显示出一些信息。它使用了什么内容管理系统？有关服务器端堆栈的任何线索？有什么样的客户聊天机器人或分析系统（如果有）存在？

知道潜在客户可能已经拥有或可能需要的技术，对于销售和市场营销都是有价值的。

# SERP 抓取

SERP，或称*搜索引擎结果页面*抓取，是直接从搜索引擎结果中获取有用数据的做法，而无需访问链接页面本身。搜索引擎结果具有已知且一致的格式优势。搜索引擎链接的页面具有各种各样且未知的格式——处理这些问题是一件混乱的事情，如果可能的话最好避免。

搜索引擎公司有专门的员工，他们的工作是使用元数据分析、巧妙的编程和 AI 工具从网站中提取页面摘要、统计数据和关键词。通过使用他们的结果，而不是在内部尝试复制它们，你可以节省大量时间和金钱。

例如，如果你想了解过去 40 年美国各大主要体育联赛的排名，你可能会找到各种信息源。[*http://nhl.com*](http://nhl.com) 提供一种格式的冰球排名，而[*http://nfl.com*](http://nfl.com) 则提供另一种格式的排名。然而，通过在谷歌上搜索“nba standings 2008”或“mlb standings 2004”，你将得到一致格式的结果，可以深入查看每个赛季的比赛得分和球员信息。

你可能还想了解搜索结果本身的存在和位置，例如，追踪特定搜索词出现的网站及其顺序。这有助于监控你的品牌并关注竞争对手。

如果你正在运营搜索引擎广告活动，或有意启动一项广告活动，你可以仅监控广告而非所有搜索结果。同样，你可以跟踪哪些广告出现，以及它们的顺序，也许还可以观察这些结果随时间的变化。

确保不要将自己局限于主要的搜索结果页面。例如，谷歌拥有谷歌地图、谷歌图片、谷歌购物、谷歌航班、谷歌新闻等。所有这些本质上都是针对不同类型内容的搜索引擎，这些内容可能与你的项目相关。

即使你不从搜索引擎本身抓取数据，了解搜索引擎如何找到和标记它们在特殊搜索结果功能和增强中显示的数据可能会有所帮助。搜索引擎并不通过猜测来决定如何显示数据；它们要求网页开发者专门为像它们这样的第三方显示格式化内容。

谷歌结构化数据的文档[可以在这里找到](https://developers.google.com/search/docs/appearance/structured-data)。如果在抓取网页时遇到这些数据，现在你将知道如何使用它。

¹ Stuart Rennie, Mara Buchbinder, and Eric Juengst, “Scraping the Web for Public Health Gains: Ethical Considerations from a ‘Big Data’ Research Project on HIV and Incarceration,” *National Library of Medicine* 13(1): April 2020, https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7392638/.

² Philip Brooker et al., “Doing Stigma: Online Commentary Around Weight-Related News Media.” *New Media & Society* 20(9): 1—22, December 2017\.

³ Roger Pizarro Milian，《现代校园、本地联系与非传统符号：加拿大社区学院部门的推广实践》，《高等教育与管理》22:218-30，2016 年 9 月，[*https://link.springer.com/article/10.1080/13583883.2016.1193764*](https://link.springer.com/article/10.1080/13583883.2016.1193764)。

⁴ 亀田誠作，《日本银行研究活动中的替代数据使用》，《日本银行综合评价》2022-E-1，2022 年 1 月，[*https://www.boj.or.jp/en/research/wps_rev/rev_2022/data/rev22e01.pdf*](https://www.boj.or.jp/en/research/wps_rev/rev_2022/data/rev22e01.pdf)。
