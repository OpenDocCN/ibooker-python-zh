<html><head></head><body><section data-pdf-bookmark="Chapter 3. Working with the Command Line" data-type="chapter" epub:type="chapter"><div class="chapter" id="working_with_the_command_line">&#13;
<h1><span class="label">Chapter 3. </span>Working with the Command Line</h1>&#13;
&#13;
&#13;
<p><a data-primary="command line" data-type="indexterm" id="ix_ch03-asciidoc0"/>The command line is where the rubber hits the road. Although there are many powerful tools with graphical interfaces, the command line is still home for DevOps work. Interacting with your shell environment from within Python and creating Python command-line tools are both necessary when using Python for DevOps.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Working with the Shell" data-type="sect1"><div class="sect1" id="idm46691340952824">&#13;
<h1>Working with the Shell</h1>&#13;
&#13;
<p><a data-primary="command line" data-secondary="shells" data-type="indexterm" id="ix_ch03-asciidoc1"/><a data-primary="shells" data-type="indexterm" id="ix_ch03-asciidoc2"/>Python offers tools for interacting with systems and shells. You should become familiar with the <code>sys</code>, <code>os</code>, and <code>subprocess</code> modules, as all are essential tools.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Talking to the Interpreter with the sys Module" data-type="sect2"><div class="sect2" id="idm46691340948120">&#13;
<h2>Talking to the Interpreter with the sys Module</h2>&#13;
&#13;
<p><a data-primary="command line" data-secondary="sys module" data-type="indexterm" id="idm46691340946680"/><a data-primary="interpreter, sys module and" data-type="indexterm" id="idm46691340945832"/><a data-primary="shells" data-secondary="sys module" data-type="indexterm" id="idm46691340945224"/><a data-primary="sys module" data-type="indexterm" id="idm46691340944376"/>The <code>sys</code> module offers access to variables and methods closely tied to the Python interpreter.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>There are two dominant ways to interpret bytes during reading. The first, <a data-primary="little endian" data-type="indexterm" id="idm46691340942376"/><em>little endian</em>, interprets each subsequent byte as having higher significance (representing a larger digit). The other, <a data-primary="big endian" data-type="indexterm" id="idm46691340941256"/><em>big endian</em>, assumes the first byte has the greatest significance and moves down from there.</p>&#13;
</div>&#13;
&#13;
<p>You can use the <a data-primary="sys.byteorder" data-type="indexterm" id="idm46691340939752"/><code>sys.byteorder</code> attribute to see the byte order of your current <span class="keep-together">architecture:</span></p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">sys</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="n">sys</code><code class="o">.</code><code class="n">byteorder</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="s1">'little'</code></pre>&#13;
&#13;
<p>You can use <a data-primary="sys.getsizeof" data-type="indexterm" id="idm46691340916504"/><code>sys.getsizeof</code> to see the size of Python objects. This is useful if you are dealing with limited memory:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">sys</code><code class="o">.</code><code class="n">getsizeof</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="mi">28</code></pre>&#13;
&#13;
<p>If you want to perform different behaviors, depending on the underlying operating system, you can use <code>sys.platform</code> to check:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="n">sys</code><code class="o">.</code><code class="n">platform</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="s1">'darwin'</code></pre>&#13;
&#13;
<p>A more common situation is that you want to use a language feature or module that is only available in specific versions of Python. You can use the <a data-primary="sys.version_info" data-type="indexterm" id="idm46691340869608"/><code>sys.version_info</code> to control behavior based on the running Python interpreter. Here we print different messages for Python 3.7, a Python version 3 that is below 3.7, and Python versions lower than 3:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">if</code> <code class="n">sys</code><code class="o">.</code><code class="n">version_info</code><code class="o">.</code><code class="n">major</code> <code class="o">&lt;</code> <code class="mi">3</code><code class="p">:</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="s2">"You need to update your Python version"</code><code class="p">)</code>&#13;
<code class="k">elif</code> <code class="n">sys</code><code class="o">.</code><code class="n">version_info</code><code class="o">.</code><code class="n">minor</code> <code class="o">&lt;</code> <code class="mi">7</code><code class="p">:</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="s2">"You are not running the latest version of Python"</code><code class="p">)</code>&#13;
<code class="k">else</code><code class="p">:</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="s2">"All is good."</code><code class="p">)</code></pre>&#13;
&#13;
<p>We cover more <code>sys</code> usage later in this chapter when we write command-line tools.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Dealing with the Operating System Using the os Module" data-type="sect2"><div class="sect2" id="idm46691340947528">&#13;
<h2>Dealing with the Operating System Using the os Module</h2>&#13;
&#13;
<p><a data-primary="command line" data-secondary="os module" data-type="indexterm" id="idm46691340791816"/><a data-primary="os module" data-type="indexterm" id="idm46691340790840"/><a data-primary="shells" data-secondary="os module functions" data-type="indexterm" id="idm46691340790168"/>You have seen the <code>os</code> module used in <a data-type="xref" href="ch02.html#automating_files_and_the_filesystem">Chapter 2</a> for dealing with the filesystem. It also has a grab bag of various attributes and functions related to dealing with the operating system. In <a data-type="xref" href="#Example-3-1">Example 3-1</a> we demonstrate some of them.</p>&#13;
<div data-type="example" id="Example-3-1">&#13;
<h5><span class="label">Example 3-1. </span>os module examples</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">os</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">getcwd</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO1-1" id="co_working_with_the_command_line_CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">/Users/kbehrman/Google-Drive/projects/python-devops</code><code class="s1">'</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">chdir</code><code class="p">(</code><code class="s1">'</code><code class="s1">/tmp</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO1-2" id="co_working_with_the_command_line_CO1-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">getcwd</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">/private/tmp</code><code class="s1">'</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">environ</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s1">'</code><code class="s1">LOGLEVEL</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO1-3" id="co_working_with_the_command_line_CO1-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">environ</code><code class="p">[</code><code class="s1">'</code><code class="s1">LOGLEVEL</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">DEBUG</code><code class="s1">'</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO1-4" id="co_working_with_the_command_line_CO1-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">7</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">environ</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s1">'</code><code class="s1">LOGLEVEL</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">7</code><code class="p">]</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">DEBUG</code><code class="s1">'</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">os</code><code class="o">.</code><code class="n">getlogin</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO1-5" id="co_working_with_the_command_line_CO1-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">kbehrman</code><code class="s1">'</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO1-1" id="callout_working_with_the_command_line_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Get the current working directory.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO1-2" id="callout_working_with_the_command_line_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Change the current working directory.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO1-3" id="callout_working_with_the_command_line_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>The <code>os.environ</code> holds the environment variables that were set when the <code>os</code> module was loaded.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO1-4" id="callout_working_with_the_command_line_CO1-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>This is the setting and environment variable. This setting exists for subprocesses spawned from this code.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO1-5" id="callout_working_with_the_command_line_CO1-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>This is the login of the user in the terminal that spawned this process.</p></dd>&#13;
</dl>&#13;
&#13;
<p>The most common usage of the <code>os</code>  module is to get settings from environment variables. These could be the level to set your logging, or secrets such as API keys.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Spawn Processes with the subprocess Module" data-type="sect2"><div class="sect2" id="idm46691340540872">&#13;
<h2>Spawn Processes with the subprocess Module</h2>&#13;
&#13;
<p><a data-primary="command line" data-secondary="subprocess module" data-type="indexterm" id="idm46691340539624"/><a data-primary="shells" data-secondary="spawning processes with subprocess module" data-type="indexterm" id="idm46691340538552"/><a data-primary="spawn processes" data-type="indexterm" id="idm46691340537704"/><a data-primary="subprocess" data-secondary="spawn processes" data-type="indexterm" id="idm46691340537096"/>There are many instances when you need to run applications outside of Python from within your Python code. This could be built-in shell commands, Bash scripts, or any other command-line application. To do this, you spawn a new <em>process</em> (instance of the application). The <code>subprocess</code> module is the right choice when you want to spawn a process and run commands within it. With <code>subprocess</code>, you can run your favorite shell command or other command-line software and collect its output from within Python. For the majority of use cases, you should use the <code>subprocess.run</code> function to spawn processes:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="n">cp</code> <code class="o">=</code> <code class="n">subprocess</code><code class="o">.</code><code class="n">run</code><code class="p">([</code><code class="s1">'ls'</code><code class="p">,</code><code class="s1">'-l'</code><code class="p">],</code>&#13;
                            <code class="n">capture_output</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code>&#13;
                            <code class="n">universal_newlines</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="n">cp</code><code class="o">.</code><code class="n">stdout</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="s1">'total 96</code>&#13;
         <code class="o">-</code><code class="n">rw</code><code class="o">-</code><code class="n">r</code><code class="o">--</code><code class="n">r</code><code class="o">--</code>  <code class="mi">1</code> <code class="n">kbehrman</code>  <code class="n">staff</code>     <code class="mi">0</code> <code class="n">Apr</code> <code class="mi">12</code> <code class="mi">08</code><code class="p">:</code><code class="mi">48</code> <code class="nf-Magic">__init__</code><code class="o">.</code><code class="n">py</code>&#13;
         <code class="n">drwxr</code><code class="o">-</code><code class="n">xr</code><code class="o">-</code><code class="n">x</code>  <code class="mi">5</code> <code class="n">kbehrman</code>  <code class="n">staff</code>   <code class="mi">160</code> <code class="n">Aug</code> <code class="mi">18</code> <code class="mi">15</code><code class="p">:</code><code class="mi">47</code> <code class="n">__pycache__</code>&#13;
         <code class="o">-</code><code class="n">rw</code><code class="o">-</code><code class="n">r</code><code class="o">--</code><code class="n">r</code><code class="o">--</code>  <code class="mi">1</code> <code class="n">kbehrman</code>  <code class="n">staff</code>   <code class="mi">123</code> <code class="n">Aug</code> <code class="mi">13</code> <code class="mi">12</code><code class="p">:</code><code class="mi">13</code> <code class="n">always_say_it</code><code class="o">.</code><code class="n">py</code>&#13;
         <code class="o">-</code><code class="n">rwxr</code><code class="o">-</code><code class="n">xr</code><code class="o">-</code><code class="n">x</code>  <code class="mi">1</code> <code class="n">kbehrman</code>  <code class="n">staff</code>  <code class="mi">1409</code> <code class="n">Aug</code>  <code class="mi">8</code> <code class="mi">15</code><code class="p">:</code><code class="mi">36</code> <code class="n">argparse_example</code><code class="o">.</code><code class="n">py</code>&#13;
         <code class="o">-</code><code class="n">rwxr</code><code class="o">-</code><code class="n">xr</code><code class="o">-</code><code class="n">x</code>  <code class="mi">1</code> <code class="n">kbehrman</code>  <code class="n">staff</code>   <code class="mi">734</code> <code class="n">Aug</code> <code class="mi">12</code> <code class="mi">09</code><code class="p">:</code><code class="mi">36</code> <code class="n">click_example</code><code class="o">.</code><code class="n">py</code>&#13;
         <code class="o">-</code><code class="n">rwxr</code><code class="o">-</code><code class="n">xr</code><code class="o">-</code><code class="n">x</code>  <code class="mi">1</code> <code class="n">kbehrman</code>  <code class="n">staff</code>   <code class="mi">538</code> <code class="n">Aug</code> <code class="mi">13</code> <code class="mi">10</code><code class="p">:</code><code class="mi">41</code> <code class="n">fire_example</code><code class="o">.</code><code class="n">py</code>&#13;
         <code class="o">-</code><code class="n">rw</code><code class="o">-</code><code class="n">r</code><code class="o">--</code><code class="n">r</code><code class="o">--</code>  <code class="mi">1</code> <code class="n">kbehrman</code>  <code class="n">staff</code>    <code class="mi">41</code> <code class="n">Aug</code> <code class="mi">18</code> <code class="mi">15</code><code class="p">:</code><code class="mi">17</code> <code class="n">foo_plugin_a</code><code class="o">.</code><code class="n">py</code>&#13;
         <code class="o">-</code><code class="n">rw</code><code class="o">-</code><code class="n">r</code><code class="o">--</code><code class="n">r</code><code class="o">--</code>  <code class="mi">1</code> <code class="n">kbehrman</code>  <code class="n">staff</code>    <code class="mi">41</code> <code class="n">Aug</code> <code class="mi">18</code> <code class="mi">15</code><code class="p">:</code><code class="mi">47</code> <code class="n">foo_plugin_b</code><code class="o">.</code><code class="n">py</code>&#13;
         <code class="o">-</code><code class="n">rwxr</code><code class="o">-</code><code class="n">xr</code><code class="o">-</code><code class="n">x</code>  <code class="mi">1</code> <code class="n">kbehrman</code>  <code class="n">staff</code>   <code class="mi">335</code> <code class="n">Aug</code> <code class="mi">10</code> <code class="mi">12</code><code class="p">:</code><code class="mi">36</code> <code class="n">simple_click</code><code class="o">.</code><code class="n">py</code>&#13;
         <code class="o">-</code><code class="n">rwxr</code><code class="o">-</code><code class="n">xr</code><code class="o">-</code><code class="n">x</code>  <code class="mi">1</code> <code class="n">kbehrman</code>  <code class="n">staff</code>   <code class="mi">256</code> <code class="n">Aug</code> <code class="mi">13</code> <code class="mi">09</code><code class="p">:</code><code class="mi">21</code> <code class="n">simple_fire</code><code class="o">.</code><code class="n">py</code>&#13;
         <code class="o">-</code><code class="n">rwxr</code><code class="o">-</code><code class="n">xr</code><code class="o">-</code><code class="n">x</code>  <code class="mi">1</code> <code class="n">kbehrman</code>  <code class="n">staff</code>   <code class="mi">509</code> <code class="n">Aug</code>  <code class="mi">8</code> <code class="mi">10</code><code class="p">:</code><code class="mi">27</code> <code class="n">simple_parse</code><code class="o">.</code><code class="n">py</code>&#13;
         <code class="o">-</code><code class="n">rwxr</code><code class="o">-</code><code class="n">xr</code><code class="o">-</code><code class="n">x</code>  <code class="mi">1</code> <code class="n">kbehrman</code>  <code class="n">staff</code>   <code class="mi">502</code> <code class="n">Aug</code> <code class="mi">18</code> <code class="mi">15</code><code class="p">:</code><code class="mi">11</code> <code class="n">simple_plugins</code><code class="o">.</code><code class="n">py</code>&#13;
         <code class="o">-</code><code class="n">rwxr</code><code class="o">-</code><code class="n">xr</code><code class="o">-</code><code class="n">x</code>  <code class="mi">1</code> <code class="n">kbehrman</code>  <code class="n">staff</code>   <code class="mi">850</code> <code class="n">Aug</code>  <code class="mi">6</code> <code class="mi">14</code><code class="p">:</code><code class="mi">44</code> <code class="n">sys_argv</code><code class="o">.</code><code class="n">py</code>&#13;
         <code class="o">-</code><code class="n">rw</code><code class="o">-</code><code class="n">r</code><code class="o">--</code><code class="n">r</code><code class="o">--</code>  <code class="mi">1</code> <code class="n">kbehrman</code>  <code class="n">staff</code>   <code class="mi">182</code> <code class="n">Aug</code> <code class="mi">18</code> <code class="mi">16</code><code class="p">:</code><code class="mi">24</code> <code class="n">sys_example</code><code class="o">.</code><code class="n">py</code>&#13;
<code class="s1">'</code></pre>&#13;
&#13;
<p>The <a data-primary="subprocess.run() function" data-type="indexterm" id="idm46691340527080"/><code>subprocess.run</code> function returns a <code>CompletedProcess</code> instance once the process completes. In this case, we run the shell command <code>ls</code> with the argument <code>-l</code> to see the contents of the current directory. We  set it to capture <code>stdout</code> and <code>stderr</code> with the <code>capture_output</code> parameter. We then access the results using <code>cp.stdout</code>. If we run our <code>ls</code> command on a nonexistent directory, causing it to return an error, we can see the output in <code>cp.stderr</code>:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">cp</code> <code class="o">=</code> <code class="n">subprocess</code><code class="o">.</code><code class="n">run</code><code class="p">([</code><code class="s1">'ls'</code><code class="p">,</code><code class="s1">'/doesnotexist'</code><code class="p">],</code>&#13;
                            <code class="n">capture_output</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code>&#13;
                            <code class="n">universal_newlines</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">cp</code><code class="o">.</code><code class="n">stderr</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="s1">'ls: /doesnotexist: No such file or directory</code><code class="se">\n</code><code class="s1">'</code></pre>&#13;
&#13;
<p>You can better integrate the handling of errors by using the <code>check</code> parameter. This raises an exception if the subprocess reports an error:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">23</code><code class="p">]:</code> <code class="n">cp</code> <code class="o">=</code> <code class="n">subprocess</code><code class="o">.</code><code class="n">run</code><code class="p">([</code><code class="s1">'ls'</code><code class="p">,</code> <code class="s1">'/doesnotexist'</code><code class="p">],</code>&#13;
                             <code class="n">capture_output</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code>&#13;
                             <code class="n">universal_newlines</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code>&#13;
                             <code class="n">check</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>&#13;
<code class="o">---------------------------------------------------------------------------</code>&#13;
<code class="n">CalledProcessError</code>                        <code class="n">Traceback</code> <code class="p">(</code><code class="n">most</code> <code class="n">recent</code> <code class="n">call</code> <code class="n">last</code><code class="p">)</code>&#13;
<code class="o">&lt;</code><code class="n">ipython</code><code class="o">-</code><code class="nb">input</code><code class="o">-</code><code class="mi">23</code><code class="o">-</code><code class="n">c0ac49c40fee</code><code class="o">&gt;</code> <code class="ow">in</code> <code class="o">&lt;</code><code class="n">module</code><code class="o">&gt;</code>&#13;
<code class="o">----&gt;</code> <code class="mi">1</code> <code class="n">cp</code> <code class="o">=</code> <code class="n">subprocess</code><code class="o">.</code><code class="n">run</code><code class="p">([</code><code class="s1">'ls'</code><code class="p">,</code> <code class="s1">'/doesnotexist'</code><code class="p">],</code>&#13;
                            <code class="n">capture_output</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code>&#13;
                            <code class="n">universal_newlines</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code>&#13;
                            <code class="n">check</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>&#13;
&#13;
<code class="o">~/.</code><code class="n">pyenv</code><code class="o">/</code><code class="n">versions</code><code class="o">/</code><code class="mf">3.7</code><code class="o">.</code><code class="mi">0</code><code class="o">/</code><code class="n">lib</code><code class="o">/</code><code class="n">python3</code><code class="o">.</code><code class="mi">7</code><code class="o">/</code><code class="n">subprocess</code><code class="o">.</code><code class="n">py</code> <code class="o">...</code>&#13;
    <code class="mi">466</code>         <code class="k">if</code> <code class="n">check</code> <code class="ow">and</code> <code class="n">retcode</code><code class="p">:</code>&#13;
    <code class="mi">467</code>             <code class="k">raise</code> <code class="n">CalledProcessError</code><code class="p">(</code><code class="n">retcode</code><code class="p">,</code> <code class="n">process</code><code class="o">.</code><code class="n">args</code><code class="p">,</code>&#13;
<code class="o">--&gt;</code> <code class="mi">468</code>                                      <code class="n">output</code><code class="o">=</code><code class="n">stdout</code><code class="p">,</code> <code class="n">stderr</code><code class="o">=</code><code class="n">stderr</code><code class="p">)</code>&#13;
    <code class="mi">469</code>     <code class="k">return</code> <code class="n">CompletedProcess</code><code class="p">(</code><code class="n">process</code><code class="o">.</code><code class="n">args</code><code class="p">,</code> <code class="n">retcode</code><code class="p">,</code> <code class="n">stdout</code><code class="p">,</code> <code class="n">stderr</code><code class="p">)</code>&#13;
    <code class="mi">470</code>&#13;
&#13;
<code class="n">CalledProcessError</code><code class="p">:</code> <code class="n">Command</code> <code class="s1">'['</code><code class="n">ls</code><code class="s1">', '</code><code class="o">/</code><code class="n">doesnotexist</code><code class="s1">']'</code> <code class="n">returned</code> <code class="n">non</code><code class="o">-</code><code class="n">zero</code> <code class="nb">exit</code></pre>&#13;
&#13;
<p>In this way, you don’t have to check <code>stderr</code> for failures. You can treat errors from your subprocess much as you would other Python exceptions.<a data-startref="ix_ch03-asciidoc2" data-type="indexterm" id="idm46691340212216"/><a data-startref="ix_ch03-asciidoc1" data-type="indexterm" id="idm46691340211608"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before less_space" data-pdf-bookmark="Creating Command-Line Tools" data-type="sect1"><div class="sect1" id="idm46691340210840">&#13;
<h1>Creating Command-Line Tools</h1>&#13;
&#13;
<p><a data-primary="command-line tools" data-type="indexterm" id="ix_ch03-asciidoc3"/>The simplest way to invoke a Python script on the command line is to invoke it using Python.&#13;
When you construct a Python script, any statements at the top level (not nested in code blocks) run whenever the script is invoked or imported. If you have a function you want to run whenever your code is loaded, you can invoke it at the top level:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">say_it</code><code class="p">():</code>&#13;
    <code class="n">greeting</code> <code class="o">=</code> <code class="s1">'Hello'</code>&#13;
    <code class="n">target</code> <code class="o">=</code> <code class="s1">'Joe'</code>&#13;
    <code class="n">message</code> <code class="o">=</code> <code class="n">f</code><code class="s1">'{greeting} {target}'</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">message</code><code class="p">)</code>&#13;
&#13;
<code class="n">say_it</code><code class="p">()</code></pre>&#13;
&#13;
<p>This function runs whenever the script runs on the command line:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>python always_say_it.py&#13;
&#13;
Hello Joe</pre>&#13;
&#13;
<p>Also, when the file is imported:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">always_say_it</code>&#13;
<code class="n">Hello</code> <code class="n">Joe</code></pre>&#13;
&#13;
<p>This should only be done with the most straightforward scripts, however.&#13;
A significant downside to this approach is that if you want to import your module into other Python modules, the code runs during import instead of waiting to be invoked by the calling module. Someone who is importing your module usually wants control over when its contents are invoked.&#13;
You can add functionality that only happens when called from the command line by using the global <code><em>name</em></code> variable. You have seen that this variable reports the name of the module during import. If the module is called directly on the command line, this sets it to the string <code><em><em>main</em></em></code>. The convention for modules running on the command line is to end with a block testing for this and run command-line specific code from this block.&#13;
To modify the script to run a function automatically only when invoked on the command line, but not during import,  put the function invocation into the block after the test:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">say_it</code><code class="p">():</code>&#13;
    <code class="n">greeting</code> <code class="o">=</code> <code class="s1">'Hello'</code>&#13;
    <code class="n">target</code> <code class="o">=</code> <code class="s1">'Joe'</code>&#13;
    <code class="n">message</code> <code class="o">=</code> <code class="n">f</code><code class="s1">'{greeting} {target}'</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">message</code><code class="p">)</code>&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="n">say_it</code><code class="p">()</code></pre>&#13;
&#13;
<p>When you import this function, this block does not run, as the <code>__name__</code> variable reflects the module path as imported. It runs when the module is run directly, <span class="keep-together">however:</span></p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>python say_it.py&#13;
&#13;
Hello Joe</pre>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46691339777032">&#13;
<h5>Making Your Shell Script Executable</h5>&#13;
<p>To eliminate the need to explicitly call type <code>python</code> on the command line when you run your script, you can add the line <code>#!/usr/bin/env python</code> to the top of your file:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c-Hashbang">#!/usr/bin/env python</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">say_it</code><code class="p">():</code>&#13;
    <code class="n">greeting</code> <code class="o">=</code> <code class="s1">'Hello'</code>&#13;
    <code class="n">target</code> <code class="o">=</code> <code class="s1">'Joe'</code>&#13;
    <code class="n">message</code> <code class="o">=</code> <code class="n">f</code><code class="s1">'{greeting} {target}'</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">message</code><code class="p">)</code>&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="n">say_it</code><code class="p">()</code></pre>&#13;
&#13;
<p>Then make the file executable using <code>chmod</code> (a command-line tool for setting <span class="keep-together">permissions):</span></p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting">chmod +x say_it.py<code class="sb">`</code></pre>&#13;
&#13;
<p>You can then call it in a shell without directly invoking Python:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./say_it.py&#13;
&#13;
Hello Joe</pre>&#13;
</div></aside>&#13;
&#13;
<p>The first step in creating command-line tools is separating code that should only run when invoked on the command line. The next step is to accept command-line arguments. Unless your tool only does one thing, you need to accept commands to know what to do. Also, command-line tools that do more than the simplest tasks accept optional flags to configure their workings. Remember that these commands and flags are the <em>user interface</em> (UI) for anyone using your tools. You need to consider how easy they are to use and understand. Providing documentation is an essential part of making your code understandable.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using sys.argv" data-type="sect2"><div class="sect2" id="idm46691339665784">&#13;
<h2>Using sys.argv</h2>&#13;
&#13;
<p><a data-primary="command-line tools" data-secondary="creating using sys.argv" data-type="indexterm" id="ix_ch03-asciidoc4"/><a data-primary="sys.argv" data-type="indexterm" id="ix_ch03-asciidoc5"/>The simplest and most basic way to process arguments from the command line is to use the <code>argv</code> attribute of the <code>sys</code> module. This attribute is a list of arguments passed to a Python script at runtime. If the script runs on the command line, the first argument is the name of the script. The rest of the items in the list are any remaining command-line arguments, represented as strings:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c-Hashbang">#!/usr/bin/env python</code>&#13;
<code class="sd">"""</code>&#13;
<code class="sd">Simple command-line tool using sys.argv</code>&#13;
<code class="sd">"""</code>&#13;
<code class="kn">import</code> <code class="nn">sys</code>&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"The first argument:  '{sys.argv[0]}'"</code><code class="p">)</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"The second argument: '{sys.argv[1]}'"</code><code class="p">)</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"The third argument:  '{sys.argv[2]}'"</code><code class="p">)</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"The fourth argument: '{sys.argv[3]}'"</code><code class="p">)</code></pre>&#13;
&#13;
<p>Run it on the command line and see the arguments:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./sys_argv.py --a-flag some-value 13&#13;
&#13;
The first argument:  <code class="s1">'./sys_argv.py'</code>&#13;
The second argument: <code class="s1">'--a-flag'</code>&#13;
The third argument:  <code class="s1">'some-value'</code>&#13;
The fourth argument: <code class="s1">'13'</code></pre>&#13;
&#13;
<p>You can use these arguments to write your own argument parser. To see what this might look like, check out <a data-type="xref" href="#Example-3-2">Example 3-2</a>.</p>&#13;
<div data-type="example" id="Example-3-2">&#13;
<h5><span class="label">Example 3-2. </span>Parsing with sys.argv</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c-Hashbang">#!/usr/bin/env python</code><code>&#13;
</code><code class="sd">"""&#13;
Simple command-line tool using sys.argv&#13;
"""</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">sys</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">say_it</code><code class="p">(</code><code class="n">greeting</code><code class="p">,</code><code> </code><code class="n">target</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">message</code><code> </code><code class="o">=</code><code> </code><code class="n">f</code><code class="s1">'</code><code class="s1">{greeting} {target}</code><code class="s1">'</code><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">message</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="k">if</code><code> </code><code class="nv-Magic">__name__</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">__main__</code><code class="s1">'</code><code class="p">:</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO2-1" id="co_working_with_the_command_line_CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">greeting</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">Hello</code><code class="s1">'</code><code>  </code><a class="co" href="#callout_working_with_the_command_line_CO2-2" id="co_working_with_the_command_line_CO2-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">target</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">Joe</code><code class="s1">'</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="s1">'</code><code class="s1">--help</code><code class="s1">'</code><code> </code><code class="ow">in</code><code> </code><code class="n">sys</code><code class="o">.</code><code class="n">argv</code><code class="p">:</code><code>  </code><a class="co" href="#callout_working_with_the_command_line_CO2-3" id="co_working_with_the_command_line_CO2-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="n">help_message</code><code> </code><code class="o">=</code><code> </code><code class="n">f</code><code class="s2">"</code><code class="s2">Usage: {sys.argv[0]} --name &lt;NAME&gt; --greeting &lt;GREETING&gt;</code><code class="s2">"</code><code>&#13;
</code><code>        </code><code class="k">print</code><code class="p">(</code><code class="n">help_message</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">sys</code><code class="o">.</code><code class="n">exit</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" href="#callout_working_with_the_command_line_CO2-4" id="co_working_with_the_command_line_CO2-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="s1">'</code><code class="s1">--name</code><code class="s1">'</code><code> </code><code class="ow">in</code><code> </code><code class="n">sys</code><code class="o">.</code><code class="n">argv</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="c1"># Get position after name flag</code><code>&#13;
</code><code>        </code><code class="n">name_index</code><code> </code><code class="o">=</code><code> </code><code class="n">sys</code><code class="o">.</code><code class="n">argv</code><code class="o">.</code><code class="n">index</code><code class="p">(</code><code class="s1">'</code><code class="s1">--name</code><code class="s1">'</code><code class="p">)</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO2-5" id="co_working_with_the_command_line_CO2-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="n">name_index</code><code> </code><code class="o">&lt;</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">sys</code><code class="o">.</code><code class="n">argv</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO2-6" id="co_working_with_the_command_line_CO2-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>            </code><code class="n">name</code><code> </code><code class="o">=</code><code> </code><code class="n">sys</code><code class="o">.</code><code class="n">argv</code><code class="p">[</code><code class="n">name_index</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="s1">'</code><code class="s1">--greeting</code><code class="s1">'</code><code> </code><code class="ow">in</code><code> </code><code class="n">sys</code><code class="o">.</code><code class="n">argv</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="c1"># Get position after greeting flag</code><code>&#13;
</code><code>        </code><code class="n">greeting_index</code><code> </code><code class="o">=</code><code> </code><code class="n">sys</code><code class="o">.</code><code class="n">argv</code><code class="o">.</code><code class="n">index</code><code class="p">(</code><code class="s1">'</code><code class="s1">--greeting</code><code class="s1">'</code><code class="p">)</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="n">greeting_index</code><code> </code><code class="o">&lt;</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">sys</code><code class="o">.</code><code class="n">argv</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>            </code><code class="n">greeting</code><code> </code><code class="o">=</code><code> </code><code class="n">sys</code><code class="o">.</code><code class="n">argv</code><code class="p">[</code><code class="n">greeting_index</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">say_it</code><code class="p">(</code><code class="n">greeting</code><code class="p">,</code><code> </code><code class="n">name</code><code class="p">)</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO2-7" id="co_working_with_the_command_line_CO2-7"><img alt="7" src="assets/7.png"/></a></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO2-1" id="callout_working_with_the_command_line_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Here we test to see if we are running from the command line.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO2-2" id="callout_working_with_the_command_line_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Default values are set in these two lines.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO2-3" id="callout_working_with_the_command_line_CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Check if the string <code>--help</code> is in the list of arguments.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO2-4" id="callout_working_with_the_command_line_CO2-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Exit the program after printing the help message.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO2-5" id="callout_working_with_the_command_line_CO2-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We need the position of the value after the flag, which should be the associated value.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO2-6" id="callout_working_with_the_command_line_CO2-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Test that the arguments list is long enough. It will not be if the flag was provided without a value.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO2-7" id="callout_working_with_the_command_line_CO2-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>Call the function with the values as modified by the arguments.</p></dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#Example-3-2">Example 3-2</a> goes far enough to print out a simple help message and accept arguments to the function:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./sys_argv.py --help&#13;
Usage: ./sys_argv.py --name &lt;NAME&gt; --greeting &lt;GREETING&gt;&#13;
&#13;
<code class="nv">$ </code>./sys_argv.py --name Sally --greeting Bonjour&#13;
Bonjour Sally</pre>&#13;
&#13;
<p>This approach is fraught with complication and potential bugs. <a data-type="xref" href="#Example-3-2">Example 3-2</a> fails to handle many situations. If a user misspells or miscapitalizes a flag, the flag is ignored with no useful feedback. If they use commands that are not supported or try to use more than one value with a flag, once again the error is ignored. You should be aware of the <code>argv</code> parsing approach, but do not use it for any production code unless you specifically set out to write an argument parser.&#13;
Luckily there are modules and packages designed for the creation of command-line tools. These packages provide frameworks to design the user interface for your module when running in a shell. Three popular solutions are <em>argparse</em>, <em>click</em>, and <em>python-fire</em>. All three include ways to design required arguments, optional flags, and means to display help documentation.&#13;
The first, <code>argparse</code>, is part of the Python standard library, and the other two are third-party packages that need to be installed separately (using <code>pip</code>).<a data-startref="ix_ch03-asciidoc5" data-type="indexterm" id="idm46691339216024"/><a data-startref="ix_ch03-asciidoc4" data-type="indexterm" id="idm46691339203736"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using argparse" data-type="sect2"><div class="sect2" id="idm46691339645976">&#13;
<h2>Using argparse</h2>&#13;
&#13;
<p><a data-primary="argparse" data-type="indexterm" id="ix_ch03-asciidoc6"/><a data-primary="command-line tools" data-secondary="creating using argparse" data-type="indexterm" id="ix_ch03-asciidoc7"/><code>argparse</code> abstracts away many of the details of parsing arguments. With it, you design your command-line user interface in detail, defining commands and flags along with their help messages. It uses the idea of parser objects, to which you attach commands and flags. The parser then parses the arguments, and you use the results to call your code. You construct your interface using <code>ArgumentParser</code> objects that parse user input for you:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="n">parser</code> <code class="o">=</code> <code class="n">argparse</code><code class="o">.</code><code class="n">ArgumentParser</code><code class="p">(</code><code class="n">description</code><code class="o">=</code><code class="s1">'Maritime control'</code><code class="p">)</code></pre>&#13;
&#13;
<p>You add position-based commands or optional flags to the parser using the <code>add_argument</code> method (see <a data-type="xref" href="#Example-3-3">Example 3-3</a>). The first argument to this method is the name of the new argument (command or flag). If the name begins with a dash, it is treated as an optional flag argument; otherwise it is treated as a position-dependent command.&#13;
The parser creates a parsed-arguments object, with the arguments as attributes that you can then use to access input. <a data-type="xref" href="#Example-3-3">Example 3-3</a> is a simple program that echoes a users input and shows the basics of how <code>argparse</code> works.</p>&#13;
<div data-type="example" id="Example-3-3">&#13;
<h5><span class="label">Example 3-3. </span>simple_parse.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c-Hashbang">#!/usr/bin/env python</code><code>&#13;
</code><code class="sd">"""&#13;
Command-line tool using argparse&#13;
"""</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">argparse</code><code>&#13;
</code><code>&#13;
</code><code>&#13;
</code><code class="k">if</code><code> </code><code class="nv-Magic">__name__</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">__main__</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">parser</code><code> </code><code class="o">=</code><code> </code><code class="n">argparse</code><code class="o">.</code><code class="n">ArgumentParser</code><code class="p">(</code><code class="n">description</code><code class="o">=</code><code class="s1">'</code><code class="s1">Echo your input</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO3-1" id="co_working_with_the_command_line_CO3-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">parser</code><code class="o">.</code><code class="n">add_argument</code><code class="p">(</code><code class="s1">'</code><code class="s1">message</code><code class="s1">'</code><code class="p">,</code><code>               </code><a class="co" href="#callout_working_with_the_command_line_CO3-2" id="co_working_with_the_command_line_CO3-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>                        </code><code class="n">help</code><code class="o">=</code><code class="s1">'</code><code class="s1">Message to echo</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">parser</code><code class="o">.</code><code class="n">add_argument</code><code class="p">(</code><code class="s1">'</code><code class="s1">--twice</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">-t</code><code class="s1">'</code><code class="p">,</code><code>         </code><a class="co" href="#callout_working_with_the_command_line_CO3-3" id="co_working_with_the_command_line_CO3-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>                        </code><code class="n">help</code><code class="o">=</code><code class="s1">'</code><code class="s1">Do it twice</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>                        </code><code class="n">action</code><code class="o">=</code><code class="s1">'</code><code class="s1">store_true</code><code class="s1">'</code><code class="p">)</code><code>     </code><a class="co" href="#callout_working_with_the_command_line_CO3-4" id="co_working_with_the_command_line_CO3-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">args</code><code> </code><code class="o">=</code><code> </code><code class="n">parser</code><code class="o">.</code><code class="n">parse_args</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" href="#callout_working_with_the_command_line_CO3-5" id="co_working_with_the_command_line_CO3-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">args</code><code class="o">.</code><code class="n">message</code><code class="p">)</code><code>    </code><a class="co" href="#callout_working_with_the_command_line_CO3-6" id="co_working_with_the_command_line_CO3-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="n">args</code><code class="o">.</code><code class="n">twice</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="k">print</code><code class="p">(</code><code class="n">args</code><code class="o">.</code><code class="n">message</code><code class="p">)</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO3-1" id="callout_working_with_the_command_line_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Create the parser object, with its documentation message.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO3-2" id="callout_working_with_the_command_line_CO3-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Add a position-based command with its help message.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO3-3" id="callout_working_with_the_command_line_CO3-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Add an optional argument.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO3-4" id="callout_working_with_the_command_line_CO3-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Store the optional argument as a boolean value.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO3-5" id="callout_working_with_the_command_line_CO3-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Use the parser to parse the arguments.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO3-6" id="callout_working_with_the_command_line_CO3-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Access the argument values by name. The optional argument’s name has the <em>--</em> removed.</p></dd>&#13;
</dl>&#13;
&#13;
<p>When you run it with the <code>--twice</code> flag, the input message prints twice:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./simple_parse.py hello --twice&#13;
hello&#13;
hello</pre>&#13;
&#13;
<p><code>argparse</code> automatically sets up help and usage messages based on the help and description text you supply:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./simple_parse.py  --help&#13;
usage: simple_parse.py <code class="o">[</code>-h<code class="o">]</code> <code class="o">[</code>--twice<code class="o">]</code> message&#13;
&#13;
Echo your input&#13;
&#13;
positional arguments:&#13;
  message      Message to <code class="nb">echo</code>&#13;
&#13;
optional arguments:&#13;
  -h, --help   show this <code class="nb">help </code>message and <code class="nb">exit</code>&#13;
  --twice, -t  Do it twice</pre>&#13;
&#13;
<p>Many command-line tools use nested levels of commands to group command areas of control. Think of <a data-primary="Git" data-secondary="nested commands" data-type="indexterm" id="idm46691338961512"/><code>git</code>. It has top-level commands, such as <code>git stash</code>, which have separate commands under them, such as <code>git stash pop</code>. With <code>argparse</code>, you create subcommands by creating subparsers under your main parser. You can create a hierarchy of commands using subparsers. In <a data-type="xref" href="#Example-3-4">Example 3-4</a>, we implement a maritime application that has commands for ships and sailors. Two subparsers are added to the main parser; each subparser has its own commands.</p>&#13;
<div data-type="example" id="Example-3-4">&#13;
<h5><span class="label">Example 3-4. </span>argparse_example.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c-Hashbang">#!/usr/bin/env python</code><code>&#13;
</code><code class="sd">"""&#13;
Command-line tool using argparse&#13;
"""</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">argparse</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">sail</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">ship_name</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">Your ship</code><code class="s1">'</code><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">{ship_name} is setting sail</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">list_ships</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">ships</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="s1">'</code><code class="s1">John B</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">Yankee Clipper</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">Pequod</code><code class="s1">'</code><code class="p">]</code><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">Ships: {</code><code class="s2">'</code><code class="s2">,</code><code class="s2">'</code><code class="s2">.join(ships)}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">greet</code><code class="p">(</code><code class="n">greeting</code><code class="p">,</code><code> </code><code class="n">name</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">message</code><code> </code><code class="o">=</code><code> </code><code class="n">f</code><code class="s1">'</code><code class="s1">{greeting} {name}</code><code class="s1">'</code><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">message</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="k">if</code><code> </code><code class="nv-Magic">__name__</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">__main__</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">parser</code><code> </code><code class="o">=</code><code> </code><code class="n">argparse</code><code class="o">.</code><code class="n">ArgumentParser</code><code class="p">(</code><code class="n">description</code><code class="o">=</code><code class="s1">'</code><code class="s1">Maritime control</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO4-1" id="co_working_with_the_command_line_CO4-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">parser</code><code class="o">.</code><code class="n">add_argument</code><code class="p">(</code><code class="s1">'</code><code class="s1">--twice</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">-t</code><code class="s1">'</code><code class="p">,</code><code>   </code><a class="co" href="#callout_working_with_the_command_line_CO4-2" id="co_working_with_the_command_line_CO4-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>                        </code><code class="n">help</code><code class="o">=</code><code class="s1">'</code><code class="s1">Do it twice</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>                        </code><code class="n">action</code><code class="o">=</code><code class="s1">'</code><code class="s1">store_true</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">subparsers</code><code> </code><code class="o">=</code><code> </code><code class="n">parser</code><code class="o">.</code><code class="n">add_subparsers</code><code class="p">(</code><code class="n">dest</code><code class="o">=</code><code class="s1">'</code><code class="s1">func</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO4-3" id="co_working_with_the_command_line_CO4-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">ship_parser</code><code> </code><code class="o">=</code><code>  </code><code class="n">subparsers</code><code class="o">.</code><code class="n">add_parser</code><code class="p">(</code><code class="s1">'</code><code class="s1">ships</code><code class="s1">'</code><code class="p">,</code><code>  </code><a class="co" href="#callout_working_with_the_command_line_CO4-4" id="co_working_with_the_command_line_CO4-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>                                         </code><code class="n">help</code><code class="o">=</code><code class="s1">'</code><code class="s1">Ship related commands</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="n">ship_parser</code><code class="o">.</code><code class="n">add_argument</code><code class="p">(</code><code class="s1">'</code><code class="s1">command</code><code class="s1">'</code><code class="p">,</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO4-5" id="co_working_with_the_command_line_CO4-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>                             </code><code class="n">choices</code><code class="o">=</code><code class="p">[</code><code class="s1">'</code><code class="s1">list</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">sail</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">sailor_parser</code><code> </code><code class="o">=</code><code> </code><code class="n">subparsers</code><code class="o">.</code><code class="n">add_parser</code><code class="p">(</code><code class="s1">'</code><code class="s1">sailors</code><code class="s1">'</code><code class="p">,</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO4-6" id="co_working_with_the_command_line_CO4-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>                                          </code><code class="n">help</code><code class="o">=</code><code class="s1">'</code><code class="s1">Talk to a sailor</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="n">sailor_parser</code><code class="o">.</code><code class="n">add_argument</code><code class="p">(</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">,</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO4-7" id="co_working_with_the_command_line_CO4-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>                               </code><code class="n">help</code><code class="o">=</code><code class="s1">'</code><code class="s1">Sailors name</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="n">sailor_parser</code><code class="o">.</code><code class="n">add_argument</code><code class="p">(</code><code class="s1">'</code><code class="s1">--greeting</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">-g</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>                               </code><code class="n">help</code><code class="o">=</code><code class="s1">'</code><code class="s1">Greeting</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>                               </code><code class="n">default</code><code class="o">=</code><code class="s1">'</code><code class="s1">Ahoy there</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">args</code><code> </code><code class="o">=</code><code> </code><code class="n">parser</code><code class="o">.</code><code class="n">parse_args</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="n">args</code><code class="o">.</code><code class="n">func</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">sailors</code><code class="s1">'</code><code class="p">:</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO4-8" id="co_working_with_the_command_line_CO4-8"><img alt="8" src="assets/8.png"/></a><code>&#13;
</code><code>        </code><code class="n">greet</code><code class="p">(</code><code class="n">args</code><code class="o">.</code><code class="n">greeting</code><code class="p">,</code><code> </code><code class="n">args</code><code class="o">.</code><code class="n">name</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="k">elif</code><code> </code><code class="n">args</code><code class="o">.</code><code class="n">command</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">list</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="n">list_ships</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="k">else</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="n">sail</code><code class="p">(</code><code class="p">)</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO4-1" id="callout_working_with_the_command_line_CO4-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Create the top-level parser.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO4-2" id="callout_working_with_the_command_line_CO4-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Add a top-level argument that can be used along with any command under this parser’s hierarchy.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO4-3" id="callout_working_with_the_command_line_CO4-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Create a subparser object to hold the subparsers. The <code>dest</code> is the name of the attribute used to choose a subparser.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO4-4" id="callout_working_with_the_command_line_CO4-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Add a subparser for <em>ships</em>.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO4-5" id="callout_working_with_the_command_line_CO4-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Add a command to the <em>ships</em> subparser. The <code>choices</code> parameter gives a list of possible choices for the command.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO4-6" id="callout_working_with_the_command_line_CO4-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Add a subparser for <em>sailors</em>.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO4-7" id="callout_working_with_the_command_line_CO4-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>Add a required positional argument to the <em>sailors</em> subparser.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO4-8" id="callout_working_with_the_command_line_CO4-8"><img alt="8" src="assets/8.png"/></a></dt>&#13;
<dd><p>Check which subparser is used by checking the <code>func</code> value.</p></dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#Example-3-4">Example 3-4</a> has one top-level optional argument (<code>twice</code>) and two subparsers. Each subparser has its own commands and flags.&#13;
<code>argparse</code> automatically creates a hierarchy of help messages and displays them with the <code>--help</code> flag. The top-level help commands, including the subparsers and the top-level <code>twice</code> argument, are documented:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./argparse_example.py --help&#13;
usage: argparse_example.py <code class="o">[</code>-h<code class="o">]</code> <code class="o">[</code>--twice<code class="o">]</code> <code class="o">{</code>ships,sailors<code class="o">}</code> ...&#13;
&#13;
Maritime control&#13;
&#13;
positional arguments:&#13;
  <code class="o">{</code>ships,sailors<code class="o">}</code>&#13;
    ships          Ship related commands&#13;
    sailors        Talk to a sailor&#13;
&#13;
optional arguments:&#13;
  -h, --help       show this <code class="nb">help </code>message and <code class="nb">exit</code>&#13;
  --twice, -t      Do it twice</pre>&#13;
&#13;
<p>You can dig into the subcommands (subparsers) by using the <code>help</code> flag after the <span class="keep-together">command:</span></p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./argparse_example.py ships --help&#13;
usage: argparse_example.py ships <code class="o">[</code>-h<code class="o">]</code> <code class="o">{</code>list,sail<code class="o">}</code>&#13;
&#13;
positional arguments:&#13;
  <code class="o">{</code>list,sail<code class="o">}</code>&#13;
&#13;
optional arguments:&#13;
  -h, --help   show this <code class="nb">help </code>message and <code class="nb">exit</code></pre>&#13;
&#13;
<p>As you can see, <code>argparse</code> gives you a lot of control over your command-line interface. You can design a multilayered interface with built-in documentation with many options to fine-tune your design. Doing so takes a lot of work on your part, however, so let’s look at some easier options.<a data-startref="ix_ch03-asciidoc7" data-type="indexterm" id="idm46691338337736"/><a data-startref="ix_ch03-asciidoc6" data-type="indexterm" id="idm46691338337128"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using click" data-type="sect2"><div class="sect2" id="idm46691339202600">&#13;
<h2>Using click</h2>&#13;
&#13;
<p><a data-primary="click" data-type="indexterm" id="ix_ch03-asciidoc8"/><a data-primary="command-line tools" data-secondary="creating using click" data-type="indexterm" id="ix_ch03-asciidoc9"/>The <code>click</code> package was first developed to work with web framework <code>flask</code>. It uses Python <em>function decorators</em> to bind the command-line interface directly with your functions.&#13;
Unlike <code>argparse</code>, <code>click</code> interweaves your interface decisions directly with the rest of your code.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="Decorators">&#13;
<h5>Function Decorators</h5>&#13;
<p><a data-primary="function decorators" data-type="indexterm" id="idm46691338878040"/>Python decorators are a special syntax for functions which take other functions as arguments. Python functions are objects, so any function can take a function as an argument. The decorator syntax provides a clean and easy way to do this. The basic format of a decorator is:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="k">def</code> <code class="nf">some_decorator</code><code class="p">(</code><code class="n">wrapped_function</code><code class="p">):</code>&#13;
   <code class="o">...</code><code class="p">:</code>     <code class="k">def</code> <code class="nf">wrapper</code><code class="p">():</code>&#13;
   <code class="o">...</code><code class="p">:</code>         <code class="k">print</code><code class="p">(</code><code class="s1">'Do something before calling wrapped function'</code><code class="p">)</code>&#13;
   <code class="o">...</code><code class="p">:</code>         <code class="n">wrapped_function</code><code class="p">()</code>&#13;
   <code class="o">...</code><code class="p">:</code>         <code class="k">print</code><code class="p">(</code><code class="s1">'Do something after calling wrapped function'</code><code class="p">)</code>&#13;
   <code class="o">...</code><code class="p">:</code>     <code class="k">return</code> <code class="n">wrapper</code>&#13;
   <code class="o">...</code><code class="p">:</code></pre>&#13;
&#13;
<p>You can define a function and pass it as an argument to this function:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="k">def</code> <code class="nf">foobat</code><code class="p">():</code>&#13;
   <code class="o">...</code><code class="p">:</code>     <code class="k">print</code><code class="p">(</code><code class="s1">'foobat'</code><code class="p">)</code>&#13;
   <code class="o">...</code><code class="p">:</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">f</code> <code class="o">=</code> <code class="n">some_decorator</code><code class="p">(</code><code class="n">foobat</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="n">f</code><code class="p">()</code>&#13;
<code class="n">Do</code> <code class="n">something</code> <code class="n">before</code> <code class="n">calling</code> <code class="n">wrapped</code> <code class="n">function</code>&#13;
<code class="n">foobat</code>&#13;
<code class="n">Do</code> <code class="n">something</code> <code class="n">after</code> <code class="n">calling</code> <code class="n">wrapped</code> <code class="n">function</code></pre>&#13;
&#13;
<p>The decorator syntax simplifies this by indicating which function should be wrapped by <em>decorating</em> it with  <code>@decorator_name</code>. Here is an example using the decorator syntax with our <code>some_decorator</code> function:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="nd">@some_decorator</code>&#13;
   <code class="o">...</code><code class="p">:</code> <code class="k">def</code> <code class="nf">batfoo</code><code class="p">():</code>&#13;
   <code class="o">...</code><code class="p">:</code>     <code class="k">print</code><code class="p">(</code><code class="s1">'batfoo'</code><code class="p">)</code>&#13;
   <code class="o">...</code><code class="p">:</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="n">batfoo</code><code class="p">()</code>&#13;
<code class="n">Do</code> <code class="n">something</code> <code class="n">before</code> <code class="n">calling</code> <code class="n">wrapped</code> <code class="n">function</code>&#13;
<code class="n">batfoo</code>&#13;
<code class="n">Do</code> <code class="n">something</code> <code class="n">after</code> <code class="n">calling</code> <code class="n">wrapped</code> <code class="n">function</code></pre>&#13;
&#13;
<p class="pagebreak-before">Now you call your wrapped function using its name rather than the decorator name. Pre-built functions intended as decorators are offered both as part of the Python Standard Library (<code>staticMethod</code>, <code>classMethod</code>) and as part of third-party packages, such as Flask and Click.</p>&#13;
</div></aside>&#13;
&#13;
<p>This means that you tie your flags and options directly to the parameters of the functions that they expose. You can create a simple command-line tool from your functions using click’s <code>command</code> and <code>option</code> functions as decorators before your function:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c-Hashbang">#!/usr/bin/env python</code>&#13;
<code class="sd">"""</code>&#13;
<code class="sd">Simple Click example</code>&#13;
<code class="sd">"""</code>&#13;
<code class="kn">import</code> <code class="nn">click</code>&#13;
&#13;
<code class="nd">@click.command</code><code class="p">()</code>&#13;
<code class="nd">@click.option</code><code class="p">(</code><code class="s1">'--greeting'</code><code class="p">,</code> <code class="n">default</code><code class="o">=</code><code class="s1">'Hiya'</code><code class="p">,</code> <code class="n">help</code><code class="o">=</code><code class="s1">'How do you want to greet?'</code><code class="p">)</code>&#13;
<code class="nd">@click.option</code><code class="p">(</code><code class="s1">'--name'</code><code class="p">,</code> <code class="n">default</code><code class="o">=</code><code class="s1">'Tammy'</code><code class="p">,</code> <code class="n">help</code><code class="o">=</code><code class="s1">'Who do you want to greet?'</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">greet</code><code class="p">(</code><code class="n">greeting</code><code class="p">,</code> <code class="n">name</code><code class="p">):</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"{greeting} {name}"</code><code class="p">)</code>&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="n">greet</code><code class="p">()</code></pre>&#13;
&#13;
<p><a data-primary="click.command" data-type="indexterm" id="idm46691338198680"/><code>click.command</code> indicates that a function should be exposed to command-line access. <a data-primary="click.option" data-type="indexterm" id="idm46691338136872"/><code>click.option</code> adds an argument to the command-line, automatically linking it to the function parameter of the same name (<code>--greeting</code> to <code>greet</code> and <code>--name</code> to <code>name</code>). <code>click</code> does some work behind the scenes so that we can call our <code>greet</code> method in our main block without parameters that are covered by the <code>options</code> decorators.</p>&#13;
&#13;
<p>These decorators handle parsing command-line arguments and automatically produce help messages:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./simple_click.py --greeting Privet --name Peggy&#13;
Privet Peggy&#13;
&#13;
<code class="nv">$ </code>./simple_click.py --help&#13;
Usage: simple_click.py <code class="o">[</code>OPTIONS<code class="o">]</code>&#13;
&#13;
Options:&#13;
  --greeting TEXT  How <code class="k">do</code> you want to greet?&#13;
  --name TEXT      Who <code class="k">do</code> you want to greet?&#13;
  --help           Show this message and exit.</pre>&#13;
&#13;
<p>You can see that with <code>click</code> you can expose your functions for command-line use with much less code than <code>argparse</code>. You can concentrate on the business logic of your code rather than designing the interface.</p>&#13;
&#13;
<p>Now let’s look at a more complicated example with nested commands.&#13;
Commands are nested by using <a data-primary="click.group" data-type="indexterm" id="idm46691338128280"/><code>click.group</code> creating functions that represent the groups. In <a data-type="xref" href="#Example-3-5">Example 3-5</a> we nest commands with <code>argparse</code>, using an interface that is very similar to the one from <a data-type="xref" href="#Example-3-4">Example 3-4</a>.</p>&#13;
<div data-type="example" id="Example-3-5">&#13;
<h5><span class="label">Example 3-5. </span>click_example.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c-Hashbang">#!/usr/bin/env python</code><code>&#13;
</code><code class="sd">"""&#13;
Command-line tool using argparse&#13;
"""</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">click</code><code>&#13;
</code><code>&#13;
</code><code class="nd">@click.group</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO5-1" id="co_working_with_the_command_line_CO5-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">cli</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO5-2" id="co_working_with_the_command_line_CO5-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="k">pass</code><code>&#13;
</code><code>&#13;
</code><code class="nd">@click.group</code><code class="p">(</code><code class="n">help</code><code class="o">=</code><code class="s1">'</code><code class="s1">Ship related commands</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO5-3" id="co_working_with_the_command_line_CO5-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">ships</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="k">pass</code><code>&#13;
</code><code>&#13;
</code><code class="n">cli</code><code class="o">.</code><code class="n">add_command</code><code class="p">(</code><code class="n">ships</code><code class="p">)</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO5-4" id="co_working_with_the_command_line_CO5-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="nd">@ships.command</code><code class="p">(</code><code class="n">help</code><code class="o">=</code><code class="s1">'</code><code class="s1">Sail a ship</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO5-5" id="co_working_with_the_command_line_CO5-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">sail</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">ship_name</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">Your ship</code><code class="s1">'</code><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">{ship_name} is setting sail</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="nd">@ships.command</code><code class="p">(</code><code class="n">help</code><code class="o">=</code><code class="s1">'</code><code class="s1">List all of the ships</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">list_ships</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">ships</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="s1">'</code><code class="s1">John B</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">Yankee Clipper</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">Pequod</code><code class="s1">'</code><code class="p">]</code><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">Ships: {</code><code class="s2">'</code><code class="s2">,</code><code class="s2">'</code><code class="s2">.join(ships)}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="nd">@cli.command</code><code class="p">(</code><code class="n">help</code><code class="o">=</code><code class="s1">'</code><code class="s1">Talk to a sailor</code><code class="s1">'</code><code class="p">)</code><code>  </code><a class="co" href="#callout_working_with_the_command_line_CO5-6" id="co_working_with_the_command_line_CO5-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code class="nd">@click.option</code><code class="p">(</code><code class="s1">'</code><code class="s1">--greeting</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">default</code><code class="o">=</code><code class="s1">'</code><code class="s1">Ahoy there</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">help</code><code class="o">=</code><code class="s1">'</code><code class="s1">Greeting for sailor</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code class="nd">@click.argument</code><code class="p">(</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">sailors</code><code class="p">(</code><code class="n">greeting</code><code class="p">,</code><code> </code><code class="n">name</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">message</code><code> </code><code class="o">=</code><code> </code><code class="n">f</code><code class="s1">'</code><code class="s1">{greeting} {name}</code><code class="s1">'</code><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">message</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="k">if</code><code> </code><code class="nv-Magic">__name__</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">__main__</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">cli</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" href="#callout_working_with_the_command_line_CO5-7" id="co_working_with_the_command_line_CO5-7"><img alt="7" src="assets/7.png"/></a></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO5-1" id="callout_working_with_the_command_line_CO5-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Create a top-level group under which other groups and commands will reside.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO5-2" id="callout_working_with_the_command_line_CO5-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Create a function to act as the top-level group. The <code>click.group</code> method transforms the function into a group.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO5-3" id="callout_working_with_the_command_line_CO5-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Create a group to hold the <code>ships</code> commands.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO5-4" id="callout_working_with_the_command_line_CO5-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Add the <code>ships</code> group as a command to the top-level group. Note that the <code>cli</code> function is now a group with an <code>add_command</code> method.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO5-5" id="callout_working_with_the_command_line_CO5-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Add a command to the <code>ships</code> group. Notice that <code>ships.command</code> is used instead of <code>click.command</code>.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO5-6" id="callout_working_with_the_command_line_CO5-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Add a command to the <code>cli</code> group.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO5-7" id="callout_working_with_the_command_line_CO5-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>Call the top-level group.</p></dd>&#13;
</dl>&#13;
&#13;
<p>The top-level help messages generated by <code>click</code> look like this:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting">./click_example.py --help&#13;
Usage: click_example.py <code class="o">[</code>OPTIONS<code class="o">]</code> COMMAND <code class="o">[</code>ARGS<code class="o">]</code>...&#13;
&#13;
Options:&#13;
  --help  Show this message and exit.&#13;
&#13;
Commands:&#13;
  sailors  Talk to a sailor&#13;
  ships    Ship related commands</pre>&#13;
&#13;
<p>You can dig into the help for a subgroup like this:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./click_example.py ships --help&#13;
Usage: click_example.py ships <code class="o">[</code>OPTIONS<code class="o">]</code> COMMAND <code class="o">[</code>ARGS<code class="o">]</code>...&#13;
&#13;
  Ship related commands&#13;
&#13;
Options:&#13;
  --help  Show this message and exit.&#13;
&#13;
Commands:&#13;
  list-ships  List all of the ships&#13;
  sail        Sail a ship</pre>&#13;
&#13;
<p>If you compare <a data-type="xref" href="#Example-3-4">Example 3-4</a> and <a data-type="xref" href="#Example-3-5">Example 3-5</a>, you will see some of the differences between using <code>argparse</code> and <code>click</code>. The <code>click</code> approach certainly requires less code, almost half in these examples. The user interface (UI) code is interspersed throughout the whole program; it is especially important when creating functions that solely act as groups. If you have a complex program, with a complex interface, you should try as best as possible to isolate different functionality. By doing so, you make individual pieces easier to test and debug. In such a case, you might choose <code>argparse</code> to keep your interface code separate.<a data-startref="ix_ch03-asciidoc9" data-type="indexterm" id="idm46691337765320"/><a data-startref="ix_ch03-asciidoc8" data-type="indexterm" id="idm46691337764616"/></p>&#13;
<aside class="pagebreak-before less_space" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46691337763944">&#13;
<h5>Defining Classes</h5>&#13;
<p><a data-primary="class definition" data-type="indexterm" id="idm46691337759976"/>A class definition starts with the keyword <code>class</code> followed by the class name and parentheses:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="k">class</code> <code class="nc">MyClass</code><code class="p">():</code></pre>&#13;
&#13;
<p>Attributes and method definitions follow in the indented code block. All methods of a class recieve as their first parameter a copy of the instantiated class object. By convention this is refered to as <code>self</code>:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="k">class</code> <code class="nc">MyClass</code><code class="p">():</code>&#13;
   <code class="o">...</code><code class="p">:</code>     <code class="k">def</code> <code class="nf">some_method</code><code class="p">(</code><code class="bp">self</code><code class="p">):</code>&#13;
   <code class="o">...</code><code class="p">:</code>         <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"Say hi to {self}"</code><code class="p">)</code>&#13;
   <code class="o">...</code><code class="p">:</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="n">myObject</code> <code class="o">=</code> <code class="n">MyClass</code><code class="p">()</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">myObject</code><code class="o">.</code><code class="n">some_method</code><code class="p">()</code>&#13;
<code class="n">Say</code> <code class="n">hi</code> <code class="n">to</code> <code class="o">&lt;</code><code class="n">__main__</code><code class="o">.</code><code class="n">MyClass</code> <code class="nb">object</code> <code class="n">at</code> <code class="mh">0x1056f4160</code><code class="o">&gt;</code></pre>&#13;
&#13;
<p>Every class has an <a data-primary="__init__() method" data-primary-sortas="init" data-type="indexterm" id="idm46691337667912"/><a data-primary="init method" data-type="indexterm" id="idm46691337632168"/><code><em>init</em></code> method. When the class is instantiated, this method is called. If you do not define this method, it gets a default one, inherited from the Python base object class:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">MyClass</code><code class="o">.</code><code class="nf-Magic">__init__</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="o">&lt;</code><code class="n">slot</code> <code class="n">wrapper</code> <code class="s1">'__init__'</code> <code class="n">of</code> <code class="s1">'object'</code> <code class="n">objects</code><code class="o">&gt;</code></pre>&#13;
&#13;
<p>Generally you define an object’s attributes in the <code><em>init</em></code> method:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="k">class</code> <code class="nc">MyOtherClass</code><code class="p">():</code>&#13;
   <code class="o">...</code><code class="p">:</code>     <code class="k">def</code> <code class="nf-Magic">__init__</code><code class="p">(</code><code class="bp">self</code><code class="p">,</code> <code class="n">name</code><code class="p">):</code>&#13;
   <code class="o">...</code><code class="p">:</code>         <code class="bp">self</code><code class="o">.</code><code class="n">name</code> <code class="o">=</code> <code class="n">name</code>&#13;
   <code class="o">...</code><code class="p">:</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="n">myOtherObject</code> <code class="o">=</code> <code class="n">MyOtherClass</code><code class="p">(</code><code class="s1">'Sammy'</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="n">myOtherObject</code><code class="o">.</code><code class="n">name</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="s1">'Sammy'</code></pre>&#13;
</div></aside>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="fire" data-type="sect2"><div class="sect2" id="idm46691338335992">&#13;
<h2>fire</h2>&#13;
&#13;
<p><a data-primary="command-line tools" data-secondary="creating using fire" data-type="indexterm" id="ix_ch03-asciidoc10"/><a data-primary="fire" data-type="indexterm" id="ix_ch03-asciidoc11"/>Now, let’s take a step farther down the road of making a command-line tool with minimal UI code. The <code>fire</code> package uses introspection of your code to create interfaces automatically. If you have a simple function you want to expose, you call <code>fire.Fire</code> with it as an argument:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c-Hashbang">#!/usr/bin/env python</code>&#13;
<code class="sd">"""</code>&#13;
<code class="sd">Simple fire example</code>&#13;
<code class="sd">"""</code>&#13;
<code class="kn">import</code> <code class="nn">fire</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">greet</code><code class="p">(</code><code class="n">greeting</code><code class="o">=</code><code class="s1">'Hiya'</code><code class="p">,</code> <code class="n">name</code><code class="o">=</code><code class="s1">'Tammy'</code><code class="p">):</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"{greeting} {name}"</code><code class="p">)</code>&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="n">fire</code><code class="o">.</code><code class="n">Fire</code><code class="p">(</code><code class="n">greet</code><code class="p">)</code></pre>&#13;
&#13;
<p><code>fire</code> then creates the UI based on the method’s name and arguments:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./simple_fire.py --help&#13;
&#13;
NAME&#13;
    simple_fire.py&#13;
&#13;
SYNOPSIS&#13;
    simple_fire.py &lt;flags&gt;&#13;
&#13;
FLAGS&#13;
    --greeting<code class="o">=</code>GREETING&#13;
    --name<code class="o">=</code>NAME</pre>&#13;
&#13;
<p>In simple cases, you can expose multiple methods automatically by invoking <code>fire</code> with no arguments:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c-Hashbang">#!/usr/bin/env python</code>&#13;
<code class="sd">"""</code>&#13;
<code class="sd">Simple fire example</code>&#13;
<code class="sd">"""</code>&#13;
<code class="kn">import</code> <code class="nn">fire</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">greet</code><code class="p">(</code><code class="n">greeting</code><code class="o">=</code><code class="s1">'Hiya'</code><code class="p">,</code> <code class="n">name</code><code class="o">=</code><code class="s1">'Tammy'</code><code class="p">):</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"{greeting} {name}"</code><code class="p">)</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">goodbye</code><code class="p">(</code><code class="n">goodbye</code><code class="o">=</code><code class="s1">'Bye'</code><code class="p">,</code> <code class="n">name</code><code class="o">=</code><code class="s1">'Tammy'</code><code class="p">):</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"{goodbye} {name}"</code><code class="p">)</code>&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="n">fire</code><code class="o">.</code><code class="n">Fire</code><code class="p">()</code></pre>&#13;
&#13;
<p><code>fire</code> creates a command from each function and documents automatically:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./simple_fire.py --help&#13;
INFO: Showing <code class="nb">help </code>with the <code class="nb">command</code> <code class="s1">'simple_fire.py -- --help'</code>.&#13;
&#13;
NAME&#13;
    simple_fire.py&#13;
&#13;
SYNOPSIS&#13;
    simple_fire.py GROUP <code class="p">|</code> COMMAND&#13;
&#13;
GROUPS&#13;
    GROUP is one of the following:&#13;
&#13;
     fire&#13;
       The Python fire module.&#13;
&#13;
COMMANDS&#13;
    COMMAND is one of the following:&#13;
&#13;
     greet&#13;
&#13;
     goodbye&#13;
<code class="o">(</code>END<code class="o">)</code></pre>&#13;
&#13;
<p>This is really convenient if you are trying to understand someone else’s code or debug your own. With one line of additional code, you can interact with all of a module’s functions from the command-line. That is powerful.&#13;
Because <code>fire</code> uses the structure of your program itself to determine the interface, it is even more tied to your non-interface code than <code>argparse</code> or <code>click</code>. To mimic our nest command interface, you need to define classes with the structure of the interface you want to expose. To see an approach to this, check out <a data-type="xref" href="#Example-3-6">Example 3-6</a>.</p>&#13;
<div data-type="example" id="Example-3-6">&#13;
<h5><span class="label">Example 3-6. </span>fire_example.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c-Hashbang">#!/usr/bin/env python</code><code>&#13;
</code><code class="sd">"""&#13;
Command-line tool using fire&#13;
"""</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">fire</code><code>&#13;
</code><code>&#13;
</code><code class="k">class</code><code> </code><code class="nc">Ships</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO6-1" id="co_working_with_the_command_line_CO6-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="k">def</code><code> </code><code class="nf">sail</code><code class="p">(</code><code class="bp">self</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="n">ship_name</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">Your ship</code><code class="s1">'</code><code>&#13;
</code><code>        </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">{ship_name} is setting sail</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="k">def</code><code> </code><code class="nf">list</code><code class="p">(</code><code class="bp">self</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="n">ships</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="s1">'</code><code class="s1">John B</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">Yankee Clipper</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">Pequod</code><code class="s1">'</code><code class="p">]</code><code>&#13;
</code><code>        </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">Ships: {</code><code class="s2">'</code><code class="s2">,</code><code class="s2">'</code><code class="s2">.join(ships)}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">sailors</code><code class="p">(</code><code class="n">greeting</code><code class="p">,</code><code> </code><code class="n">name</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO6-2" id="co_working_with_the_command_line_CO6-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">message</code><code> </code><code class="o">=</code><code> </code><code class="n">f</code><code class="s1">'</code><code class="s1">{greeting} {name}</code><code class="s1">'</code><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">message</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="k">class</code><code> </code><code class="nc">Cli</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO6-3" id="co_working_with_the_command_line_CO6-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="k">def</code><code> </code><code class="nf-Magic">__init__</code><code class="p">(</code><code class="bp">self</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="bp">self</code><code class="o">.</code><code class="n">sailors</code><code> </code><code class="o">=</code><code> </code><code class="n">sailors</code><code>&#13;
</code><code>        </code><code class="bp">self</code><code class="o">.</code><code class="n">ships</code><code> </code><code class="o">=</code><code> </code><code class="n">Ships</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="k">if</code><code> </code><code class="nv-Magic">__name__</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">__main__</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">fire</code><code class="o">.</code><code class="n">Fire</code><code class="p">(</code><code class="n">Cli</code><code class="p">)</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO6-4" id="co_working_with_the_command_line_CO6-4"><img alt="4" src="assets/4.png"/></a></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO6-1" id="callout_working_with_the_command_line_CO6-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Define a class for the ships commands.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO6-2" id="callout_working_with_the_command_line_CO6-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p><code>sailors</code> has no subcommands, so it can be defined as a function.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO6-3" id="callout_working_with_the_command_line_CO6-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Define a class to act as the top group. Add the <code>sailors</code> function and the <code>Ships</code> as attributes of the class.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO6-4" id="callout_working_with_the_command_line_CO6-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Call <code>fire.Fire</code> on the class acting as the top-level group.</p></dd>&#13;
</dl>&#13;
&#13;
<p>The automatically generated documentation at the top level represents the <code>Ships</code> class as a group, and the <code>sailors</code> command as a command:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./fire_example.py&#13;
&#13;
NAME&#13;
    fire_example.py&#13;
&#13;
SYNOPSIS&#13;
    fire_example.py GROUP <code class="p">|</code> COMMAND&#13;
&#13;
GROUPS&#13;
    GROUP is one of the following:&#13;
&#13;
     ships&#13;
&#13;
COMMANDS&#13;
    COMMAND is one of the following:&#13;
&#13;
     sailors&#13;
<code class="o">(</code>END<code class="o">)</code></pre>&#13;
&#13;
<p>The documentation for the <code>ships</code> group shows the commands representing the methods attached to the <code>Ships</code> class:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./fire_example.py ships --help&#13;
INFO: Showing <code class="nb">help </code>with the <code class="nb">command</code> <code class="s1">'fire_example.py ships -- --help'</code>.&#13;
&#13;
NAME&#13;
    fire_example.py ships&#13;
&#13;
SYNOPSIS&#13;
    fire_example.py ships COMMAND&#13;
&#13;
COMMANDS&#13;
    COMMAND is one of the following:&#13;
&#13;
     list&#13;
&#13;
     sail&#13;
<code class="o">(</code>END<code class="o">)</code></pre>&#13;
&#13;
<p>The parameters for the <code>sailors</code> function are turned into positional arguments:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./fire_example.py sailors --help&#13;
INFO: Showing <code class="nb">help </code>with the <code class="nb">command</code> <code class="s1">'fire_example.py sailors -- --help'</code>.&#13;
&#13;
NAME&#13;
    fire_example.py sailors&#13;
&#13;
SYNOPSIS&#13;
    fire_example.py sailors GREETING NAME&#13;
&#13;
POSITIONAL ARGUMENTS&#13;
    GREETING&#13;
    NAME&#13;
&#13;
NOTES&#13;
    You can also use flags syntax <code class="k">for</code> POSITIONAL ARGUMENTS&#13;
<code class="o">(</code>END<code class="o">)</code></pre>&#13;
&#13;
<p>You can call the commands and subcommands as expected:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./fire_example.py ships sail&#13;
Your ship is setting sail&#13;
chapter3<code class="nv">$ </code>./fire_example.py ships list&#13;
Ships: John B,Yankee Clipper,Pequod&#13;
chapter3<code class="nv">$ </code>./fire_example.py sailors Hiya Karl&#13;
Hiya Karl</pre>&#13;
&#13;
<p>An exciting feature of <code>fire</code> is the ability to enter an interactive mode easily. By using the <code>--interactive</code> flag, <code>fire</code> opens an IPython shell with the object and functions of your script available:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./fire_example.py sailors Hiya Karl -- --interactive&#13;
Hiya Karl&#13;
Fire is starting a Python REPL with the following objects:&#13;
Modules: fire&#13;
Objects: Cli, Ships, component, fire_example.py, result, sailors, self, trace&#13;
&#13;
Python 3.7.0 <code class="o">(</code>default, Sep <code class="m">23</code> 2018, 09:47:03<code class="o">)</code>&#13;
Type <code class="s1">'copyright'</code>, <code class="s1">'credits'</code> or <code class="s1">'license'</code> <code class="k">for</code> more information&#13;
IPython 7.5.0 -- An enhanced Interactive Python. Type <code class="s1">'?'</code> <code class="k">for</code> help.&#13;
 ---------------------------------------------------------------------------&#13;
In <code class="o">[</code>1<code class="o">]</code>: sailors&#13;
Out<code class="o">[</code>1<code class="o">]</code>: &lt;<code class="k">function</code> __main__.sailors<code class="o">(</code>greeting, name<code class="o">)</code>&gt;&#13;
&#13;
In <code class="o">[</code>2<code class="o">]</code>: sailors<code class="o">(</code><code class="s1">'hello'</code>, <code class="s1">'fred'</code><code class="o">)</code>&#13;
hello fred</pre>&#13;
&#13;
<p>Here we run the maritime program’s <code>sailors</code> command in interactive mode. An IPython shell opens, and you have access to the <code>sailors</code> function. This interactive mode, in combination with the ease of exposing objects with <code>fire</code>, makes it the right tool both for debugging and introducing yourself to new code.</p>&#13;
&#13;
<p>You have now run the gamut in command-line tool building libraries, from the very hands-on <code>argparse</code>, to the less verbose <code>click</code>, and lastly to the minimal <code>fire</code>. So which one should you use? We recommend <code>click</code> for most use cases. It balances ease and control. In the case of complex interfaces where you want to separate the UI code from business logic, <code>argparse</code> is the way to go. Moreover, if you need to access code that does not have a command-line interface quickly, <code>fire</code> is right for you.<a data-startref="ix_ch03-asciidoc11" data-type="indexterm" id="idm46691336939160"/><a data-startref="ix_ch03-asciidoc10" data-type="indexterm" id="idm46691336938424"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Implementing Plug-ins" data-type="sect2"><div class="sect2" id="idm46691337523368">&#13;
<h2>Implementing Plug-ins</h2>&#13;
&#13;
<p><a data-primary="command-line tools" data-secondary="implementing plugins" data-type="indexterm" id="idm46691336936648"/><a data-primary="plugins" data-type="indexterm" id="idm46691336935672"/>Once you’ve implemented your application’s command-line user interface, you might want to consider a plug-in system. Plug-ins are pieces of code supplied by the user of your program to extend functionality. Plug-in systems are used in all sorts of applications, from large applications like Autodesk’s Maya to minimal web frameworks like Flask. You could write a tool that handles walking a filesystem and allows a user to provide plug-ins to operate on its contents. A key part of any plug-in system is plug-in discover. Your program needs to know what plug-ins are available to load and run. In <a data-type="xref" href="#Example-3-7">Example 3-7</a>, we write a simple application that discovers and runs plug-ins. It uses a user-supplied prefix to search for, load, and run plug-ins.</p>&#13;
<div data-type="example" id="Example-3-7">&#13;
<h5><span class="label">Example 3-7. </span>simple_plugins.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c-Hashbang">#!/usr/bin/env python</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">fire</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">pkgutil</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">importlib</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">find_and_run_plugins</code><code class="p">(</code><code class="n">plugin_prefix</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">plugins</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="p">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># Discover and Load Plugins</code><code>&#13;
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">Discovering plugins with prefix: {plugin_prefix}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="k">for</code><code> </code><code class="n">_</code><code class="p">,</code><code> </code><code class="n">name</code><code class="p">,</code><code> </code><code class="n">_</code><code> </code><code class="ow">in</code><code>  </code><code class="n">pkgutil</code><code class="o">.</code><code class="n">iter_modules</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO7-1" id="co_working_with_the_command_line_CO7-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="n">name</code><code class="o">.</code><code class="n">startswith</code><code class="p">(</code><code class="n">plugin_prefix</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO7-2" id="co_working_with_the_command_line_CO7-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>            </code><code class="n">module</code><code> </code><code class="o">=</code><code> </code><code class="n">importlib</code><code class="o">.</code><code class="n">import_module</code><code class="p">(</code><code class="n">name</code><code class="p">)</code><code> </code><a class="co" href="#callout_working_with_the_command_line_CO7-3" id="co_working_with_the_command_line_CO7-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>            </code><code class="n">plugins</code><code class="p">[</code><code class="n">name</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">module</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># Run Plugins</code><code>&#13;
</code><code>    </code><code class="k">for</code><code> </code><code class="n">name</code><code class="p">,</code><code> </code><code class="n">module</code><code> </code><code class="ow">in</code><code> </code><code class="n">plugins</code><code class="o">.</code><code class="n">items</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"</code><code class="s2">Running plugin {name}</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">module</code><code class="o">.</code><code class="n">run</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" href="#callout_working_with_the_command_line_CO7-4" id="co_working_with_the_command_line_CO7-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="k">if</code><code> </code><code class="nv-Magic">__name__</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">__main__</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">fire</code><code class="o">.</code><code class="n">Fire</code><code class="p">(</code><code class="p">)</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO7-1" id="callout_working_with_the_command_line_CO7-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p><code>pkgutil.iter_modules</code> returns all modules available in the current <code>sys.path</code>.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO7-2" id="callout_working_with_the_command_line_CO7-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Check if the module uses our plug-in prefix.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO7-3" id="callout_working_with_the_command_line_CO7-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Use <code>importlib</code> to load the module, saving it in a <code>dict</code> for later use.</p></dd>&#13;
<dt><a class="co" href="#co_working_with_the_command_line_CO7-4" id="callout_working_with_the_command_line_CO7-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Call the <code>run</code> method on the plug-in.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Writing supplying plug-ins to <a data-type="xref" href="#Example-3-7">Example 3-7</a> is as simple as supplying modules whose names use a shared prefix and whose functionality is accessed using a method named <code>run</code>. If you write two files using the prefix <code>foo_plugin</code> with individual run methods:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">run</code><code class="p">():</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="s2">"Running plugin A"</code><code class="p">)</code></pre>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">run</code><code class="p">():</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="s2">"Running plugin B"</code><code class="p">)</code></pre>&#13;
&#13;
<p>You can discover and run them with our plugin application:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>./simple_plugins.py find_and_run_plugins foo_plugin&#13;
Running plugin foo_plugin_a&#13;
Running plugin A&#13;
Running plugin foo_plugin_b&#13;
Running plugin B</pre>&#13;
&#13;
<p>You can easily extend this simple example to create plug-in systems for your <span class="keep-together">applications.</span><a data-startref="ix_ch03-asciidoc3" data-type="indexterm" id="idm46691336703384"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Case Study: Turbocharging Python with Command-Line Tools" data-type="sect1"><div class="sect1" id="idm46691340034824">&#13;
<h1>Case Study: Turbocharging Python <span class="keep-together">with Command-Line Tools</span></h1>&#13;
&#13;
<p><a data-primary="command line" data-secondary="case study: turbocharging Python with command-line tools" data-type="indexterm" id="ix_ch03-asciidoc12"/><a data-primary="command-line tools" data-secondary="case study: turbocharging Python with" data-type="indexterm" id="ix_ch03-asciidoc13"/>It’s as good a time as ever to be writing code these days; a little bit of code goes a long way.  Just a single function is capable of performing incredible things. Thanks to GPUs, machine learning, the cloud, and Python, it’s easy to create “turbocharged” command-line tools. Think of it as upgrading your code from using a basic internal combustion engine to a jet engine. What’s the basic recipe for the upgrade? One function, a sprinkle of powerful logic, and, finally, a decorator to route it to the command line.</p>&#13;
&#13;
<p>Writing and maintaining traditional GUI applications—web or desktop—is a Sisyphean task at best. It all starts with the best of intentions, but can quickly turn into a soul crushing, time-consuming ordeal where you end up asking yourself why you thought becoming a programmer was a good idea in the first place. Why did you run that web framework setup utility that essentially automated a 1970s technology—the relational database—into series of Python files? The old Ford Pinto with the exploding rear gas tank has newer technology than your web framework. There has got to be a better way to make a living.</p>&#13;
&#13;
<p>The answer is simple: stop writing web applications and start writing jet-powered command-line tools instead. The turbocharged command-line tools discussed in the following sections are focused on fast results vis-à-vis minimal lines of code. They can do things like learn from data (machine learning), make your code run two thousand times faster, and best of all, generate colored terminal output.</p>&#13;
&#13;
<p>Here are the raw ingredients that will be used to make several solutions:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Click framework</p>&#13;
</li>&#13;
<li>&#13;
<p>Python CUDA framework</p>&#13;
</li>&#13;
<li>&#13;
<p>Numba framework</p>&#13;
</li>&#13;
<li>&#13;
<p>Scikit-learn machine learning framework</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using the Numba Just-in-Time (JIT) Compiler" data-type="sect2"><div class="sect2" id="idm46691336678392">&#13;
<h2>Using the Numba Just-in-Time (JIT) Compiler</h2>&#13;
&#13;
<p><a data-primary="command-line tools" data-secondary="Numba JIT compiler" data-type="indexterm" id="ix_ch03-asciidoc14"/><a data-primary="Numba Just-in-Time (JIT) Compiler" data-type="indexterm" id="ix_ch03-asciidoc15"/>Python has a reputation for slow performance because it’s fundamentally a scripting language. One way to get around this problem is to use the Numba Just-in-Time (JIT) compiler.  Let’s take a look at what that code looks like.</p>&#13;
&#13;
<p>First, use a timing decorator to get a grasp on the runtime of your functions:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">timing</code><code class="p">(</code><code class="n">f</code><code class="p">):</code>&#13;
    <code class="nd">@wraps</code><code class="p">(</code><code class="n">f</code><code class="p">)</code>&#13;
    <code class="k">def</code> <code class="nf">wrap</code><code class="p">(</code><code class="o">*</code><code class="n">args</code><code class="p">,</code> <code class="o">**</code><code class="n">kwargs</code><code class="p">):</code>&#13;
        <code class="n">ts</code> <code class="o">=</code> <code class="n">time</code><code class="p">()</code>&#13;
        <code class="n">result</code> <code class="o">=</code> <code class="n">f</code><code class="p">(</code><code class="o">*</code><code class="n">args</code><code class="p">,</code> <code class="o">**</code><code class="n">kwargs</code><code class="p">)</code>&#13;
        <code class="n">te</code> <code class="o">=</code> <code class="n">time</code><code class="p">()</code>&#13;
        <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"fun: {f.__name__}, args: [{args}, {kwargs}] took: {te-ts} sec"</code><code class="p">)</code>&#13;
        <code class="k">return</code> <code class="n">result</code>&#13;
    <code class="k">return</code> <code class="n">wrap</code></pre>&#13;
&#13;
<p>Next, add a <code>numba.jit</code> decorator with the <code>nopython</code> keyword argument and set it to <code>True</code>.  This will ensure that the code will be run by JIT instead of regular Python.</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="nd">@timing</code>&#13;
<code class="nd">@numba.jit</code><code class="p">(</code><code class="n">nopython</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">expmean_jit</code><code class="p">(</code><code class="n">rea</code><code class="p">):</code>&#13;
    <code class="sd">"""Perform multiple mean calculations"""</code>&#13;
&#13;
    <code class="n">val</code> <code class="o">=</code> <code class="n">rea</code><code class="o">.</code><code class="n">mean</code><code class="p">()</code> <code class="o">**</code> <code class="mi">2</code>&#13;
    <code class="k">return</code> <code class="n">val</code></pre>&#13;
&#13;
<p>When you run it, you can see both a <code>jit</code> as well as a regular version being run via the command-line tool:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>python nuclearcli.py jit-test&#13;
Running NO JIT&#13;
func:<code class="s1">'expmean'</code> args:<code class="o">[(</code>array<code class="o">([[</code>1.0000e+00, 4.2080e+05, 2350e+05, ...,&#13;
                                  1.0543e+06, 1.0485e+06, 1.0444e+06<code class="o">]</code>,&#13;
       <code class="o">[</code>2.0000e+00, 5.4240e+05, 5.4670e+05, ...,&#13;
              1.5158e+06, 1.5199e+06, 1.5253e+06<code class="o">]</code>,&#13;
       <code class="o">[</code>3.0000e+00, 7.0900e+04, 7.1200e+04, ...,&#13;
              1.1380e+05, 1.1350e+05, 1.1330e+05<code class="o">]</code>,&#13;
       ...,&#13;
       <code class="o">[</code>1.5277e+04, 9.8900e+04, 9.8100e+04, ...,&#13;
              2.1980e+05, 2.2000e+05, 2.2040e+05<code class="o">]</code>,&#13;
       <code class="o">[</code>1.5280e+04, 8.6700e+04, 8.7500e+04, ...,&#13;
              1.9070e+05, 1.9230e+05, 1.9360e+05<code class="o">]</code>,&#13;
       <code class="o">[</code>1.5281e+04, 2.5350e+05, 2.5400e+05, ..., 7.8360e+05, 7.7950e+05,&#13;
        7.7420e+05<code class="o">]]</code>, <code class="nv">dtype</code><code class="o">=</code>float32<code class="o">)</code>,<code class="o">)</code>, <code class="o">{}]</code> took: 0.0007 sec&#13;
<code class="nv">$ </code>python nuclearcli.py jit-test --jit&#13;
Running with JIT&#13;
func:<code class="s1">'expmean_jit'</code> args:<code class="o">[(</code>array<code class="o">([[</code>1.0000e+00, 4.2080e+05, 4.2350e+05, ...,&#13;
                                     0543e+06, 1.0485e+06, 1.0444e+06<code class="o">]</code>,&#13;
       <code class="o">[</code>2.0000e+00, 5.4240e+05, 5.4670e+05, ..., 1.5158e+06, 1.5199e+06,&#13;
        1.5253e+06<code class="o">]</code>,&#13;
       <code class="o">[</code>3.0000e+00, 7.0900e+04, 7.1200e+04, ..., 1.1380e+05, 1.1350e+05,&#13;
        1.1330e+05<code class="o">]</code>,&#13;
       ...,&#13;
       <code class="o">[</code>1.5277e+04, 9.8900e+04, 9.8100e+04, ..., 2.1980e+05, 2.2000e+05,&#13;
        2.2040e+05<code class="o">]</code>,&#13;
       <code class="o">[</code>1.5280e+04, 8.6700e+04, 8.7500e+04, ..., 1.9070e+05, 1.9230e+05,&#13;
        1.9360e+05<code class="o">]</code>,&#13;
       <code class="o">[</code>1.5281e+04, 2.5350e+05, 2.5400e+05, ..., 7.8360e+05, 7.7950e+05,&#13;
@click.option<code class="o">(</code><code class="s1">'--jit/--no-jit'</code>, <code class="nv">default</code><code class="o">=</code>False<code class="o">)</code>&#13;
        7.7420e+05<code class="o">]]</code>, <code class="nv">dtype</code><code class="o">=</code>float32<code class="o">)</code>,<code class="o">)</code>, <code class="o">{}]</code> took: 0.2180 sec</pre>&#13;
&#13;
<p>How does that work?  Just a few lines of code allow for this simple toggle:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="nd">@cli.command</code><code class="p">()</code>&#13;
<code class="k">def</code> <code class="nf">jit_test</code><code class="p">(</code><code class="n">jit</code><code class="p">):</code>&#13;
    <code class="n">rea</code> <code class="o">=</code> <code class="n">real_estate_array</code><code class="p">()</code>&#13;
    <code class="k">if</code> <code class="n">jit</code><code class="p">:</code>&#13;
        <code class="n">click</code><code class="o">.</code><code class="n">echo</code><code class="p">(</code><code class="n">click</code><code class="o">.</code><code class="n">style</code><code class="p">(</code><code class="s1">'Running with JIT'</code><code class="p">,</code> <code class="n">fg</code><code class="o">=</code><code class="s1">'green'</code><code class="p">))</code>&#13;
        <code class="n">expmean_jit</code><code class="p">(</code><code class="n">rea</code><code class="p">)</code>&#13;
    <code class="k">else</code><code class="p">:</code>&#13;
        <code class="n">click</code><code class="o">.</code><code class="n">echo</code><code class="p">(</code><code class="n">click</code><code class="o">.</code><code class="n">style</code><code class="p">(</code><code class="s1">'Running NO JIT'</code><code class="p">,</code> <code class="n">fg</code><code class="o">=</code><code class="s1">'red'</code><code class="p">))</code>&#13;
        <code class="n">expmean</code><code class="p">(</code><code class="n">rea</code><code class="p">)</code></pre>&#13;
&#13;
<p>In some cases, a JIT version could make code run thousands of times faster, but benchmarking is key. Another item to point out is this line:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">click</code><code class="o">.</code><code class="n">echo</code><code class="p">(</code><code class="n">click</code><code class="o">.</code><code class="n">style</code><code class="p">(</code><code class="s1">'Running with JIT'</code><code class="p">,</code> <code class="n">fg</code><code class="o">=</code><code class="s1">'green'</code><code class="p">))</code></pre>&#13;
&#13;
<p>This script allows for colored terminal output, which can be very helpful when creating sophisticated tools.<a data-startref="ix_ch03-asciidoc15" data-type="indexterm" id="idm46691336325800"/><a data-startref="ix_ch03-asciidoc14" data-type="indexterm" id="idm46691336325304"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using the GPU with CUDA Python" data-type="sect2"><div class="sect2" id="idm46691336677768">&#13;
<h2>Using the GPU with CUDA Python</h2>&#13;
&#13;
<p><a data-primary="command-line tools" data-secondary="running code on GPU with CUDA Python" data-type="indexterm" id="idm46691336323320"/><a data-primary="CUDA Python" data-type="indexterm" id="idm46691336336792"/><a data-primary="GPU (Graphics Processing Unit)" data-type="indexterm" id="idm46691336336120"/>Another way to turbocharge your code is to run it straight on a GPU. This example requires you run it on a machine with a CUDA enabled. Here’s what that code looks like:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="nd">@cli.command</code><code class="p">()</code>&#13;
<code class="k">def</code> <code class="nf">cuda_operation</code><code class="p">():</code>&#13;
    <code class="sd">"""Performs Vectorized Operations on GPU"""</code>&#13;
&#13;
    <code class="n">x</code> <code class="o">=</code> <code class="n">real_estate_array</code><code class="p">()</code>&#13;
    <code class="n">y</code> <code class="o">=</code> <code class="n">real_estate_array</code><code class="p">()</code>&#13;
&#13;
    <code class="k">print</code><code class="p">(</code><code class="s2">"Moving calculations to GPU memory"</code><code class="p">)</code>&#13;
    <code class="n">x_device</code> <code class="o">=</code> <code class="n">cuda</code><code class="o">.</code><code class="n">to_device</code><code class="p">(</code><code class="n">x</code><code class="p">)</code>&#13;
    <code class="n">y_device</code> <code class="o">=</code> <code class="n">cuda</code><code class="o">.</code><code class="n">to_device</code><code class="p">(</code><code class="n">y</code><code class="p">)</code>&#13;
    <code class="n">out_device</code> <code class="o">=</code> <code class="n">cuda</code><code class="o">.</code><code class="n">device_array</code><code class="p">(</code>&#13;
        <code class="n">shape</code><code class="o">=</code><code class="p">(</code><code class="n">x_device</code><code class="o">.</code><code class="n">shape</code><code class="p">[</code><code class="mi">0</code><code class="p">],</code><code class="n">x_device</code><code class="o">.</code><code class="n">shape</code><code class="p">[</code><code class="mi">1</code><code class="p">]),</code> <code class="n">dtype</code><code class="o">=</code><code class="n">np</code><code class="o">.</code><code class="n">float32</code><code class="p">)</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">x_device</code><code class="p">)</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">x_device</code><code class="o">.</code><code class="n">shape</code><code class="p">)</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">x_device</code><code class="o">.</code><code class="n">dtype</code><code class="p">)</code>&#13;
&#13;
    <code class="k">print</code><code class="p">(</code><code class="s2">"Calculating on GPU"</code><code class="p">)</code>&#13;
    <code class="n">add_ufunc</code><code class="p">(</code><code class="n">x_device</code><code class="p">,</code><code class="n">y_device</code><code class="p">,</code> <code class="n">out</code><code class="o">=</code><code class="n">out_device</code><code class="p">)</code>&#13;
&#13;
    <code class="n">out_host</code> <code class="o">=</code> <code class="n">out_device</code><code class="o">.</code><code class="n">copy_to_host</code><code class="p">()</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s2">"Calculations from GPU {out_host}"</code><code class="p">)</code></pre>&#13;
&#13;
<p>It’s useful to point out that if the Numpy array is first moved to the GPU, then a vectorized function does the work on the GPU. After that work is completed, the data is moved from the GPU. By using a GPU, there could be a monumental improvement to the code, depending on what it’s running.  The output from the command-line tool is shown here:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>python nuclearcli.py cuda-operation&#13;
Moving calculations to GPU memory&#13;
&lt;numba.cuda.cudadrv.devicearray.DeviceNDArray object at 0x7f01bf6ccac8&gt;&#13;
<code class="o">(</code>10015, 259<code class="o">)</code>&#13;
float32&#13;
Calculating on GPU&#13;
Calculcations from GPU <code class="o">[</code>&#13;
 <code class="o">[</code>2.0000e+00 8.4160e+05 8.4700e+05 ... 2.1086e+06 2.0970e+06 2.0888e+06<code class="o">]</code>&#13;
 <code class="o">[</code>4.0000e+00 1.0848e+06 1.0934e+06 ... 3.0316e+06 3.0398e+06 3.0506e+06<code class="o">]</code>&#13;
 <code class="o">[</code>6.0000e+00 1.4180e+05 1.4240e+05 ... 2.2760e+05 2.2700e+05 2.2660e+05<code class="o">]</code>&#13;
 ...&#13;
 <code class="o">[</code>3.0554e+04 1.9780e+05 1.9620e+05 ... 4.3960e+05 4.4000e+05 4.4080e+05<code class="o">]</code>&#13;
 <code class="o">[</code>3.0560e+04 1.7340e+05 1.7500e+05 ... 3.8140e+05 3.8460e+05 3.8720e+05<code class="o">]</code>&#13;
 <code class="o">[</code>3.0562e+04 5.0700e+05 5.0800e+05 ... 1.5672e+06 1.5590e+06 1.5484e+06<code class="o">]</code>&#13;
<code class="o">]</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Running True Multicore Multithreaded Python Using Numba" data-type="sect2"><div class="sect2" id="idm46691336176984">&#13;
<h2>Running True Multicore Multithreaded Python Using Numba</h2>&#13;
&#13;
<p><a data-primary="command line" data-secondary="running true multicore multithreaded Python using Numba" data-type="indexterm" id="idm46691336168328"/><a data-primary="command-line tools" data-secondary="running true multicore multithreaded Python using Numba" data-type="indexterm" id="idm46691336167352"/><a data-primary="Numba" data-type="indexterm" id="idm46691336166376"/>One common performance problem with Python is the lack of true, multithreaded performance.  This also can be fixed with Numba. Here’s an example of some basic operations:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="nd">@timing</code>&#13;
<code class="nd">@numba.jit</code><code class="p">(</code><code class="n">parallel</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">add_sum_threaded</code><code class="p">(</code><code class="n">rea</code><code class="p">):</code>&#13;
    <code class="sd">"""Use all the cores"""</code>&#13;
&#13;
    <code class="n">x</code><code class="p">,</code><code class="n">_</code> <code class="o">=</code> <code class="n">rea</code><code class="o">.</code><code class="n">shape</code>&#13;
    <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code>&#13;
    <code class="k">for</code> <code class="n">_</code> <code class="ow">in</code> <code class="n">numba</code><code class="o">.</code><code class="n">prange</code><code class="p">(</code><code class="n">x</code><code class="p">):</code>&#13;
        <code class="n">total</code> <code class="o">+=</code> <code class="n">rea</code><code class="o">.</code><code class="n">sum</code><code class="p">()</code>&#13;
        <code class="k">print</code><code class="p">(</code><code class="n">total</code><code class="p">)</code>&#13;
&#13;
<code class="nd">@timing</code>&#13;
<code class="k">def</code> <code class="nf">add_sum</code><code class="p">(</code><code class="n">rea</code><code class="p">):</code>&#13;
    <code class="sd">"""traditional for loop"""</code>&#13;
&#13;
    <code class="n">x</code><code class="p">,</code><code class="n">_</code> <code class="o">=</code> <code class="n">rea</code><code class="o">.</code><code class="n">shape</code>&#13;
    <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code>&#13;
    <code class="k">for</code> <code class="n">_</code> <code class="ow">in</code> <code class="n">numba</code><code class="o">.</code><code class="n">prange</code><code class="p">(</code><code class="n">x</code><code class="p">):</code>&#13;
        <code class="n">total</code> <code class="o">+=</code> <code class="n">rea</code><code class="o">.</code><code class="n">sum</code><code class="p">()</code>&#13;
        <code class="k">print</code><code class="p">(</code><code class="n">total</code><code class="p">)</code>&#13;
&#13;
<code class="nd">@cli.command</code><code class="p">()</code>&#13;
<code class="nd">@click.option</code><code class="p">(</code><code class="s1">'--threads/--no-jit'</code><code class="p">,</code> <code class="n">default</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">thread_test</code><code class="p">(</code><code class="n">threads</code><code class="p">):</code>&#13;
    <code class="n">rea</code> <code class="o">=</code> <code class="n">real_estate_array</code><code class="p">()</code>&#13;
    <code class="k">if</code> <code class="n">threads</code><code class="p">:</code>&#13;
        <code class="n">click</code><code class="o">.</code><code class="n">echo</code><code class="p">(</code><code class="n">click</code><code class="o">.</code><code class="n">style</code><code class="p">(</code><code class="s1">'Running with multicore threads'</code><code class="p">,</code> <code class="n">fg</code><code class="o">=</code><code class="s1">'green'</code><code class="p">))</code>&#13;
        <code class="n">add_sum_threaded</code><code class="p">(</code><code class="n">rea</code><code class="p">)</code>&#13;
    <code class="k">else</code><code class="p">:</code>&#13;
        <code class="n">click</code><code class="o">.</code><code class="n">echo</code><code class="p">(</code><code class="n">click</code><code class="o">.</code><code class="n">style</code><code class="p">(</code><code class="s1">'Running NO THREADS'</code><code class="p">,</code> <code class="n">fg</code><code class="o">=</code><code class="s1">'red'</code><code class="p">))</code>&#13;
        <code class="n">add_sum</code><code class="p">(</code><code class="n">rea</code><code class="p">)</code></pre>&#13;
&#13;
<p>Note that the key difference between the parallel version is that it uses <code>@numba.jit(parallel=True)</code> and <code>numba.prange</code> to spawn threads for iteration. As you can see in <a data-type="xref" href="#Figure-3-1">Figure 3-1</a>, all of the CPUs are maxed out on the machine, but when almost the exact same code is run without the parallelization, it only uses a core.</p>&#13;
&#13;
<figure><div class="figure" id="Figure-3-1">&#13;
<img alt="pydo 0301" src="assets/pydo_0301.png"/>&#13;
<h6><span class="label">Figure 3-1. </span>Using all of the cores</h6>&#13;
</div></figure>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>python nuclearcli.py thread-test&#13;
<code class="nv">$ </code>python nuclearcli.py thread-test --threads</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="KMeans Clustering" data-type="sect2"><div class="sect2" id="idm46691335905736">&#13;
<h2>KMeans Clustering</h2>&#13;
&#13;
<p><a data-primary="command line" data-secondary="KMeans clustering" data-type="indexterm" id="idm46691335930248"/><a data-primary="command-line tools" data-secondary="KMeans clustering" data-type="indexterm" id="idm46691335929304"/><a data-primary="KMeans clustering" data-type="indexterm" id="idm46691335928360"/>Another powerful thing that can be accomplished with a command-line tool is machine learning. In the example below, a KMeans clustering function is created with just a few lines of code.  This clusters a Pandas DataFrame into a default of three <span class="keep-together">clusters:</span></p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">kmeans_cluster_housing</code><code class="p">(</code><code class="n">clusters</code><code class="o">=</code><code class="mi">3</code><code class="p">):</code>&#13;
    <code class="sd">"""Kmeans cluster a dataframe"""</code>&#13;
    <code class="n">url</code> <code class="o">=</code> <code class="s2">"https://raw.githubusercontent.com/noahgift/</code><code class="se">\</code>&#13;
<code class="s2">           socialpowernba/master/data/nba_2017_att_val_elo_win_housing.csv"</code>&#13;
    <code class="n">val_housing_win_df</code> <code class="o">=</code><code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">)</code>&#13;
    <code class="n">numerical_df</code> <code class="o">=</code><code class="p">(</code>&#13;
        <code class="n">val_housing_win_df</code><code class="o">.</code><code class="n">loc</code><code class="p">[:,[</code><code class="s2">"TOTAL_ATTENDANCE_MILLIONS"</code><code class="p">,</code> <code class="s2">"ELO"</code><code class="p">,</code>&#13;
        <code class="s2">"VALUE_MILLIONS"</code><code class="p">,</code> <code class="s2">"MEDIAN_HOME_PRICE_COUNTY_MILLIONS"</code><code class="p">]]</code>&#13;
    <code class="p">)</code>&#13;
    <code class="c1">#scale data</code>&#13;
    <code class="n">scaler</code> <code class="o">=</code> <code class="n">MinMaxScaler</code><code class="p">()</code>&#13;
    <code class="n">scaler</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">numerical_df</code><code class="p">)</code>&#13;
    <code class="n">scaler</code><code class="o">.</code><code class="n">transform</code><code class="p">(</code><code class="n">numerical_df</code><code class="p">)</code>&#13;
    <code class="c1">#cluster data</code>&#13;
    <code class="n">k_means</code> <code class="o">=</code> <code class="n">KMeans</code><code class="p">(</code><code class="n">n_clusters</code><code class="o">=</code><code class="n">clusters</code><code class="p">)</code>&#13;
    <code class="n">kmeans</code> <code class="o">=</code> <code class="n">k_means</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">scaler</code><code class="o">.</code><code class="n">transform</code><code class="p">(</code><code class="n">numerical_df</code><code class="p">))</code>&#13;
    <code class="n">val_housing_win_df</code><code class="p">[</code><code class="s1">'cluster'</code><code class="p">]</code> <code class="o">=</code> <code class="n">kmeans</code><code class="o">.</code><code class="n">labels_</code>&#13;
    <code class="k">return</code> <code class="n">val_housing_win_df</code></pre>&#13;
&#13;
<p>The cluster number can be changed by passing in another number (as shown below) using <code>click</code>:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="nd">@cli.command</code><code class="p">()</code>&#13;
<code class="nd">@click.option</code><code class="p">(</code><code class="s2">"--num"</code><code class="p">,</code> <code class="n">default</code><code class="o">=</code><code class="mi">3</code><code class="p">,</code> <code class="n">help</code><code class="o">=</code><code class="s2">"number of clusters"</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">cluster</code><code class="p">(</code><code class="n">num</code><code class="p">):</code>&#13;
    <code class="n">df</code> <code class="o">=</code> <code class="n">kmeans_cluster_housing</code><code class="p">(</code><code class="n">clusters</code><code class="o">=</code><code class="n">num</code><code class="p">)</code>&#13;
    <code class="n">click</code><code class="o">.</code><code class="n">echo</code><code class="p">(</code><code class="s2">"Clustered DataFrame"</code><code class="p">)</code>&#13;
    <code class="n">click</code><code class="o">.</code><code class="n">echo</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">head</code><code class="p">())</code></pre>&#13;
&#13;
<p>Finally, the output of the Pandas DataFrame with the cluster assignment is shown next. Note that it now has cluster assignment as a column:<a data-startref="ix_ch03-asciidoc13" data-type="indexterm" id="idm46691335647720"/><a data-startref="ix_ch03-asciidoc12" data-type="indexterm" id="idm46691335653496"/></p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>python -W nuclearcli.py cluster</pre>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">Clustered</code> <code class="n">DataFrame</code>&#13;
               <code class="n">TEAM</code>  <code class="n">GMS</code>    <code class="o">...</code>         <code class="n">COUNTY</code>   <code class="n">cluster</code>&#13;
<code class="mi">0</code>     <code class="n">Chicago</code> <code class="n">Bulls</code>   <code class="mi">41</code>    <code class="o">...</code>           <code class="n">Cook</code>         <code class="mi">0</code>&#13;
<code class="mi">1</code>  <code class="n">Dallas</code> <code class="n">Mavericks</code>   <code class="mi">41</code>    <code class="o">...</code>         <code class="n">Dallas</code>         <code class="mi">0</code>&#13;
<code class="mi">2</code>  <code class="n">Sacramento</code> <code class="n">Kings</code>   <code class="mi">41</code>    <code class="o">...</code>     <code class="n">Sacremento</code>         <code class="mi">1</code>&#13;
<code class="mi">3</code>        <code class="n">Miami</code> <code class="n">Heat</code>   <code class="mi">41</code>    <code class="o">...</code>     <code class="n">Miami</code><code class="o">-</code><code class="n">Dade</code>         <code class="mi">0</code>&#13;
<code class="mi">4</code>   <code class="n">Toronto</code> <code class="n">Raptors</code>   <code class="mi">41</code>    <code class="o">...</code>    <code class="n">York</code><code class="o">-</code><code class="n">County</code>         <code class="mi">0</code>&#13;
&#13;
<code class="p">[</code><code class="mi">5</code> <code class="n">rows</code> <code class="n">x</code> <code class="mi">12</code> <code class="n">columns</code><code class="p">]</code></pre>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="nv">$ </code>python -W nuclearcli.py cluster --num 2</pre>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">Clustered</code> <code class="n">DataFrame</code>&#13;
               <code class="n">TEAM</code>  <code class="n">GMS</code>     <code class="o">...</code>         <code class="n">COUNTY</code>   <code class="n">cluster</code>&#13;
<code class="mi">0</code>     <code class="n">Chicago</code> <code class="n">Bulls</code>   <code class="mi">41</code>     <code class="o">...</code>           <code class="n">Cook</code>         <code class="mi">1</code>&#13;
<code class="mi">1</code>  <code class="n">Dallas</code> <code class="n">Mavericks</code>   <code class="mi">41</code>     <code class="o">...</code>         <code class="n">Dallas</code>         <code class="mi">1</code>&#13;
<code class="mi">2</code>  <code class="n">Sacramento</code> <code class="n">Kings</code>   <code class="mi">41</code>     <code class="o">...</code>     <code class="n">Sacremento</code>         <code class="mi">0</code>&#13;
<code class="mi">3</code>        <code class="n">Miami</code> <code class="n">Heat</code>   <code class="mi">41</code>     <code class="o">...</code>     <code class="n">Miami</code><code class="o">-</code><code class="n">Dade</code>         <code class="mi">1</code>&#13;
<code class="mi">4</code>   <code class="n">Toronto</code> <code class="n">Raptors</code>   <code class="mi">41</code>     <code class="o">...</code>    <code class="n">York</code><code class="o">-</code><code class="n">County</code>         <code class="mi">1</code>&#13;
&#13;
<code class="p">[</code><code class="mi">5</code> <code class="n">rows</code> <code class="n">x</code> <code class="mi">12</code> <code class="n">columns</code><code class="p">]</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Exercises" data-type="sect1"><div class="sect1" id="idm46691336702312">&#13;
<h1>Exercises</h1>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Use <code>sys</code> to write a script that prints <em>command line</em> only when run from the command line.</p>&#13;
</li>&#13;
<li>&#13;
<p>Use <code>click</code> to create a command-line tool that takes a name as an argument and prints it if it does not begin with a <em>p</em>.</p>&#13;
</li>&#13;
<li>&#13;
<p>Use <code>fire</code> to access methods in an existing Python script from the command line.<a data-startref="ix_ch03-asciidoc0" data-type="indexterm" id="idm46691335464376"/></p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>