# 前言

这本书是我尝试与世界分享我从“黑客”到“软件工程师”的旅程。主要讲的是测试，但如你即将看到的，内容还有很多。

我想感谢你阅读它。

如果你购买了一本书，那么我非常感激。如果你正在阅读免费的在线版本，那么我仍然感激你决定把你的一些时间花在上面。谁知道，也许一旦你读完，你会觉得这本书足够好，值得为自己或朋友购买一本真实的复印件。

如果您有任何意见、问题或建议，我很乐意听取。您可以通过 obeythetestinggoat@gmail.com 直接联系我，或者在 Twitter 上找到我[@hjwp](https://www.twitter.com/hjwp)。您还可以查看[网站和我的博客](http://www.obeythetestinggoat.com)，以及[邮件列表](https://groups.google.com/forum/#!forum/obey-the-testing-goat-book)。

希望您阅读这本书能像我写作时的愉快一样愉快。

# 为什么我写了一本关于测试驱动开发的书

*`‘你是谁，你为什么写这本书，我为什么要读它？’*我听到你问。

在我的职业早期，我很幸运地加入了一群 TDD 狂热者，这对我的编程产生了巨大影响，我迫不及待地想与所有人分享。可以说我像一个新皈依者一样充满热情，学习经验对我来说仍然是个新鲜记忆，这就是为什么在 2014 年推出第一版的原因。

当我第一次学习 Python（来自 Mark Pilgrim 优秀的《*Dive Into Python*》）时，我接触到了 TDD 的概念，心想“是的，我完全能理解其中的道理。”或许当你第一次听说 TDD 时也有类似的反应？听起来是一个非常明智的方法，一种很好的习惯——就像定期用牙线清洁牙齿一样。

然后来了我的第一个大项目，你可以猜到发生了什么——有客户，有截止日期，有很多事情要做，对于 TDD 的任何良好意图都荡然无存。

实际上，一切都挺好。我也挺好。

起初。

起初，我知道我并不真的需要 TDD，因为那只是一个小网站，我可以通过手动检查来轻松测试是否有效。点击这个链接*这里*，选择那个下拉项*那里*，然后*这个*应该发生。简单。整个写测试的事情听起来好像要花*很久*的时间，而且，从我短短三周的成人编程经验中，我自认为是一个相当不错的程序员。我能搞定。很简单。

然后来了可怕的复杂女神。她很快向我展示了我的经验局限性。

项目逐渐扩展。系统的部分开始依赖于其他部分。我尽力遵循像 DRY（不要重复自己）这样的良好原则，但这只是引入了一些非常危险的领域。很快，我开始涉足多重继承。八层深的类层次结构。`eval`语句。

我开始害怕改动我的代码。我不再确定依赖关系，如果我改变了这里的代码，可能会发生什么，哦天啊，我想这部分可能继承自它——不，它不是，它被重写了。哦，但它依赖于那个类变量。好吧，只要我重写重写就应该没问题。我只是要检查一下——但是检查变得越来越困难。现在网站有很多部分，手动点击它们都开始变得不切实际。最好让一切继续如此，不再重构，只是将就着用。

不久后，我的代码变得混乱而丑陋。新的开发变得痛苦起来。

不久之后，我有幸在一个名叫 Resolver Systems（现在称为[PythonAnywhere](https://www.pythonanywhere.com)）的公司找到了一份工作，那里极限编程（XP）是常规。他们向我介绍了严格的 TDD。

尽管我的以前经验确实使我意识到自动化测试的可能好处，但我在每个阶段都拖延不前。“我的意思是，总体上测试可能是个好主意，但*真的吗*？所有这些测试？其中一些看起来完全是浪费时间…… 什么？功能测试*和*单元测试？得了吧，这也太过了！还有这个 TDD 的测试/最小代码更改/测试循环？这太愚蠢了！我们不需要这些步步为营！来吧，我们可以看到正确答案是什么，为什么不直接跳到结尾？”

相信我，我对每条规则都有过犹豫，我提出了每一个捷径，我要求对 TDD 每一个看似毫无意义的方面进行解释，最终我看到了其中的智慧。我不记得多少次想到“谢谢，测试”，因为一个功能测试揭示了一个我们永远不会预料到的回归，或者一个单元测试让我避免了一个非常愚蠢的逻辑错误。从心理上讲，这使得开发过程不再那么紧张。它生成的代码非常令人愉快地使用。

所以，让我告诉你*全部*关于它！

# 本书的目标

我的主要目标是传授一种方法论——一种进行 Web 开发的方式，我认为这能使 Web 应用更好，开发者更快乐。如果一本书只涵盖你通过 Google 可以找到的材料，那它就没什么意义，所以这本书不是 Python 语法指南，也不是 Web 开发教程*本身*。相反，我希望教你如何使用 TDD 更可靠地实现我们共同的神圣目标：*能运行的干净代码*。

话虽如此：我会不断地参考一个实际的实例，通过使用 Django、Selenium、jQuery 和 Mocks 等工具从头开始构建 Web 应用程序。我不假设读者对这些工具有任何先前的了解，所以你应该在本书的最后掌握这些工具的基本知识，以及 TDD 的方法论。

在极限编程中，我们总是成对编程，所以我想象自己写这本书，就像是和我的前任自己一起编程，需要解释工具的工作原理并回答为什么要以这种特定方式编码的问题。所以，如果我有时听起来有点自大，那是因为我并不是那么聪明，我必须对自己非常耐心。如果我听起来有点防守，那是因为我是那种总是与别人持不同意见的烦人人物，所以有时候我必须花费很多精力来说服自己接受任何事情。

# 大纲

我把这本书分成了三部分。

第 I 部分（章节 1–7）：基础知识

直接开始构建一个简单的 Web 应用程序，使用 TDD 进行。我们首先编写一个功能测试（使用 Selenium），然后逐步讲解 Django 的基础——模型、视图、模板——并在每个阶段都进行严格的单元测试。我还介绍了 Testing Goat。

第 II 部分（章节 8–[链接即将到来]）：Web 开发基础

涵盖了 Web 开发中一些更棘手但不可避免的方面，并展示了测试如何帮助我们处理这些问题：静态文件、部署到生产环境、表单数据验证、数据库迁移以及可怕的 JavaScript。

[链接即将到来]（章节 [链接即将到来]–[链接即将到来]）：更高级的测试主题

模拟、集成第三方系统、测试固件、Outside-In TDD 和持续集成（CI）。

继续进行一些日常事务…​

# 本书中使用的约定

本书使用以下排版约定：

*斜体*

表示新术语、URL、电子邮件地址、文件名和文件扩展名。

`固定宽度`

用于程序清单，以及在段落内引用程序元素，如变量或函数名、数据库、数据类型、环境变量、语句和关键字。

`**固定宽度加粗**`

显示用户应该按照字面意义输入的命令或其他文本。

偶尔我会使用符号：

```py
[...]
```

表示某些内容已被跳过，以缩短输出的长度，或跳转到相关部分。

###### 提示

此元素表示一个提示或建议。

###### 注意

此元素表示一般提示或旁注。

###### 警告

此元素表示警告或注意事项。

# 提交勘误

发现错误或错别字？本书的源代码可在 GitHub 上获取，我非常乐意接收问题和拉取请求：[*https://github.com/hjwp/Book-TDD-Web-Dev-Python/*](https://github.com/hjwp/Book-TDD-Web-Dev-Python/)。

# 使用代码示例

代码示例可在[*https://github.com/hjwp/book-example/*](https://github.com/hjwp/book-example/)找到；每章节有对应的分支（例如，[*https://github.com/hjwp/book-example/tree/chapter_unit_test_first_view*](https://github.com/hjwp/book-example/tree/chapter_unit_test_first_view)）。完整列表及有关使用此代码库的建议，详见[Link to Come]。

如果您有技术问题或在使用代码示例时遇到问题，请发送电子邮件至*support@oreilly.com*。

本书旨在帮助您完成工作任务。一般而言，如果本书提供示例代码，您可以在自己的程序和文档中使用它。除非您复制了大量代码片段，否则无需征得我们的许可。例如，编写一个使用本书中多个代码片段的程序无需许可。销售或分发 O’Reilly 书籍中的示例代码则需许可。引用本书回答问题并引用示例代码无需许可。将本书中大量示例代码整合到产品文档中需要许可。

我们感谢但不要求署名。通常的署名包括标题、作者、出版商和 ISBN。例如：“*Python 测试驱动开发*, 第 3 版，作者 Harry J.W. Percival（O’Reilly）。版权 2024 Harry Percival，978-1-098-14871-3。”

如果您认为您使用的示例代码超出了合理使用范围或上述许可，请随时通过*permissions@oreilly.com*与我们联系。

# O’Reilly 在线学习

###### 注意

40 多年来，[*O’Reilly Media*](https://oreilly.com)为企业提供技术和商业培训、知识和见解，帮助其取得成功。

我们独特的专家和创新者网络通过书籍、文章和在线学习平台分享他们的知识和专业知识。O’Reilly 的在线学习平台为您提供按需访问实时培训课程、深度学习路径、交互式编码环境以及来自 O’Reilly 和其他 200 多家出版商的大量文本和视频。更多信息，请访问[*https://oreilly.com*](https://oreilly.com)。

# 如何联系我们

请将有关本书的评论和问题发送至出版商：

+   O’Reilly Media, Inc.

+   1005 Gravenstein Highway North

+   加利福尼亚州塞巴斯托波尔 95472

+   800-889-8969（美国或加拿大）

+   707-829-7019（国际或本地）

+   707-829-0104（传真）

+   *support@oreilly.com*

+   [*https://www.oreilly.com/about/contact.xhtml*](https://www.oreilly.com/about/contact.xhtml)

我们为本书设有网页，列出勘误、示例及其他相关信息。请访问[*https://learning.oreilly.com/library/view/~/9781098148706*](https://learning.oreilly.com/library/view/~/9781098148706)。

获取有关我们的书籍和课程的新闻和信息，请访问[*https://oreilly.com*](https://oreilly.com)。

在 LinkedIn 上找到我们：[*https://linkedin.com/company/oreilly-media*](https://linkedin.com/company/oreilly-media)

关注我们的 Twitter：[*https://twitter.com/oreillymedia*](https://twitter.com/oreillymedia)

在 YouTube 上观看我们：[*https://youtube.com/oreillymedia*](https://youtube.com/oreillymedia)

# 免费版许可证

如果你正在阅读托管在[*http://www.obeythetestinggoat.com*](http://www.obeythetestinggoat.com)的免费版这本书，那么许可证是[知识共享 署名-非商业性使用-禁止演绎](https://creativecommons.org/licenses/by-nc-nd/4.0/legalcode) ¹。我要感谢 O’Reilly 对于许可证的积极态度，大多数出版商都没有这样的前瞻性。

我把这看作是一个“试读再购买”的计划。如果你正在阅读这本书是出于职业原因，我希望如果你喜欢它，你会购买一本——如果不是为了自己，那就为了朋友！O’Reilly 做得很棒，值得你的支持。你可以在[主页上找到购买链接](http://www.obeythetestinggoat.com/)。

¹（没有衍生条款是因为 O’Reilly 希望对衍生作品保持一定的控制，但他们经常允许这样的权限，所以如果你想基于这本书构建某些东西，不要犹豫，与他们联系。）
