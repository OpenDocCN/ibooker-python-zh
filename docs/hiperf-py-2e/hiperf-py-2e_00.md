# 序言

Python 易于学习。您可能来到这里是因为现在您的代码可以正确运行，但您希望它运行得更快。您喜欢您的代码易于修改，并且可以快速迭代想法的事实。在“易于开发”和“能以我需要的速度运行”之间的权衡是一个众所周知并经常抱怨的现象。这里有解决方案。

有些人有必须运行更快的串行进程。其他人有可能能够利用多核架构、集群或图形处理单元解决问题。有些人需要可伸缩的系统，可以根据需要以更高效或更少的方式处理，而不会失去可靠性。其他人会意识到，他们的编码技术，通常是从其他语言借鉴而来，也许并不像他们从其他人那里看到的示例那样自然。

在本书中，我们将涵盖所有这些主题，并为理解瓶颈和生成更快、更可扩展解决方案提供实用指导。我们还包括一些前辈的战斗经历，他们为你走过的路，以便您无需重复。

Python 非常适合快速开发、生产部署和可扩展系统。生态系统中有许多人正在努力使其能够按照您的意愿进行扩展，从而使您能够更多地专注于周围更具挑战性的任务。

# 本书适合谁

你已经使用 Python 足够长时间，对于为什么某些事情很慢有所了解，并且见过像 Cython、`numpy`和 PyPy 这样的技术被讨论为可能的解决方案。你可能还使用其他语言编程，因此知道解决性能问题的方法不止一种。

虽然本书主要面向 CPU 绑定问题的人群，我们也关注数据传输和内存绑定的解决方案。通常，这些问题会遇到科学家、工程师、量化分析师和学术界人士。

我们还会探讨 Web 开发人员可能面临的问题，包括数据传输和像 PyPy 这样的即时编译器（JIT），以及异步 I/O 以获取易胜利的性能提升。

如果您具备 C（或 C++，或者可能是 Java）的背景，则可能会有所帮助，但这并非必要条件。Python 最常见的解释器（CPython——通常在命令行中输入`python`后得到的标准解释器）是用 C 编写的，因此所有的钩子和库都暴露了内部的 C 机制。我们还介绍了许多不需要任何 C 知识的技术。

您可能还对 CPU、内存架构和数据总线有较低层次的了解，但同样，这并非绝对必要。

# 本书不适合谁

本书适用于中高级 Python 程序员。有动力的初学者 Python 程序员也许也能跟上，但我们建议具备扎实的 Python 基础。

我们不涵盖存储系统优化。如果您有 SQL 或 NoSQL 瓶颈问题，那么这本书可能不会对您有帮助。

# 你将会学到什么

你的作者们多年来在工业界和学术界一直在处理大量数据，这是 *我想更快得到答案！* 的需求和可扩展架构的必要性。我们将尽力将我们的艰辛经验传授给你，以免你犯我们犯过的错误。

在每章的开头，我们将列出以下文本应该回答的问题。（如果没有，请告诉我们，我们将在下一个修订版中进行修正！）

我们涵盖以下主题：

+   计算机背后的机器原理，让你了解幕后发生的一切

+   列表和元组——这些基础数据结构中微妙的语义和速度差异

+   字典和集合——这些重要数据结构中的内存分配策略和访问算法

+   迭代器——如何以更符合 Python 风格的方式编写，并利用迭代开启无限数据流的大门

+   纯 Python 方法——如何有效地使用 Python 及其模块

+   使用 `numpy` 的矩阵——如何像专家一样使用深受喜爱的 `numpy` 库

+   编译和即时计算——通过编译成机器码来加速处理，确保你根据分析结果来引导

+   并发性——高效移动数据的方式

+   `multiprocessing`——使用内置的 `multiprocessing` 库进行并行计算的各种方法，并有效地共享 `numpy` 矩阵，以及进程间通信（IPC）的一些成本和效益

+   集群计算——将你的 `multiprocessing` 代码转换为本地或远程集群上运行，适用于研究和生产系统

+   使用更少的 RAM——解决大问题的方法，而不是购买一台巨大的计算机

+   从实战中汲取的教训——从那些曾经吃过苦头的人身上学到的教训，让你不必再吃苦头

# Python 3

Python 3 自 2020 年起成为 Python 的标准版本，Python 2.7 经过 10 年的迁移过程已被废弃。如果你仍在使用 Python 2.7，那么你做错了——许多库已不再支持此版本，支持成本将随时间推移而增加。请为社区着想，迁移到 Python 3，并确保所有新项目使用 Python 3。

在本书中，我们使用 64 位 Python。虽然支持 32 位 Python，但在科学工作中并不常见。我们预期所有的库都能正常工作，但数值精度（取决于可用于计数的位数）可能会有所变化。64 位在这个领域占主导地位，通常与 *nix 环境（通常是 Linux 或 Mac）一起使用。64 位让你能够处理更大量的 RAM。*nix 让你构建可以以被理解的方式部署和配置的应用程序，具有被理解的行为。

如果你是 Windows 用户，你就得做好准备。我们展示的大部分内容都可以正常工作，但有些东西是特定于操作系统的，你需要研究 Windows 的解决方案。Windows 用户可能面临的最大困难是模块的安装：在 Stack Overflow 等网站上进行研究应该会给你提供所需的解决方案。如果你使用 Windows，在运行 Linux 安装的虚拟机（例如，使用 VirtualBox）上可以帮助你更自由地进行实验。

Windows 用户应该绝对考虑像 Anaconda、Canopy、Python(x,y) 或 Sage 这样的打包解决方案。这些相同的发行版也将使 Linux 和 Mac 用户的生活变得更加简单。

# 与 Python 2.7 的更改

如果你从 Python 2.7 升级过来，可能不知道一些相关的变化：

+   `/` 在 Python 2.7 中表示*整数*除法，而在 Python 3 中表示*浮点数*除法。

+   在 Python 2.7 中，`str` 和 `unicode` 用于表示文本数据；在 Python 3 中，一切都是 `str`，而这些始终是 Unicode。为了清晰起见，如果我们使用未编码的字节序列，将使用 `bytes` 类型。

如果您正在升级您的代码，两个很好的指南是[“将 Python 2 代码移植到 Python 3”](http://bit.ly/pyporting)和[“支持 Python 3：深入指南”](http://python3porting.com)。使用 Anaconda 或 Canopy 这样的发行版，您可以同时运行 Python 2 和 Python 3 —— 这将简化您的移植。

# 许可证

本书根据[知识共享署名-非商业性使用-禁止演绎 3.0](http://bit.ly/CC_A-NC-ND3)许可。

您可以自由使用本书进行非商业目的，包括非商业教学。许可证仅允许完整复制；对于部分复制，请联系 O’Reilly（请参阅“如何联系我们”）。请如下部分所示归属本书。

我们商定本书应具有知识共享许可，以便内容能够在全球传播。如果此决定对您有所帮助，我们会非常高兴收到一瓶啤酒。我们怀疑 O’Reilly 的工作人员对啤酒也会有类似的看法。

# 如何进行归属

根据知识共享许可证，您应该表明您使用了本书的一部分。表明只是指您应该写一些其他人可以遵循以找到本书的内容。以下方式是合理的：“《高性能 Python》，第二版，作者 Micha Gorelick 和 Ian Ozsvald（O’Reilly）。版权所有 2020 Micha Gorelick 和 Ian Ozsvald，978-1-492-05502-0。”

# 补记和反馈

我们鼓励您在像亚马逊这样的公共网站上审查本书，以帮助其他人了解他们是否会从本书中受益！您还可以通过邮件与我们联系 feedback@highperformancepython.com。

我们特别希望听到有关本书中错误的反馈、本书帮助您成功的使用案例以及应在下一版中覆盖的高性能技术。您可以访问本书的网页，地址为[*https://oreil.ly/high-performance-python-2e*](https://oreil.ly/high-performance-python-2e)。

投诉可以通过即时投诉传输服务 `> /dev/null` 进行欢迎。

# 本书使用的约定

本书中使用以下排版约定：

*斜体*

表示新术语、网址、电子邮件地址、文件名和文件扩展名。

`常量宽度`

用于程序列表，以及段落内引用程序元素如变量或函数名称、数据库、数据类型、环境变量、语句和关键字。

**`常量宽度粗体`**

显示用户应直接输入的命令或其他文本。

*`常量宽度斜体`*

显示应由用户提供值或由上下文确定值的文本。

###### 提示

此元素表示提示、建议或批判性思考问题。

###### 注意

此元素表示一般注释。

###### 警告

此元素表示警告或注意事项。

# 使用代码示例

补充材料（代码示例、练习等）可在[*https://github.com/mynameisfiber/high_performance_python_2e*](https://github.com/mynameisfiber/high_performance_python_2e)下载。

如果您有技术问题或使用代码示例时遇到问题，请发送电子邮件至*bookquestions@oreilly.com*。

本书旨在帮助您完成工作。通常情况下，如果本书提供了示例代码，您可以在自己的程序和文档中使用它。除非您要复制大量代码，否则无需联系我们寻求许可。例如，编写一个使用本书多个代码片段的程序不需要许可。出售或分发 O'Reilly 书籍中的示例需要许可。引用本书并引用示例代码回答问题不需要许可。将本书大量示例代码整合到产品文档中需要许可。

如果您认为您使用的代码示例超出了合理使用范围或上述授权，请随时通过*permissions@oreilly.com*联系我们。

# O’Reilly 在线学习

###### 注意

超过 40 年来，[*O’Reilly Media*](http://oreilly.com) 提供技术和商业培训、知识和见解，帮助公司取得成功。

我们独特的专家和创新者网络通过书籍、文章和我们的在线学习平台分享他们的知识和专业知识。奥莱利的在线学习平台让您随时访问现场培训课程、深入学习路径、交互式编码环境以及来自奥莱利和其他 200 多家出版商的大量文本和视频。更多信息，请访问[*http://oreilly.com*](http://oreilly.com)。

# 如何联系我们

请将有关本书的评论和问题寄给出版商：

+   奥莱利传媒公司

+   1005 Gravenstein Highway North

+   加利福尼亚州塞巴斯托波尔市，95472

+   800-998-9938（美国或加拿大境内）

+   707-829-0515（国际或本地）

+   707-829-0104（传真）

发送电子邮件至*bookquestions@oreilly.com*以评论或提问关于本书的技术问题。

欲了解更多有关我们书籍和课程的消息，请访问我们的网站[*http://oreilly.com*](http://oreilly.com)。

在 Facebook 上找到我们：[*http://facebook.com/oreilly*](http://facebook.com/oreilly)

在 Twitter 上关注我们：[*http://twitter.com/oreillymedia*](http://twitter.com/oreillymedia)

观看我们的 YouTube 频道：[*http://youtube.com/oreillymedia*](http://youtube.com/oreillymedia)

# 致谢

希拉里·梅森为我们的序言写了一篇感谢她为我们的书写了如此精彩的开场述评。吉尔斯·韦弗和迪米特里·德尼索诺克在本版本中提供了宝贵的技术反馈；干得好，伙计们。

感谢帕特里克·库珀、凯伦·戴尔、丹·福尔曼-麦基、卡尔文·吉尔斯、布莱恩·格兰杰、杰米·马修斯、约翰·蒙哥马利、克里斯蒂安·施奥·奥克斯维格、马特“蛇”雷弗森、巴尔萨扎·鲁伯洛尔、迈克尔·斯基尔潘、卢克·安德伍德、杰克·范德普拉斯和威廉·温特为宝贵的反馈和贡献。

伊恩感谢他的妻子艾米莉，让他又消失了八个月来写这第二版（幸运的是，她非常理解）。伊恩向他的狗道歉，因为他坐着写作，而不是像她希望的那样多在树林里散步。

米卡感谢玛丽安和他的其他朋友和家人，在他学会写作的过程中表现得如此耐心。

奥莱利的编辑们非常愉快地与他们合作；如果你想写自己的书，强烈考虑与他们交流。

我们在“实战经验教训”章节的贡献者非常友好地分享了他们的时间和艰辛经验。我们感谢索莱达德·加利、琳达·乌鲁丘尔图、瓦伦丁·哈内尔和文森特·D·瓦默达姆为这一版本作出的贡献，以及本·杰克逊、拉迪姆·雷胡雷克、塞巴斯蒂安·特雷普卡、亚历克斯·凯利、马尔科·塔西奇和安德鲁·戈德温在之前版本中的付出。
