<html><head></head><body><section data-pdf-bookmark="Chapter 14. Databases, Data Science, and a Little AI" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch14">&#13;
<h1><span class="label">Chapter 14. </span>Databases, Data Science, and a Little AI</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Preview" data-type="sect1"><div class="sect1" id="id133">&#13;
<h1>Preview</h1>&#13;
&#13;
<p><a data-primary="databases" data-type="indexterm" id="icd060"/>This chapter discusses how to use FastAPI to&#13;
store and retrieve data.&#13;
It expands on the simple SQLite examples of <a data-type="xref" href="ch10.html#ch10">Chapter 10</a> with the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Other open source databases (relational and not)</p>&#13;
</li>&#13;
<li>&#13;
<p>Higher-level uses of SQLAlchemy</p>&#13;
</li>&#13;
<li>&#13;
<p>Better error checking</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Data Storage Alternatives" data-type="sect1"><div class="sect1" id="id224">&#13;
<h1>Data Storage Alternatives</h1>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The term <em>database</em> is unfortunately used to refer&#13;
to three things:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>The server <em>type</em>, like PostgreSQL, SQLite, or MySQL</p>&#13;
</li>&#13;
<li>&#13;
<p>A running instance of that <em>server</em></p>&#13;
</li>&#13;
<li>&#13;
<p>A <em>collection of tables</em> on that server</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>To avoid <a data-primary="databases" data-secondary="confusing terminology" data-type="indexterm" id="id875"/>confusion—referring to an instance of the last bulleted item above as a&#13;
“PostgreSQL database database database”—I’ll attach other terms to indicate which one I mean.</p>&#13;
</div>&#13;
&#13;
<p>The usual backend for a website is a database.&#13;
Websites and databases are like peanut butter and jelly,&#13;
and although you could conceivably store your data&#13;
in other ways&#13;
(or pair peanut butter with pickles),&#13;
for this book we’ll stick with databases.</p>&#13;
&#13;
<p class="pagebreak-before">Databases handle many problems that you would otherwise have to&#13;
solve yourself with code, such as these:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Multiple access</p>&#13;
</li>&#13;
<li>&#13;
<p>Indexing</p>&#13;
</li>&#13;
<li>&#13;
<p>Data consistency</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>The general choices for databases are as follows:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Relational databases, with the SQL query language</p>&#13;
</li>&#13;
<li>&#13;
<p>Nonrelational databases, with various query languages</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Relational Databases and SQL" data-type="sect1"><div class="sect1" id="id134">&#13;
<h1>Relational Databases and SQL</h1>&#13;
&#13;
<p>Python<a data-primary="databases" data-secondary="relational databases" data-type="indexterm" id="icd061"/> has<a data-primary="relational databases" data-type="indexterm" id="icd062"/> a <a data-primary="SQL" data-type="indexterm" id="icd063"/>standard relational API definition&#13;
called <a href="https://oreil.ly/StbE4">DB-API</a>,&#13;
and it’s supported by Python driver packages&#13;
for all the major <a data-primary="ibm_db" data-type="indexterm" id="id876"/><a data-primary="pymssql" data-type="indexterm" id="id877"/><a data-primary="pyodbc" data-type="indexterm" id="id878"/><a data-primary="SQL Server" data-type="indexterm" id="id879"/><a data-primary="python-oracledb" data-type="indexterm" id="id880"/><a data-primary="Oracle" data-type="indexterm" id="id881"/><a data-primary="PyMySQL" data-type="indexterm" id="id882"/><a data-primary="MySQLdb" data-type="indexterm" id="id883"/><a data-primary="MySQL" data-type="indexterm" id="id884"/><a data-primary="psycopg2" data-type="indexterm" id="id885"/><a data-primary="PostgreSQL" data-type="indexterm" id="id886"/><a data-primary="sqlite3" data-type="indexterm" id="id887"/><a data-primary="asyncpg" data-type="indexterm" id="id888"/><a data-primary="SQLite" data-type="indexterm" id="id889"/><a data-primary="IBM Db2" data-type="indexterm" id="id890"/>databases. <a data-type="xref" href="#table1401">Table 14-1</a> lists some prominent relational databases and their main Python driver packages.</p>&#13;
<table id="table1401">&#13;
<caption><span class="label">Table 14-1. </span>Relational databases and Python drivers</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Database</th>&#13;
<th>Python drivers</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="fakeheader" colspan="2"><p>Open source</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><a href="https://www.sqlite.org">SQLite</a></p></td>&#13;
<td><p><a href="https://oreil.ly/TNNaA">sqlite3</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><a href="https://www.postgresql.org">PostgreSQL</a></p></td>&#13;
<td><p><a href="https://oreil.ly/nLn5x">psycopg2</a> and <a href="https://oreil.ly/90pvK">asyncpg</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><a href="https://www.mysql.com">MySQL</a></p></td>&#13;
<td><p><a href="https://oreil.ly/yn1fn">MySQLdb</a> and <a href="https://oreil.ly/Cmup-">PyMySQL</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="fakeheader" colspan="2"><p>Commercial</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><a href="https://www.oracle.com">Oracle</a></p></td>&#13;
<td><p><a href="https://oreil.ly/gynvX">python-oracledb</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><a href="https://www.microsoft.com/en-us/sql-server">SQL Server</a></p></td>&#13;
<td><p><a href="https://oreil.ly/_UEYq">pyodbc</a> and <a href="https://oreil.ly/FkKUn">pymssql</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><a href="https://www.ibm.com/products/db2">IBM Db2</a></p></td>&#13;
<td><p><a href="https://oreil.ly/3uwpD">ibm_db</a></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>The <a data-primary="Python" data-secondary="relational database and SQL packages" data-type="indexterm" id="icd072"/>main Python packages for relational databases and SQL are as follows:</p>&#13;
<dl>&#13;
<dt><a href="https://www.sqlalchemy.org">SQLAlchemy</a></dt>&#13;
<dd>&#13;
<p>A<a data-primary="relational databases" data-secondary="SQLAlchemy" data-type="indexterm" id="icd073"/> full-featured&#13;
library<a data-primary="SQLAlchemy" data-type="indexterm" id="icd064"/> that can be used at many levels</p>&#13;
</dd>&#13;
<dt><a href="https://sqlmodel.tiangolo.com">SQLModel</a></dt>&#13;
<dd>&#13;
<p><a data-primary="SQLModel" data-type="indexterm" id="id891"/>A combination of&#13;
SQLAlchemy and Pydantic, by the author of FastAPI</p>&#13;
</dd>&#13;
<dt><a href="https://github.com/kennethreitz/records">Records</a></dt>&#13;
<dd>&#13;
<p>From<a data-primary="Records package" data-type="indexterm" id="id892"/> the author&#13;
of the Requests package, a simple query API</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="SQLAlchemy" data-type="sect2"><div class="sect2" id="id315">&#13;
<h2>SQLAlchemy</h2>&#13;
&#13;
<p>The most popular Python SQL package is SQLAlchemy.&#13;
Although many explanations of SQLAlchemy discuss only its&#13;
ORM, it has multiple layers,&#13;
and I’ll discuss these bottom-up.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Core" data-type="sect3"><div class="sect3" id="id225">&#13;
<h3>Core</h3>&#13;
&#13;
<p>The <a data-primary="SQLAlchemy" data-secondary="Core" data-type="indexterm" id="id893"/>base of SQLAlchemy, called <em>Core</em>, comprises the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>An <code>Engine</code> object that implements the DB-API standard</p>&#13;
</li>&#13;
<li>&#13;
<p>URLs that express the SQL server type and driver,&#13;
and the specific database collection on that server</p>&#13;
</li>&#13;
<li>&#13;
<p>Client-server connection pools</p>&#13;
</li>&#13;
<li>&#13;
<p>Transactions (<code>COMMIT</code> and <code>ROLLBACK</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p>SQL <em>dialect</em> differences among various database types</p>&#13;
</li>&#13;
<li>&#13;
<p>Direct SQL (text string) queries</p>&#13;
</li>&#13;
<li>&#13;
<p>Queries in the SQLAlchemy Expression Language</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Some of these features, like the dialect handling,&#13;
make SQLAlchemy the package of choice for working with&#13;
various server types.&#13;
You can use it to execute plain DB-API SQL statements&#13;
or use the SQLAlchemy Expression Language.</p>&#13;
&#13;
<p>I’ve been using the raw DB-API SQLite driver so far&#13;
and will continue.&#13;
But for larger sites or those that might need to&#13;
take advantage of a special server feature,&#13;
SQLAlchemy (using basic DB-API, SQLAlchemy Expression Language,&#13;
or the full ORM)&#13;
is well worth using.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="SQLAlchemy Expression Language" data-type="sect3"><div class="sect3" id="id226">&#13;
<h3>SQLAlchemy Expression Language</h3>&#13;
&#13;
<p>The <a data-primary="SQLAlchemy" data-secondary="SQLAlchemy Expression Language" data-type="indexterm" id="icd065"/>SQLAlchemy Expression Language is <em>not</em> the ORM,&#13;
but another way of expressing queries against relational&#13;
tables.&#13;
It maps the underlying storage structures&#13;
to Python classes like <code>Table</code> and <code>Column</code>,&#13;
and operations to Python methods like&#13;
<code>select()</code> and <code>insert()</code>.&#13;
These functions translate to plain SQL strings,&#13;
and you can access them to see what happened.&#13;
The language is independent of SQL server types.&#13;
If you find SQL difficult,&#13;
this may be worth trying.</p>&#13;
&#13;
<p>Let’s compare a few examples.&#13;
<a data-type="xref" href="#ex-14-1">Example 14-1</a> shows the plain SQL version.</p>&#13;
<div data-type="example" id="ex-14-1">&#13;
<h5><span class="label">Example 14-1. </span>Straight SQL code for <code>get_one()</code> in <span class="plain">data/explorer.py</span></h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">get_one</code><code class="p">(</code><code class="n">name</code><code class="p">:</code> <code class="nb">str</code><code class="p">)</code> <code class="o">-&gt;</code> <code class="n">Explorer</code><code class="p">:</code>&#13;
    <code class="n">qry</code> <code class="o">=</code> <code class="s2">"select * from explorer where name=:name"</code>&#13;
    <code class="n">params</code> <code class="o">=</code> <code class="p">{</code><code class="s2">"name"</code><code class="p">:</code> <code class="n">name</code><code class="p">}</code>&#13;
    <code class="n">curs</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="n">qry</code><code class="p">,</code> <code class="n">params</code><code class="p">)</code>&#13;
    <code class="k">return</code> <code class="n">row_to_model</code><code class="p">(</code><code class="n">curs</code><code class="o">.</code><code class="n">fetchone</code><code class="p">())</code></pre></div>&#13;
&#13;
<p><a data-type="xref" href="#ex-14-2">Example 14-2</a> shows a partial&#13;
SQLAlchemy Expression Language equivalent&#13;
to set up the database,&#13;
build the table,&#13;
and perform the insertion.</p>&#13;
<div data-type="example" id="ex-14-2">&#13;
<h5><span class="label">Example 14-2. </span>SQLAlchemy Expression Language for <code>get_one()</code></h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">sqlalchemy</code> <code class="kn">import</code> <code class="n">Metadata</code><code class="p">,</code> <code class="n">Table</code><code class="p">,</code> <code class="n">Column</code><code class="p">,</code> <code class="n">Text</code>&#13;
<code class="kn">from</code> <code class="nn">sqlalchemy</code> <code class="kn">import</code> <code class="n">connect</code><code class="p">,</code> <code class="n">insert</code>&#13;
&#13;
<code class="n">conn</code> <code class="o">=</code> <code class="n">connect</code><code class="p">(</code><code class="s2">"sqlite:///cryptid.db"</code><code class="p">)</code>&#13;
<code class="n">meta</code> <code class="o">=</code> <code class="n">Metadata</code><code class="p">()</code>&#13;
<code class="n">explorer_table</code> <code class="o">=</code> <code class="n">Table</code><code class="p">(</code>&#13;
    <code class="s2">"explorer"</code><code class="p">,</code>&#13;
    <code class="n">meta</code><code class="p">,</code>&#13;
    <code class="n">Column</code><code class="p">(</code><code class="s2">"name"</code><code class="p">,</code> <code class="n">Text</code><code class="p">,</code> <code class="n">primary_key</code><code class="o">=</code><code class="kc">True</code><code class="p">),</code>&#13;
    <code class="n">Column</code><code class="p">(</code><code class="s2">"country"</code><code class="p">,</code> <code class="n">Text</code><code class="p">),</code>&#13;
    <code class="n">Column</code><code class="p">(</code><code class="s2">"description"</code><code class="p">,</code> <code class="n">Text</code><code class="p">),</code>&#13;
    <code class="p">)</code>&#13;
<code class="n">insert</code><code class="p">(</code><code class="n">explorer_table</code><code class="p">)</code><code class="o">.</code><code class="n">values</code><code class="p">(</code>&#13;
    <code class="n">name</code><code class="o">=</code><code class="s2">"Beau Buffette"</code><code class="p">,</code>&#13;
    <code class="n">country</code><code class="o">=</code><code class="s2">"US"</code><code class="p">,</code>&#13;
    <code class="n">description</code><code class="o">=</code><code class="s2">"..."</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>For more examples,&#13;
some alternative&#13;
<a href="https://oreil.ly/ZGCHv">documentation</a>&#13;
is a bit more readable than the official pages<a data-primary="SQLAlchemy" data-secondary="SQLAlchemy Expression Language" data-startref="icd065" data-type="indexterm" id="id894"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="ORM" data-type="sect3"><div class="sect3" id="id135">&#13;
<h3>ORM</h3>&#13;
&#13;
<p>An <a data-primary="SQLAlchemy" data-secondary="ORM" data-type="indexterm" id="id895"/>ORM <a data-primary="ORM (object-relational mapper)" data-type="indexterm" id="id896"/>expresses queries in terms of domain data models,&#13;
not the relational tables and SQL logic at the base of the&#13;
database machinery.&#13;
The official&#13;
<a href="https://oreil.ly/x4DCi">documentation</a>&#13;
goes into all the details.&#13;
The ORM is much more complex than the&#13;
SQL expression language.&#13;
Developers who prefer fully <em>object-oriented</em> patterns&#13;
usually prefer ORMs.</p>&#13;
&#13;
<p>Many books and articles on FastAPI jump right into&#13;
SQLAlchemy’s ORM when they come to the database section.&#13;
I understand the appeal&#13;
but also know that it requires you to learn another abstraction.&#13;
SQLAlchemy is an excellent package,&#13;
but if its abstractions don’t always hold,&#13;
then you have two problems.&#13;
The simplest solution may be to just use SQL,&#13;
and move to the Expression Language or ORM&#13;
if the SQL gets too <a data-primary="SQLAlchemy" data-startref="icd064" data-type="indexterm" id="id897"/>hairy<a data-primary="relational databases" data-secondary="SQLAlchemy" data-startref="icd073" data-type="indexterm" id="id898"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="SQLModel" data-type="sect2"><div class="sect2" id="id136">&#13;
<h2>SQLModel</h2>&#13;
&#13;
<p>The <a data-primary="SQLModel" data-type="indexterm" id="id899"/>author <a data-primary="relational databases" data-secondary="SQLModel" data-type="indexterm" id="id900"/>of FastAPI combined aspects of FastAPI,&#13;
Pydantic,&#13;
and SQLAlchemy to&#13;
make&#13;
<a href="https://sqlmodel.tiangolo.com">SQLModel</a>.&#13;
It repurposes some development techniques from&#13;
the web world to&#13;
relational databases.&#13;
SQLModel matches SQLAlchemy’s ORM&#13;
with Pydantic’s data definition and validation.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="SQLite" data-type="sect2"><div class="sect2" id="id137">&#13;
<h2>SQLite</h2>&#13;
&#13;
<p>I <a data-primary="SQLite" data-type="indexterm" id="id901"/>introduced<a data-primary="relational databases" data-secondary="SQLite" data-type="indexterm" id="id902"/> SQLite in <a data-type="xref" href="ch10.html#ch10">Chapter 10</a>,&#13;
using it for the Data layer examples.&#13;
It’s public domain—you can’t get more open sourcey than that.&#13;
SQLite is used in every browser and every smartphone,&#13;
making it one of the most widely deployed software packages&#13;
in the world.&#13;
It’s often overlooked when choosing a relational database,&#13;
but it’s possible that multiple SQLite “servers”&#13;
could support some large services as well as a beefy&#13;
server like PostgreSQL.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="PostgreSQL" data-type="sect2"><div class="sect2" id="id138">&#13;
<h2>PostgreSQL</h2>&#13;
&#13;
<p>In <a data-primary="PostgreSQL" data-type="indexterm" id="id903"/>the <a data-primary="relational databases" data-secondary="PostgreSQL" data-type="indexterm" id="id904"/>early days of relational databases,&#13;
IBM’s System R was the pioneer,&#13;
and&#13;
offshoots battled for the new market—mainly open source&#13;
Ingres&#13;
versus commercial&#13;
Oracle.&#13;
Ingres featured a query language named QUEL,&#13;
and System R had SQL.&#13;
Although QUEL was considered better than SQL by some,&#13;
Oracle’s adoption of SQL as a standard,&#13;
plus IBM’s influence,&#13;
helped push Oracle and SQL to success.</p>&#13;
&#13;
<p>Years later, Michael Stonebraker<a data-primary="Stonebraker, Michael" data-type="indexterm" id="id905"/> returned to migrate&#13;
Ingres to&#13;
<a href="https://www.postgresql.org">PostgreSQL</a>.&#13;
Nowadays, open source developers tend to choose PostgreSQL,&#13;
although MySQL was popular a few years ago and is still around.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="EdgeDB" data-type="sect2"><div class="sect2" id="id139">&#13;
<h2>EdgeDB</h2>&#13;
&#13;
<p>Despite <a data-primary="EdgeDB" data-type="indexterm" id="id906"/>the<a data-primary="relational databases" data-secondary="EdgeDB" data-type="indexterm" id="id907"/> success of SQL over the years,&#13;
it does have some design flaws that make queries awkward.&#13;
Unlike the mathematical theory that SQL is based on (<em>relational calculus</em> by E. F. Codd),&#13;
the SQL language design itself is not <em>composable</em>.&#13;
Mainly, this means that it’s hard to nest queries within&#13;
larger ones,&#13;
leading to more complex and verbose code.</p>&#13;
&#13;
<p>So, just for fun, I’m throwing in a new relational database here.&#13;
<a href="https://www.edgedb.com">EdgeDB</a>&#13;
was written (in Python!) by the author of Python’s asyncio.&#13;
It’s described as&#13;
<em>Post-SQL</em> or <em>graph-relational</em>.&#13;
Under the hood,&#13;
it uses PostgreSQL to handle the tough system stuff.&#13;
Edge’s contribution is&#13;
<a href="https://oreil.ly/sdK4J">EdgeQL</a>:&#13;
a <a data-primary="EdgeQL" data-type="indexterm" id="id908"/>new query language&#13;
that aims to avoid those sharp SQL edges;&#13;
it’s actually translated to SQL for PostgreSQL to execute.&#13;
<a href="https://oreil.ly/ciNfg">“My Experience with EdgeDB” by Ivan Daniluk</a> handily compares EdgeQL and SQL.&#13;
The readable illustrated&#13;
<a href="https://oreil.ly/ce6y3">official documentation</a>&#13;
parallels the book <em>Dracula</em>.</p>&#13;
&#13;
<p>Could EdgeQL spread beyond EdgeDB and become an alternative to <a data-primary="Python" data-secondary="relational database and SQL packages" data-startref="icd072" data-type="indexterm" id="id909"/>SQL?&#13;
Time<a data-primary="SQL" data-startref="icd063" data-type="indexterm" id="id910"/> will <a data-primary="relational databases" data-startref="icd062" data-type="indexterm" id="id911"/>tell<a data-primary="databases" data-secondary="relational databases" data-startref="icd061" data-type="indexterm" id="id912"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before less_space" data-pdf-bookmark="Nonrelational (NoSQL) Databases" data-type="sect1"><div class="sect1" id="id140">&#13;
<h1>Nonrelational (NoSQL) Databases</h1>&#13;
&#13;
<p>Biggies<a data-primary="databases" data-secondary="NoSQL databases" data-type="indexterm" id="icd067"/> in<a data-primary="NoSQL (nonrelational) databases" data-type="indexterm" id="icd068"/> the open source NoSQL or <a data-primary="NewSQL" data-type="indexterm" id="id913"/>NewSQL world are listed in <a data-type="xref" href="#table1402">Table 14-2</a>.</p>&#13;
<table id="table1402">&#13;
<caption><span class="label">Table 14-2. </span>NoSQL databases and Python drivers</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Database</th>&#13;
<th>Python<a data-primary="Python" data-secondary="NoSQL database drivers" data-type="indexterm" id="icd074"/> drivers</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><a href="https://redis.io">Redis</a></p></td>&#13;
<td><p><a href="https://github.com/redis/redis-py">redis-py</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><a href="https://www.mongodb.com">MongoDB</a></p></td>&#13;
<td><p><a href="https://pymongo.readthedocs.io">PyMongo</a>, <a href="https://oreil.ly/Cmgtl">Motor</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><a href="https://cassandra.apache.org">Apache Cassandra</a></p></td>&#13;
<td><p><a href="https://github.com/datastax/python-driver">DataStax Driver for Apache Cassandra</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><a href="https://www.elastic.co/elasticsearch">Elasticsearch</a></p></td>&#13;
<td><p><a href="https://oreil.ly/e_bDI">Python Elasticsearch Client</a></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>Sometimes <em>NoSQL</em> means literally <em>no SQL</em>,&#13;
but sometimes <em>not only SQL</em>.&#13;
Relational databases enforce structures on data,&#13;
often visualized as rectangular tables&#13;
with column fields and data rows,&#13;
similar to spreadsheets.&#13;
To reduce redundancy and improve performance,&#13;
relational databases are <em>normalized</em> with <em>normal forms</em> (rules for data and structures), such as allowing only a single value per cell (row/column intersection).</p>&#13;
&#13;
<p>NoSQL databases relax these rules,&#13;
sometimes allowing varying column/field types&#13;
across individual data rows.&#13;
Often the <em>schemas</em> (database designs) can be ragged structures,&#13;
as you could express in JSON or Python,&#13;
rather than relational boxes.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Redis" data-type="sect2"><div class="sect2" id="id141">&#13;
<h2>Redis</h2>&#13;
&#13;
<p><em>Redis</em> <a data-primary="NoSQL (nonrelational) databases" data-secondary="Redis" data-type="indexterm" id="id914"/>is<a data-primary="Redis" data-type="indexterm" id="id915"/> a data structure server that&#13;
runs completely in memory,&#13;
although it can save to and restore from disk.&#13;
It closely matches Python’s own data structures&#13;
and has become extremely popular.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="MongoDB" data-type="sect2"><div class="sect2" id="id142">&#13;
<h2>MongoDB</h2>&#13;
&#13;
<p><em>MongoDB</em> <a data-primary="NoSQL (nonrelational) databases" data-secondary="MongoDB" data-type="indexterm" id="id916"/>is <a data-primary="MongoDB" data-type="indexterm" id="id917"/>sort of the PostgreSQL of NoSQL servers.&#13;
A <em>collection</em> is the equivalent of a SQL table,&#13;
and a <em>document</em> is the equivalent of a SQL table row.&#13;
Another difference, and the main reason for a NoSQL database&#13;
in the first place,&#13;
is that you don’t need to define what a document looks like.&#13;
In other words, there’s no fixed <em>schema</em>.&#13;
A document is like a Python dictionary, with any string as a key.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Cassandra" data-type="sect2"><div class="sect2" id="id143">&#13;
<h2>Cassandra</h2>&#13;
&#13;
<p>Cassandra <a data-primary="NoSQL (nonrelational) databases" data-secondary="Cassandra" data-type="indexterm" id="id918"/>is<a data-primary="Cassandra" data-type="indexterm" id="id919"/> a large-scale database that can be distributed across hundreds of nodes. It’s written in Java.</p>&#13;
&#13;
<p>An alternative database called <a href="https://www.scylladb.com">ScyllaDB</a> is written in C++ and claims to be compatible with Cassandra but more performant.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Elasticsearch" data-type="sect2"><div class="sect2" id="id144">&#13;
<h2>Elasticsearch</h2>&#13;
&#13;
<p><a href="https://www.elastic.co/elasticsearch">Elasticsearch</a> <a data-primary="NoSQL (nonrelational) databases" data-secondary="Elasticsearch" data-type="indexterm" id="id920"/>is <a data-primary="Elasticsearch" data-type="indexterm" id="id921"/>more like a database index than a database itself. It’s often used for <a data-primary="Python" data-secondary="NoSQL database drivers" data-startref="icd074" data-type="indexterm" id="id922"/>full-text<a data-primary="NoSQL (nonrelational) databases" data-startref="icd068" data-type="indexterm" id="id923"/> search<a data-primary="databases" data-secondary="NoSQL databases" data-startref="icd067" data-type="indexterm" id="id924"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="NoSQL Features in SQL Databases" data-type="sect1"><div class="sect1" id="id145">&#13;
<h1>NoSQL Features in SQL Databases</h1>&#13;
&#13;
<p>As <a data-primary="databases" data-secondary="NoSQL features in relational databases" data-type="indexterm" id="id925"/>noted<a data-primary="relational databases" data-secondary="NoSQL features in" data-type="indexterm" id="id926"/> previously, relational databases were traditionally normalized—constrained to follow different levels of rules&#13;
called<a data-primary="normal forms" data-type="indexterm" id="id927"/> <em>normal forms</em>.&#13;
One basic rule was that&#13;
the value in each cell (row-column intersection)&#13;
had to be a <em>scalar</em> (no arrays or&#13;
other structures).</p>&#13;
&#13;
<p>NoSQL (or <em>document</em>) databases supported JSON directly&#13;
and were&#13;
usually your only choice if you had “uneven” or “ragged”&#13;
data structures.&#13;
They were often <em>denormalized</em>: all the data needed for&#13;
a document was included with that document.&#13;
In SQL, you often needed to <em>join</em> across tables to build&#13;
a full document.</p>&#13;
&#13;
<p>However, recent revisions of the <a data-primary="SQL" data-type="indexterm" id="id928"/>SQL <a data-primary="JSON (JavaScript Object Notation)" data-secondary="SQL and" data-type="indexterm" id="id929"/>standard have allowed&#13;
JSON data to be stored in relational databases also.&#13;
Some relational databases now let you store complex (nonscalar)&#13;
data in table cells, and even search and index within them.&#13;
JSON functions are supported in various ways for&#13;
<a href="https://oreil.ly/h_FNn">SQLite</a>,&#13;
<a href="https://oreil.ly/awYrc">PostgreSQL</a>,&#13;
<a href="https://oreil.ly/OA_sT">MySQL</a>,&#13;
<a href="https://oreil.ly/osOYk">Oracle</a>,&#13;
and <span class="keep-together">others</span>.</p>&#13;
&#13;
<p>SQL with JSON can be the best of both worlds.&#13;
SQL databases have been around much longer&#13;
and have really useful features&#13;
such as foreign keys and secondary indexes.&#13;
Also, SQL is fairly standardized up to a point,&#13;
and NoSQL query languages are all different.</p>&#13;
&#13;
<p>Finally, new data design and query languages are trying to combine SQL and NoSQL advantages,&#13;
like EdgeQL that I mentioned earlier.</p>&#13;
&#13;
<p>So, if you can’t fit your data into the rectangular relational box,&#13;
look at a NoSQL database, a relational database with JSON support,&#13;
or a “Post-SQL” database.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Database Load Testing" data-type="sect1"><div class="sect1" id="id146">&#13;
<h1>Database Load Testing</h1>&#13;
&#13;
<p>This <a data-primary="databases" data-secondary="load testing" data-type="indexterm" id="icd069"/>book<a data-primary="load testing" data-type="indexterm" id="icd070"/> is mainly about FastAPI,&#13;
but websites are so frequently tied to databases.</p>&#13;
&#13;
<p>The data examples in this book have been tiny.&#13;
To really stress-test a database, millions of items would be great.&#13;
Rather than think of things to add, it’s easier use a Python package like&#13;
<a href="https://faker.readthedocs.io">Faker</a><a data-primary="Faker" data-type="indexterm" id="id930"/>.&#13;
Faker can generate many kinds of data quickly—names,&#13;
places, or special types that you define.</p>&#13;
&#13;
<p>In <a data-type="xref" href="#ex-14-3">Example 14-3</a>,&#13;
Faker pumps out names and countries,&#13;
which are then loaded by <code>load()</code> into SQLite.</p>&#13;
<div data-type="example" id="ex-14-3">&#13;
<h5><span class="label">Example 14-3. </span>Load fake explorers in <span class="plain">test_load.py</span></h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">faker</code> <code class="kn">import</code> <code class="n">Faker</code>&#13;
<code class="kn">from</code> <code class="nn">time</code> <code class="kn">import</code> <code class="n">perf_counter</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">load</code><code class="p">():</code>&#13;
    <code class="kn">from</code> <code class="nn">error</code> <code class="kn">import</code> <code class="n">Duplicate</code>&#13;
    <code class="kn">from</code> <code class="nn">data.explorer</code> <code class="kn">import</code> <code class="n">create</code>&#13;
    <code class="kn">from</code> <code class="nn">model.explorer</code> <code class="kn">import</code> <code class="n">Explorer</code>&#13;
&#13;
    <code class="n">f</code> <code class="o">=</code> <code class="n">Faker</code><code class="p">()</code>&#13;
    <code class="n">NUM</code> <code class="o">=</code> <code class="mi">100_000</code>&#13;
    <code class="n">t1</code> <code class="o">=</code> <code class="n">perf_counter</code><code class="p">()</code>&#13;
    <code class="k">for</code> <code class="n">row</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="n">NUM</code><code class="p">):</code>&#13;
        <code class="k">try</code><code class="p">:</code>&#13;
            <code class="n">create</code><code class="p">(</code><code class="n">Explorer</code><code class="p">(</code><code class="n">name</code><code class="o">=</code><code class="n">f</code><code class="o">.</code><code class="n">name</code><code class="p">(),</code>&#13;
                <code class="n">country</code><code class="o">=</code><code class="n">f</code><code class="o">.</code><code class="n">country</code><code class="p">(),</code>&#13;
                <code class="n">description</code><code class="o">=</code><code class="n">f</code><code class="o">.</code><code class="n">description</code><code class="p">))</code>&#13;
        <code class="k">except</code> <code class="n">Duplicate</code><code class="p">:</code>&#13;
            <code class="k">pass</code>&#13;
    <code class="n">t2</code> <code class="o">=</code> <code class="n">perf_counter</code><code class="p">()</code>&#13;
    <code class="nb">print</code><code class="p">(</code><code class="n">NUM</code><code class="p">,</code> <code class="s2">"rows"</code><code class="p">)</code>&#13;
    <code class="nb">print</code><code class="p">(</code><code class="s2">"write time:"</code><code class="p">,</code> <code class="n">t2</code><code class="o">-</code><code class="n">t1</code><code class="p">)</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">read_db</code><code class="p">():</code>&#13;
    <code class="kn">from</code> <code class="nn">data.explorer</code> <code class="kn">import</code> <code class="n">get_all</code>&#13;
&#13;
    <code class="n">t1</code> <code class="o">=</code> <code class="n">perf_counter</code><code class="p">()</code>&#13;
    <code class="n">_</code> <code class="o">=</code> <code class="n">get_all</code><code class="p">()</code>&#13;
    <code class="n">t2</code> <code class="o">=</code> <code class="n">perf_counter</code><code class="p">()</code>&#13;
    <code class="nb">print</code><code class="p">(</code><code class="s2">"db read time:"</code><code class="p">,</code> <code class="n">t2</code><code class="o">-</code><code class="n">t1</code><code class="p">)</code>&#13;
&#13;
<code class="k">def</code> <code class="nf">read_api</code><code class="p">():</code>&#13;
    <code class="kn">from</code> <code class="nn">fastapi.testclient</code> <code class="kn">import</code> <code class="n">TestClient</code>&#13;
    <code class="kn">from</code> <code class="nn">main</code> <code class="kn">import</code> <code class="n">app</code>&#13;
&#13;
    <code class="n">t1</code> <code class="o">=</code> <code class="n">perf_counter</code><code class="p">()</code>&#13;
    <code class="n">client</code> <code class="o">=</code> <code class="n">TestClient</code><code class="p">(</code><code class="n">app</code><code class="p">)</code>&#13;
    <code class="n">_</code> <code class="o">=</code> <code class="n">client</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s2">"/explorer/"</code><code class="p">)</code>&#13;
    <code class="n">t2</code> <code class="o">=</code> <code class="n">perf_counter</code><code class="p">()</code>&#13;
    <code class="nb">print</code><code class="p">(</code><code class="s2">"api read time:"</code><code class="p">,</code> <code class="n">t2</code><code class="o">-</code><code class="n">t1</code><code class="p">)</code>&#13;
&#13;
<code class="n">load</code><code class="p">()</code>&#13;
<code class="n">read_db</code><code class="p">()</code>&#13;
<code class="n">read_db</code><code class="p">()</code>&#13;
<code class="n">read_api</code><code class="p">()</code></pre></div>&#13;
&#13;
<p>You’re catching the <code>Duplicate</code> exception in <code>load()</code> and ignoring it,&#13;
because Faker generates names from a limited list and is likely&#13;
to repeat one now and then.&#13;
So the result may be less than 100,000 explorers loaded.</p>&#13;
&#13;
<p>Also, you’re calling <code>read_db()</code> twice, to remove any startup&#13;
time as SQLite does the query.&#13;
Then <code>read_api()</code> timing should be fair.&#13;
<a data-type="xref" href="#ex-14-4">Example 14-4</a> fires it up.</p>&#13;
<div data-type="example" id="ex-14-4">&#13;
<h5><span class="label">Example 14-4. </span>Test database query performance</h5>&#13;
&#13;
<pre data-type="programlisting">$ <strong>python test_load.py</strong>&#13;
100000 rows&#13;
write time: 14.868232927983627&#13;
db read time: 0.4025074450764805&#13;
db read time: 0.39750714192632586&#13;
api read time: 2.597553930943832</pre></div>&#13;
&#13;
<p>The API read time for all explorers was much slower than the&#13;
Data layer’s read time.&#13;
Some of this is probably overhead from FastAPI’s conversion of&#13;
the response to JSON.&#13;
Also, the initial write time to the database wasn’t very zippy.&#13;
It wrote one explorer at a time, because&#13;
the Data layer API has a single <code>create()</code> function, but not&#13;
a <code>create_many()</code>; on the read side,&#13;
the API can return one (<code>get_one()</code>) or all (<code>get_all()</code>).&#13;
So, if you ever want to do bulk loading,&#13;
it might be good to add a new Data load function&#13;
and a new Web endpoint&#13;
(with restricted authorization).</p>&#13;
&#13;
<p>Also, if you expect any table in your database to&#13;
grow to 100,000 rows, maybe you shouldn’t allow random&#13;
users to get all of them in one API call.&#13;
Pagination would be useful,&#13;
or a way to download a single CSV file from the <a data-primary="load testing" data-startref="icd070" data-type="indexterm" id="id931"/>table<a data-primary="databases" data-secondary="load testing" data-startref="icd069" data-type="indexterm" id="id932"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Data Science and AI" data-type="sect1"><div class="sect1" id="id147">&#13;
<h1>Data Science and AI</h1>&#13;
&#13;
<p>Python<a data-primary="AI (artificial intelligence)" data-type="indexterm" id="icd071"/> has<a data-primary="data science" data-type="indexterm" id="icd075"/> become the most prominent language in&#13;
data science in general, and machine learning in particular.&#13;
So much data massaging is needed, and Python is good at that.</p>&#13;
&#13;
<p>Sometimes&#13;
<a data-primary="AI (artificial intelligence)" data-secondary="external tools" data-type="indexterm" id="id933"/>developers have used&#13;
<a href="https://oreil.ly/WFHo9">external tools</a>&#13;
like&#13;
<a data-primary="pandas" data-type="indexterm" id="id934"/>pandas to do the data manipulation that’s too tricky in SQL.</p>&#13;
&#13;
<p><a href="https://pytorch.org">PyTorch</a><a data-primary="PyTorch" data-type="indexterm" id="id935"/>&#13;
is one of the most popular ML tools,&#13;
because it leverages Python’s strengths in&#13;
data manipulation.&#13;
The underlying computations may be in C or C++ for speed,&#13;
but Python or Go are well-suited for the “higher”&#13;
data-integration tasks.&#13;
(The&#13;
<a href="https://www.modular.com/mojo">Mojo</a><a data-primary="Mojo" data-type="indexterm" id="id936"/>&#13;
language,&#13;
a superset of Python,&#13;
may handle both the high and low ends&#13;
if it succeeds as planned.&#13;
Although a general-purpose language,&#13;
it specifically addresses some of the current&#13;
complexity in AI development.)</p>&#13;
&#13;
<p>A new Python tool called&#13;
<a href="https://www.trychroma.com">Chroma</a><a data-primary="Chroma" data-type="indexterm" id="id937"/>&#13;
is a database, similar to SQLite,&#13;
but tailored to machine learning,&#13;
specifically large language models (LLMs).&#13;
Read the&#13;
<a href="https://oreil.ly/W59nn">Getting Started page</a> to,&#13;
you know,&#13;
get started.</p>&#13;
&#13;
<p>Although AI development is complex and moving fast,&#13;
you can try out some AI with Python on your own machine without&#13;
spending the megabucks that were behind GPT-4 and ChatGPT.&#13;
Let’s build a small FastAPI web interface to a small AI model.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><em>Model</em> has different meanings in AI and Pydantic/FastAPI. In Pydantic, a model is a Python class that bundles related data fields. <a data-primary="AI (artificial intelligence)" data-secondary="models" data-type="indexterm" id="id938"/>AI models cover a broad range of techniques for determining patterns in data.</p>&#13;
</div>&#13;
&#13;
<p><a href="https://huggingface.co">Hugging Face</a><a data-primary="Hugging Face" data-type="indexterm" id="id939"/>&#13;
provides free AI models, datasets, and Python code to use&#13;
them.&#13;
First, install PyTorch and Hugging Face code:</p>&#13;
&#13;
<pre data-type="programlisting">$ <strong>pip install torch torchvision</strong>&#13;
$ <strong>pip install transformers</strong></pre>&#13;
&#13;
<p><a data-type="xref" href="#ex-14-5">Example 14-5</a>&#13;
shows a FastAPI application&#13;
that uses Hugging Face’s transformers module&#13;
to access a pretrained&#13;
mid-sized open source machine language model&#13;
and try to answer your prompts.&#13;
(This was adapted from a command-line example&#13;
on the YouTube channel&#13;
CodeToTheMoon.)</p>&#13;
<div data-type="example" id="ex-14-5">&#13;
<h5><span class="label">Example 14-5. </span>Top-level LLM test (<span class="plain">ai.py</span>)</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">fastapi</code> <code class="kn">import</code> <code class="n">FastAPI</code>&#13;
&#13;
<code class="n">app</code> <code class="o">=</code> <code class="n">FastAPI</code><code class="p">()</code>&#13;
&#13;
<code class="kn">from</code> <code class="nn">transformers</code> <code class="kn">import</code> <code class="p">(</code><code class="n">AutoTokenizer</code><code class="p">,</code>&#13;
    <code class="n">AutoModelForSeq2SeqLM</code><code class="p">,</code> <code class="n">GenerationConfig</code><code class="p">)</code>&#13;
<code class="n">model_name</code> <code class="o">=</code> <code class="s2">"google/flan-t5-base"</code>&#13;
<code class="n">tokenizer</code> <code class="o">=</code> <code class="n">AutoTokenizer</code><code class="o">.</code><code class="n">from_pretrained</code><code class="p">(</code><code class="n">model_name</code><code class="p">)</code>&#13;
<code class="n">model</code> <code class="o">=</code> <code class="n">AutoModelForSeq2SeqLM</code><code class="o">.</code><code class="n">from_pretrained</code><code class="p">(</code><code class="n">model_name</code><code class="p">)</code>&#13;
<code class="n">config</code> <code class="o">=</code> <code class="n">GenerationConfig</code><code class="p">(</code><code class="n">max_new_tokens</code><code class="o">=</code><code class="mi">200</code><code class="p">)</code>&#13;
&#13;
<code class="nd">@app</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s2">"/ai"</code><code class="p">)</code>&#13;
<code class="k">def</code> <code class="nf">prompt</code><code class="p">(</code><code class="n">line</code><code class="p">:</code> <code class="nb">str</code><code class="p">)</code> <code class="o">-&gt;</code> <code class="nb">str</code><code class="p">:</code>&#13;
    <code class="n">tokens</code> <code class="o">=</code> <code class="n">tokenizer</code><code class="p">(</code><code class="n">line</code><code class="p">,</code> <code class="n">return_tensors</code><code class="o">=</code><code class="s2">"pt"</code><code class="p">)</code>&#13;
    <code class="n">outputs</code> <code class="o">=</code> <code class="n">model</code><code class="o">.</code><code class="n">generate</code><code class="p">(</code><code class="o">**</code><code class="n">tokens</code><code class="p">,</code>&#13;
        <code class="n">generator_config</code><code class="o">=</code><code class="n">config</code><code class="p">)</code>&#13;
    <code class="n">result</code> <code class="o">=</code> <code class="n">tokenizer</code><code class="o">.</code><code class="n">batch_decode</code><code class="p">(</code><code class="n">outputs</code><code class="p">,</code>&#13;
        <code class="n">skip_special_tokens</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code>&#13;
    <code class="k">return</code> <code class="n">result</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code></pre></div>&#13;
&#13;
<p>Run this with <code>uvicorn ai:app</code> (as always,&#13;
first make sure you don’t&#13;
have another web server still running on <code>localhost</code>, port <code>8000</code>).&#13;
Feed the <em>/ai</em> endpoint questions and get answers, like this&#13;
(note the double <code>==</code> for an HTTPie query parameter):</p>&#13;
&#13;
<pre data-type="programlisting">$ <strong>http -b localhost:8000/ai line=="What are you?"</strong>&#13;
"a sailor"</pre>&#13;
&#13;
<p>This is a fairly small model, and as you can see,&#13;
it doesn’t answer questions&#13;
especially well.&#13;
I tried other prompts&#13;
(<code>line</code> arguments)&#13;
and got equally noteworthy answers:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Q: Are cats better than dogs?</p>&#13;
</li>&#13;
<li>&#13;
<p>A: No</p>&#13;
</li>&#13;
<li>&#13;
<p>Q: What does bigfoot eat for breakfast?</p>&#13;
</li>&#13;
<li>&#13;
<p>A: A squid</p>&#13;
</li>&#13;
<li>&#13;
<p>Q: Who comes down the chimney?</p>&#13;
</li>&#13;
<li>&#13;
<p>A: A squealing pig</p>&#13;
</li>&#13;
<li>&#13;
<p>Q: What group was John Cleese in?</p>&#13;
</li>&#13;
<li>&#13;
<p>A: The Beatles</p>&#13;
</li>&#13;
<li>&#13;
<p>Q: What has nasty pointy teeth?</p>&#13;
</li>&#13;
<li>&#13;
<p>A: A teddy bear</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>These questions may get different answers at different times!&#13;
Once the same endpoint said that Bigfoot eats sand for breakfast.&#13;
In AI-speak, answers like this are called <a data-primary="AI (artificial intelligence)" data-secondary="hallucinations" data-type="indexterm" id="id940"/><em>hallucinations</em>.&#13;
You can get better answers by using a larger model, like&#13;
<code>google/flan-75-xl</code>, but it will take longer to download&#13;
model data and respond on a personal computer.&#13;
And of course, models like <a data-primary="ChatGPT" data-type="indexterm" id="id941"/>ChatGPT were trained on all&#13;
the data they could find&#13;
(using every CPU, GPU, TPU, and any other kind of PU),&#13;
and will give excellent <a data-primary="data science" data-startref="icd075" data-type="indexterm" id="id942"/>answers<a data-primary="AI (artificial intelligence)" data-startref="icd071" data-type="indexterm" id="id943"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Review" data-type="sect1"><div class="sect1" id="id148">&#13;
<h1>Review</h1>&#13;
&#13;
<p>This chapter expanded on the use of SQLite we went over in <a data-type="xref" href="ch10.html#ch10">Chapter 10</a>&#13;
to other SQL databases, and even NoSQL ones.&#13;
It also showed how some SQL databases can do NoSQL tricks&#13;
with JSON support.&#13;
Finally, it talked about the uses of database and special data&#13;
tools that have become more important as machine learning&#13;
continues its explosive growth<a data-primary="databases" data-startref="icd060" data-type="indexterm" id="id944"/>.</p>&#13;
</div></section>&#13;
</div></section></body></html>